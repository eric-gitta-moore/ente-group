(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5125],{32774:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/change-password",function(){return r(68341)}])},68341:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return g}});var a=r(52903),n=r(50193),i=r(6372),o=r(34360),s=r(19764),c=r(39596),l=r(22969),u=r(8033),d=r(91430),p=r(60108),f=r(22063),w=r(63462),m=r(83446),y=r(38045),h=r(25683),Z=r(50267),S=r(1799),v=r(24991),E=r(5632),P=r(2784),R=r(12595),b=()=>{var t,e,r;let[b,A]=(0,P.useState)(),[g,T]=(0,P.useState)(),_=(0,E.useRouter)();(0,P.useEffect)(()=>{let t=(0,h.Yu)(h.Pd.USER);T(t),(null==t?void 0:t.token)?A(t.token):((0,R.M8)(o.q.CHANGE_PASSWORD),_.push("/"))},[]);let x=async(t,e)=>{let r;let a=await (0,l.Lb)(),i=await (0,S.G)(),o=(0,h.Yu)(h.Pd.KEY_ATTRIBUTES),d=await a.generateSaltToDeriveKey();try{r=await a.deriveSensitiveKey(t,d)}catch(t){e("confirm",(0,v.t)("PASSWORD_GENERATION_FAILED"));return}let p=await a.encryptToB64(i,r.key),f={kekSalt:d,encryptedKey:p.encryptedData,keyDecryptionNonce:p.nonce,opsLimit:r.opsLimit,memLimit:r.memLimit},w=await (0,y.uA)(r.key),{srpUserID:m,srpSalt:E,srpVerifier:P}=await (0,s.a4)(w),R=await (0,s.u1)(E,m,w),A=(0,c.HC)(R.computeA()),{setupID:T,srpB:_}=await (0,n.zx)((0,u.zx)(b),{srpUserID:m,srpSalt:E,srpVerifier:P,srpA:A});R.setB((0,c.GS)(_));let x=(0,c.HC)(R.computeM1());if(await (0,n.$Q)((0,u.zx)(b),{setupID:T,srpM1:x,updatedKeyAttr:f}),null==g?void 0:g.email){let t=await (0,n.O3)(g.email);t&&(0,h.a_)(h.Pd.SRP_ATTRIBUTES,t)}let O=Object.assign(o,f);await (0,y.iv)(t,O,i),await (0,y.CP)(Z.Qm.ENCRYPTION_KEY,i),C()},C=()=>{(0,h.a_)(h.Pd.SHOW_BACK_BUTTON,{value:!0}),_.push(R.Pm)};return(0,a.tZ)(d.wx,{children:(0,a.BX)(p.Z,{children:[(0,a.tZ)(w.Z,{children:(0,v.t)("CHANGE_PASSWORD")}),(0,a.tZ)(i.Z,{userEmail:null!==(e=null==g?void 0:g.email)&&void 0!==e?e:"",callback:x,buttonText:(0,v.t)("CHANGE_PASSWORD")}),(null===(r=null===(t=(0,h.Yu)(h.Pd.SHOW_BACK_BUTTON))||void 0===t?void 0:t.value)||void 0===r||r)&&(0,a.tZ)(f.Z,{children:(0,a.tZ)(m.Z,{onClick:_.back,children:(0,v.t)("GO_BACK")})})]})})},A=r(55005),g=()=>(0,a.tZ)(b,{appContext:(0,A.useAppContext)()})},73216:function(t,e,r){"use strict";var a=r(71600);e.Z=void 0;var n=a(r(84198)),i=r(52322);e.Z=(0,n.default)((0,i.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},16331:function(t,e,r){"use strict";var a=r(71600);e.Z=void 0;var n=a(r(84198)),i=r(52322);e.Z=(0,n.default)((0,i.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff")},36673:function(t,e,r){"use strict";r.d(e,{Z:function(){return R}});var a,n=r(31461),i=r(7896),o=r(2784),s=r(40489),c=r(69075),l=r(36082),u=r(42541),d=r(19256),p=r(86685),f=r(31572),w=r(69222),m=r(15672);function y(t){return(0,m.ZP)("MuiInputAdornment",t)}let h=(0,w.Z)("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var Z=r(34183),S=r(52322);let v=["children","className","component","disablePointerEvents","disableTypography","position","variant"],E=t=>{let{classes:e,disablePointerEvents:r,hiddenLabel:a,position:n,size:i,variant:o}=t,s={root:["root",r&&"disablePointerEvents",n&&"position".concat((0,l.Z)(n)),o,a&&"hiddenLabel",i&&"size".concat((0,l.Z)(i))]};return(0,c.Z)(s,y,e)},P=(0,f.ZP)("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:(t,e)=>{let{ownerState:r}=t;return[e.root,e["position".concat((0,l.Z)(r.position))],!0===r.disablePointerEvents&&e.disablePointerEvents,e[r.variant]]}})(t=>{let{theme:e,ownerState:r}=t;return(0,i.Z)({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(e.vars||e).palette.action.active},"filled"===r.variant&&{["&.".concat(h.positionStart,"&:not(.").concat(h.hiddenLabel,")")]:{marginTop:16}},"start"===r.position&&{marginRight:8},"end"===r.position&&{marginLeft:8},!0===r.disablePointerEvents&&{pointerEvents:"none"})});var R=o.forwardRef(function(t,e){let r=(0,Z.i)({props:t,name:"MuiInputAdornment"}),{children:c,className:l,component:f="div",disablePointerEvents:w=!1,disableTypography:m=!1,position:y,variant:h}=r,R=(0,n.Z)(r,v),b=(0,p.Z)()||{},A=h;h&&b.variant,b&&!A&&(A=b.variant);let g=(0,i.Z)({},r,{hiddenLabel:b.hiddenLabel,size:b.size,disablePointerEvents:w,position:y,variant:A}),T=E(g);return(0,S.jsx)(d.Z.Provider,{value:null,children:(0,S.jsx)(P,(0,i.Z)({as:f,ownerState:g,className:(0,s.Z)(T.root,l),ref:e},R,{children:"string"!=typeof c||m?(0,S.jsxs)(o.Fragment,{children:["start"===y?a||(a=(0,S.jsx)("span",{className:"notranslate",children:"â€‹"})):null,c]}):(0,S.jsx)(u.Z,{color:"text.secondary",children:c})}))})})},50193:function(t,e,r){"use strict";r.d(e,{$Q:function(){return f},IG:function(){return d},O3:function(){return c},XD:function(){return u},gd:function(){return p},zx:function(){return l}});var a=r(10934),n=r(68351),i=r(27949),o=r(56810),s=r(80613);let c=async t=>{try{return(await o.Z.get(await (0,n.QH)("/users/srp/attributes"),{email:t})).data.attributes}catch(t){return a.ZP.error("failed to get SRP attributes",t),null}},l=async(t,e)=>{try{return(await o.Z.post(await (0,n.QH)("/users/srp/setup"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw a.ZP.error("failed to post SRP attributes",t),t}},u=async(t,e)=>{try{return(await o.Z.post(await (0,n.QH)("/users/srp/complete"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw a.ZP.error("failed to complete SRP setup",t),t}},d=async(t,e)=>{try{return(await o.Z.post(await (0,n.QH)("/users/srp/create-session"),{srpUserID:t,srpA:e})).data}catch(t){throw a.ZP.error("createSRPSession failed",t),t}},p=async(t,e,r)=>{try{return(await o.Z.post(await (0,n.QH)("/users/srp/verify-session"),{sessionID:t,srpUserID:e,srpM1:r},void 0)).data}catch(t){if(a.ZP.error("verifySRPSession failed",t),t instanceof i.MS&&t.httpStatusCode===s.WE.Unauthorized)throw Error(i.sH.INCORRECT_PASSWORD);throw t}},f=async(t,e)=>{try{return(await o.Z.post(await (0,n.QH)("/users/srp/update"),e,void 0,{"X-Auth-Token":t})).data}catch(t){throw a.ZP.error("updateSRPAndKeys failed",t),t}}},49354:function(t,e,r){"use strict";r.d(e,{L:function(){return l}});var a=r(52903),n=r(39596),i=r(91430),o=r(42541),s=r(24991),c=r(2784);let l=t=>{let{password:e}=t,r=(0,c.useMemo)(()=>(0,n.rp)(e),[e]);return(0,a.tZ)(i.A0,{mt:"8px",mb:"4px",children:(0,a.tZ)(o.Z,{variant:"small",sx:t=>({color:"weak"==r?t.colors.danger.A700:"moderate"==r?t.colors.warning.A500:t.colors.accent.A500}),textAlign:"left",flex:1,children:e?(0,s.t)("passphrase_strength",{context:r}):""})})}},6372:function(t,e,r){"use strict";var a=r(52903),n=r(39596),i=r(39382),o=r(43643),s=r(42541),c=r(84381),l=r(53793),u=r(58488),d=r(31708),p=r(24991),f=r(2784),w=r(98614),m=r(48601),y=r(49354);e.Z=function(t){let[e,r]=(0,f.useState)(!1),[h,Z]=(0,f.useState)(!1),S=()=>{Z(!h)},v=t=>{t.preventDefault()},E=async(e,a)=>{let{setFieldError:n}=a;r(!0);try{let{passphrase:r,confirm:a}=e;r===a?await t.callback(r,n):n("confirm",(0,p.t)("PASSPHRASE_MATCH_ERROR"))}catch(e){let t=e instanceof Error?e.message:"";n("confirm","".concat((0,p.t)("UNKNOWN_ERROR")," ").concat(t))}finally{r(!1)}};return(0,a.tZ)(d.J9,{initialValues:{passphrase:"",confirm:""},validationSchema:m.Ry().shape({passphrase:m.Z_().required((0,p.t)("REQUIRED")),confirm:m.Z_().required((0,p.t)("REQUIRED"))}),validateOnChange:!1,validateOnBlur:!1,onSubmit:E,children:r=>{let{values:d,errors:f,handleChange:m,handleSubmit:Z}=r;return(0,a.BX)("form",{noValidate:!0,onSubmit:Z,children:[(0,a.tZ)(s.Z,{mb:2,color:"text.muted",variant:"small",children:(0,p.t)("ENTER_ENC_PASSPHRASE")}),(0,a.tZ)(c.Z,{sx:{display:"none"},name:"email",id:"email",autoComplete:"username",type:"email",value:t.userEmail}),(0,a.tZ)(l.Z,{fullWidth:!0,name:"password",id:"password",autoComplete:"new-password",type:h?"text":"password",label:(0,p.t)("PASSPHRASE_HINT"),value:d.passphrase,onChange:m("passphrase"),error:!!f.passphrase,helperText:f.passphrase,autoFocus:!0,disabled:e,InputProps:{endAdornment:(0,a.tZ)(i.Z,{showPassword:h,handleClickShowPassword:S,handleMouseDownPassword:v})}}),(0,a.tZ)(l.Z,{fullWidth:!0,name:"confirm-password",id:"confirm-password",autoComplete:"new-password",type:"password",label:(0,p.t)("CONFIRM_PASSPHRASE"),value:d.confirm,onChange:m("confirm"),disabled:e,error:!!f.confirm,helperText:f.confirm}),(0,a.tZ)(y.L,{password:d.passphrase}),(0,a.tZ)(s.Z,{my:2,variant:"small",children:(0,a.tZ)(w.cC,{i18nKey:"PASSPHRASE_DISCLAIMER"})}),(0,a.BX)(u.Z,{my:4,children:[(0,a.tZ)(o.Z,{sx:{my:0},loading:e,buttonText:t.buttonText,disabled:(0,n.DZ)(d.passphrase)}),e&&(0,a.tZ)(s.Z,{textAlign:"center",mt:1,color:"text.muted",variant:"small",children:(0,p.t)("KEY_GENERATION_IN_PROGRESS_MESSAGE")})]})]})}})}},34360:function(t,e,r){"use strict";var a,n;r.d(e,{q:function(){return a}}),(n=a||(a={})).ROOT="/",n.CHANGE_EMAIL="/change-email",n.CHANGE_PASSWORD="/change-password",n.CREDENTIALS="/credentials",n.GENERATE="/generate",n.LOGIN="/login",n.RECOVER="/recover",n.SIGNUP="/signup",n.TWO_FACTOR_SETUP="/two-factor/setup",n.TWO_FACTOR_VERIFY="/two-factor/verify",n.TWO_FACTOR_RECOVER="/two-factor/recover",n.VERIFY="/verify",n.SHARED_ALBUMS="/shared-albums"},19764:function(t,e,r){"use strict";r.d(e,{Bs:function(){return f},a4:function(){return w},pL:function(){return m},u1:function(){return y}});var a=r(22969),n=r(10934),i=r(38045),o=r(29650),s=r(50232),c=r(6364),l=r(50193),u=r(39596),d=r(79644).Buffer;let p=s.SRP.params["4096"],f=async t=>{let{srpSalt:e,srpUserID:r,srpVerifier:a,loginSubKey:i}=t;try{let t=await y(e,r,i),s=(0,u.HC)(t.computeA());n.ZP.debug(()=>"srp a: ".concat(s));let c=(0,o.LP)(),{setupID:d,srpB:p}=await (0,l.zx)(c,{srpA:s,srpUserID:r,srpSalt:e,srpVerifier:a});t.setB((0,u.GS)(p));let f=(0,u.HC)(t.computeM1()),{srpM2:w}=await (0,l.XD)(c,{srpM1:f,setupID:d});t.checkM2((0,u.GS)(w))}catch(t){throw n.ZP.error("Failed to configure SRP",t),t}},w=async t=>{let e=await (0,a.Lb)(),r=await e.generateSaltToDeriveKey(),i=(0,c.Z)(),o=s.SRP.computeVerifier(p,(0,u.GS)(r),d.from(i),(0,u.GS)(t)),l={srpUserID:i,srpSalt:r,srpVerifier:(0,u.HC)(o),loginSubKey:t};return n.ZP.debug(()=>"SRP setup attributes generated: ".concat(JSON.stringify(l))),l},m=async(t,e)=>{try{let r=await (0,i.uA)(e),a=await y(t.srpSalt,t.srpUserID,r),o=a.computeA(),{srpB:s,sessionID:c}=await (0,l.IG)(t.srpUserID,(0,u.HC)(o));a.setB((0,u.GS)(s));let d=a.computeM1();n.ZP.debug(()=>"srp m1: ".concat((0,u.HC)(d)));let{srpM2:p,...f}=await (0,l.gd)(c,t.srpUserID,(0,u.HC)(d));return n.ZP.debug(()=>"srp verify session successful,srpM2: ".concat(p)),a.checkM2((0,u.GS)(p)),n.ZP.debug(()=>"srp server verify successful"),f}catch(t){throw n.ZP.error("srp verify failed",t),t}},y=async(t,e,r)=>new Promise((a,n)=>{s.SRP.genKey(function(i,o){try{if(i&&n(i),!o)throw Error("secret1 gen failed");let c=new s.SrpClient(p,(0,u.GS)(t),d.from(e),(0,u.GS)(r),o,!1);a(c)}catch(t){n(t)}})})},39596:function(t,e,r){"use strict";r.d(e,{DZ:function(){return l},GS:function(){return s},HC:function(){return o},rp:function(){return c}});var a=r(16152),n=r.n(a),i=r(79644).Buffer;let o=t=>t.toString("base64"),s=t=>i.from(t,"base64");function c(t){if(!t)return"weak";let e=n()(t);return e.score<2?"weak":e.score<3?"moderate":"strong"}let l=t=>"weak"==c(t)},22063:function(t,e,r){"use strict";var a=r(52903),n=r(91430),i=r(37862);r(2784),e.Z=t=>{let{sx:e,style:r,...o}=t;return(0,a.BX)(a.HY,{children:[(0,a.tZ)(i.Z,{}),(0,a.tZ)(n.wx,{style:{flexDirection:"row",...r},sx:{mt:3,...e},...o,children:o.children})]})}},63462:function(t,e,r){"use strict";var a=r(52903),n=r(42541);r(2784),e.Z=t=>{let{sx:e,...r}=t;return(0,a.tZ)(n.Z,{variant:"h2",sx:{mb:8,...e},...r,children:r.children})}},60108:function(t,e,r){"use strict";var a=r(31572),n=r(67295);let i=(0,a.ZP)(n.Z)(t=>{let{theme:e}=t;return{padding:e.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});e.Z=i},39382:function(t,e,r){"use strict";var a=r(52903),n=r(73216),i=r(16331),o=r(36673),s=r(53091);r(2784),e.Z=t=>{let{showPassword:e,handleClickShowPassword:r,handleMouseDownPassword:c}=t;return(0,a.tZ)(o.Z,{position:"end",children:(0,a.tZ)(s.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:r,onMouseDown:c,edge:"end",children:e?(0,a.tZ)(i.Z,{}):(0,a.tZ)(n.Z,{})})})}},83446:function(t,e,r){"use strict";var a=r(52903),n=r(72595);r(2784),e.Z=t=>{let{children:e,sx:r,color:i,...o}=t;return(0,a.tZ)(n.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(i,".main"),textDecoration:"underline ",textDecorationColor:"".concat(i,".main")},...r},...o,children:e})}},43643:function(t,e,r){"use strict";var a=r(52903),n=r(53819),i=r(10222),o=r(7706);r(2784),e.Z=t=>{let{loading:e,buttonText:r,disabled:s,success:c,sx:l,...u}=t;return(0,a.tZ)(i.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:s||e||c,sx:{my:4,...e?{"&.Mui-disabled":{backgroundColor:t=>t.colors.accent.A500,color:t=>t.colors.text.base}}:{},...l},...u,children:e?(0,a.tZ)(o.Z,{size:20}):c?(0,a.tZ)(n.Z,{sx:{fontSize:20}}):r})}},38045:function(t,e,r){"use strict";r.d(e,{CP:function(){return f},OT:function(){return w},PN:function(){return u},iv:function(){return d},uA:function(){return p},yr:function(){return m}});var a=r(30433),n=r(22969),i=r(10934),o=r(25683),s=r(29650),c=r(50267),l=r(1799);async function u(t,e){let r=await (0,n.Lb)(),a=(0,o.Yu)(o.Pd.USER),i=null,{encryptedToken:s}=a;if(s&&s.length>0){let n=await r.decryptB64(t.encryptedSecretKey,t.secretKeyDecryptionNonce,e),c=await r.boxSealOpen(s,t.publicKey,n),l=await r.fromB64(c);i=await r.toB64URLSafe(l),await (0,o.CA)({...a,token:i,encryptedToken:null})}}async function d(t,e,r){let a=await (0,n.Lb)(),i=await a.generateSaltToDeriveKey(),s=await a.deriveInteractiveKey(t,i),c=await a.encryptToB64(r,s.key),l=Object.assign(e,{kekSalt:i,encryptedKey:c.encryptedData,keyDecryptionNonce:c.nonce,opsLimit:s.opsLimit,memLimit:s.memLimit});return(0,o.a_)(o.Pd.KEY_ATTRIBUTES,l),l}let p=async t=>{let e=await (0,n.Lb)(),r=await e.generateSubKey(t,32,1,"loginctx"),a=await e.fromB64(r);return await e.toB64(a.slice(0,16))},f=async(t,e,r)=>{let a=await (0,n.Lb)(),i=await a.generateKeyAndEncryptToB64(e);(0,c.Dt)(t,i);let o=globalThis.electron;o&&!r&&t===c.Qm.ENCRYPTION_KEY&&o.saveMasterKeyB64(e)};async function w(t){let e=await (0,n.Lb)(),r=await m(),a=await e.fromHex(r);return await e.encryptToB64(t,a)}let m=async()=>{try{let t;let e=await (0,n.Lb)(),{recoveryKeyEncryptedWithMasterKey:r,recoveryKeyDecryptionNonce:a}=(0,o.Yu)(o.Pd.KEY_ATTRIBUTES),i=await (0,l.G)();return t=r?await e.decryptB64(r,a,i):await y(),t=await e.toHex(t)}catch(t){throw console.log(t),i.ZP.error("getRecoveryKey failed",t),t}};async function y(){let t=await (0,l.G)(),e=(0,o.Yu)(o.Pd.KEY_ATTRIBUTES),r=await (0,n.Lb)(),i=await r.generateEncryptionKey(),c=await r.encryptToB64(t,i),u=await r.encryptToB64(i,t),d={masterKeyEncryptedWithRecoveryKey:c.encryptedData,masterKeyDecryptionNonce:c.nonce,recoveryKeyEncryptedWithMasterKey:u.encryptedData,recoveryKeyDecryptionNonce:u.nonce};await (0,a.Jl)((0,s.LP)(),d);let p=Object.assign(e,d);return(0,o.a_)(o.Pd.KEY_ATTRIBUTES,p),i}}},function(t){t.O(0,[1981,1708,4373,3432,3692,2888,9774,179],function(){return t(t.s=32774)}),_N_E=t.O()}]);