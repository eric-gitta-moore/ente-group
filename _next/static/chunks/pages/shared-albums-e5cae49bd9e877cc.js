(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7440],{14261:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shared-albums",function(){return l(35246)}])},35246:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return ee}});var n=l(52903),r=l(3229),o=l(22969),i=l(52535),a=l(10934),c=l(52939),u=l(39010),s=l(24758),d=l(77488),h=l(91430),Z=l(98996),C=l(60108),p=l(63462),w=l(97335),f=l(85999),v=l(50006),E=l(8620),g=l(27949),m=l(46794),R=l(15833),S=l(89668),_=l(50634),b=l(34288),y=l(4559),L=l(58488),T=l(53091),N=l(10222),P=l(96566),x=l(35999),I=l(42541),D=l(17022),H=l.n(D);let k=()=>(0,n.tZ)("svg",{width:"50",height:"26",viewBox:"0 0 43 13",fill:"#fff",xmlns:"http://www.w3.org/2000/svg",children:(0,n.tZ)("path",{d:"M6.102 12.144C4.998 12.144 4.026 11.928 3.186 11.496C2.358 11.064 1.716 10.476 1.26 9.732C0.804 8.976 0.576 8.118 0.576 7.158C0.576 6.186 0.798 5.328 1.242 4.584C1.698 3.828 2.316 3.24 3.096 2.82C3.876 2.388 4.758 2.172 5.742 2.172C6.69 2.172 7.542 2.376 8.298 2.784C9.066 3.18 9.672 3.756 10.116 4.512C10.56 5.256 10.782 6.15 10.782 7.194C10.782 7.302 10.776 7.428 10.764 7.572C10.752 7.704 10.74 7.83 10.728 7.95H2.862V6.312H9.252L8.172 6.798C8.172 6.294 8.07 5.856 7.866 5.484C7.662 5.112 7.38 4.824 7.02 4.62C6.66 4.404 6.24 4.296 5.76 4.296C5.28 4.296 4.854 4.404 4.482 4.62C4.122 4.824 3.84 5.118 3.636 5.502C3.432 5.874 3.33 6.318 3.33 6.834V7.266C3.33 7.794 3.444 8.262 3.672 8.67C3.912 9.066 4.242 9.372 4.662 9.588C5.094 9.792 5.598 9.894 6.174 9.894C6.69 9.894 7.14 9.816 7.524 9.66C7.92 9.504 8.28 9.27 8.604 8.958L10.098 10.578C9.654 11.082 9.096 11.472 8.424 11.748C7.752 12.012 6.978 12.144 6.102 12.144ZM18.5375 2.172C19.3055 2.172 19.9895 2.328 20.5895 2.64C21.2015 2.94 21.6815 3.408 22.0295 4.044C22.3775 4.668 22.5515 5.472 22.5515 6.456V12H19.7435V6.888C19.7435 6.108 19.5695 5.532 19.2215 5.16C18.8855 4.788 18.4055 4.602 17.7815 4.602C17.3375 4.602 16.9355 4.698 16.5755 4.89C16.2275 5.07 15.9515 5.352 15.7475 5.736C15.5555 6.12 15.4595 6.612 15.4595 7.212V12H12.6515V2.316H15.3335V4.998L14.8295 4.188C15.1775 3.54 15.6755 3.042 16.3235 2.694C16.9715 2.346 17.7095 2.172 18.5375 2.172ZM29.0568 12.144C27.9168 12.144 27.0288 11.856 26.3928 11.28C25.7568 10.692 25.4388 9.822 25.4388 8.67V0.174H28.2468V8.634C28.2468 9.042 28.3548 9.36 28.5708 9.588C28.7868 9.804 29.0808 9.912 29.4528 9.912C29.8968 9.912 30.2748 9.792 30.5868 9.552L31.3428 11.532C31.0548 11.736 30.7068 11.892 30.2988 12C29.9028 12.096 29.4888 12.144 29.0568 12.144ZM23.9448 4.692V2.532H30.6588V4.692H23.9448ZM37.4262 12.144C36.3222 12.144 35.3502 11.928 34.5102 11.496C33.6822 11.064 33.0402 10.476 32.5842 9.732C32.1282 8.976 31.9002 8.118 31.9002 7.158C31.9002 6.186 32.1222 5.328 32.5662 4.584C33.0222 3.828 33.6402 3.24 34.4202 2.82C35.2002 2.388 36.0822 2.172 37.0662 2.172C38.0142 2.172 38.8662 2.376 39.6222 2.784C40.3902 3.18 40.9962 3.756 41.4402 4.512C41.8842 5.256 42.1062 6.15 42.1062 7.194C42.1062 7.302 42.1002 7.428 42.0882 7.572C42.0762 7.704 42.0642 7.83 42.0522 7.95H34.1862V6.312H40.5762L39.4962 6.798C39.4962 6.294 39.3942 5.856 39.1902 5.484C38.9862 5.112 38.7042 4.824 38.3442 4.62C37.9842 4.404 37.5642 4.296 37.0842 4.296C36.6042 4.296 36.1782 4.404 35.8062 4.62C35.4462 4.824 35.1642 5.118 34.9602 5.502C34.7562 5.874 34.6542 6.318 34.6542 6.834V7.266C34.6542 7.794 34.7682 8.262 34.9962 8.67C35.2362 9.066 35.5662 9.372 35.9862 9.588C36.4182 9.792 36.9222 9.894 37.4982 9.894C38.0142 9.894 38.4642 9.816 38.8482 9.66C39.2442 9.504 39.6042 9.27 39.9282 8.958L41.4222 10.578C40.9782 11.082 40.4202 11.472 39.7482 11.748C39.0762 12.012 38.3022 12.144 37.4262 12.144Z"})});var U=l(68032),A=l(13058),M=l(33446),O=l(14563),X=l(98977),B=l(86508),K=l(92289),V=l(24991),F=l(5632),W=l(55005),G=l(2784),Q=l(75031),Y=l(23499),$=l(33967),z=l(26552),J=l(22624),j=l(77777),q=l(50846);function ee(){var e,t,l;let r=(0,G.useRef)(null),i=(0,G.useRef)(null),c=(0,G.useRef)(null),u=(0,G.useRef)(null),w=(0,G.useRef)(""),[f,R]=(0,G.useState)(null),[S,_]=(0,G.useState)(null),[b,y]=(0,G.useState)(null),L=(0,G.useContext)(W.AppContext),[T,N]=(0,G.useState)(!0),P=(0,F.useRouter)(),[x,D]=(0,G.useState)(!1),[k,$]=(0,G.useState)(null),[j,ee]=(0,G.useState)(null),[el,en]=(0,G.useState)(!1),[eo,ec]=(0,G.useState)(!1),[eu,es]=(0,G.useState)(!1),[ed,eh]=(0,G.useState)({ownCount:0,count:0,collectionID:0,context:void 0}),{getRootProps:eZ,getInputProps:eC,acceptedFiles:ep}=(0,Q.uI)({noClick:!0,noKeyboard:!0,disabled:eu}),{getInputProps:ew,openSelector:ef,selectedFiles:ev}=(0,m.e)({directory:!1}),{getInputProps:eE,openSelector:eg,selectedFiles:em}=(0,m.e)({directory:!0}),[eR,eS]=(0,G.useState)([]),e_=(e,t,l)=>{var n;let r=null!==(n=null==eR?void 0:eR.length)&&void 0!==n?n:0,o=e=>{eS(t=>{let l=null==t?void 0:t.find(e=>e.id===r),n="function"==typeof e?e(l):{...l,...e};return l?t.map(e=>e.id===r?n:e):[...t,n]})};return o({id:r,folderName:e,collectionID:t,isHidden:l,canceller:null,total:0,success:0,failed:0,downloadDirPath:null}),o},eb=(0,G.useMemo)(()=>{var e,t;return(null==S?void 0:null===(t=S.publicURLs)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.enableCollect)?()=>en(!0):void 0},[S]);(0,G.useEffect)(()=>{let e=new URL(window.location.href);"/"!==e.pathname&&P.replace({pathname:E.W.SHARED_ALBUMS,search:e.search,hash:e.hash},{pathname:"/",search:e.search,hash:e.hash},{shallow:!0}),(async()=>{let e=!1;try{let h=await (0,o.Lb)();await s.Z.init(),u.current=window.location.href;let Z=new URL(u.current),C=Z.searchParams.get("t"),p=Z.hash.slice(1);if(C||p||(window.location.href="https://ente.io",e=!0),!C||!p)return;let f=p.length<50?await h.toB64(H().decode(p)):await h.fromHex(p);r.current=C,s.Z.updateToken(r.current),c.current=f,u.current=window.location.href;let v=await (0,Y.to)(c.current);if(v){var t,l,n,a;w.current=await (0,Y.py)();let e=null!==(a=null==v?void 0:null===(t=v.pubMagicMetadata)||void 0===t?void 0:t.data.asc)&&void 0!==a&&a;_(v);let o=null==v?void 0:null===(n=v.publicURLs)||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.passwordEnabled;D(o);let c=(0,Y.yB)(r.current),u=await (0,Y.CE)(c),h=(0,J.hE)((0,d.SA)(u),e);R(h),i.current=await (0,Y.ed)(c),s.Z.updateToken(r.current,i.current)}await eL()}finally{e||N(!1)}})()},[]);let ey=null===(l=null==S?void 0:null===(t=S.publicURLs)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.enableDownload)||void 0===l||l;(0,G.useEffect)(()=>{S&&f&&$({item:(0,n.tZ)(ea,{publicCollection:S,publicFiles:f,setFilesDownloadProgressAttributesCreator:e_}),itemType:X.Z$.HEADER,height:68})},[S,f]),(0,G.useEffect)(()=>{ee(eb?{item:(0,n.tZ)(h.Tn,{sx:{marginTop:"56px"},children:(0,n.tZ)(er,{onClick:eb})}),itemType:X.Z$.FOOTER,height:104}:null)},[eb]);let eL=async()=>{let e=(0,Y.yB)(r.current);try{var t,l;L.startLoading(),N(!0);let[n,o]=await (0,Y.Uo)(r.current,c.current);w.current=o,_(n);let a=null==n?void 0:null===(l=n.publicURLs)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.passwordEnabled;if(D(a),y(null),!a&&i.current&&(i.current=null,(0,Y.Kc)(e,null)),!a||a&&i.current)try{await (0,Y.mF)(r.current,i.current,n,R)}catch(e){(0,g.a3)(e).message===g.sH.TOKEN_EXPIRED&&(i.current=null)}a&&!i.current&&await (0,Y.DH)(e)}catch(l){let t=(0,g.a3)(l);t.message===g.sH.TOKEN_EXPIRED||t.message===g.sH.TOO_MANY_REQUESTS?(y(t.message===g.sH.TOO_MANY_REQUESTS?(0,V.t)("LINK_TOO_MANY_REQUESTS"):(0,V.t)("LINK_EXPIRED_MESSAGE")),(0,Y.Wk)(e,c.current),_(null),R(null)):a.ZP.error("failed to sync public album with remote",l)}finally{L.finishLoading(),N(!1)}},eT=async(e,t)=>{try{let l=await (0,o.Lb)(),n=null;try{let t=S.publicURLs[0];n=await l.deriveKey(e,t.nonce,t.opsLimit,t.memLimit)}catch(e){a.ZP.error("failed to derive key for verifyLinkPassword",e),t("".concat((0,V.t)("UNKNOWN_ERROR")," ").concat(e.message));return}let c=(0,Y.yB)(r.current);try{let e=await (0,Y.w4)(r.current,n);i.current=e,s.Z.updateToken(r.current,i.current),await (0,Y.Kc)(c,e)}catch(e){if((0,g.a3)(e).message===g.sH.TOKEN_EXPIRED){t((0,V.t)("INCORRECT_PASSPHRASE"));return}throw e}await eL(),L.finishLoading()}catch(e){a.ZP.error("failed to verifyLinkPassword",e),t("".concat((0,V.t)("UNKNOWN_ERROR")," ").concat(e.message))}};if(T){if(!f)return(0,n.tZ)(h.wx,{children:(0,n.tZ)(Z.Z,{})})}else{if(b)return(0,n.tZ)(h.wx,{children:b});if(x&&!i.current)return(0,n.tZ)(h.wx,{children:(0,n.BX)(C.Z,{children:[(0,n.tZ)(p.Z,{children:(0,V.t)("password")}),(0,n.tZ)(I.Z,{color:"text.muted",mb:2,variant:"small",children:(0,V.t)("link_password_description")}),(0,n.tZ)(v.Z,{callback:eT,placeholder:(0,V.t)("password"),buttonText:(0,V.t)("unlock"),fieldType:"password"})]})});if(!f)return(0,n.tZ)(h.wx,{children:(0,V.t)("NOT_FOUND")})}let eN=()=>{(null==ed?void 0:ed.count)&&eh({ownCount:0,count:0,collectionID:0,context:void 0})},eP=async()=>{try{let e=(0,J.Rb)(ed,f),t=e_("".concat(e.length," ").concat((0,V.t)("FILES")));await (0,J.ng)(e,t),eN()}catch(e){a.ZP.error("failed to download selected files",e)}};return(0,n.tZ)(q.H.Provider,{value:{token:r.current,referralCode:w.current,passwordToken:i.current,accessedThroughSharedURL:!0,photoListHeader:k,photoListFooter:j},children:(0,n.BX)(A.Z,{getDragAndDropRootProps:eZ,children:[(0,n.tZ)(K.l,{getDragAndDropInputProps:eC,getFileSelectorInputProps:ew,getFolderSelectorInputProps:eE}),(0,n.tZ)(et,{onAddPhotos:eb}),(0,n.tZ)(O.Z,{page:E.W.SHARED_ALBUMS,files:f,syncWithRemote:eL,setSelected:eh,selected:ed,activeCollectionID:z.Ug,enableDownload:ey,fileToCollectionsMap:null,collectionNameMap:null,setFilesDownloadProgressAttributesCreator:e_,selectable:ey}),eo&&(0,n.tZ)(M.f,{children:(0,n.tZ)(Z.Z,{})}),(0,n.tZ)(B.Z,{syncWithRemote:eL,uploadCollection:S,setLoading:ec,setShouldDisableDropzone:es,setFiles:R,uploadTypeSelectorView:el,closeUploadTypeSelector:()=>{en(!1)},showSessionExpiredMessage:()=>L.setDialogMessage({title:(0,V.t)("LINK_EXPIRED"),content:(0,V.t)("LINK_EXPIRED_MESSAGE"),nonClosable:!0,proceed:{text:(0,V.t)("login"),action:()=>P.push("/"),variant:"accent"}}),uploadTypeSelectorIntent:"collect",dragAndDropFiles:ep,openFileSelector:ef,fileSelectorFiles:ev,openFolderSelector:eg,folderSelectorFiles:em}),(0,n.tZ)(U.yu,{attributesList:eR,setAttributesList:eS}),ed.count>0&&(0,n.tZ)(ei,{downloadFilesHelper:eP,clearSelection:eN,count:ed.count})]})})}let et=e=>{let{onAddPhotos:t}=e;return(0,n.BX)(r.sD,{children:[(0,n.tZ)(h.G5,{children:(0,n.tZ)(el,{})}),t?(0,n.tZ)(en,{onClick:t}):(0,n.tZ)(eo,{})]})},el=()=>(0,n.tZ)("a",{href:"https://ente.io",children:(0,n.tZ)(L.Z,{sx:e=>({":hover":{cursor:"pointer",svg:{fill:e.colors.text.faint}}}),children:(0,n.tZ)(k,{})})}),en=e=>{let t=!$.Z.shouldAllowNewUpload(),l=(0,i.I)(),r=(0,n.tZ)(R.Z,{});return(0,n.tZ)(L.Z,{children:l?(0,n.tZ)(T.Z,{...e,disabled:t,children:r}):(0,n.tZ)(N.Z,{...e,disabled:t,color:"secondary",startIcon:r,children:(0,V.t)("add_photos")})})},er=e=>{let t=!$.Z.shouldAllowNewUpload();return(0,n.tZ)(L.Z,{children:(0,n.tZ)(N.Z,{...e,disabled:t,color:"accent",startIcon:(0,n.tZ)(R.Z,{}),children:(0,V.t)("add_more_photos")})})},eo=()=>{let e=(0,i.T)();return(0,n.tZ)(N.Z,{color:"accent",href:"https://ente.io",children:e?(0,V.t)("install"):(0,V.t)("sign_up")})},ei=e=>{let{downloadFilesHelper:t,count:l,clearSelection:o}=e;return(0,n.BX)(r.XL,{children:[(0,n.BX)(h.G5,{children:[(0,n.tZ)(T.Z,{onClick:o,children:(0,n.tZ)(S.Z,{})}),(0,n.BX)(L.Z,{ml:1.5,children:[(0,j.u)(l)," ",(0,V.t)("SELECTED")," "]})]}),(0,n.tZ)(P.Z,{spacing:2,direction:"row",mr:2,children:(0,n.tZ)(x.Z,{title:(0,V.t)("download"),children:(0,n.tZ)(T.Z,{onClick:t,children:(0,n.tZ)(_.Z,{})})})})]})},ea=e=>{var t,l,r;let{publicCollection:o,publicFiles:i,setFilesDownloadProgressAttributesCreator:a}=e,s=null===(r=null===(l=o.publicURLs)||void 0===l?void 0:null===(t=l[0])||void 0===t?void 0:t.enableDownload)||void 0===r||r,d=async()=>{let e=a(o.name,o.id,(0,z._K)(o));await (0,z.Jx)(o.name,i,e)};return(0,n.tZ)(c.R,{children:(0,n.BX)(u.G,{children:[(0,n.tZ)(c.M,{name:o.name,fileCount:i.length}),s&&(0,n.tZ)(w.Z,{ariaControls:"collection-options",triggerButtonIcon:(0,n.tZ)(y.Z,{}),children:(0,n.tZ)(f.x,{startIcon:(0,n.tZ)(b.Z,{}),onClick:d,children:(0,V.t)("download_album")})})]})})}},63462:function(e,t,l){"use strict";var n=l(52903),r=l(42541);l(2784),t.Z=e=>{let{sx:t,...l}=e;return(0,n.tZ)(r.Z,{variant:"h2",sx:{mb:8,...t},...l,children:l.children})}},60108:function(e,t,l){"use strict";var n=l(31572),r=l(67295);let o=(0,n.ZP)(r.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});t.Z=o}},function(e){e.O(0,[3164,1708,4373,9668,5999,805,4666,6702,3359,2888,9774,179],function(){return e(e.s=14261)}),_N_E=e.O()}]);