(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{29856:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/recover",function(){return n(60573)}])},60573:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var a=n(52903),r=n(30433),i=n(34360),o=n(22969),l=n(10934),c=n(8033),u=n(91430),s=n(60108),d=n(22063),p=n(63462),y=n(83446),E=n(50006),f=n(38045),h=n(25683),w=n(50267),T=n(24991),m=n(5632),R=n(2784),Z=n(12595);let b=n(36832);b.setDefaultWordlist("english");var _=e=>{let{appContext:t}=e,{showNavBar:n,setDialogBoxAttributesV2:_}=t,[C,v]=(0,R.useState)(),x=(0,m.useRouter)();(0,R.useEffect)(()=>{let e=(0,h.Yu)(h.Pd.USER),t=(0,h.Yu)(h.Pd.KEY_ATTRIBUTES),a=(0,w.km)(w.Qm.ENCRYPTION_KEY);if(!(null==e?void 0:e.email)){x.push("/");return}if(!(null==e?void 0:e.encryptedToken)&&!(null==e?void 0:e.token)){(0,r.Tb)(e.email),(0,Z.M8)(i.q.RECOVER),x.push(i.q.VERIFY);return}t?a?x.push(Z.Pm):v(t):x.push(i.q.GENERATE),n(!0)},[]);let O=async(e,t)=>{try{if((e=e.trim().split(" ").map(e=>e.trim()).filter(e=>!!e).join(" ")).indexOf(" ")>0){if(24!==e.split(" ").length)throw Error("recovery code should have 24 words");e=b.mnemonicToEntropy(e)}let t=await (0,o.Lb)(),n=(0,c.zx)(C),a=await t.decryptB64(n.masterKeyEncryptedWithRecoveryKey,n.masterKeyDecryptionNonce,await t.fromHex(e));await (0,f.CP)(w.Qm.ENCRYPTION_KEY,a),await (0,f.PN)(n,a),(0,h.a_)(h.Pd.SHOW_BACK_BUTTON,{value:!1}),x.push(i.q.CHANGE_PASSWORD)}catch(e){l.ZP.error("password recovery failed",e),t((0,T.t)("INCORRECT_RECOVERY_KEY"))}};return(0,a.tZ)(u.wx,{children:(0,a.BX)(s.Z,{children:[(0,a.tZ)(p.Z,{children:(0,T.t)("RECOVER_ACCOUNT")}),(0,a.tZ)(E.Z,{callback:O,fieldType:"text",placeholder:(0,T.t)("RECOVERY_KEY_HINT"),buttonText:(0,T.t)("RECOVER"),disableAutoComplete:!0}),(0,a.BX)(d.Z,{style:{justifyContent:"space-between"},children:[(0,a.tZ)(y.Z,{onClick:()=>_({title:(0,T.t)("sorry"),close:{},content:(0,T.t)("NO_RECOVERY_KEY_MESSAGE")}),children:(0,T.t)("NO_RECOVERY_KEY")}),(0,a.tZ)(y.Z,{onClick:x.back,children:(0,T.t)("GO_BACK")})]})]})})},C=n(55005),v=()=>(0,a.tZ)(_,{appContext:(0,C.useAppContext)()})},34360:function(e,t,n){"use strict";var a,r;n.d(t,{q:function(){return a}}),(r=a||(a={})).ROOT="/",r.CHANGE_EMAIL="/change-email",r.CHANGE_PASSWORD="/change-password",r.CREDENTIALS="/credentials",r.GENERATE="/generate",r.LOGIN="/login",r.RECOVER="/recover",r.SIGNUP="/signup",r.TWO_FACTOR_SETUP="/two-factor/setup",r.TWO_FACTOR_VERIFY="/two-factor/verify",r.TWO_FACTOR_RECOVER="/two-factor/recover",r.VERIFY="/verify",r.SHARED_ALBUMS="/shared-albums"},22063:function(e,t,n){"use strict";var a=n(52903),r=n(91430),i=n(37862);n(2784),t.Z=e=>{let{sx:t,style:n,...o}=e;return(0,a.BX)(a.HY,{children:[(0,a.tZ)(i.Z,{}),(0,a.tZ)(r.wx,{style:{flexDirection:"row",...n},sx:{mt:3,...t},...o,children:o.children})]})}},63462:function(e,t,n){"use strict";var a=n(52903),r=n(42541);n(2784),t.Z=e=>{let{sx:t,...n}=e;return(0,a.tZ)(r.Z,{variant:"h2",sx:{mb:8,...t},...n,children:n.children})}},60108:function(e,t,n){"use strict";var a=n(31572),r=n(67295);let i=(0,a.ZP)(r.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});t.Z=i},39382:function(e,t,n){"use strict";var a=n(52903),r=n(73216),i=n(16331),o=n(36673),l=n(53091);n(2784),t.Z=e=>{let{showPassword:t,handleClickShowPassword:n,handleMouseDownPassword:c}=e;return(0,a.tZ)(o.Z,{position:"end",children:(0,a.tZ)(l.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:n,onMouseDown:c,edge:"end",children:t?(0,a.tZ)(i.Z,{}):(0,a.tZ)(r.Z,{})})})}},83446:function(e,t,n){"use strict";var a=n(52903),r=n(72595);n(2784),t.Z=e=>{let{children:t,sx:n,color:i,...o}=e;return(0,a.tZ)(r.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(i,".main"),textDecoration:"underline ",textDecorationColor:"".concat(i,".main")},...n},...o,children:t})}},50006:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var a=n(52903),r=n(91430),i=n(39382),o=n(94848),l=n(10222),c=n(53793),u=n(31708),s=n(24991),d=n(2784),p=n(48601),y=n(43643);function E(e){var t;let{submitButtonProps:n}=e,{sx:E,...f}=null!=n?n:{},[h,w]=(0,d.useState)(!1),[T,m]=(0,d.useState)(!1),R=async(t,n)=>{let{setFieldError:a,resetForm:r}=n;w(!0),await e.callback(t.inputValue,e=>a("inputValue",e),r),w(!1)},Z=()=>{m(!T)},b=e=>{e.preventDefault()},_=(0,d.useMemo)(()=>{switch(e.fieldType){case"text":case"password":return p.Ry().shape({inputValue:p.Z_().required((0,s.t)("REQUIRED"))});case"email":return p.Ry().shape({inputValue:p.Z_().email((0,s.t)("EMAIL_ERROR")).required((0,s.t)("REQUIRED"))})}},[e.fieldType]);return(0,a.tZ)(u.J9,{initialValues:{inputValue:null!==(t=e.initialValue)&&void 0!==t?t:""},onSubmit:R,validationSchema:_,validateOnChange:!1,validateOnBlur:!1,children:t=>{let{values:n,errors:u,handleChange:d,handleSubmit:p}=t;return(0,a.BX)("form",{noValidate:!0,onSubmit:p,children:[e.hiddenPreInput,(0,a.tZ)(c.Z,{hiddenLabel:e.hiddenLabel,variant:"filled",fullWidth:!0,type:T?"text":e.fieldType,id:e.fieldType,name:e.fieldType,...e.hiddenLabel?{placeholder:e.placeholder}:e.realPlaceholder?{placeholder:e.realPlaceholder,label:e.realLabel}:{label:e.placeholder},value:n.inputValue,onChange:d("inputValue"),error:!!u.inputValue,helperText:u.inputValue,disabled:h,autoFocus:!e.disableAutoFocus,autoComplete:e.autoComplete,InputProps:{autoComplete:e.disableAutoComplete||"password"===e.fieldType?"off":"on",endAdornment:"password"===e.fieldType&&(0,a.tZ)(i.Z,{showPassword:T,handleClickShowPassword:Z,handleMouseDownPassword:b})}}),(0,a.tZ)(o.Z,{sx:{position:"relative",top:u.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:e.caption}),e.hiddenPostInput,(0,a.BX)(r.A0,{justifyContent:"flex-end",flexWrap:e.blockButton?"wrap-reverse":"nowrap",children:[e.secondaryButtonAction&&(0,a.tZ)(l.Z,{onClick:e.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:e.blockButton?.5:2,mb:e.blockButton?0:4,mr:e.blockButton?0:1,...E}},...f,children:(0,s.t)("cancel")}),(0,a.tZ)(y.Z,{sx:{"&&&":{mt:2,...E}},buttonText:e.buttonText,loading:h,...f})]})]})}})}},43643:function(e,t,n){"use strict";var a=n(52903),r=n(53819),i=n(10222),o=n(7706);n(2784),t.Z=e=>{let{loading:t,buttonText:n,disabled:l,success:c,sx:u,...s}=e;return(0,a.tZ)(i.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:l||t||c,sx:{my:4,...t?{"&.Mui-disabled":{backgroundColor:e=>e.colors.accent.A500,color:e=>e.colors.text.base}}:{},...u},...s,children:t?(0,a.tZ)(o.Z,{size:20}):c?(0,a.tZ)(r.Z,{sx:{fontSize:20}}):n})}},38045:function(e,t,n){"use strict";n.d(t,{CP:function(){return y},OT:function(){return E},PN:function(){return s},iv:function(){return d},uA:function(){return p},yr:function(){return f}});var a=n(30433),r=n(22969),i=n(10934),o=n(25683),l=n(29650),c=n(50267),u=n(1799);async function s(e,t){let n=await (0,r.Lb)(),a=(0,o.Yu)(o.Pd.USER),i=null,{encryptedToken:l}=a;if(l&&l.length>0){let r=await n.decryptB64(e.encryptedSecretKey,e.secretKeyDecryptionNonce,t),c=await n.boxSealOpen(l,e.publicKey,r),u=await n.fromB64(c);i=await n.toB64URLSafe(u),await (0,o.CA)({...a,token:i,encryptedToken:null})}}async function d(e,t,n){let a=await (0,r.Lb)(),i=await a.generateSaltToDeriveKey(),l=await a.deriveInteractiveKey(e,i),c=await a.encryptToB64(n,l.key),u=Object.assign(t,{kekSalt:i,encryptedKey:c.encryptedData,keyDecryptionNonce:c.nonce,opsLimit:l.opsLimit,memLimit:l.memLimit});return(0,o.a_)(o.Pd.KEY_ATTRIBUTES,u),u}let p=async e=>{let t=await (0,r.Lb)(),n=await t.generateSubKey(e,32,1,"loginctx"),a=await t.fromB64(n);return await t.toB64(a.slice(0,16))},y=async(e,t,n)=>{let a=await (0,r.Lb)(),i=await a.generateKeyAndEncryptToB64(t);(0,c.Dt)(e,i);let o=globalThis.electron;o&&!n&&e===c.Qm.ENCRYPTION_KEY&&o.saveMasterKeyB64(t)};async function E(e){let t=await (0,r.Lb)(),n=await f(),a=await t.fromHex(n);return await t.encryptToB64(e,a)}let f=async()=>{try{let e;let t=await (0,r.Lb)(),{recoveryKeyEncryptedWithMasterKey:n,recoveryKeyDecryptionNonce:a}=(0,o.Yu)(o.Pd.KEY_ATTRIBUTES),i=await (0,u.G)();return e=n?await t.decryptB64(n,a,i):await h(),e=await t.toHex(e)}catch(e){throw console.log(e),i.ZP.error("getRecoveryKey failed",e),e}};async function h(){let e=await (0,u.G)(),t=(0,o.Yu)(o.Pd.KEY_ATTRIBUTES),n=await (0,r.Lb)(),i=await n.generateEncryptionKey(),c=await n.encryptToB64(e,i),s=await n.encryptToB64(i,e),d={masterKeyEncryptedWithRecoveryKey:c.encryptedData,masterKeyDecryptionNonce:c.nonce,recoveryKeyEncryptedWithMasterKey:s.encryptedData,recoveryKeyDecryptionNonce:s.nonce};await (0,a.Jl)((0,l.LP)(),d);let p=Object.assign(t,d);return(0,o.a_)(o.Pd.KEY_ATTRIBUTES,p),i}}},function(e){e.O(0,[1708,4373,9668,2888,9774,179],function(){return e(e.s=29856)}),_N_E=e.O()}]);