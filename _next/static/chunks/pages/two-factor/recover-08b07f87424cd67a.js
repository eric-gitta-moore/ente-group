(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9740],{50574:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/two-factor/recover",function(){return n(37086)}])},37086:function(e,t,n){"use strict";n.r(t);var o=n(52903),r=n(8768),a=n(55005);t.default=()=>(0,o.tZ)(r.Z,{appContext:(0,a.useAppContext)(),twoFactorType:"totp"})},34360:function(e,t,n){"use strict";var o,r;n.d(t,{q:function(){return o}}),(r=o||(o={})).ROOT="/",r.CHANGE_EMAIL="/change-email",r.CHANGE_PASSWORD="/change-password",r.CREDENTIALS="/credentials",r.GENERATE="/generate",r.LOGIN="/login",r.RECOVER="/recover",r.SIGNUP="/signup",r.TWO_FACTOR_SETUP="/two-factor/setup",r.TWO_FACTOR_VERIFY="/two-factor/verify",r.TWO_FACTOR_RECOVER="/two-factor/recover",r.VERIFY="/verify",r.SHARED_ALBUMS="/shared-albums"},8768:function(e,t,n){"use strict";var o=n(52903),r=n(30433),a=n(34360),i=n(22969),l=n(10934),c=n(8033),s=n(91430),u=n(60108),d=n(22063),p=n(63462),h=n(83446),f=n(50006),Z=n(27949),E=n(25683),b=n(72595),w=n(80613),C=n(24991),R=n(5632),y=n(2784),_=n(98614);let x=n(36832);x.setDefaultWordlist("english"),t.Z=e=>{let{appContext:t,twoFactorType:n}=e,{logout:T}=t,[m,v]=(0,y.useState)(null),[O,A]=(0,y.useState)(null),[S,g]=(0,y.useState)(!1),V=(0,R.useRouter)();(0,y.useEffect)(()=>{let e=(0,E.Yu)(E.Pd.USER),t=e.passkeySessionID||e.twoFactorSessionID;e&&e.email&&t?!(e.isTwoFactorEnabled||e.isTwoFactorEnabledPasskey)&&(e.encryptedToken||e.token)?V.push(a.q.GENERATE):A(t):V.push("/"),(async()=>{try{let e=await (0,r.fG)(t,n);g(!!e.encryptedSecret),e.encryptedSecret?v({encryptedData:e.encryptedSecret,nonce:e.secretDecryptionNonce}):B({text:(0,C.t)("GO_BACK"),action:V.back})}catch(e){e instanceof Z.MS&&e.httpStatusCode===w.WE.NotFound?T():(l.ZP.error("two factor recovery page setup failed",e),g(!1),B({text:(0,C.t)("GO_BACK"),action:V.back}))}})()},[]);let k=async(e,t)=>{try{if((e=e.trim().split(" ").map(e=>e.trim()).filter(e=>!!e).join(" ")).indexOf(" ")>0){if(24!==e.split(" ").length)throw Error("recovery code should have 24 words");e=x.mnemonicToEntropy(e)}let t=await (0,i.Lb)(),{encryptedData:o,nonce:l}=(0,c.zx)(m),s=await t.decryptB64(o,l,await t.fromHex(e)),{keyAttributes:u,encryptedToken:d,token:p,id:h}=await (0,r.Jr)((0,c.zx)(O),s,n);await (0,E.CA)({...(0,E.Yu)(E.Pd.USER),token:p,encryptedToken:d,id:h,isTwoFactorEnabled:!1}),(0,E.a_)(E.Pd.KEY_ATTRIBUTES,u),V.push(a.q.CREDENTIALS)}catch(e){l.ZP.error("two factor recovery failed",e),t((0,C.t)("INCORRECT_RECOVERY_KEY"))}},B=e=>{t.setDialogBoxAttributesV2({title:(0,C.t)("contact_support"),close:null!=e?e:{},content:(0,o.tZ)(_.cC,{i18nKey:"NO_TWO_FACTOR_RECOVERY_KEY_MESSAGE",components:{a:(0,o.tZ)(b.Z,{href:"mailto:support@ente.io"})},values:{emailID:"support@ente.io"}})})};return S?(0,o.tZ)(s.wx,{children:(0,o.BX)(u.Z,{children:[(0,o.tZ)(p.Z,{children:(0,C.t)("RECOVER_TWO_FACTOR")}),(0,o.tZ)(f.Z,{callback:k,fieldType:"text",placeholder:(0,C.t)("RECOVERY_KEY_HINT"),buttonText:(0,C.t)("RECOVER"),disableAutoComplete:!0}),(0,o.BX)(d.Z,{style:{justifyContent:"space-between"},children:[(0,o.tZ)(h.Z,{onClick:()=>B(),children:(0,C.t)("NO_RECOVERY_KEY")}),(0,o.tZ)(h.Z,{onClick:V.back,children:(0,C.t)("GO_BACK")})]})]})}):(0,o.tZ)(o.HY,{})}},22063:function(e,t,n){"use strict";var o=n(52903),r=n(91430),a=n(37862);n(2784),t.Z=e=>{let{sx:t,style:n,...i}=e;return(0,o.BX)(o.HY,{children:[(0,o.tZ)(a.Z,{}),(0,o.tZ)(r.wx,{style:{flexDirection:"row",...n},sx:{mt:3,...t},...i,children:i.children})]})}},63462:function(e,t,n){"use strict";var o=n(52903),r=n(42541);n(2784),t.Z=e=>{let{sx:t,...n}=e;return(0,o.tZ)(r.Z,{variant:"h2",sx:{mb:8,...t},...n,children:n.children})}},60108:function(e,t,n){"use strict";var o=n(31572),r=n(67295);let a=(0,o.ZP)(r.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(4,2),maxWidth:"360px",width:"100%",textAlign:"left"}});t.Z=a},39382:function(e,t,n){"use strict";var o=n(52903),r=n(73216),a=n(16331),i=n(36673),l=n(53091);n(2784),t.Z=e=>{let{showPassword:t,handleClickShowPassword:n,handleMouseDownPassword:c}=e;return(0,o.tZ)(i.Z,{position:"end",children:(0,o.tZ)(l.Z,{tabIndex:-1,color:"secondary","aria-label":"toggle password visibility",onClick:n,onMouseDown:c,edge:"end",children:t?(0,o.tZ)(a.Z,{}):(0,o.tZ)(r.Z,{})})})}},83446:function(e,t,n){"use strict";var o=n(52903),r=n(72595);n(2784),t.Z=e=>{let{children:t,sx:n,color:a,...i}=e;return(0,o.tZ)(r.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(a,".main"),textDecoration:"underline ",textDecorationColor:"".concat(a,".main")},...n},...i,children:t})}},50006:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var o=n(52903),r=n(91430),a=n(39382),i=n(94848),l=n(10222),c=n(53793),s=n(31708),u=n(24991),d=n(2784),p=n(48601),h=n(43643);function f(e){var t;let{submitButtonProps:n}=e,{sx:f,...Z}=null!=n?n:{},[E,b]=(0,d.useState)(!1),[w,C]=(0,d.useState)(!1),R=async(t,n)=>{let{setFieldError:o,resetForm:r}=n;b(!0),await e.callback(t.inputValue,e=>o("inputValue",e),r),b(!1)},y=()=>{C(!w)},_=e=>{e.preventDefault()},x=(0,d.useMemo)(()=>{switch(e.fieldType){case"text":case"password":return p.Ry().shape({inputValue:p.Z_().required((0,u.t)("REQUIRED"))});case"email":return p.Ry().shape({inputValue:p.Z_().email((0,u.t)("EMAIL_ERROR")).required((0,u.t)("REQUIRED"))})}},[e.fieldType]);return(0,o.tZ)(s.J9,{initialValues:{inputValue:null!==(t=e.initialValue)&&void 0!==t?t:""},onSubmit:R,validationSchema:x,validateOnChange:!1,validateOnBlur:!1,children:t=>{let{values:n,errors:s,handleChange:d,handleSubmit:p}=t;return(0,o.BX)("form",{noValidate:!0,onSubmit:p,children:[e.hiddenPreInput,(0,o.tZ)(c.Z,{hiddenLabel:e.hiddenLabel,variant:"filled",fullWidth:!0,type:w?"text":e.fieldType,id:e.fieldType,name:e.fieldType,...e.hiddenLabel?{placeholder:e.placeholder}:e.realPlaceholder?{placeholder:e.realPlaceholder,label:e.realLabel}:{label:e.placeholder},value:n.inputValue,onChange:d("inputValue"),error:!!s.inputValue,helperText:s.inputValue,disabled:E,autoFocus:!e.disableAutoFocus,autoComplete:e.autoComplete,InputProps:{autoComplete:e.disableAutoComplete||"password"===e.fieldType?"off":"on",endAdornment:"password"===e.fieldType&&(0,o.tZ)(a.Z,{showPassword:w,handleClickShowPassword:y,handleMouseDownPassword:_})}}),(0,o.tZ)(i.Z,{sx:{position:"relative",top:s.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:e.caption}),e.hiddenPostInput,(0,o.BX)(r.A0,{justifyContent:"flex-end",flexWrap:e.blockButton?"wrap-reverse":"nowrap",children:[e.secondaryButtonAction&&(0,o.tZ)(l.Z,{onClick:e.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:e.blockButton?.5:2,mb:e.blockButton?0:4,mr:e.blockButton?0:1,...f}},...Z,children:(0,u.t)("cancel")}),(0,o.tZ)(h.Z,{sx:{"&&&":{mt:2,...f}},buttonText:e.buttonText,loading:E,...Z})]})]})}})}},43643:function(e,t,n){"use strict";var o=n(52903),r=n(53819),a=n(10222),i=n(7706);n(2784),t.Z=e=>{let{loading:t,buttonText:n,disabled:l,success:c,sx:s,...u}=e;return(0,o.tZ)(a.Z,{size:"large",variant:"contained",color:"accent",type:"submit",disabled:l||t||c,sx:{my:4,...t?{"&.Mui-disabled":{backgroundColor:e=>e.colors.accent.A500,color:e=>e.colors.text.base}}:{},...s},...u,children:t?(0,o.tZ)(i.Z,{size:20}):c?(0,o.tZ)(r.Z,{sx:{fontSize:20}}):n})}}},function(e){e.O(0,[1708,4373,9668,2888,9774,179],function(){return e(e.s=50574)}),_N_E=e.O()}]);