"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3359],{68032:function(e,t,n){n.d(t,{ZN:function(){return d},yu:function(){return h},z7:function(){return p}});var i=n(52903),o=n(59315),l=n(24991),r=n(55005),a=n(3359),c=n(2784);let s=e=>e&&e.total>0,d=e=>e&&e.success+e.failed===e.total,u=e=>e&&e.failed>0&&d(e),p=e=>{var t,n;return e&&(null===(n=e.canceller)||void 0===n?void 0:null===(t=n.signal)||void 0===t?void 0:t.aborted)},h=e=>{let{attributesList:t,setAttributesList:n}=e,p=(0,c.useContext)(r.AppContext),h=(0,c.useContext)(a.GalleryContext);if(!t)return(0,i.tZ)(i.HY,{});let Z=e=>{n(t.filter(t=>t.id!==e))},g=e=>{p.setDialogMessage({title:(0,l.t)("STOP_DOWNLOADS_HEADER"),content:(0,l.t)("STOP_ALL_DOWNLOADS_MESSAGE"),proceed:{text:(0,l.t)("YES_STOP_DOWNLOADS"),variant:"critical",action:()=>{null==e||e.canceller.abort(),Z(e.id)}},close:{text:(0,l.t)("no"),variant:"secondary",action:()=>{}}})},f=e=>()=>{d(e)?Z(e.id):g(e)},m=e=>()=>{let n=t.find(t=>t.id===e),i=globalThis.electron;i?i.openDirectory(n.downloadDirPath):n.isHidden?h.openHiddenSection(()=>{h.setActiveCollectionID(n.collectionID)}):h.setActiveCollectionID(n.collectionID)};return(0,i.tZ)(i.HY,{children:t.map((e,t)=>(0,i.tZ)(o.Z,{horizontal:"left",sx:{"&&":{bottom:"".concat(80*t+20,"px")},zIndex:1600},open:s(e),onClose:f(e),keepOpenOnClick:!0,attributes:{variant:u(e)?"critical":"secondary",title:u(e)?(0,l.t)("DOWNLOAD_FAILED"):d(e)?(0,l.t)("DOWNLOAD_COMPLETE"):(0,l.t)("DOWNLOADING_COLLECTION",{name:e.folderName}),caption:d(e)?e.folderName:(0,l.t)("DOWNLOAD_PROGRESS",{progress:{current:e.success+e.failed,total:e.total}}),onClick:m(e.id)}},e.id))})}},13058:function(e,t,n){n.d(t,{Z:function(){return f}});var i=n(73235),o=n(52903),l=n(89668),r=n(31572),a=n(24991),c=n(55005),s=n(2784);function d(){let e=(0,i._)(["\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    cursor: pointer;\n"]);return d=function(){return e},e}function u(){let e=(0,i._)(["\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n"]);return u=function(){return e},e}function p(){let e=(0,i._)(["\n    border-width: 8px;\n    left: 0;\n    top: 0;\n    outline: none;\n    transition: border 0.24s ease-in-out;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-size: 24px;\n    font-weight: 900;\n    text-align: center;\n    position: absolute;\n    border-color: #51cd7c;\n    border-style: solid;\n    background: rgba(0, 0, 0, 0.9);\n    z-index: 3000;\n"]);return p=function(){return e},e}let h=(0,r.ZP)("div")(d()),Z=(0,r.ZP)("div")(u()),g=(0,r.ZP)("div")(p());function f(e){let t=(0,s.useContext)(c.AppContext),[n,i]=(0,s.useState)(!1),r=()=>i(!1);return(0,s.useEffect)(()=>{window.addEventListener("keydown",e=>{"Escape"===e.code&&r()})},[]),(0,s.useEffect)(()=>{let e=e=>{if(!t.watchFolderView)return;e.preventDefault(),e.stopPropagation();let n=e.dataTransfer.files;n.length>0&&t.setWatchFolderFiles(n)};return addEventListener("drop",e),()=>{removeEventListener("drop",e)}},[t.watchFolderView]),(0,o.BX)(Z,{...e.getDragAndDropRootProps({onDragEnter:()=>i(!0)}),children:[n&&(0,o.BX)(g,{onDrop:r,onDragLeave:r,children:[(0,o.tZ)(h,{onClick:r,children:(0,o.tZ)(l.Z,{})}),t.watchFolderView?(0,a.t)("WATCH_FOLDER_DROPZONE_MESSAGE"):(0,a.t)("UPLOAD_DROPZONE_MESSAGE")]}),e.children]})}},39327:function(e,t,n){n.d(t,{Z:function(){return u}});var i=n(52903),o=n(35999),l=n(58488),r=n(36631),a=n(2784),c=n(52482);let s=(0,r.Z)((e,t,n)=>({renderListItem:e,getItemTitle:t,items:n})),d=a.memo(e=>{let{index:t,style:n,data:l}=e,{renderListItem:r,items:a,getItemTitle:c}=l;return(0,i.tZ)(o.Z,{PopperProps:{sx:{".MuiTooltip-tooltip.MuiTooltip-tooltip.MuiTooltip-tooltip":{marginTop:0}}},title:c(a[t]),placement:"bottom-start",enterDelay:300,enterNextDelay:100,children:(0,i.tZ)("div",{style:n,children:r(a[t])})})},c.wy);function u(e){let t=s(e.renderListItem,e.getItemTitle,e.items);return(0,i.tZ)(l.Z,{pl:2,children:(0,i.tZ)(c.t7,{itemData:t,height:Math.min(e.itemSize*e.items.length,e.maxHeight),width:"100%",itemSize:e.itemSize,itemCount:e.items.length,itemKey:(t,n)=>{let{items:i}=n;return e.generateItemKey(i[t])},children:d})})}},33446:function(e,t,n){n.d(t,{f:function(){return l}});var i=n(73235);function o(){let e=(0,i._)(["\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-weight: 900;\n    position: absolute;\n    background: rgba(0, 0, 0, 0.5);\n    z-index: 9000;\n"]);return o=function(){return e},e}let l=(0,n(31572).ZP)("div")(o())},14563:function(e,t,n){n.d(t,{Z:function(){return nm}});var i,o,l=n(73235),r=n(52903),a=n(10934),c=n(52721),s=n(24758),d=n(8620),u=n(27949),p=n(96269),h=n(31572),Z=n(56910),g=n.n(Z),f=n(70098),m=n.n(f),v=n(2784),A=n(77636),C=n(22624),x=n(60373),w=n(61917),y=n(20210),b=n(27677),E=n(77488),I=n(91430),_=n(98996),S=n(48999),T=n(52655),P=n(46573),D=n(89668),R=n(40947),L=n(98642),k=n(49717),O=n(77003),N=n(57253),B=n(34288),M=n(27789),U=n(58853),F=n(97490),H=n(38058),X=n(20646),K=n(10222),W=n(58488),z=n(24991),G=n(72751),Y=n.n(G),V=n(55005),j=n(3359),Q=n(82045),J=n(38924),q=n(50846),$=n(13118),ee=n(42721),et=n(81961),en=n(34349),ei=n(53903),eo=n(84951),el=n(98925),er=n(51861),ea=n(96386),ec=n(12256),es=n(92549),ed=n(86617);let eu=e=>{if(e.pubMagicMetadata){if("string"==typeof e.pubMagicMetadata.data){if(ed.lE)throw Error("Public magic metadata for ".concat((0,E.wM)(e)," had not been decrypted even when the file reached the UI layer"));(0,ei.kw)(e)}return e.pubMagicMetadata.data}};var ep=n(37653),eh=n(56029),eZ=n(7850),eg=n(28936),ef=n(8568),em=n(46467),ev=n(10121),eA=n(34187),eC=n(96566),ex=n(72595),ew=n(42541);let ey=(0,h.ZP)(e=>(0,r.tZ)(K.Z,{color:"secondary",...e}))(e=>{let{theme:t}=e;return{...t.typography.small,padding:"8px"}});var eb=n(46562),eE=n(25312),eI=n(50006);let e_=e=>{let{isInEditMode:t,closeEditMode:n,filename:i,extension:o,saveEdits:l}=e,a=async(e,t)=>{try{await l(e),n()}catch(e){t((0,z.t)("UNKNOWN_ERROR"))}};return(0,r.tZ)(eE.Z,{sx:{zIndex:1600},open:t,onClose:n,attributes:{title:(0,z.t)("rename_file")},children:(0,r.tZ)(eI.Z,{initialValue:i,callback:a,placeholder:(0,z.t)("enter_file_name"),buttonText:(0,z.t)("rename"),fieldType:"text",caption:o,secondaryButtonAction:n,submitButtonProps:{sx:{mt:1,mb:2}}})})};var eS=n(53091);let eT=()=>(0,r.tZ)(_.Z,{style:{width:"20px",height:"20px"}});function eP(e){let{icon:t,title:n,caption:i,openEditor:o,loading:l,hideEditOption:a,customEndButton:c,children:s}=e;return(0,r.BX)(I.A0,{justifyContent:"space-between",children:[(0,r.BX)(W.Z,{display:"flex",alignItems:"flex-start",gap:.5,pr:1,children:[(0,r.tZ)(eS.Z,{color:"secondary",sx:{"&&":{cursor:"default",m:.5}},disableRipple:!0,children:t}),(0,r.tZ)(W.Z,{py:.5,children:s||(0,r.BX)(r.HY,{children:[(0,r.tZ)(ew.Z,{sx:{wordBreak:"break-all"},children:n}),i&&"string"!=typeof i?(0,r.tZ)(ew.Z,{variant:"small",component:"div",color:"text.muted",children:i}):(0,r.tZ)(ew.Z,{variant:"small",color:"text.muted",children:i})]})})]}),c||!a&&(0,r.tZ)(eS.Z,{onClick:o,color:"secondary",children:l?(0,r.tZ)(eT,{}):(0,r.tZ)(k.Z,{})})]})}let eD=(0,h.ZP)(e=>(0,r.tZ)(K.Z,{color:"secondary",...e}))(e=>{let{theme:t}=e;return{...t.typography.small,padding:"8px"}});function eR(){let e=(0,l._)(["\n    height: 200px;\n    width: 100%;\n"]);return eR=function(){return e},e}function eL(){let e=(0,l._)(["\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: rgba(255, 255, 255, 0.09);\n"]);return eL=function(){return e},e}n(79586),n(48974),(0,ed.ly)()&&n(18006);let ek=(0,ed.ly)()?n(85062):null,eO=(0,h.ZP)("div")(eR()),eN=(0,h.ZP)(eO)(eL());var eB=e=>{let{location:t,mapEnabled:n,openUpdateMapConfirmationDialog:i}=e,o=(0,v.useRef)(null);return(0,v.useEffect)(()=>{let e=o.current;if(n){let n=[t.latitude,t.longitude];if(e&&!e.hasChildNodes()){let t=ek.map(e).setView(n,16);ek.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a target="_blank" rel="noopener" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t),ek.marker(n).addTo(t).openPopup()}}else e&&e.hasChildNodes()&&e.firstChild&&e.removeChild(e.firstChild)},[n]),n?(0,r.tZ)(eO,{ref:o}):(0,r.tZ)(eN,{children:(0,r.BX)(eD,{onClick:i,children:[" ",(0,z.t)("ENABLE_MAP")]})})},eM=n(53819),eU=n(53793),eF=n(31708),eH=n(48601);function eX(e){var t;let{file:n,scheduleUpdate:i,refreshPhotoswipe:o,shouldDisableEdits:l}=e,[c,s]=(0,v.useState)(null==n?void 0:null===(t=n.pubMagicMetadata)||void 0===t?void 0:t.data.caption),[d,u]=(0,v.useState)(!1),p=async e=>{try{if(n){if(c===e)return;s(e);let t=await (0,C.gq)(n,e);(0,C.Vz)(n,t),n.title=n.pubMagicMetadata.data.caption,o(),i()}}catch(e){a.ZP.error("failed to update caption",e)}},h=async e=>{try{u(!0),await p(e.caption)}finally{u(!1)}};return(null==c?void 0:c.length)||!l?(0,r.tZ)(W.Z,{p:1,children:(0,r.tZ)(eF.J9,{initialValues:{caption:c},validationSchema:eH.Ry().shape({caption:eH.Z_().max(5e3,(0,z.t)("CAPTION_CHARACTER_LIMIT"))}),validateOnBlur:!1,onSubmit:h,children:e=>{let{values:t,errors:n,handleChange:i,handleSubmit:o,resetForm:a}=e;return(0,r.BX)("form",{noValidate:!0,onSubmit:o,children:[(0,r.tZ)(eU.Z,{hiddenLabel:!0,fullWidth:!0,id:"caption",name:"caption",type:"text",multiline:!0,placeholder:(0,z.t)("CAPTION_PLACEHOLDER"),value:t.caption,onChange:i("caption"),error:!!n.caption,helperText:n.caption,disabled:d||l}),t.caption!==c&&(0,r.BX)(I.A0,{justifyContent:"flex-end",children:[(0,r.tZ)(eS.Z,{type:"submit",disabled:d,children:d?(0,r.tZ)(eT,{}):(0,r.tZ)(eM.Z,{})}),(0,r.tZ)(eS.Z,{onClick:()=>a({values:{caption:null!=c?c:""},touched:{caption:!1}}),disabled:d,children:(0,r.tZ)(D.Z,{})})]})]})}})}):(0,r.tZ)(r.HY,{})}function eK(){let e=(0,l._)(["\n    padding-left: 8px;\n    padding-right: 8px;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n"]);return eK=function(){return e},e}let eW=e=>{var t,n;let{shouldDisableEdits:i,showInfo:o,handleCloseInfo:l,file:a,exif:c,scheduleUpdate:s,refreshPhotoswipe:d,fileToCollectionsMap:u,collectionNameMap:p,showCollectionChips:h,closePhotoViewer:Z,onSelectPerson:g}=e,{mapEnabled:f,updateMapEnabled:m,setDialogBoxAttributesV2:A}=(0,v.useContext)(V.AppContext),C=(0,v.useContext)(j.GalleryContext),x=(0,v.useContext)(q.H),[w,y]=(0,v.useState)(),[b,E]=(0,v.useState)(!1),[I,S]=(0,v.useState)(),T=(0,v.useMemo)(()=>{var e;if(a){let e=(0,ei.Qk)(a);if(e)return e}return null==c?void 0:null===(e=c.parsed)||void 0===e?void 0:e.location},[a,c]);if((0,v.useEffect)(()=>{if(!a)return;let e=!1;return(async()=>{let t=await (0,ea.vP)(a);e||S(t)})(),()=>{e=!0}},[a]),(0,v.useEffect)(()=>{y(ez(c))},[c]),!a)return(0,r.tZ)(r.HY,{});let P=e=>{C.onShowCollection(e),Z()};return(0,r.BX)(eG,{open:o,onClose:l,children:[(0,r.tZ)(et.b,{onClose:l,title:(0,z.t)("INFO"),backIsClose:!0}),(0,r.BX)(eC.Z,{pt:1,pb:3,spacing:"20px",children:[(0,r.tZ)(eX,{file:a,shouldDisableEdits:i,scheduleUpdate:s,refreshPhotoswipe:d}),(0,r.tZ)(eY,{enteFile:a,shouldDisableEdits:i,scheduleUpdate:s}),(0,r.tZ)(eV,{file:a,exifInfo:w,shouldDisableEdits:i,scheduleUpdate:s}),(null==w?void 0:w.takenOnDevice)&&(0,r.tZ)(eP,{icon:(0,r.tZ)(eZ.Z,{}),title:null==w?void 0:w.takenOnDevice,caption:(0,r.tZ)(eQ,{parsedExif:w}),hideEditOption:!0}),T&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(eP,{icon:(0,r.tZ)(ef.Z,{}),title:(0,z.t)("location"),caption:!f||x.accessedThroughSharedURL?(0,r.tZ)(ex.Z,{href:eJ(T),target:"_blank",rel:"noopener",sx:{fontWeight:"bold"},children:(0,z.t)("SHOW_ON_MAP")}):(0,r.tZ)(eb.Z,{onClick:()=>A((0,$.QU)(()=>m(!1))),sx:{textDecoration:"none",color:"text.muted",fontWeight:"bold"},children:(0,z.t)("DISABLE_MAP")}),customEndButton:(0,r.tZ)(es.Z,{code:eJ(T),color:"secondary",size:"medium"})}),!x.accessedThroughSharedURL&&(0,r.tZ)(eB,{location:T,mapEnabled:f,openUpdateMapConfirmationDialog:()=>A((0,$.tJ)(()=>m(!0)))})]}),(0,r.tZ)(eP,{icon:(0,r.tZ)(ev.Z,{}),title:(0,z.t)("DETAILS"),caption:c?c.tags?(0,r.tZ)(eb.Z,{onClick:()=>E(!0),sx:{textDecoration:"none",color:"text.muted",fontWeight:"bold"},children:(0,z.t)("view_exif")}):(0,z.t)("no_exif"):(0,r.tZ)(_.Z,{size:12}),hideEditOption:!0}),h&&(0,r.tZ)(eP,{icon:(0,r.tZ)(eg.Z,{}),hideEditOption:!0,children:(0,r.tZ)(W.Z,{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",children:null==u?void 0:null===(n=u.get(a.id))||void 0===n?void 0:null===(t=n.filter(e=>p.has(e)))||void 0===t?void 0:t.map(e=>(0,r.tZ)(ey,{onClick:()=>P(e),children:p.get(e)},e))})}),(0,ea.MA)()&&I&&(0,r.BX)(r.HY,{children:[(0,r.tZ)(eo.mU,{enteFile:a,annotatedFaceIDs:I.annotatedFaceIDs,onSelectFace:e=>{g&&(g(e.personID),Z())}}),(0,r.tZ)(eo.IA,{enteFile:a,faceIDs:I.otherFaceIDs})]})]}),(0,r.tZ)(eq,{open:b,onClose:()=>E(!1),onInfoClose:l,tags:null==c?void 0:c.tags,fileName:a.metadata.title})]})},ez=e=>{if(!e||!e.tags||!e.parsed)return;let t={...e},{width:n,height:i}=e.parsed;if(n&&i){t.resolution="".concat(n," x ").concat(i);let e=Math.round(n*i/1e6);e&&(t.megaPixels="".concat(e,"MP"))}let{tags:o}=e,{exif:l}=o;return l&&(l.Make&&l.Model&&(t.takenOnDevice="".concat(l.Make.description," ").concat(l.Model.description)),l.FNumber&&(t.fNumber=l.FNumber.description),l.ExposureTime&&(t.exposureTime=l.ExposureTime.description),l.ISOSpeedRatings&&(t.iso="ISO".concat((0,b.A)(l.ISOSpeedRatings)))),t},eG=(0,h.ZP)(e=>(0,r.tZ)(ee.c,{...e,anchor:"right"}))({zIndex:er.g+1,"& .MuiPaper-root":{padding:8}}),eY=e=>{let{enteFile:t,shouldDisableEdits:n,scheduleUpdate:i}=e,[o,l]=(0,v.useState)(!1),[c,s]=(0,v.useState)(!1),d=()=>s(!1),u=eu(t),p=(0,ei.nM)(t,u),h=async e=>{try{if(l(!0),c&&t){let{dateTime:n,timestamp:o}=e;if(o==p.getTime()){d();return}await (0,ei.xS)(t,{dateTime:n,editedTime:o}),i()}}catch(e){a.ZP.error("failed to update creationTime",e)}finally{d(),l(!1)}};return(0,r.tZ)(r.HY,{children:(0,r.BX)(I.A0,{children:[(0,r.tZ)(eP,{icon:(0,r.tZ)(eh.Z,{}),title:(0,ep.p6)(p),caption:(0,ep.mr)(p),openEditor:()=>s(!0),loading:o,hideEditOption:n||c}),c&&(0,r.tZ)(el.Y,{initialValue:p,disabled:o,onAccept:h,onClose:d})]})})},eV=e=>{let{file:t,shouldDisableEdits:n,exifInfo:i,scheduleUpdate:o}=e,[l,a]=(0,v.useState)(!1),s=()=>a(!1),[d,u]=(0,v.useState)(),[p,h]=(0,v.useState)();(0,v.useEffect)(()=>{let[e,n]=(0,w.YA)(t.metadata.title);u(e),h(n)},[t]);let Z=async e=>{if(!t)return;if(d===e){s();return}u(e);let n=[e,p].join("."),i=await (0,C.tc)(t,n);(0,C.Vz)(t,i),o()};return(0,r.BX)(r.HY,{children:[(0,r.tZ)(eP,{icon:t.metadata.fileType===c.Tv.video?(0,r.tZ)(eA.Z,{}):(0,r.tZ)(em.Z,{}),title:[d,p].join("."),caption:ej(t,i),openEditor:()=>a(!0),hideEditOption:n||l}),(0,r.tZ)(e_,{isInEditMode:l,closeEditMode:s,filename:d,extension:p,saveEdits:Z})]})},ej=(e,t)=>{var n;let i=null==t?void 0:t.megaPixels,o=null==t?void 0:t.resolution,l=null===(n=e.info)||void 0===n?void 0:n.fileSize,a=[];return i&&a.push(i),o&&a.push(o),l&&a.push((0,ec.O5)(l)),(0,r.tZ)(I.A0,{gap:1,children:a.map(e=>(0,r.BX)(W.Z,{children:[" ",e]},e))})},eQ=e=>{let{parsedExif:t}=e;return(0,r.BX)(I.A0,{gap:1,children:[(0,r.tZ)(W.Z,{children:t.fNumber}),(0,r.tZ)(W.Z,{children:t.exposureTime}),(0,r.tZ)(W.Z,{children:t.iso})]})},eJ=e=>{let{latitude:t,longitude:n}=e;return"https://www.openstreetmap.org/?mlat=".concat(t,"&mlon=").concat(n,"#map=15/").concat(t,"/").concat(n)},eq=e=>{let{open:t,onClose:n,onInfoClose:i,tags:o,fileName:l}=e;if(!o)return(0,r.tZ)(r.HY,{});let a=Object.entries(o).map(e=>{let[t,n]=e;return Object.entries(n).map(e=>{let[n,i]=e,o="".concat(t,":").concat(n),l="<...>";return"string"==typeof i?l=i:"number"==typeof i?l="".concat(i):i&&"object"==typeof i&&"description"in i&&"string"==typeof i.description&&(l=i.description),[o,t,n,l]})}).flat().filter(e=>{let[,,,t]=e;return t});return(0,r.BX)(eG,{open:t,onClose:n,children:[(0,r.tZ)(et.b,{onClose:n,title:(0,z.t)("exif"),caption:l,onRootClose:()=>{n(),i()},actionButton:(0,r.tZ)(es.Z,{code:JSON.stringify(o),color:"secondary"})}),(0,r.tZ)(eC.Z,{py:3,px:1,spacing:2,children:a.map(e=>{let[t,n,i,o]=e;return(0,r.BX)(e$,{children:[(0,r.BX)(eC.Z,{direction:"row",gap:1,children:[(0,r.tZ)(ew.Z,{variant:"small",color:"text.muted",children:i}),(0,r.tZ)(ew.Z,{variant:"tiny",color:"text.faint",children:n})]}),(0,r.tZ)(en.L,{sx:{width:"100%"},children:o})]},t)})})]})},e$=(0,h.ZP)(W.Z)(eK());var e0=n(58792),e1=n(8033),e2=n(30394),e5=n(72754),e3=n(24570),e4=n(43828),e8=n(12877),e9=n(75372),e6=n(50634),e7=n(47245),te=n(19287),tt=n(7706),tn=n(41479),ti=n(46529),to=n(33967),tl=n(88425),tr=e=>(0,r.BX)(r.HY,{children:[(0,r.BX)(W.Z,{px:"8px",children:[(0,r.tZ)(e0.F_,{title:(0,z.t)("BRIGHTNESS")}),(0,r.tZ)(tl.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:e.brightness,marks:[{value:100,label:"100%"}],onChange:(t,n)=>{e.setBrightness(n)}}),(0,r.tZ)(e0.F_,{title:(0,z.t)("CONTRAST")}),(0,r.tZ)(tl.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:e.contrast,onChange:(t,n)=>{e.setContrast(n)},marks:[{value:100,label:"100%"}]}),(0,r.tZ)(e0.F_,{title:(0,z.t)("BLUR")}),(0,r.tZ)(tl.ZP,{min:0,max:10,defaultValue:0,step:1,valueLabelDisplay:"auto",value:e.blur,onChange:(t,n)=>{e.setBlur(n)}}),(0,r.tZ)(e0.F_,{title:(0,z.t)("SATURATION")}),(0,r.tZ)(tl.ZP,{min:0,max:200,defaultValue:100,step:10,valueLabelDisplay:"auto",value:e.saturation,onChange:(t,n)=>{e.setSaturation(n)},marks:[{value:100,label:"100%"}]})]}),(0,r.tZ)(e0.GP,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(e5.v,{variant:"toggle",checked:e.invert,label:(0,z.t)("INVERT_COLORS"),onClick:()=>{e.setInvert(!e.invert)}})})]});let ta=function(e,t,n,i,o){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=e.getContext("2d");if(!r||!e)return;r.imageSmoothingEnabled=!1;let a=(i-t)*l,c=(o-n)*l,s=new Image;s.src=e.toDataURL(),s.onload=()=>{r.clearRect(0,0,e.width,e.height),e.width=a,e.height=c,r.drawImage(s,t,n,a,c,0,0,a,c)}},tc=(e,t)=>{let n=e.getBoundingClientRect(),i=t.getBoundingClientRect(),o=t.width/i.width,l=(n.left-i.left+window.scrollX)*o,r=(n.top-i.top+window.scrollY)*o,a=l+n.width*o,c=r+n.height*o;return{x1:l,x2:a,y1:r,y2:c}};var ts=e=>{let{canvasRef:t,originalSizeCanvasRef:n,canvasLoading:i,setCanvasLoading:o,setTransformationPerformed:l,setCurrentTab:a}=(0,v.useContext)(tx);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(e0.F_,{title:(0,z.t)("FREEHAND")}),(0,r.tZ)(e0.GP,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(e5.v,{disabled:i,startIcon:(0,r.tZ)(e8.Z,{}),onClick:()=>{if(!e.cropBoxRef.current||!t.current)return;let{x1:i,x2:r,y1:c,y2:s}=tc(e.cropBoxRef.current,t.current);o(!0),l(!0),ta(t.current,i,c,r,s),ta(n.current,i/e.previewScale,c/e.previewScale,r/e.previewScale,s/e.previewScale),e.resetCropBox(),o(!1),a("transform")},label:(0,z.t)("APPLY_CROP")})})]})};let td={position:"absolute",height:"10px",width:"10px",backgroundColor:"white",border:"1px solid black",right:"-5px",bottom:"-5px",cursor:"se-resize"},tu=(0,v.forwardRef)((e,t)=>(0,r.BX)(r.HY,{children:[(0,r.tZ)("div",{style:{position:"absolute",top:0,left:0,right:0,height:e.cropBox.y+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"calc(100% - ".concat(e.cropBox.y+e.cropBox.height,"px)"),backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",top:e.cropBox.y+"px",left:0,width:e.cropBox.x+"px",height:e.cropBox.height+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.tZ)("div",{style:{position:"absolute",top:e.cropBox.y+"px",right:0,width:"calc(100% - ".concat(e.cropBox.x+e.cropBox.width,"px)"),height:e.cropBox.height+"px",backgroundColor:"rgba(0,0,0,0.5)",pointerEvents:"none"}}),(0,r.BX)("div",{style:{display:"grid",position:"absolute",left:e.cropBox.x+"px",top:e.cropBox.y+"px",width:e.cropBox.width+"px",height:e.cropBox.height+"px",border:"1px solid white",gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"0px",zIndex:30},ref:t,children:[Array.from({length:9}).map((e,t)=>(0,r.tZ)("div",{style:{border:"1px solid white",boxSizing:"border-box",pointerEvents:"none"}},t)),(0,r.tZ)("div",{style:td,onMouseDown:t=>{t.preventDefault(),e.setIsDragging(!0)}})]})]}));var tp=n(94647),th=n(66543),tZ=n(46558),tg=n(63696),tf=n(94786),tm=n(15390);let tv=[{width:16,height:9,icon:(0,r.tZ)(tZ.Z,{})},{width:3,height:2,icon:(0,r.tZ)(th.Z,{})},{width:16,height:10,icon:(0,r.tZ)(tp.Z,{})}];var tA=()=>{let{canvasRef:e,originalSizeCanvasRef:t,canvasLoading:n,setCanvasLoading:i,setTransformationPerformed:o}=(0,v.useContext)(tx),l=(e,t,n)=>{let i=e.getContext("2d"),o=t/n;if(!i||!e)return;i.imageSmoothingEnabled=!1;let l=new Image;l.src=e.toDataURL(),l.onload=()=>{let t=l.width,n=l.height,r=0,a=0;t/n>o?r=(t-n*o)/2:a=(n-t/o)/2;let c=t-2*r,s=n-2*a;i.clearRect(0,0,e.width,e.height),e.width=c,e.height=s,i.drawImage(l,r,a,c,s,0,0,c,s)}},c=(e,t)=>{let n=e.getContext("2d");if(!n||!e)return;n.resetTransform(),n.imageSmoothingEnabled=!1;let i=new Image;i.src=e.toDataURL(),i.onload=()=>{n.clearRect(0,0,e.width,e.height),n.save(),"horizontal"===t?(n.translate(e.width,0),n.scale(-1,1)):(n.translate(0,e.height),n.scale(1,-1)),n.drawImage(i,0,0,e.width,e.height),n.restore()}},s=(e,t)=>{let n=null==e?void 0:e.getContext("2d");if(!n||!e)return;n.imageSmoothingEnabled=!1;let i=new Image;i.src=e.toDataURL(),i.onload=()=>{n.clearRect(0,0,e.width,e.height),n.save();let o=t*Math.PI/180,l=Math.sin(o),r=Math.cos(o),a=Math.abs(i.width*r)+Math.abs(i.height*l),c=Math.abs(i.width*l)+Math.abs(i.height*r);e.width=a,e.height=c,n.translate(e.width/2,e.height/2),n.rotate(o),n.drawImage(i,-i.width/2,-i.height/2,i.width,i.height),n.restore()}},d=(n,r)=>()=>{try{i(!0),l(e.current,n,r),l(t.current,n,r),i(!1),o(!0)}catch(e){a.ZP.error("crop handler failed - ".concat(JSON.stringify({widthRatio:n,heightRatio:r})),e)}},u=n=>()=>{try{i(!0),s(e.current,"left"===n?-90:90),s(t.current,"left"===n?-90:90),i(!1),o(!0)}catch(e){a.ZP.error("rotation handler (".concat(n,") failed"),e)}},p=n=>()=>{try{i(!0),c(e.current,n),c(t.current,n),i(!1),o(!0)}catch(e){a.ZP.error("flip handler ".concat(n," failed"),e)}};return(0,r.BX)(r.HY,{children:[(0,r.tZ)(e0.F_,{title:(0,z.t)("ASPECT_RATIO")}),(0,r.tZ)(e0.GP,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(e5.v,{disabled:n,startIcon:(0,r.tZ)(tZ.Z,{}),onClick:d(1,1),label:(0,z.t)("SQUARE")+" (1:1)"})}),(0,r.tZ)(e0.GP,{style:{marginBottom:"1rem"},children:tv.map((e,t)=>(0,r.BX)(v.Fragment,{children:[(0,r.tZ)(e5.v,{disabled:n,startIcon:e.icon,onClick:d(e.width,e.height),label:"".concat(e.width,":").concat(e.height)}),t!==tv.length-1&&(0,r.tZ)(e0.NP,{})]},t))}),(0,r.tZ)(e0.GP,{style:{marginBottom:"1rem"},children:tv.map((e,t)=>(0,r.BX)(v.Fragment,{children:[(0,r.tZ)(e5.v,{disabled:n,startIcon:e.icon,onClick:d(e.height,e.width),label:"".concat(e.height,":").concat(e.width)},t),t!==tv.length-1&&(0,r.tZ)(e0.NP,{})]},t))}),(0,r.tZ)(e0.F_,{title:(0,z.t)("ROTATION")}),(0,r.BX)(e0.GP,{style:{marginBottom:"1rem"},children:[(0,r.tZ)(e5.v,{disabled:n,startIcon:(0,r.tZ)(tf.Z,{}),onClick:u("left"),label:(0,z.t)("ROTATE_LEFT")+" 90˚"}),(0,r.tZ)(e0.NP,{}),(0,r.tZ)(e5.v,{disabled:n,startIcon:(0,r.tZ)(tm.Z,{}),onClick:u("right"),label:(0,z.t)("ROTATE_RIGHT")+" 90˚"})]}),(0,r.tZ)(e0.F_,{title:(0,z.t)("FLIP")}),(0,r.BX)(e0.GP,{style:{marginBottom:"1rem"},children:[(0,r.tZ)(e5.v,{disabled:n,startIcon:(0,r.tZ)(tg.Z,{style:{transform:"rotateZ(90deg)"}}),onClick:p("vertical"),label:(0,z.t)("FLIP_VERTICALLY")}),(0,r.tZ)(e0.NP,{}),(0,r.tZ)(e5.v,{disabled:n,startIcon:(0,r.tZ)(tg.Z,{}),onClick:p("horizontal"),label:(0,z.t)("FLIP_HORIZONTALLY")})]})]})};let tC={brightness:100,contrast:100,blur:0,saturation:100,invert:!1},tx=(0,v.createContext)({});var tw=e=>{let t=(0,v.useContext)(V.AppContext),n=(0,v.useRef)(null),i=(0,v.useRef)(null),o=(0,v.useRef)(null),[l,c]=(0,v.useState)(""),[d,u]=(0,v.useState)(),[p,h]=(0,v.useState)(0),[Z,g]=(0,v.useState)("transform"),[f,m]=(0,v.useState)(tC.brightness),[C,x]=(0,v.useState)(tC.contrast),[w,y]=(0,v.useState)(tC.blur),[b,E]=(0,v.useState)(tC.saturation),[_,S]=(0,v.useState)(tC.invert),[T,R]=(0,v.useState)(!1),[L,k]=(0,v.useState)(!1),[O,N]=(0,v.useState)(!1),[B,M]=(0,v.useState)(!0),[U,F]=(0,v.useState)(0),[H,X]=(0,v.useState)({x:0,y:0,width:100,height:100}),[K,G]=(0,v.useState)(0),[Y,j]=(0,v.useState)(0),[Q,J]=(0,v.useState)(0),[q,et]=(0,v.useState)(0),[en,ei]=(0,v.useState)(!1),[eo,el]=(0,v.useState)(!1),er=(0,v.useRef)(null),ea=()=>{let e={height:n.current.height,width:n.current.width},t=o.current.getBoundingClientRect(),i=(t.width-e.width)/2;return{offsetY:(t.height-e.height)/2,offsetX:i,canvasBounds:e,parentBounds:t}},ec=()=>{X(e=>{let{offsetX:t,offsetY:n,canvasBounds:i}=ea();return{...e,x:t,y:n,height:i.height,width:i.width}})};(0,v.useEffect)(()=>{if(n.current)try{es([n.current,i.current]),k(f!==tC.brightness||C!==tC.contrast||w!==tC.blur||b!==tC.saturation||_!==tC.invert)}catch(e){a.ZP.error("Error applying filters",e)}},[f,C,w,b,_,n,l]),(0,v.useEffect)(()=>{"crop"===Z&&(ec(),M(!1))},[Z]);let es=async e=>{try{for(let t of e){let e=Math.min(t.width,t.height)/Math.min(n.current.width,n.current.height)*w,i="brightness(".concat(f,"%) contrast(").concat(C,"%) blur(").concat(e,"px) saturate(").concat(b,"%) invert(").concat(_?1:0,")"),o=t.getContext("2d");o.imageSmoothingEnabled=!1,o.filter=i;let r=new Image;r.src=l,await new Promise((e,n)=>{r.onload=()=>{try{o.clearRect(0,0,t.width,t.height),o.save(),o.drawImage(r,0,0,t.width,t.height),o.restore(),e(!0)}catch(e){n(e)}}})}}catch(e){throw a.ZP.error("Error applying filters",e),e}};(0,v.useEffect)(()=>{(p>=360||p<=-360)&&h(0)},[p]);let ed=()=>{m(100),x(100),y(0),E(100),S(!1)},eu=async()=>{try{if(!n.current||!o.current||!i.current)return;N(!0),ed(),h(0);let t=new Image,r=n.current.getContext("2d");if(r.imageSmoothingEnabled=!1,l)t.src=l;else{let n=await s.Z.getFileForPreview(e.file);t.src=n.url,c(n.url),u(n.mimeType)}await new Promise((e,l)=>{t.onload=()=>{try{let l=Math.min(o.current.clientWidth/t.width,o.current.clientHeight/t.height);F(l);let a=t.width*l,c=t.height*l;n.current.width=a,n.current.height=c,null==r||r.drawImage(t,0,0,a,c),i.current.width=t.width,i.current.height=t.height;let s=i.current.getContext("2d");null==s||s.drawImage(t,0,0,t.width,t.height),R(!1),k(!1),N(!1),ec(),G(0),j(0),ei(!1),el(!1),e(!0)}catch(e){l(e)}},t.onerror=e=>{l(e)}})}catch(e){a.ZP.error("Error loading canvas",e)}};(0,v.useEffect)(()=>{e.show&&e.file&&eu()},[e.show,e.file]);let ep=()=>{c(null),e.onClose()},eh=()=>{T||L?t.setDialogBoxAttributesV2((0,$.Et)(ep)):ep()};if(!e.show)return(0,r.tZ)(r.HY,{});let eZ=async()=>ty((0,e1.zx)(i.current),e.file.metadata.title,d),eg=async()=>{if(!n.current)return;let e=await eZ();(0,e3.Et)(URL.createObjectURL(e),e.name)},ef=async()=>{if(n.current)try{let t=(await (0,A.zr)()).find(t=>t.id===e.file.collectionID),n={uploadItem:await eZ(),localID:1,collectionID:e.file.collectionID};to.Z.prepareForNewUpload(),to.Z.showUploadProgressDialog(),to.Z.uploadItems([n],[t]),c(null),e.onClose(),e.closePhotoViewer()}catch(e){a.ZP.error("Error saving copy to ente",e)}};return(0,r.tZ)(r.HY,{children:(0,r.BX)(te.Z,{sx:{background:"#000",zIndex:1600,width:"100%"},open:!0,children:[(0,r.BX)(W.Z,{padding:"1rem",width:"100%",height:"100%",children:[(0,r.BX)(I.cD,{justifyContent:"space-between",alignItems:"center",children:[(0,r.tZ)(ew.Z,{variant:"h2",fontWeight:"bold",children:(0,z.t)("PHOTO_EDITOR")}),(0,r.tZ)(eS.Z,{onClick:()=>{M(!0)},children:(0,r.tZ)(e7.Z,{})})]}),(0,r.tZ)(W.Z,{width:"100%",height:"100%",overflow:"hidden",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",onMouseUp:()=>{G(0),j(0),el(!1),ei(!1)},onMouseMove:en?e=>{if(!en&&!eo)return;let t=e.pageX-K,n=e.pageY-Y,{offsetX:i,offsetY:o,canvasBounds:l}=ea();eo?X(e=>{let r=Math.min(q+t,l.width-e.x+i),a=Math.min(Q+n,l.height-e.y+o);return{...e,width:r,height:a}}):(X(e=>{let r=e.x+t,a=e.y+n;return r=Math.max(i,Math.min(r,i+l.width-e.width)),a=Math.max(o,Math.min(a,o+l.height-e.height)),{...e,x:r,y:a}}),G(e.pageX),j(e.pageY))}:null,onMouseDown:e=>{if("crop"!==Z)return;let t=er.current.getBoundingClientRect(),n=e.pageX-t.left-t.width/2,i=e.pageY-t.top-t.height/2,o=e.pageX<t.left+20||e.pageX>t.right-20,l=e.pageY<t.top+20||e.pageY>t.bottom-20;if(o&&l){el(!0),G(e.pageX),j(e.pageY),et(H.width),J(H.height);return}ei(!0),G(e.pageX-n),j(e.pageY-i)},children:(0,r.BX)(W.Z,{style:{position:"relative",width:"100%",height:"100%"},children:[(0,r.BX)(W.Z,{height:"90%",width:"100%",ref:o,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",children:[(null===l||O)&&(0,r.tZ)(tt.Z,{}),(0,r.tZ)("canvas",{ref:n,style:{objectFit:"contain",display:null===l||O?"none":"block",position:"absolute"}}),(0,r.tZ)("canvas",{ref:i,style:{display:"none"}}),"crop"===Z&&(0,r.tZ)(tu,{cropBox:H,ref:er,setIsDragging:ei})]}),"crop"===Z&&(0,r.tZ)(I.Tn,{marginTop:"1rem",children:(0,r.tZ)(e2.Z,{color:"accent",startIcon:(0,r.tZ)(e8.Z,{}),onClick:()=>{if(!er.current||!n.current)return;let{x1:e,x2:t,y1:o,y2:l}=tc(er.current,n.current);N(!0),R(!0),ta(n.current,e,o,t,l),ta(i.current,e/U,o/U,t/U,l/U),ec(),N(!1),g("transform")},children:(0,z.t)("APPLY_CROP")})})]})})]}),(0,r.BX)(ee.c,{variant:"persistent",anchor:"right",open:B,onClose:eh,children:[(0,r.BX)(I.cD,{justifyContent:"space-between",children:[(0,r.tZ)(eS.Z,{onClick:()=>{M(!1)},children:(0,r.tZ)(P.Z,{})}),(0,r.tZ)(eS.Z,{onClick:eh,children:(0,r.tZ)(D.Z,{})})]}),(0,r.tZ)(I.cD,{gap:"0.5rem",marginBottom:"1rem",children:(0,r.BX)(tn.Z,{value:Z,onChange:(e,t)=>{g(t)},children:[(0,r.tZ)(ti.Z,{label:(0,z.t)("editor.crop"),value:"crop"}),(0,r.tZ)(ti.Z,{label:(0,z.t)("TRANSFORM"),value:"transform"}),(0,r.tZ)(ti.Z,{label:(0,z.t)("COLORS"),value:"colours",disabled:T})]})}),(0,r.tZ)(e0.F_,{title:(0,z.t)("reset")}),(0,r.tZ)(e0.GP,{style:{marginBottom:"0.5rem"},children:(0,r.tZ)(e5.v,{disabled:O,startIcon:(0,r.tZ)(e9.Z,{}),onClick:()=>{eu()},label:(0,z.t)("RESTORE_ORIGINAL")})}),(0,r.BX)(tx.Provider,{value:{originalSizeCanvasRef:i,canvasRef:n,setCanvasLoading:N,canvasLoading:O,setTransformationPerformed:R,setCurrentTab:g},children:["crop"===Z&&(0,r.tZ)(ts,{previewScale:U,cropBoxProps:H,cropBoxRef:er,resetCropBox:ec}),"transform"===Z&&(0,r.tZ)(tA,{})]}),"colours"===Z&&(0,r.tZ)(tr,{brightness:f,contrast:C,saturation:b,blur:w,invert:_,setBrightness:m,setContrast:x,setSaturation:E,setBlur:y,setInvert:S}),(0,r.tZ)(e0.F_,{title:(0,z.t)("EXPORT")}),(0,r.BX)(e0.GP,{children:[(0,r.tZ)(e5.v,{startIcon:(0,r.tZ)(e6.Z,{}),onClick:eg,label:(0,z.t)("DOWNLOAD_EDITED"),disabled:!T&&!L}),(0,r.tZ)(e0.NP,{}),(0,r.tZ)(e5.v,{startIcon:(0,r.tZ)(e4.Z,{}),onClick:ef,label:(0,z.t)("SAVE_A_COPY_TO_ENTE"),disabled:!T&&!L})]}),!T&&!L&&(0,r.tZ)(e0.F_,{title:(0,z.t)("PHOTO_EDIT_REQUIRED_TO_SAVE")})]})]})})};let ty=async(e,t,n)=>{new Image().src=e.toDataURL();let[i,o]=["image/png","png"];switch(n){case"image/jpeg":i=n,o="jpeg";break;case"image/webp":i=n,o="webp"}let l=(0,e1.zx)(await new Promise(t=>e.toBlob(t,i))),[r]=(0,w.YA)(t),c="".concat(r,"-edited.").concat(o);return a.ZP.debug(()=>["canvas => file",{blob:l,type:l.type,mimeType:i}]),new File([l],c)};var tb=function(e){return(0,r.BX)(r.HY,{children:[(0,r.tZ)(tt.Z,{variant:"determinate",...e,color:"accent"}),(0,r.tZ)(I.aV,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"40px"},children:(0,r.tZ)(ew.Z,{variant:"mini",component:"div",color:"text.secondary",children:"".concat(Math.round(e.value),"%")})})]})},tE=n(59315);let tI=e=>{let{open:t,onClose:n,onClick:i}=e;return(0,r.tZ)(tE.Z,{open:t,onClose:n,attributes:{variant:"secondary",subtext:(0,z.t)("CONVERSION_FAILED_NOTIFICATION_MESSAGE"),onClick:i},horizontal:"right",vertical:"bottom",sx:{zIndex:4e3}})};var t_=n(67295);function tS(){let e=(0,l._)(["\n    border-radius: 4px;\n    position: absolute;\n    bottom: 10vh;\n    right: 6vh;\n    z-index: 10;\n"]);return tS=function(){return e},e}let tT=(0,h.ZP)(t_.Z)(tS()),tP={click:()=>{},hide:()=>{},show:()=>{},loading:!1,visible:!1},tD=["beforeChange","afterChange","imageLoadComplete","resize","gettingData","mouseUsed","initialZoomIn","initialZoomInEnd","initialZoomOut","initialZoomOutEnd","parseVerticalMargin","close","unbindEvents","destroy","updateScrollOffset","preventDragEvent","shareLinkClick"],tR=(0,h.ZP)("div")(e=>{let{theme:t}=e;return{padding:t.spacing(2),wordBreak:"break-word",textAlign:"right",maxWidth:"375px",fontSize:"14px",lineHeight:"17px",backgroundColor:t.colors.backdrop.faint,backdropFilter:"blur(".concat(t.colors.blur.base,")")}});var tL=function(e){var t,n;let i=(0,v.useContext)(j.GalleryContext),o=(0,v.useContext)(V.AppContext),l=(0,v.useContext)(q.H),{isOpen:d,items:u}=e,p=(0,v.useRef)(),[h,Z]=(0,v.useState)(),[f,G]=(0,v.useState)(!1),[ee,et]=(0,v.useState)(!1),[en,ei]=(0,v.useState)(),eo=(0,v.useRef)(null),[el,er]=(0,v.useState)(tP),[ea,ec]=(0,v.useState)(!1),[es,ed]=(0,v.useState)(!1),[eu,ep]=(0,v.useState)(!1),[eh,eZ]=(0,v.useState)(!1),eg=(0,v.useRef)(!1),ef=(0,v.useRef)(null),em=(0,v.useMemo)(()=>"undefined"!=typeof ClipboardItem,[]),[ev,eA]=(0,v.useState)(!1),[eC,ex]=(0,v.useState)(!1),[ew,ey]=(0,v.useState)(new Map),[eb,eE]=(0,v.useState)(!1),[eI,e_]=(0,v.useState)(!1);function eS(e){var t;if(e.metadata.fileType===c.Tv.video){ei({key:e.src,value:{tags:void 0,parsed:void 0}});return}if(!e||!e.isSourceLoaded||e.conversionFailed)return;let n=e.metadata.fileType===c.Tv.image?e.src:e.srcURLs.url.image;(null==eo?void 0:null===(t=eo.current)||void 0===t?void 0:t.key)!==n&&(ei({key:n,value:void 0}),eH(e))}function eT(e){ed(Y()()&&(e.metadata.fileType===c.Tv.video||e.metadata.fileType===c.Tv.livePhoto)&&!e.isConverted&&e.isSourceLoaded&&!e.conversionFailed)}function eP(e){ex(e.conversionFailed)}function eD(e){ep(e.isSourceLoaded)}(0,v.useEffect)(()=>{s.Z.setProgressUpdater(ey)},[]),(0,v.useEffect)(()=>{if(p)return d&&eR(),d||eL(),()=>{eL()}},[d]),(0,v.useEffect)(()=>{if(h)return window.addEventListener("keyup",t),em&&window.addEventListener("copy",e),()=>{window.removeEventListener("keyup",t),em&&window.removeEventListener("copy",e)};function e(){d&&!ee&&eG(h.currItem)}function t(e){if(d&&!ee)switch(a.ZP.debug(()=>"Event: "+e.key),e.key){case"i":case"I":et(!0);break;case"Backspace":case"Delete":eM(null==h?void 0:h.currItem);break;case"d":case"D":ez(null==h?void 0:h.currItem);break;case"f":case"F":eY(h);break;case"l":case"L":eN(null==h?void 0:h.currItem);break;case"ArrowLeft":eU(e,"left");break;case"ArrowRight":eU(e,"right")}}},[d,h,ee]),(0,v.useEffect)(()=>{h&&(h.options.escKey=!ee)},[ee]),(0,v.useEffect)(()=>{if(!d)return;let e=u[null==h?void 0:h.getCurrentIndex()];if(!e)return;if(e.metadata.fileType===c.Tv.livePhoto){let{video:t,image:n}={video:document.getElementById("live-photo-video-".concat(e.id)),image:document.getElementById("live-photo-image-".concat(e.id))};t&&n?er({click:async()=>{await (0,J.Kz)(t,n)},hide:async()=>{await (0,J.r)(t,n)},show:async()=>{await (0,J.Kz)(t,n)},visible:!0,loading:!1}):er({...tP,visible:!0,loading:!0})}let t=document.getElementById("download-btn-".concat(e.id)),n=()=>{ez(h.currItem)};return t&&t.addEventListener("click",n),()=>{t&&t.removeEventListener("click",n),er(tP)}},[null==h?void 0:h.currItem,d,eu]),(0,v.useEffect)(()=>{eo.current=en},[en]);let eR=()=>{let{items:t,currentIndex:n}=e,o=new(g())(p.current,m(),t,{history:!1,maxSpreadZoom:5,index:n,showHideOpacity:!0,arrowKeys:!1,getDoubleTapZoom:(e,t)=>e?2.5:t.initialZoomLevel<.7?1:1.5,getThumbBoundsFn:e=>{try{let n=t[e],i=document.getElementById("thumb-".concat(n.id));if(i){let e=i.getBoundingClientRect(),t=window.pageYOffset||document.documentElement.scrollTop;return{x:e.left,y:e.top+t,w:e.width}}return null}catch(e){return null}}});tD.forEach(t=>{let n=e[t];(n||"destroy"===t)&&o.listen(t,function(){for(var e=arguments.length,i=Array(e),l=0;l<e;l++)i[l]=arguments[l];n&&(i.unshift(o),n(...i)),"destroy"===t&&ek(),"close"===t&&ek()})}),o.listen("beforeChange",()=>{var e;if(!(null==o?void 0:o.currItem))return;let t=o.currItem;for(let e of document.getElementsByTagName("video"))e.pause();G(eO(t)),ec(!l.accessedThroughSharedURL&&(null===(e=i.user)||void 0===e?void 0:e.id)===t.ownerID),eP(t),eS(t),eT(t),eD(t),function(e){let t=(0,w.qN)(e.metadata.title),n=!0;(0,y.f)(t)&&!x.nI&&(n=(0,y.l)(t)),eE(e.metadata.fileType===c.Tv.image&&n)}(t),e_(t.metadata.fileType===c.Tv.image)}),o.listen("resize",()=>{if(!(null==o?void 0:o.currItem))return;let e=o.currItem;eS(e),eP(e),eT(e),eD(e)}),o.init(),eg.current=!1,eZ(!1),Z(o)},eL=()=>{h&&h.close()},ek=()=>{let{onClose:t}=e;for(let e of("function"==typeof t&&t(eg.current),document.getElementsByTagName("video")))e.pause();eX()},eO=t=>{let{favItemIds:n}=e;return!!n&&!!t&&n.has(t.id)},eN=async t=>{try{if(!t||e.isTrashCollection||!ea||e.isInHiddenSection)return;let{favItemIds:n}=e;eO(t)?(n.delete(t.id),(0,A.zm)(t),G(!1)):(n.add(t.id),(0,A._p)(t),G(!0)),eg.current=!0}catch(e){a.ZP.error("onFavClick failed",e)}},eB=async t=>{let{tempDeletedFileIds:n,setTempDeletedFileIds:i}=e;try{o.startLoading(),await (0,Q.N5)([t]),o.finishLoading(),n.add(t.id),i(new Set(n)),eF(e.items.filter(e=>e.id!==t.id)),eg.current=!0}catch(e){a.ZP.error("trashFile failed",e)}},eM=t=>{t&&ea&&!e.isTrashCollection&&o.setDialogMessage((0,$.Db)(()=>eB(t)))},eU=(e,t)=>{e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||("left"===t?h.prev():h.next())},eF=e=>{try{h&&(0===e.length&&h.close(),h.items.length=0,e.forEach(e=>{h.items.push(e)}),h.invalidateCurrItems(),d&&(h.updateSize(!0),h.getCurrentIndex()>=h.items.length&&h.goTo(0)))}catch(e){a.ZP.error("updateItems failed",e)}},eH=async e=>{if(ef.current!==e.src)try{ef.current=e.src;let t=await (0,C.G5)(e.metadata.fileType===c.Tv.image?e.src:e.srcURLs.url.image,e.metadata.title),n=await (0,b.nF)(t),i=(0,b.RC)(n);ef.current===e.src&&ei({key:e.src,value:{tags:n,parsed:i}})}catch(t){a.ZP.error("Failed to extract Exif from ".concat((0,E.wM)(e)),t),ei({key:e.src,value:{tags:void 0,parsed:void 0}})}finally{ef.current=null}},eX=()=>{et(!1)},eK=e=>{if(eh){var t;let n=null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.getFullscreenAPI();n&&n.isFullscreen()&&(n.exit(),eZ(!1))}et(!0)},ez=async t=>{if(t&&e.enableDownload&&e.setFilesDownloadProgressAttributesCreator)try{let n=e.setFilesDownloadProgressAttributesCreator(t.metadata.title);await (0,C.ae)(t,n)}catch(e){}},eG=async t=>{t&&e.enableDownload&&em&&(o.startLoading(),await (0,C.C2)(t.src),o.finishLoading())},eY=e=>{var t;let n=null==e?void 0:null===(t=e.ui)||void 0===t?void 0:t.getFullscreenAPI();n&&(n.isFullscreen()?(n.exit(),eZ(!1)):(n.enter(),eZ(!0)))},{id:eV}=e;return(0,r.BX)(r.HY,{children:[(0,r.BX)("div",{id:eV,className:"pswp",tabIndex:Number("-1"),role:"dialog","aria-hidden":"true",ref:p,children:[(0,r.tZ)("div",{className:"pswp__bg"}),(0,r.BX)("div",{className:"pswp__scroll-wrap",children:[el.visible&&(0,r.tZ)(tT,{children:(0,r.tZ)(K.Z,{color:"secondary",onClick:el.click,onMouseEnter:el.show,onMouseLeave:el.hide,disabled:el.loading,children:(0,r.BX)(I.A0,{gap:"4px",children:[(0,r.tZ)(S.Z,{})," ",(0,z.t)("LIVE")]})})}),(0,r.tZ)(tI,{open:eC,onClose:()=>ex(!1),onClick:()=>ez(h.currItem)}),(0,r.tZ)(W.Z,{sx:{position:"absolute",top:"10vh",right:"2vh",zIndex:10},children:ew.has(null==h?void 0:null===(t=h.currItem)||void 0===t?void 0:t.id)?(0,r.tZ)(tb,{value:ew.get(null===(n=h.currItem)||void 0===n?void 0:n.id)}):!eu&&(0,r.tZ)(_.Z,{})}),(0,r.BX)("div",{className:"pswp__container",children:[(0,r.tZ)("div",{className:"pswp__item"}),(0,r.tZ)("div",{className:"pswp__item"}),(0,r.tZ)("div",{className:"pswp__item"})]}),(0,r.BX)("div",{className:"pswp__ui pswp__ui--hidden",children:[(0,r.BX)("div",{className:"pswp__top-bar",children:[(0,r.tZ)("div",{className:"pswp__counter"}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,z.t)("close_key"),onClick:ek,children:(0,r.tZ)(D.Z,{})}),e.enableDownload&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,z.t)("download_key"),onClick:()=>ez(h.currItem),children:(0,r.tZ)(B.Z,{})}),e.enableDownload&&em&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,z.t)("copy_key"),onClick:()=>eG(h.currItem),children:(0,r.tZ)(R.Z,{fontSize:"small"})}),ea&&!e.isTrashCollection&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,z.t)("DELETE_OPTION"),onClick:()=>{eM(null==h?void 0:h.currItem)},children:(0,r.tZ)(L.Z,{})}),eI&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{if(!h)return;let e=h.currItem.initialZoomLevel;h.getZoomLevel()!==e?h.zoomTo(e,{x:h.viewportSize.x/2,y:h.viewportSize.y/2},333):h.zoomTo(h.options.getDoubleTapZoom(!0,h.currItem),{x:h.viewportSize.x/2,y:h.viewportSize.y/2},333)},title:(0,z.t)("zoom_in_out_key"),children:(0,r.tZ)(X.Z,{})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{eY(h)},title:(0,z.t)("toggle_fullscreen_key"),children:eh?(0,r.tZ)(M.Z,{sx:{fontSize:32}}):(0,r.tZ)(U.Z,{sx:{fontSize:32}})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",title:(0,z.t)("INFO_OPTION"),onClick:()=>eK(h),children:(0,r.tZ)(F.Z,{})}),ea&&!e.isTrashCollection&&!e.isInHiddenSection&&(0,r.BX)(r.HY,{children:[eb&&(0,r.tZ)("button",{className:"pswp__button pswp__button--custom",onClick:()=>{eA(!0)},children:(0,r.tZ)(k.Z,{})}),(0,r.tZ)("button",{title:f?(0,z.t)("UNFAVORITE_OPTION"):(0,z.t)("FAVORITE_OPTION"),className:"pswp__button pswp__button--custom",onClick:()=>{eN(null==h?void 0:h.currItem)},children:f?(0,r.tZ)(N.Z,{}):(0,r.tZ)(O.Z,{})})]}),es&&(0,r.tZ)("button",{title:(0,z.t)("CONVERT"),className:"pswp__button pswp__button--custom",onClick:()=>{e.getConvertedItem(h,h.getCurrentIndex(),h.currItem)},children:(0,r.tZ)(H.Z,{fontSize:"small"})}),(0,r.tZ)("div",{className:"pswp__preloader"})]}),(0,r.tZ)("button",{className:"pswp__button pswp__button--arrow--left",title:(0,z.t)("previous_key"),children:(0,r.tZ)(T.Z,{sx:{pointerEvents:"none"}})}),(0,r.tZ)("button",{className:"pswp__button pswp__button--arrow--right",title:(0,z.t)("next_key"),children:(0,r.tZ)(P.Z,{sx:{pointerEvents:"none"}})}),(0,r.tZ)("div",{className:"pswp__caption pswp-custom-caption-container",children:(0,r.tZ)(tR,{})})]})]})]}),(0,r.tZ)(eW,{showInfo:ee,handleCloseInfo:eX,closePhotoViewer:ek,file:null==h?void 0:h.currItem,exif:null==en?void 0:en.value,shouldDisableEdits:!ea,showCollectionChips:!e.isTrashCollection&&ea&&!e.isInHiddenSection,scheduleUpdate:()=>eg.current=!0,refreshPhotoswipe:()=>{try{h.invalidateCurrItems(),d&&h.updateSize(!0)}catch(e){a.ZP.error("refreshPhotoswipe failed",e)}},fileToCollectionsMap:e.fileToCollectionsMap,collectionNameMap:e.collectionNameMap,onSelectPerson:e.onSelectPerson}),(0,r.tZ)(tw,{show:ev,file:null==h?void 0:h.currItem,onClose:()=>{eA(!1)},closePhotoViewer:ek})]})},tk=n(5632),tO=n(6738),tN=n(26552),tB=n(98977),tM=n(73832),tU=n(36631),tF=n(52482);function tH(){let e=(0,l._)(["\n    display: flex;\n    justify-content: center;\n"]);return tH=function(){return e},e}function tX(){let e=(0,l._)(["\n    display: grid;\n    grid-template-columns: ",";\n    grid-column-gap: ","px;\n    width: 100%;\n    color: #fff;\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n"]);return tX=function(){return e},e}function tK(){let e=(0,l._)(["\n    grid-column: span ",";\n"]);return tK=function(){return e},e}function tW(){let e=(0,l._)(["\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: ","px;\n    color: ",";\n"]);return tW=function(){return e},e}function tz(){let e=(0,l._)(["\n    margin-top: 1rem;\n    height: ","px;\n"]);return tz=function(){return e},e}(i=o||(o={})).TIME="TIME",i.FILE="FILE",i.SIZE_AND_COUNT="SIZE_AND_COUNT",i.HEADER="HEADER",i.FOOTER="FOOTER",i.MARKETING_FOOTER="MARKETING_FOOTER",i.OTHER="OTHER";let tG=(0,h.ZP)("div")(tH()),tY=(e,t,n)=>n?n.map(e=>"repeat(".concat(e,", ").concat(tM.C3*t,"px)")).join(" ".concat(tB.BV,"px ")):"repeat(".concat(e,",").concat(tM.C3*t,"px)");function tV(e){return e>tM.yc*tM.C3?24:4}let tj=(0,h.ZP)(W.Z)(tX(),e=>{let{columns:t,shrinkRatio:n,groups:i}=e;return tY(t,n,i)},tM.dP,tM.C3*tM.yc),tQ=(0,h.ZP)(I.A0)(tK(),e=>e.span),tJ=(0,h.ZP)(tQ)(tW(),tB.xU,e=>{let{theme:t}=e;return t.colors.text.muted}),tq=(0,h.ZP)(tJ)(tz(),tB.ve),t$=(0,tU.Z)((e,t,n,i)=>({timeStampList:e,columns:t,shrinkRatio:n,renderListItem:i})),t0=v.memo(e=>{let{index:t,style:n,isScrolling:i,data:o}=e,{timeStampList:l,columns:a,shrinkRatio:c,renderListItem:s}=o;return(0,r.tZ)(tG,{style:n,children:(0,r.tZ)(tj,{columns:a,shrinkRatio:c,groups:l[t].groups,children:s(l[t],i)})})},tF.wy),t1=(e,t)=>{let n=[];for(let i=0;i<e.length;i++){let o=e[i];n.push({itemType:"SIZE_AND_COUNT",fileSize:o.size,fileCount:o.files.length});let l=0;for(;l<o.files.length;)n.push({itemType:"FILE",items:o.files.slice(l,l+t),itemStartIndex:i}),l+=t}return n};function t2(e){let{height:t,width:n,duplicates:i,getThumbnail:o,activeCollectionID:l}=e,[a,c]=(0,v.useState)([]),s=(0,v.useRef)(!1),d=(0,v.useRef)(!1),u=(0,v.useRef)(null),p=(0,v.useMemo)(()=>{let e=Math.floor((n-2*tV(n)+tM.dP)/(tM.C3+tM.dP));return e<tM.yc&&(e=tM.yc),e},[n]),h=(n-2*tV(n)-(p-1)*tM.dP)/(p*tM.C3),Z=tM.Ho*h+tM.dP,g=()=>{var e;null===(e=u.current)||void 0===e||e.resetAfterIndex(0)};if((0,v.useEffect)(()=>{let e=()=>{if(s.current){d.current=!0;return}s.current=!0,c(t1(i,p)),s.current=!1,d.current&&(d.current=!1,setTimeout(e,0))};e()},[p,i]),(0,v.useEffect)(()=>{g()},[a]),!(null==a?void 0:a.length))return(0,r.tZ)(r.HY,{});let f=t$(a,p,h,(e,t)=>{switch(e.itemType){case"SIZE_AND_COUNT":return(0,r.BX)(tq,{span:p,children:[e.fileCount," ",(0,z.t)("FILES"),","," ",(0,ec.O5)(e.fileSize||0)," ",(0,z.t)("EACH")]});case"FILE":{let n=e.items.map((n,i)=>o(n,e.itemStartIndex+i,t));if(e.groups){let t=0;for(let i=0;i<e.groups.length-1;i++)t+=e.groups[i],n.splice(t,0,(0,r.tZ)("div",{},"".concat(e.items[0].id,"-gap-").concat(i))),t+=1}return n}default:return e.item}});return(0,r.tZ)(tF.S_,{itemData:f,ref:u,itemSize:e=>{switch(a[e].itemType){case"TIME":return tB.xU;case"SIZE_AND_COUNT":return tB.ve;case"FILE":return Z;default:return a[e].height}},height:t,width:n,itemCount:a.length,itemKey:e=>"FILE"===a[e].itemType?"".concat(a[e].items[0].id,"-").concat(a[e].items.slice(-1)[0].id):"".concat(a[e].id,"-").concat(e),overscanCount:3,useIsScrolling:!0,children:t0},"".concat(l))}var t5=n(46082),t3=n(70815),t4=n(35999),t8=n(23209),t9=n(50684);function t6(){let e=(0,l._)(['\n    appearance: none;\n    position: absolute;\n    z-index: 10;\n    left: 0;\n    outline: none;\n    cursor: pointer;\n    @media (pointer: coarse) {\n        pointer-events: none;\n    }\n\n    &::before {\n        content: "";\n        width: 16px;\n        height: 16px;\n        border: 2px solid #fff;\n        background-color: #ddd;\n        display: inline-block;\n        border-radius: 50%;\n        vertical-align: bottom;\n        margin: 8px 8px;\n        text-align: center;\n        line-height: 16px;\n        transition: background-color 0.3s ease;\n        pointer-events: inherit;\n        color: #aaa;\n    }\n    &::after {\n        content: "";\n        width: 5px;\n        height: 10px;\n        border-right: 2px solid #333;\n        border-bottom: 2px solid #333;\n        transform: translate(-18px, 8px);\n        transition: transform 0.3s ease;\n        position: absolute;\n        pointer-events: inherit;\n        transform: translate(-18px, 10px) rotate(45deg);\n    }\n\n    /** checked */\n    &:checked::before {\n        content: "";\n        background-color: #51cd7c;\n        border-color: #51cd7c;\n        color: #fff;\n    }\n    &:checked::after {\n        content: "";\n        border-right: 2px solid #ddd;\n        border-bottom: 2px solid #ddd;\n    }\n    visibility: hidden;\n    ',";\n    &:checked {\n        visibility: visible;\n        opacity: 1 !important;\n    }\n"]);return t6=function(){return e},e}function t7(){let e=(0,l._)(["\n    opacity: 0;\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 40%;\n    width: 100%;\n    position: absolute;\n    ",";\n"]);return t7=function(){return e},e}function ne(){let e=(0,l._)(["\n    display: flex;\n    justify-content: flex-end;\n    align-items: flex-start;\n    padding-right: 5px;\n    padding-top: 5px;\n"]);return ne=function(){return e},e}function nt(){let e=(0,l._)(["\n    opacity: ",";\n    left: 0;\n    top: 0;\n    outline: none;\n    height: 100%;\n    width: 100%;\n    position: absolute;\n    ",";\n"]);return nt=function(){return e},e}function nn(){let e=(0,l._)(["\n    width: 100%;\n    bottom: 0;\n    left: 0;\n    max-height: 40%;\n    width: 100%;\n    background: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 2));\n    & > p {\n        max-width: calc(","px - 10px);\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        margin: 2px;\n        text-align: center;\n    }\n    padding: 7px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    color: #fff;\n    position: absolute;\n"]);return nn=function(){return e},e}function ni(){let e=(0,l._)(["\n    z-index: 5;\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%;\n    ","\n    border-radius: 4px;\n"]);return ni=function(){return e},e}function no(){let e=(0,l._)(["\n    display: flex;\n    width: fit-content;\n    margin-bottom: ","px;\n    min-width: 100%;\n    overflow: hidden;\n    position: relative;\n    flex: 1;\n    cursor: ",';\n    user-select: none;\n    & > img {\n        object-fit: cover;\n        max-width: 100%;\n        min-height: 100%;\n        flex: 1;\n        pointer-events: none;\n    }\n\n    &:hover {\n        input[type="checkbox"] {\n            visibility: visible;\n            opacity: 0.5;\n        }\n\n        .preview-card-hover-overlay {\n            opacity: 1;\n        }\n    }\n\n    border-radius: 4px;\n']);return no=function(){return e},e}let nl=(0,h.ZP)("input")(t6(),e=>e.$active&&"visibility: visible; opacity: 0.5;"),nr=(0,h.ZP)("div")(t7(),e=>!e.checked&&"background:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0))"),na=(0,h.ZP)(I.aV)(ne()),nc=(0,h.ZP)("div")(nt(),e=>e.$active?1:0,e=>e.$active&&"background:rgba(81, 205, 124, 0.25)"),ns=(0,h.ZP)("div")(nn(),tM.C3),nd=(0,h.ZP)("div")(ni(),e=>e.selected&&"border: 5px solid #51cd7c;"),nu=(0,h.ZP)(I.aV)(e=>{let{theme:t}=e;return"\n    display: flex;\n    justify-content: flex-end;\n    align-items: flex-end;\n    background:".concat("dark"===t.palette.mode?"linear-gradient(\n        315deg,\n        rgba(0, 0, 0, 0.14) 0%,\n        rgba(0, 0, 0, 0.05) 29.61%,\n        rgba(0, 0, 0, 0) 49.86%\n    )":"linear-gradient(\n        315deg,\n        rgba(255, 255, 255, 0.14) 0%,\n        rgba(255, 255, 255, 0.05) 29.61%,\n        rgba(255, 255, 255, 0) 49.86%\n    ",";\n    padding: 8px;\n")}),np=(0,h.ZP)("div")(no(),tM.dP,e=>e.disabled?"not-allowed":"pointer");function nh(e){let t=(0,v.useContext)(j.GalleryContext),n=(0,v.useContext)(t8.DeduplicateContext),i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,[n,i]=(0,v.useState)(!1);return(0,v.useEffect)(()=>{let i;return n?i=setTimeout(e,t):clearTimeout(i),()=>{clearTimeout(i)}},[e,t,n]),{onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:()=>i(!0),onTouchEnd:()=>i(!1)}}(()=>{Z(!h)},500),{file:o,onClick:l,updateURL:d,selectable:p,selected:h,onSelect:Z,selectOnClick:g,onHover:f,onRangeSelect:m,isRangeSelectActive:A,isInsSelectRange:x}=e,[w,y]=(0,v.useState)(o.msrc),b=(0,v.useRef)(!0);(0,v.useEffect)(()=>()=>{b.current=!1},[]),(0,v.useEffect)(()=>{(async()=>{try{if(o.msrc)return;let t=await s.Z.getThumbnailForPreview(o,e.showPlaceholder);if(!b.current||!t)return;y(t),d(o.id,t)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("preview card useEffect failed",e)}})()},[e.showPlaceholder]);let E=()=>{g?A?m():Z(!h):((null==o?void 0:o.msrc)||w)&&(null==l||l())},I=e=>{A?null==m||m():Z(e.target.checked)},_=()=>{A&&f()},T=()=>(0,r.BX)(np,{onClick:E,onMouseEnter:_,disabled:!(null==o?void 0:o.msrc)&&!w,...p?i:{},children:[p&&(0,r.tZ)(nl,{type:"checkbox",checked:h,onChange:I,$active:A&&x,onClick:e=>e.stopPropagation()}),o.metadata.hasStaticThumbnail?(0,r.tZ)(t5.T,{fileType:o.metadata.fileType}):w?(0,r.tZ)("img",{src:w}):(0,r.tZ)(t5.f,{}),o.metadata.fileType===c.Tv.livePhoto?(0,r.tZ)(nu,{children:(0,r.tZ)(S.Z,{})}):o.metadata.fileType===c.Tv.video&&(0,r.tZ)(nu,{children:(0,r.tZ)(t3.Z,{})}),(0,r.tZ)(nd,{selected:h}),(0,C.r6)(o,t.user)&&(0,r.tZ)(na,{children:(0,r.tZ)(t9.Z,{file:o})}),(0,r.tZ)(nr,{className:"preview-card-hover-overlay",checked:h}),(0,r.tZ)(nc,{$active:A&&x}),n.isOnDeduplicatePage&&(0,r.BX)(ns,{children:[(0,r.tZ)("p",{children:o.metadata.title}),(0,r.tZ)("p",{children:n.collectionNameMap.get(o.collectionID)})]}),(null==e?void 0:e.activeCollectionID)===tN.jn&&o.isTrashed&&(0,r.tZ)(ns,{children:(0,r.tZ)("p",{children:function(e){let t={year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4,second:1e3},n=new Intl.RelativeTimeFormat(z.ZP.language,{localeMatcher:"best fit",numeric:"always",style:"long"}),i=e-Date.now();for(let e in t)if(Math.abs(i)>t[e]||"second"===e)return n.format(Math.round(i/t[e]),e)}(o.deleteBy/1e3)})})]},"thumb-".concat(o.id,"}"));return n.isOnDeduplicatePage?(0,r.tZ)(t4.Z,{placement:"bottom-start",enterDelay:300,enterNextDelay:100,title:"".concat(o.metadata.title," - ").concat(n.collectionNameMap.get(o.collectionID)),children:T()}):T()}function nZ(){let e=(0,l._)(["\n    display: block;\n    flex: 1;\n    width: 100%;\n    flex-wrap: wrap;\n    margin: 0 auto;\n    overflow: hidden;\n    .pswp-thumbnail {\n        display: inline-block;\n        cursor: pointer;\n    }\n"]);return nZ=function(){return e},e}let ng=(0,h.ZP)("div")(nZ()),nf="&opened";var nm=e=>{let{page:t,duplicates:n,mode:i,files:o,syncWithRemote:l,favItemIds:h,setSelected:Z,selected:g,tempDeletedFileIds:f,setTempDeletedFileIds:m,activeCollectionID:A,activePersonID:C,enableDownload:x,fileToCollectionsMap:w,collectionNameMap:y,showAppDownloadBanner:b,setIsPhotoSwipeOpen:E,isInHiddenSection:I,setFilesDownloadProgressAttributesCreator:_,selectable:S,onSelectPerson:T}=e,[P,D]=(0,v.useState)(!1),[R,L]=(0,v.useState)(0),[k,O]=(0,v.useState)({}),[N,B]=(0,v.useState)({}),M=(0,v.useContext)(j.GalleryContext),[U,F]=(0,v.useState)(null),[H,X]=(0,v.useState)(null),[K,W]=(0,v.useState)(!1),z=(0,tk.useRouter)(),G=(0,p.Z)(()=>o.map(e=>{var t;return{...e,w:window.innerWidth,h:window.innerHeight,title:null===(t=e.pubMagicMetadata)||void 0===t?void 0:t.data.caption}}),[o]);if((0,v.useEffect)(()=>{O({}),B({})},[G]),(0,v.useEffect)(()=>{let e=new URL(window.location.href),t=e.hash.lastIndexOf("&"),n=e.hash.slice(1,-1!==t?t:void 0);P?z.push({hash:n+nf}):z.push({hash:n})},[P]),(0,v.useEffect)(()=>{let e=e=>{"Shift"===e.key&&W(!0)},t=e=>{"Shift"===e.key&&W(!1)};return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",t,!1),z.events.on("hashChangeComplete",e=>{let t=e.indexOf("#");e.slice(-1!==t?t:e.length).endsWith(nf)?(null==E||E(!0),D(!0)):(null==E||E(!1),D(!1))}),()=>{document.removeEventListener("keydown",e,!1),document.removeEventListener("keyup",t,!1)}},[]),(0,v.useEffect)(()=>{0===g.count&&F(null)},[g]),!G)return(0,r.tZ)("div",{});let Y=e=>(t,n,i)=>{let o=G[e];if(o.id!==t)throw a.ZP.info("[".concat(t,"]PhotoSwipe: updateURL: file id mismatch: ").concat(o.id," !== ").concat(t)),Error(u.sH.UPDATE_URL_FILE_ID_MISMATCH);if(o.msrc&&!i)throw Error(u.sH.URL_ALREADY_SET);(0,J.al)(o,n)},V=async(e,t,n,i)=>{let o=G[e];if(o.id!==t)throw a.ZP.info("[".concat(t,"]PhotoSwipe: updateSrcURL: file id mismatch: ").concat(o.id)),Error(u.sH.UPDATE_URL_FILE_ID_MISMATCH);if(o.isSourceLoaded&&!i)throw Error(u.sH.URL_ALREADY_SET);if(o.conversionFailed)throw a.ZP.info("[".concat(t,"]PhotoSwipe: updateSrcURL: conversion failed")),Error(u.sH.FILE_CONVERSION_FAILED);await (0,J.Rw)(o,n,x)},Q=e=>()=>{L(e),D(!0),null==E||E(!0)},q=(0,J.Po)(Z,i,A,C,F),$=e=>()=>{X(e)},ee=e=>()=>{if(void 0!==U&&U!==e){var t,n;let i=(e-U)/Math.abs(e-U),o=!0;for(let t=U;(e-t)*i>=0;t+=i)o=o&&!!g[G[t].id];for(let t=U;(e-t)*i>0;t+=i)q(G[t].id,G[t].ownerID===(null===(n=M.user)||void 0===n?void 0:n.id))(!o);q(G[e].id,G[e].ownerID===(null===(t=M.user)||void 0===t?void 0:t.id),e)(!o)}},et=(e,t,n)=>{var o,l,a;return(0,r.tZ)(nh,{file:e,updateURL:Y(t),onClick:Q(t),selectable:S,onSelect:q(e.id,e.ownerID===(null===(o=M.user)||void 0===o?void 0:o.id),t),selected:(i?i==(null===(l=g.context)||void 0===l?void 0:l.mode)&&("people"==g.context.mode?g.context.personID==C:g.context.collectionID==A):g.collectionID===A)&&g[e.id],selectOnClick:g.count>0,onHover:$(t),onRangeSelect:ee(t),isRangeSelectActive:K&&g.count>0,isInsSelectRange:t>=U&&t<=H||t>=H&&t<=U,activeCollectionID:A,showPlaceholder:n},"tile-".concat(e.id,"-selected-").concat(null!==(a=g[e.id])&&void 0!==a&&a))},en=async(e,t,n)=>{if(a.ZP.info("[".concat(n.id,"] getSlideData called for thumbnail: ").concat(!!n.msrc," sourceLoaded: ").concat(!!n.isSourceLoaded," fetching: ").concat(!!k[n.id])),!n.msrc)try{if(N[n.id]){a.ZP.info("[".concat(n.id,"] thumb download already in progress"));return}a.ZP.info("[".concat(n.id,"] doesn't have thumbnail")),N[n.id]=!0;let i=await s.Z.getThumbnailForPreview(n);try{Y(t)(n.id,i),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for thumbnail msrc: ").concat(!!n.msrc)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe after msrc url update failed",e)}}catch(e){a.ZP.error("getSlideData failed get msrc url failed",e),N[n.id]=!1}if(n.isSourceLoaded||n.conversionFailed){n.isSourceLoaded&&a.ZP.info("[".concat(n.id,"] source already loaded")),n.conversionFailed&&a.ZP.info("[".concat(n.id,"] conversion failed"));return}if(k[n.id]){a.ZP.info("[".concat(n.id,"] file download already in progress"));return}try{a.ZP.info("[".concat(n.id,"] new file src request")),k[n.id]=!0;let i=await s.Z.getFileForPreview(n);if(n.metadata.fileType===c.Tv.livePhoto){let o=i.url,l=await o.image();try{await V(t,n.id,{url:l,isOriginal:!1,isRenderable:!!l,type:"normal"}),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for live photo imgSrc, source loaded: ").concat(n.isSourceLoaded)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe after for live photo imgSrc update failed",e)}if(!l)return;let r=await o.video();try{await V(t,n.id,{url:{video:r,image:l},isOriginal:!1,isRenderable:!!r,type:"livePhoto"},!0),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for live photo complete, source loaded: ").concat(n.isSourceLoaded)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe for live photo complete update failed",e)}}else try{await V(t,n.id,i),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for src, source loaded: ").concat(n.isSourceLoaded)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe after src url update failed",e)}}catch(e){a.ZP.error("getSlideData failed get src url failed",e),k[n.id]=!1}},ei=async(e,t,n)=>{if(n.metadata.fileType!==c.Tv.video&&n.metadata.fileType!==c.Tv.livePhoto){a.ZP.error("getConvertedVideo called for non video file");return}if(n.conversionFailed){a.ZP.error("getConvertedVideo called for file that conversion failed");return}try{Y(t)(n.id,n.msrc,!0),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for thumbnail msrc: ").concat(!!n.msrc)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe after msrc url update failed",e)}try{a.ZP.info("[".concat(n.id,"] new file getConvertedVideo request ").concat(n.metadata.title,"}")),k[n.id]=!0;let i=await s.Z.getFileForPreview(n,{forceConvertVideos:!0});try{await V(t,n.id,i,!0),a.ZP.info("[".concat(n.id,"] calling invalidateCurrItems for src, source loaded: ").concat(n.isSourceLoaded)),e.invalidateCurrItems(),e.isOpen()&&e.updateSize(!0)}catch(e){throw e.message!==u.sH.URL_ALREADY_SET&&a.ZP.error("updating photoswipe after src url update failed",e),e}}catch(e){a.ZP.error("getConvertedVideo failed get src url failed",e),k[n.id]=!1}};return(0,r.BX)(ng,{children:[(0,r.tZ)(tO.ZP,{children:e=>{let{height:o,width:l}=e;return t===d.W.DEDUPLICATE?(0,r.tZ)(t2,{width:l,height:o,getThumbnail:et,duplicates:n,activeCollectionID:A,showAppDownloadBanner:b}):(0,r.tZ)(tB.P,{width:l,height:o,getThumbnail:et,mode:i,displayFiles:G,activeCollectionID:A,activePersonID:C,showAppDownloadBanner:b})}}),(0,r.tZ)(tL,{isOpen:P,items:G,currentIndex:R,onClose:e=>{D(!1),e&&l(),null==E||E(!1)},gettingData:en,getConvertedItem:ei,favItemIds:h,tempDeletedFileIds:f,setTempDeletedFileIds:m,isTrashCollection:A===tN.jn,isInHiddenSection:I,enableDownload:x,fileToCollectionsMap:w,collectionNameMap:y,setFilesDownloadProgressAttributesCreator:_,onSelectPerson:T})]})}},98977:function(e,t,n){n.d(t,{BV:function(){return O},P:function(){return j},Z$:function(){return o},ve:function(){return k},xU:function(){return L}});var i,o,l=n(73235),r=n(52903),a=n(12256),c=n(91430),s=n(37653),d=n(31572),u=n(58488),p=n(42541),h=n(72595),Z=n(56840),g=n(24991),f=n(36631),m=n(3359),v=n(2784),A=n(98614),C=n(52482),x=n(38924),w=n(50846),y=n(73832);function b(){let e=(0,l._)(["\n    display: flex;\n    justify-content: center;\n"]);return b=function(){return e},e}function E(){let e=(0,l._)(["\n    display: grid;\n    grid-template-columns: ",";\n    grid-column-gap: ","px;\n    width: 100%;\n    color: #fff;\n    padding: 0 24px;\n    @media (max-width: ","px) {\n        padding: 0 4px;\n    }\n"]);return E=function(){return e},e}function I(){let e=(0,l._)(["\n    grid-column: span ",";\n"]);return I=function(){return e},e}function _(){let e=(0,l._)(["\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    height: ","px;\n    color: ",";\n"]);return _=function(){return e},e}function S(){let e=(0,l._)(["\n    margin-top: 1rem;\n    height: ","px;\n"]);return S=function(){return e},e}function T(){let e=(0,l._)(["\n    margin-bottom: 0.75rem;\n    @media (max-width: 540px) {\n        font-size: 12px;\n        margin-bottom: 0.5rem;\n    }\n    color: #979797;\n    text-align: center;\n    justify-content: center;\n    align-items: flex-end;\n    margin-top: calc(2rem + 20px);\n"]);return T=function(){return e},e}function P(){let e=(0,l._)(["\n    margin-top: 48px;\n    margin-bottom: ",";\n    text-align: center;\n    justify-content: center;\n"]);return P=function(){return e},e}function D(){let e=(0,l._)(["\n    margin: 0 -24px;\n    width: calc(100% + 46px);\n    left: -24px;\n    @media (max-width: ","px) {\n        margin: 0 -4px;\n        width: calc(100% + 6px);\n        left: -4px;\n    }\n    background-color: ",";\n"]);return D=function(){return e},e}function R(){let e=(0,l._)(["\n    color: #979797;\n    text-align: center;\n    justify-content: center;\n"]);return R=function(){return e},e}let L=48,k=72,O=44;(i=o||(o={})).TIME="TIME",i.FILE="FILE",i.SIZE_AND_COUNT="SIZE_AND_COUNT",i.HEADER="HEADER",i.FOOTER="FOOTER",i.MARKETING_FOOTER="MARKETING_FOOTER",i.OTHER="OTHER";let N=(0,d.ZP)("div")(b()),B=(e,t,n)=>n?n.map(e=>"repeat(".concat(e,", ").concat(y.C3*t,"px)")).join(" ".concat(O,"px ")):"repeat(".concat(e,",").concat(y.C3*t,"px)");function M(e){return e>y.yc*y.C3?24:4}let U=(0,d.ZP)(u.Z,{shouldForwardProp:e=>"gridTemplateColumns"!=e})(E(),e=>e.gridTemplateColumns,y.dP,y.C3*y.yc),F=(0,d.ZP)(c.A0)(I(),e=>e.span),H=(0,d.ZP)(F)(_(),L,e=>{let{theme:t}=e;return t.colors.text.muted}),X=(0,d.ZP)(H)(S(),k),K=(0,d.ZP)(F)(T()),W=(0,d.ZP)(F)(P(),e=>{let{hasReferral:t}=e;return t?"0px":"10px"}),z=(0,d.ZP)(u.Z)(D(),y.C3*y.yc,e=>{let{theme:t}=e;return t.colors.accent.A500}),G=(0,d.ZP)(F)(R()),Y=(0,f.Z)((e,t,n,i)=>({timeStampList:e,columns:t,shrinkRatio:n,renderListItem:i})),V=v.memo(e=>{let{index:t,style:n,isScrolling:i,data:o}=e,{timeStampList:l,columns:a,shrinkRatio:c,renderListItem:s}=o;return(0,r.tZ)(N,{style:n,children:(0,r.tZ)(U,{gridTemplateColumns:B(a,c,l[t].groups),children:s(l[t],i)})})},C.wy);function j(e){var t;let{height:n,width:i,mode:o,displayFiles:l,showAppDownloadBanner:c,getThumbnail:d,activeCollectionID:f,activePersonID:b}=e,E=(0,v.useContext)(m.GalleryContext),I=(0,v.useContext)(w.H),[_,S]=(0,v.useState)([]),T=(0,v.useRef)(!1),P=(0,v.useRef)(!1),D=(0,v.useRef)(null),[R,O]=(0,v.useState)({}),N=Math.floor((i-2*M(i)+y.dP)/(y.C3+y.dP)),B=!1;N<y.yc&&(N=y.yc,B=!0);let U=(t=N,(i-2*M(i)-(t-1)*y.dP)/(t*y.C3)),j=y.Ho*U+y.dP,$=()=>{var e;null===(e=D.current)||void 0===e||e.resetAfterIndex(0)};(0,v.useEffect)(()=>{let e=()=>{if(T.current){P.current=!0;return}T.current=!0;let t=[];E.photoListHeader?t.push(en(E.photoListHeader)):I.photoListHeader&&t.push(en(I.photoListHeader)),E.isClipSearchResult?et(t):ee(t),B||(t=ec(t,N)),1===t.length&&t.push(eo()),t.push(el(t)),I.accessedThroughSharedURL?(I.photoListFooter&&t.push(ei(I.photoListFooter)),t.push(ea())):c&&t.push(er()),S(t),T.current=!1,P.current&&(P.current=!1,setTimeout(e,0))};e()},[i,n,l,E.photoListHeader,I.photoListHeader,E.isClipSearchResult]),(0,v.useEffect)(()=>{S(e=>(e=null!=e?e:[]).length>0&&"HEADER"===e[0].itemType?e:E.photoListHeader?[en(E.photoListHeader),...e]:I.photoListHeader?[en(I.photoListHeader),...e]:e)},[E.photoListHeader,I.photoListHeader]),(0,v.useEffect)(()=>{S(e=>{if((e=null!=e?e:[]).length>0&&"MARKETING_FOOTER"===e[e.length-1].itemType)return e;if(I.accessedThroughSharedURL){if(I.photoListFooter)return[...e,ei(I.photoListFooter),ea()]}else if(c)return[...e,er()];else return e})},[I.accessedThroughSharedURL,c,I.photoListFooter]),(0,v.useEffect)(()=>{$()},[_]);let ee=e=>{let t,n=0;l.forEach((i,o)=>{t&&q(new Date(i.metadata.creationTime/1e3),new Date(t))?n<N?(e[e.length-1].items.push(i),n++):(n=1,e.push({itemType:"FILE",items:[i],itemStartIndex:o})):(t=i.metadata.creationTime/1e3,e.push({itemType:"TIME",date:q(new Date(t),new Date)?(0,g.t)("TODAY"):q(new Date(t),new Date(Date.now()-Q))?(0,g.t)("YESTERDAY"):(0,s.p6)(t),id:t.toString()}),e.push({itemType:"FILE",items:[i],itemStartIndex:o}),n=1)})},et=e=>{let t=N;l.forEach((n,i)=>{t<N?(e[e.length-1].items.push(n),t++):(t=1,e.push({itemType:"FILE",items:[n],itemStartIndex:i}))})},en=e=>({...e,item:(0,r.tZ)(F,{span:N,children:e.item})}),ei=e=>({...e,item:(0,r.tZ)(F,{span:N,children:e.item})}),eo=()=>({itemType:"OTHER",item:(0,r.tZ)(G,{span:N,children:(0,r.tZ)("div",{children:(0,g.t)("nothing_here")})}),id:"empty-list-banner",height:n-48}),el=e=>{let t;t=I.accessedThroughSharedURL?I.referralCode?113:75:90;let i=(()=>{let i=0,o=es(e);for(let l=0;l<e.length&&!(n-(i+=o(l))<=t);l++);return i})();return{itemType:"OTHER",item:(0,r.tZ)(r.HY,{}),height:Math.max(n-i-t,0)}},er=()=>({itemType:"MARKETING_FOOTER",height:90,item:(0,r.tZ)(K,{span:N,children:(0,r.tZ)(p.Z,{variant:"small",children:(0,r.tZ)(A.cC,{i18nKey:"install_mobile_app",components:{a:(0,r.tZ)(h.Z,{href:"https://play.google.com/store/apps/details?id=io.ente.photos",target:"_blank",rel:"noopener"}),b:(0,r.tZ)(h.Z,{href:"https://apps.apple.com/in/app/ente-photos/id1542026904",target:"_blank",rel:"noopener"})}})})})}),ea=()=>({itemType:"MARKETING_FOOTER",height:I.referralCode?113:75,item:(0,r.tZ)(W,{span:N,hasReferral:!!I.referralCode,children:(0,r.BX)(u.Z,{width:"100%",children:[(0,r.tZ)(h.Z,{color:"text.base",sx:{"&:hover":{color:"inherit"}},target:"_blank",href:"https://ente.io",children:(0,r.BX)(p.Z,{variant:"small",display:"block",children:[(0,g.t)("SHARED_USING")," ",(0,r.tZ)(h.Z,{target:"_blank",href:"https://ente.io",children:"ente.io"})]})}),I.referralCode?(0,r.tZ)(z,{children:(0,r.tZ)(p.Z,{sx:{marginTop:"12px",padding:"8px"},children:(0,r.tZ)(A.cC,{i18nKey:"SHARING_REFERRAL_CODE",values:{referralCode:I.referralCode}})})}):null]})})}),ec=(e,t)=>{let n=[],i=0,o=0;for(;i<e.length;){let l=e[i];"TIME"===l.itemType?n[o]?n[o+1].items.length+e[i+1].items.length+Math.ceil(.244*n[o].dates.length)<=t?(n[o].dates.push({date:l.date,span:e[i+1].items.length}),n[o+1].items=[...n[o+1].items,...e[i+1].items],i+=2):o+=2:(n.push({...l,date:null,dates:[{date:l.date,span:e[i+1].items.length}]}),n.push(e[i+1]),i+=2):(n.push(l),i++,o=n.length)}for(let e=0;e<n.length;e++){let t=n[e],i=n[e+1];"TIME"===t.itemType&&t.dates.length>1&&(t.groups=t.dates.map(e=>e.span),i.groups=t.groups)}return n},es=e=>t=>{switch(e[t].itemType){case"TIME":return L;case"SIZE_AND_COUNT":return k;case"FILE":return j;default:return e[t].height}};(0,v.useEffect)(()=>{if(!E.selectedFile)return;let e=null==l?void 0:l.filter(e=>!E.selectedFile[e.id]),t=[...new Set(null==e?void 0:e.map(e=>J(e)))],n=l.filter(e=>!t.includes(J(e))),i=[...new Set(null==n?void 0:n.map(e=>J(e)))];t.forEach(e=>{O(t=>({...t,[e]:!1}))}),i.map(e=>{O(t=>({...t,[e]:!0}))})},[E.selectedFile]);let ed=(0,x.Po)(E.setSelectedFiles,o,f,b),eu=e=>{let t={...R,[e]:!R[e]},n=!R[e];O(t),(null==l?void 0:l.filter(t=>J(t)===e)).forEach(e=>{var t;ed(e.id,e.ownerID===(null==E?void 0:null===(t=E.user)||void 0===t?void 0:t.id))(n)})};if(!(null==_?void 0:_.length))return(0,r.tZ)(r.HY,{});let ep=Y(_,N,U,(e,t)=>{var n,i;let o=(null!==(i=null===(n=E.selectedFile)||void 0===n?void 0:n.count)&&void 0!==i?i:0)>0;switch(e.itemType){case"TIME":return e.dates?e.dates.map(e=>[(0,r.BX)(H,{span:e.span,children:[o&&(0,r.tZ)(Z.Z,{name:e.date,checked:!!R[e.date],onChange:()=>eu(e.date),size:"small",sx:{pl:0},disableRipple:!0},e.date),e.date]},e.date),(0,r.tZ)("div",{},"".concat(e.date,"-gap"))]).flat():(0,r.BX)(H,{span:N,children:[o&&(0,r.tZ)(Z.Z,{name:e.date,checked:!!R[e.date],onChange:()=>eu(e.date),size:"small",sx:{pl:0},disableRipple:!0},e.date),e.date]});case"SIZE_AND_COUNT":return(0,r.BX)(X,{span:N,children:[e.fileCount," ",(0,g.t)("FILES"),","," ",(0,a.O5)(e.fileSize||0)," ",(0,g.t)("EACH")]});case"FILE":{let n=e.items.map((n,i)=>d(n,e.itemStartIndex+i,t));if(e.groups){let t=0;for(let i=0;i<e.groups.length-1;i++)t+=e.groups[i],n.splice(t,0,(0,r.tZ)("div",{},"".concat(e.items[0].id,"-gap-").concat(i))),t+=1}return n}default:return e.item}});return(0,r.tZ)(C.S_,{itemData:ep,ref:D,itemSize:es(_),height:n,width:i,itemCount:_.length,itemKey:e=>"FILE"===_[e].itemType?"".concat(_[e].items[0].id,"-").concat(_[e].items.slice(-1)[0].id):"".concat(_[e].id,"-").concat(e),overscanCount:3,useIsScrolling:!0,children:V},"".concat(f))}let Q=864e5,J=e=>{let t=e.metadata.creationTime/1e3;return q(new Date(t),new Date)?(0,g.t)("TODAY"):q(new Date(t),new Date(Date.now()-Q))?(0,g.t)("YESTERDAY"):(0,s.p6)(t)},q=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},21240:function(e,t,n){n.d(t,{C:function(){return g}});var i=n(52903),o=n(81174),l=n(89668),r=n(12214),a=n(12671),c=n(22711),s=n(54002),d=n(42541),u=n(53091),p=n(38898),h=n(96566),Z=n(24991);let g=e=>{let{open:t,onClose:n,didSelect:g}=e;return(0,i.BX)(c.Z,{open:t,onClose:n,fullWidth:!0,PaperProps:{sx:{paddingBlockEnd:"12px",paddingInline:"12px",maxWidth:"390px"}},children:[(0,i.BX)(s.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center","&&&":{paddingBlockEnd:0}},children:[(0,i.tZ)(d.Z,{variant:"large",fontWeight:"bold",children:(0,Z.t)("multi_folder_upload")}),(0,i.tZ)(u.Z,{"aria-label":(0,Z.t)("close"),color:"secondary",onClick:n,sx:{marginInlineEnd:"-12px"},children:(0,i.tZ)(l.Z,{})})]}),(0,i.tZ)(p.Z,{sx:{"&&&":{paddingBlockStart:"16px"}},children:(0,i.BX)(h.Z,{sx:{gap:"16px"},children:[(0,i.tZ)(d.Z,{color:"text.muted",children:(0,Z.t)("upload_to_choice")}),(0,i.BX)(h.Z,{sx:{mt:"4px",gap:"12px"},children:[(0,i.tZ)(o.U,{size:"medium",color:"accent",startIcon:(0,i.tZ)(r.Z,{}),onClick:()=>{n(),g("root")},children:(0,Z.t)("upload_to_single_album")}),(0,i.tZ)(o.U,{size:"medium",color:"accent",startIcon:(0,i.tZ)(a.Z,{}),onClick:()=>{n(),g("parent")},children:(0,Z.t)("upload_to_album_per_folder")})]})]})})]})}},86508:function(e,t,n){n.d(t,{Z:function(){return eK}});var i,o,l=n(52903),r=n(61917),a=n(10934),c=n(79058),s=n(95033),d=n(28345),u=n(8033),p=n(27949),h=n(90433),Z=n(91),g=n(6089),f=n(50006),m=n(62661),v=n(54002),A=n(38898),C=n(42541),x=n(24991);function w(e){let{open:t,onClose:n,onNameSubmit:i,toUploadFilesCount:o,uploaderName:r}=e,a=async e=>{n(),await i(e)};return(0,l.BX)(Z.Z,{maxWidth:"xs",open:t,onClose:n,children:[(0,l.tZ)(g.Z,{icon:(0,l.tZ)(m.Z,{})}),(0,l.tZ)(v.Z,{children:(0,x.t)("enter_name")}),(0,l.BX)(A.Z,{children:[(0,l.tZ)(C.Z,{color:"text.muted",pb:1,children:(0,x.t)("PUBLIC_UPLOADER_NAME_MESSAGE")}),(0,l.tZ)(f.Z,{hiddenLabel:!0,initialValue:r,callback:a,placeholder:(0,x.t)("NAME_PLACEHOLDER"),buttonText:(0,x.t)("add_photos_count",{count:null!=o?o:0}),fieldType:"text",blockButton:!0,secondaryButtonAction:n})]})]})}var y=n(72751),b=n.n(y),E=n(55005),I=n(3359),_=n(2784),S=n(77836),T=n(77636),P=n(23499),D=n(33967),R=n(16003),L=n(95673),k=n(26552),O=n(50846),N=n(13118),B=n(21240);let M=(0,_.createContext)({open:null,onClose:()=>null,uploadCounter:null,uploadStage:null,percentComplete:null,retryFailed:()=>null,inProgressUploads:null,uploadFileNames:null,finishedUploads:null,hasLivePhotos:null,expanded:null,setExpanded:()=>null});var U=n(99408),F=n(22711),H=n(72595),X=n(98614),K=n(17699),W=n(10222);function z(){var e,t;let{uploadStage:n,finishedUploads:i,retryFailed:o,onClose:r}=(0,_.useContext)(M);return(0,l.tZ)(K.Z,{children:n===s.ps.FINISH&&((null==i?void 0:null===(e=i.get(s.Le.FAILED))||void 0===e?void 0:e.length)>0||(null==i?void 0:null===(t=i.get(s.Le.BLOCKED))||void 0===t?void 0:t.length)>0?(0,l.tZ)(W.Z,{variant:"contained",fullWidth:!0,onClick:o,children:(0,x.t)("RETRY_FAILED")}):(0,l.tZ)(W.Z,{variant:"contained",fullWidth:!0,onClick:r,children:(0,x.t)("close")}))})}var G=n(58488),Y=n(64433),V=n(37862);function j(){let{uploadStage:e,percentComplete:t}=(0,_.useContext)(M);return(0,l.tZ)(G.Z,{children:(e===s.ps.READING_GOOGLE_METADATA_FILES||e===s.ps.EXTRACTING_METADATA||e===s.ps.UPLOADING)&&(0,l.BX)(l.HY,{children:[(0,l.tZ)(Y.Z,{sx:{height:"2px",backgroundColor:"transparent"},variant:"determinate",value:t}),(0,l.tZ)(V.Z,{})]})})}var Q=n(39010),J=n(91430),q=n(89668),$=n(57053),ee=n(99997),et=n(96566);let en=e=>{let{expanded:t}=e;return(0,l.tZ)(C.Z,{variant:t?"h2":"h3",children:(0,x.t)("FILE_UPLOAD")})};function ei(){let{uploadStage:e,uploadCounter:t}=(0,_.useContext)(M);return(0,l.tZ)(C.Z,{color:"text.muted",marginTop:"4px",children:e===s.ps.UPLOADING?(0,x.t)("UPLOAD_STAGE_MESSAGE.".concat(e),{uploadCounter:t}):e===s.ps.EXTRACTING_METADATA?(0,x.t)("UPLOAD_STAGE_MESSAGE.".concat(e),{uploadCounter:t}):(0,x.t)("UPLOAD_STAGE_MESSAGE.".concat(e))})}function eo(){let{setExpanded:e,onClose:t,expanded:n}=(0,_.useContext)(M);return(0,l.tZ)(v.Z,{children:(0,l.BX)(J.Gm,{children:[(0,l.BX)(G.Z,{children:[(0,l.tZ)(en,{expanded:n}),(0,l.tZ)(ei,{})]}),(0,l.tZ)(G.Z,{children:(0,l.BX)(et.Z,{direction:"row",spacing:1,children:[(0,l.tZ)(Q._,{onClick:()=>e(e=>!e),children:n?(0,l.tZ)($.Z,{}):(0,l.tZ)(ee.Z,{})}),(0,l.tZ)(Q._,{onClick:t,children:(0,l.tZ)(q.Z,{})})]})})]})})}function el(){return(0,l.BX)(l.HY,{children:[(0,l.tZ)(eo,{}),(0,l.tZ)(j,{})]})}var er=n(32096),ea=n(39327),ec=n(31572),es=n(62728),ed=n(50462),eu=n(96442);let ep=(0,ec.ZP)(e=>(0,l.tZ)(es.Z,{disableGutters:!0,elevation:0,square:!0,...e}))(e=>{let{theme:t}=e;return{borderTop:"1px solid ".concat(t.palette.divider),"&:last-child":{borderBottom:"1px solid ".concat(t.palette.divider)},"&:before":{display:"none"}}}),eh=(0,ec.ZP)(eu.Z)(()=>({backgroundColor:"rgba(255, 255, 255, .05)"})),eZ=(0,ec.ZP)(ed.Z)(e=>{let{theme:t}=e;return{padding:t.spacing(2)}}),eg=e=>(0,l.tZ)(C.Z,{color:"text.muted",variant:"small",...e,sx:{mb:1}});var ef=n(73235);function em(){let e=(0,ef._)(["\n    display: inline-block;\n    & > span {\n        display: inline-block;\n    }\n    & > span:first-of-type {\n        position: relative;\n        top: 5px;\n        max-width: 340px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n    }\n    & > .separator {\n        margin: 0 5px;\n    }\n"]);return em=function(){return e},e}function ev(){let e=(0,ef._)(["\n    position: relative;\n    top: 5px;\n    display: inline-block;\n    max-width: 394px;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n"]);return ev=function(){return e},e}let eA=(0,ec.ZP)("div")(e=>{let{theme:t}=e;return"\n    text-align: center;\n    color: ".concat(t.colors.danger.A700,";\n    border-bottom: 1px solid ").concat(t.colors.danger.A700,";\n    margin:").concat(t.spacing(3,2,1),"\n")}),eC=(0,ec.ZP)("div")(em()),ex=(0,ec.ZP)("div")(ev()),ew=e=>"critical"===e?"critical.main":"text.faint",ey=e=>(0,l.BX)(J.zr,{gap:"4px",children:[(0,l.BX)(C.Z,{children:[" ",e.mainText]}),(0,l.tZ)(C.Z,{variant:"small",color:ew(e.color),children:"•"}),e.subText?(0,l.tZ)(C.Z,{variant:"small",color:ew(e.color),children:e.subText}):(0,l.tZ)(C.Z,{variant:"small",color:ew(e.color),children:e.subIcon})]}),eb=()=>{var e;let{inProgressUploads:t,hasLivePhotos:n,uploadFileNames:i,uploadStage:o}=(0,_.useContext)(M);return(0,l.BX)(ep,{children:[(0,l.tZ)(eh,{expandIcon:(0,l.tZ)(er.Z,{}),children:(0,l.tZ)(ey,{mainText:o===s.ps.EXTRACTING_METADATA?(0,x.t)("INPROGRESS_METADATA_EXTRACTION"):(0,x.t)("INPROGRESS_UPLOADS"),subText:String(null!==(e=null==t?void 0:t.length)&&void 0!==e?e:0)})}),(0,l.BX)(eZ,{children:[n&&(0,l.tZ)(eg,{children:(0,x.t)("LIVE_PHOTOS_DETECTED")}),(0,l.tZ)(ea.Z,{items:null!=t?t:[],generateItemKey:e=>{let{localFileID:t,progress:n}=e;return"".concat(t,"-").concat(n)},getItemTitle:e=>{let{localFileID:t,progress:n}=e;return"".concat(i.get(t)," - ").concat(n,"%")},renderListItem:e=>{let{localFileID:t,progress:n}=e;return(0,l.BX)(eC,{children:[(0,l.tZ)("span",{children:i.get(t)}),o===s.ps.UPLOADING&&(0,l.BX)(l.HY,{children:[" ",(0,l.tZ)("span",{className:"separator",children:"-"}),(0,l.tZ)("span",{children:"".concat(n,"%")})]})]},t)},maxHeight:160,itemSize:35})]})]})},eE=e=>{var t;let{finishedUploads:n,uploadFileNames:i}=(0,_.useContext)(M),o=n.get(e.uploadResult);return(null==o?void 0:o.length)?(0,l.BX)(ep,{children:[(0,l.tZ)(eh,{expandIcon:(0,l.tZ)(er.Z,{}),children:(0,l.tZ)(ey,{mainText:e.sectionTitle,subText:String(null!==(t=null==o?void 0:o.length)&&void 0!==t?t:0)})}),(0,l.BX)(eZ,{children:[e.sectionInfo&&(0,l.tZ)(eg,{children:e.sectionInfo}),(0,l.tZ)(ea.Z,{items:o,generateItemKey:e=>e,getItemTitle:e=>i.get(e),renderListItem:e=>(0,l.tZ)(ex,{children:i.get(e)},e),maxHeight:160,itemSize:35})]})]}):(0,l.tZ)(l.HY,{})};function eI(){let{open:e,onClose:t,uploadStage:n,finishedUploads:i}=(0,_.useContext)(M),[o,r]=(0,_.useState)(!1);(0,_.useEffect)(()=>{var e,t,n,o,l,a;(null===(e=i.get(s.Le.ALREADY_UPLOADED))||void 0===e?void 0:e.length)>0||(null===(t=i.get(s.Le.BLOCKED))||void 0===t?void 0:t.length)>0||(null===(n=i.get(s.Le.FAILED))||void 0===n?void 0:n.length)>0||(null===(o=i.get(s.Le.LARGER_THAN_AVAILABLE_STORAGE))||void 0===o?void 0:o.length)>0||(null===(l=i.get(s.Le.TOO_LARGE))||void 0===l?void 0:l.length)>0||(null===(a=i.get(s.Le.UNSUPPORTED))||void 0===a?void 0:a.length)>0?r(!0):r(!1)},[i]);let a=(0,U.l)({staticBackdrop:!0,onClose:t});return(0,l.BX)(F.Z,{open:e,onClose:a,maxWidth:"xs",fullWidth:!0,children:[(0,l.tZ)(el,{}),(n===s.ps.UPLOADING||n===s.ps.FINISH||n===s.ps.EXTRACTING_METADATA)&&(0,l.BX)(A.Z,{sx:{"&&&":{px:0}},children:[(n===s.ps.UPLOADING||n===s.ps.EXTRACTING_METADATA)&&(0,l.tZ)(eb,{}),(n===s.ps.UPLOADING||n===s.ps.FINISH)&&(0,l.BX)(l.HY,{children:[(0,l.tZ)(eE,{uploadResult:s.Le.UPLOADED,sectionTitle:(0,x.t)("SUCCESSFUL_UPLOADS")}),(0,l.tZ)(eE,{uploadResult:s.Le.UPLOADED_WITH_STATIC_THUMBNAIL,sectionTitle:(0,x.t)("THUMBNAIL_GENERATION_FAILED_UPLOADS"),sectionInfo:(0,x.t)("THUMBNAIL_GENERATION_FAILED_INFO")}),n===s.ps.FINISH&&o&&(0,l.tZ)(eA,{children:(0,x.t)("FILE_NOT_UPLOADED_LIST")}),(0,l.tZ)(eE,{uploadResult:s.Le.BLOCKED,sectionTitle:(0,x.t)("BLOCKED_UPLOADS"),sectionInfo:(0,l.tZ)(X.cC,{i18nKey:"ETAGS_BLOCKED",components:{a:(0,l.tZ)(H.Z,{href:"https://ente.io/download/desktop",target:"_blank"})}})}),(0,l.tZ)(eE,{uploadResult:s.Le.FAILED,sectionTitle:(0,x.t)("FAILED_UPLOADS"),sectionInfo:n===s.ps.FINISH?void 0:(0,x.t)("failed_uploads_hint")}),(0,l.tZ)(eE,{uploadResult:s.Le.ALREADY_UPLOADED,sectionTitle:(0,x.t)("SKIPPED_FILES"),sectionInfo:(0,x.t)("SKIPPED_INFO")}),(0,l.tZ)(eE,{uploadResult:s.Le.LARGER_THAN_AVAILABLE_STORAGE,sectionTitle:(0,x.t)("LARGER_THAN_AVAILABLE_STORAGE_UPLOADS"),sectionInfo:(0,x.t)("LARGER_THAN_AVAILABLE_STORAGE_INFO")}),(0,l.tZ)(eE,{uploadResult:s.Le.UNSUPPORTED,sectionTitle:(0,x.t)("UNSUPPORTED_FILES"),sectionInfo:(0,x.t)("UNSUPPORTED_INFO")}),(0,l.tZ)(eE,{uploadResult:s.Le.TOO_LARGE,sectionTitle:(0,x.t)("TOO_LARGE_UPLOADS"),sectionInfo:(0,x.t)("TOO_LARGE_INFO")})]})]}),n===s.ps.FINISH&&(0,l.tZ)(z,{})]})}var e_=n(63158),eS=n(67295);function eT(){return(0,l.tZ)(e_.Z,{open:!0,anchorOrigin:{horizontal:"right",vertical:"bottom"},children:(0,l.tZ)(eS.Z,{sx:{width:"360px"},children:(0,l.tZ)(el,{})})})}function eP(e){let{open:t,uploadCounter:n,uploadStage:i,percentComplete:o,retryFailed:r,uploadFileNames:a,hasLivePhotos:c,inProgressUploads:d,finishedUploads:u,...p}=e,h=(0,_.useContext)(E.AppContext),[Z,g]=(0,_.useState)(!1);return((0,_.useEffect)(()=>{t&&g(!1)},[t]),t)?(0,l.tZ)(M.Provider,{value:{open:t,onClose:function(){i!==s.ps.FINISH?h.setDialogMessage({title:(0,x.t)("STOP_UPLOADS_HEADER"),content:(0,x.t)("STOP_ALL_UPLOADS_MESSAGE"),proceed:{text:(0,x.t)("YES_STOP_UPLOADS"),variant:"critical",action:p.cancelUploads},close:{text:(0,x.t)("no"),variant:"secondary",action:()=>{}}}):p.onClose()},uploadCounter:n,uploadStage:i,percentComplete:o,retryFailed:r,inProgressUploads:d,uploadFileNames:a,finishedUploads:u,hasLivePhotos:c,expanded:Z,setExpanded:g},children:Z?(0,l.tZ)(eI,{}):(0,l.tZ)(eT,{})}):(0,l.tZ)(l.HY,{})}var eD=n(52535),eR=n(81174),eL=n(72754),ek=n(46573),eO=n(98687),eN=n(26769),eB=n(36789),eM=n(53091);let eU=e=>{let{open:t,onClose:n,intent:i,uploadFiles:o,uploadFolders:r,uploadGoogleTakeoutZips:a}=e,c=(0,_.useContext)(O.H),s=(0,eD.T)();return(0,_.useEffect)(()=>{t&&s&&c.accessedThroughSharedURL&&(o(),n())},[t]),(0,l.tZ)(F.Z,{open:t,PaperProps:{sx:e=>({maxWidth:"375px",p:1,[e.breakpoints.down(360)]:{p:0}})},onClose:(0,U.l)({onClose:n}),children:(0,l.tZ)(eF,{intent:i,onSelect:e=>{switch(e){case"files":o();break;case"folders":r();break;case"zips":a()}},onClose:n})})},eF=e=>{let{intent:t,onSelect:n,onClose:i}=e,[o,r]=(0,_.useState)(!1),a=e=>{switch(e){case"files":n("files");break;case"folders":n("folders");break;case"zips":o?n("zips"):r(!0)}};return o?(0,l.tZ)(eX,{onSelect:a,onClose:()=>{r(!1)}}):(0,l.tZ)(eH,{intent:t,onClose:i,onSelect:a})},eH=e=>{let{intent:t,onClose:n,onSelect:i}=e;return(0,l.BX)(l.HY,{children:[(0,l.tZ)(U.Z,{onClose:n,children:"collect"==t?(0,x.t)("select_photos"):"import"==t?(0,x.t)("import"):(0,x.t)("upload")}),(0,l.BX)(G.Z,{p:1.5,pt:.5,children:[(0,l.BX)(et.Z,{spacing:.5,children:["import"!=t&&(0,l.tZ)(eL.v,{onClick:()=>i("files"),startIcon:(0,l.tZ)(eN.Z,{}),endIcon:(0,l.tZ)(ek.Z,{}),label:(0,x.t)("file")}),(0,l.tZ)(eL.v,{onClick:()=>i("folders"),startIcon:(0,l.tZ)(eB.Z,{}),endIcon:(0,l.tZ)(ek.Z,{}),label:(0,x.t)("folder")}),"collect"!==t&&(0,l.tZ)(eL.v,{onClick:()=>i("zips"),startIcon:(0,l.tZ)(eO.Z,{}),endIcon:(0,l.tZ)(ek.Z,{}),label:(0,x.t)("google_takeout")})]}),(0,l.tZ)(C.Z,{p:1.5,pt:4,color:"text.muted",sx:{textAlign:"center"},children:(0,x.t)("drag_and_drop_hint")})]})]})},eX=e=>{let{onSelect:t,onClose:n}=e;return(0,l.BX)(l.HY,{children:[(0,l.tZ)(v.Z,{children:(0,l.BX)(Q.G,{children:[(0,x.t)("google_takeout"),(0,l.tZ)(eM.Z,{"aria-label":(0,x.t)("close"),color:"secondary",onClick:n,children:(0,l.tZ)(q.Z,{})})]})}),(0,l.tZ)(G.Z,{p:1.5,children:(0,l.BX)(et.Z,{gap:2.5,children:[(0,l.BX)(et.Z,{gap:1,children:[(0,l.tZ)(eR.U,{color:"accent",fullWidth:!0,onClick:()=>t("folders"),children:(0,x.t)("select_folder")}),(0,l.tZ)(eR.U,{color:"secondary",fullWidth:!0,onClick:()=>t("zips"),children:(0,x.t)("Select zips")}),(0,l.tZ)(H.Z,{href:"https://help.ente.io/photos/migration/from-google-photos/",target:"_blank",rel:"noopener",children:(0,l.tZ)(eR.U,{color:"secondary",fullWidth:!0,children:(0,x.t)("faq")})})]}),(0,l.tZ)(C.Z,{variant:"small",color:"text.muted",pb:1,children:(0,x.t)("takeout_hint")})]})})]})};function eK(e){var t;let{isFirstUpload:n,dragAndDropFiles:i,openFileSelector:o,fileSelectorFiles:c,openFolderSelector:d,folderSelectorFiles:Z,openZipFileSelector:g,fileSelectorZipFiles:f,...m}=e,v=(0,_.useContext)(E.AppContext),A=(0,_.useContext)(I.GalleryContext),C=(0,_.useContext)(O.H),[y,M]=(0,_.useState)(!1),[U,F]=(0,_.useState)(s.ps.START),[H,X]=(0,_.useState)(),[K,W]=(0,_.useState)({finished:0,total:0}),[z,G]=(0,_.useState)([]),[Y,V]=(0,_.useState)(new Map),[j,Q]=(0,_.useState)(0),[J,q]=(0,_.useState)(!1),[$,ee]=(0,_.useState)(!1),[et,en]=(0,_.useState)(!1),[ei,eo]=(0,_.useState)(eG),[el,er]=(0,_.useState)([]),[ea,ec]=(0,_.useState)([]),[es,ed]=(0,_.useState)([]),[eu,ep]=(0,_.useState)([]),eh=(0,_.useRef)([]),eZ=(0,_.useRef)(!1),eg=(0,_.useRef)(""),ef=(0,_.useRef)(null),em=(0,_.useRef)(),ev=(0,_.useRef)(!1),eA=(0,_.useRef)(null),eC=(0,_.useRef)(!1),ex=globalThis.electron,ew=()=>M(!1),ey=()=>en(!0),eb=()=>{ev.current=!1};(0,_.useEffect)(()=>{D.Z.init({setPercentComplete:Q,setUploadCounter:W,setInProgressUploads:G,setFinishedUploads:V,setUploadStage:F,setUploadFilenames:X,setHasLivePhotos:q,setUploadProgressView:M},m.setFiles,C,v.isCFProxyDisabled),D.Z.isUploadRunning()&&M(!0),ex&&(R.Z.init((e,t)=>{eZ.current=!0,eg.current=e,ed(t)},()=>{m.syncWithRemote().catch(e=>{a.ZP.error("Ignoring error when syncing trash changes with remote",e)})}),ex.pendingUploads().then(e=>{if(!e)return;let{collectionName:t,filePaths:n,zipItems:i}=e;a.ZP.info("Resuming pending of upload of ".concat(n.length+i.length," items").concat(t?" to collection "+t:"")),eZ.current=!0,eg.current=t,ed(n),ep(i)}))},[C.accessedThroughSharedURL,C.token,C.passwordToken,v.isCFProxyDisabled]),(0,_.useEffect)(()=>{let e;if(!v.watchFolderView){switch(eC.current=!1,ef.current){case"files":e=c;break;case"folders":e=Z;break;case"zips":e=f;break;default:eC.current=!0,e=i}ex?eW(ex,e).then(e=>{let{fileAndPaths:t,zipItems:n}=e;ec(t),ep(n)}):er(e)}},[i,c,Z,f]),(0,_.useEffect)(()=>{let e=[el.map(e=>[e,ez(e)]),ea.map(e=>[e,e.path]),es.map(e=>[e,e]),eu.map(e=>[e,e[1]])].flat();if(0==e.length)return;if(D.Z.isUploadRunning()){if(R.Z.isUploadRunning())a.ZP.info("Pausing watch folder sync to prioritize user upload"),R.Z.pauseRunningSync();else{a.ZP.info("Ignoring new upload request when upload is already running");return}}ev.current=!0,m.closeUploadTypeSelector(),m.setLoading(!0),er([]),ec([]),ed([]),ep([]);let t=e.filter(e=>{let[t,n]=e;return!(0,r.EZ)(n).startsWith(".")});if(eh.current=t,0===eh.current.length){m.setLoading(!1);return}let i=function(e,t){if(b()()&&"files"===e)return eG;let n=new Map(t.map(e=>{var t,n;return[e,null!==(n=null===(t=e.match(/\//g))||void 0===t?void 0:t.length)&&void 0!==n?n:0]})),i=e=>(0,u.zx)(n.get(e));t.sort((e,t)=>i(e)-i(t));let o=t[0],l=t[t.length-1],r=o.length,a=0,c=o.substring(0,o.lastIndexOf("/")),s=l.substring(0,l.lastIndexOf("/"));for(;a<r&&o.charAt(a)===l.charAt(a);)a++;let d=o.substring(0,a);return d&&(d=d.substring(0,d.lastIndexOf("/")))&&(d=d.substring(d.lastIndexOf("/")+1)),{rootFolderName:d||null,hasNestedFolders:c!==s,hasRootLevelFileWithFolder:""===c}}(ef.current,t.map(e=>{let[t,n]=e;return n}));eo(i),a.ZP.debug(()=>["Upload request",eh.current]),a.ZP.debug(()=>["Import suggestion",i]);let o=ef.current;ef.current=null,m.setLoading(!1),(async()=>{if(C.accessedThroughSharedURL){let e=await (0,P.SP)((0,P.yB)(C.token));eA.current=e,ey();return}if(eZ.current){eZ.current=!1,eg.current?(e_("root",eg.current),eg.current=null):e_("parent");return}if(ex&&"zips"===o){e_("parent");return}if(n&&!i.rootFolderName&&(i.rootFolderName=(0,x.t)("autogenerated_first_album_name")),eC.current){var e;if(eC.current=!1,m.activeCollection&&m.activeCollection.owner.id===(null===(e=A.user)||void 0===e?void 0:e.id)){eI(m.activeCollection);return}}let t=()=>{};t=i.hasNestedFolders?()=>ee(!0):()=>eN(i.rootFolderName),m.setCollectionSelectorAttributes({callback:eI,onCancel:eb,showNextModal:t,intent:L.r.upload})})()},[el,ea,es,eu]);let eE=async()=>{var e;null===(e=m.closeCollectionSelector)||void 0===e||e.call(m),m.setShouldDisableDropzone(!D.Z.shouldAllowNewUpload()),F(s.ps.START),M(!0)},eI=async(e,t)=>{await eE();let n=eh.current.map((t,n)=>{let[i]=t;return{uploadItem:i,localID:n,collectionID:e.id}});await eS(n,[e],t),eh.current=null},e_=async(e,t)=>{await eE();let n=[],i=[],o=new Map;"root"==e?o.set(t,eh.current.map(e=>{let[t]=e;return t})):o=eY(eh.current);try{let e=await (0,T.of)(),t=0;for(let[l,r]of o){let o=await (0,k.Xv)(l,e);i.push(o),m.setCollections([...e,...i]),n=[...n,...r.map(e=>({localID:t++,collectionID:o.id,uploadItem:e}))]}}catch(e){throw ew(),a.ZP.error("Failed to create album",e),v.setDialogMessage({title:(0,x.t)("error"),close:{variant:"critical"},content:(0,x.t)("CREATE_ALBUM_FAILED")}),e}await eS(n,i),eh.current=null},eS=async(e,t,n)=>{let i=em.current;em.current=(async()=>(i&&await i,eR(e,t,n)))(),await em.current},eT=async()=>{D.Z.prepareForNewUpload(),M(!0),await m.syncWithRemote(!0,!0)};function eD(){m.setShouldDisableDropzone(!1),ev.current=!1,m.syncWithRemote()}let eR=async(e,t,n)=>{try{eT(),!ex||eZ.current||R.Z.isUploadRunning()||eV(ex,t,e.map(e=>{let{uploadItem:t}=e;return t}).filter(e=>e)),await D.Z.uploadItems(e,t,n)||ew(),b()()&&(R.Z.isUploadRunning()?await R.Z.allFileUploadsDone(e,t):R.Z.isSyncPaused()&&R.Z.resumePausedSync())}catch(e){a.ZP.error("Failed to upload files",e),ek(e.message),ew()}finally{eD()}},eL=async()=>{try{a.ZP.info("Retrying failed uploads");let{items:e,collections:t}=D.Z.getFailedItemsWithCollections(),n=D.Z.getUploaderName();await eT(),await D.Z.uploadItems(e,t,n)}catch(e){a.ZP.error("Retrying failed uploads failed",e),ek(e.message),ew()}finally{eD()}};function ek(e){let t;switch(e){case p.sH.SESSION_EXPIRED:return m.showSessionExpiredMessage();case p.sH.SUBSCRIPTION_EXPIRED:t={variant:"critical",subtext:(0,x.t)("subscription_expired"),message:(0,x.t)("renew_now"),onClick:()=>S.Z.redirectToCustomerPortal()};break;case p.sH.STORAGE_QUOTA_EXCEEDED:t={variant:"critical",subtext:(0,x.t)("storage_quota_exceeded"),message:(0,x.t)("upgrade_now"),onClick:()=>A.showPlanSelectorModal(),startIcon:(0,l.tZ)(h.Z,{})};break;default:t={variant:"critical",message:(0,x.t)("UNKNOWN_ERROR"),onClick:()=>null}}v.setNotificationAttributes(t)}let eO=e=>{e_("root",e)},eN=e=>{m.setCollectionNamerAttributes({title:(0,x.t)("CREATE_COLLECTION"),buttonText:(0,x.t)("CREATE"),autoFilledName:e,callback:eO})},eB=e=>{ef.current=e,"files"===e?o():"folders"===e?d():g&&ex?g():v.setDialogMessage((0,N.nf)())},eM=async(e,t)=>{try{t||(0,P.e4)((0,P.yB)(C.token),e),await eI(m.uploadCollection,e)}catch(e){a.ZP.error("public upload failed ",e)}};return(0,l.BX)(l.HY,{children:[(0,l.tZ)(B.C,{open:$,onClose:()=>{ee(!1),ev.current=!1},didSelect:e=>{switch(e){case"root":var t;eO(null!==(t=ei.rootFolderName)&&void 0!==t?t:(0,x.t)("autogenerated_default_album_name"));break;case"parent":ei.hasRootLevelFileWithFolder?v.setDialogMessage((0,N.KV)()):e_("parent")}}}),(0,l.tZ)(eU,{open:m.uploadTypeSelectorView,onClose:m.closeUploadTypeSelector,intent:m.uploadTypeSelectorIntent,uploadFiles:()=>eB("files"),uploadFolders:()=>eB("folders"),uploadGoogleTakeoutZips:()=>eB("zips")}),(0,l.tZ)(eP,{open:y,onClose:ew,percentComplete:j,uploadFileNames:H,uploadCounter:K,uploadStage:U,inProgressUploads:z,hasLivePhotos:J,retryFailed:eL,finishedUploads:Y,cancelUploads:()=>{D.Z.cancelRunningUpload()}}),(0,l.tZ)(w,{open:et,onClose:()=>{en(!1),ev.current=!1},onNameSubmit:eM,toUploadFilesCount:null===(t=eh.current)||void 0===t?void 0:t.length,uploaderName:eA.current})]})}(i=o||(o={})).FILES="files",i.FOLDERS="folders",i.ZIPS="zips";let eW=async(e,t)=>{let n=[],i=[];for(let o of t){let t=e.pathForFile(o);o.name.endsWith(".zip")?i=i.concat(await e.listZipItems(t)):n.push({file:o,path:t})}return{fileAndPaths:n,zipItems:i}},ez=e=>(0,u.zx)((0,d.LD)(["path"in e&&"string"==typeof e.path?e.path:void 0,e.webkitRelativePath,e.name])),eG={rootFolderName:"",hasNestedFolders:!1,hasRootLevelFileWithFolder:!1},eY=e=>{let t=new Map;for(let[n,i]of e){let e=i.substring(0,i.lastIndexOf("/"));e.endsWith(c.o)&&(e=e.substring(0,e.lastIndexOf("/")));let o=e.substring(e.lastIndexOf("/")+1);if(!o)throw Error("Unexpected empty folder name");t.has(o)||t.set(o,[]),t.get(o).push(n)}return t},eV=async(e,t,n)=>{let i;1==t.length&&(i=t[0].name);let o=[],l=[];for(let e of n){if(e instanceof File)throw Error("Unexpected web file for a desktop pending upload");"string"==typeof e?o.push(e):Array.isArray(e)?l.push(e):o.push(e.path)}await e.setPendingUploads({collectionName:i,filePaths:o,zipItems:l})}},92289:function(e,t,n){n.d(t,{l:function(){return o}});var i=n(52903);let o=e=>{let{getDragAndDropInputProps:t,getFileSelectorInputProps:n,getFolderSelectorInputProps:o,getZipFileSelectorInputProps:l}=e;return(0,i.BX)(i.HY,{children:[(0,i.tZ)("input",{...t()}),(0,i.tZ)("input",{...n()}),(0,i.tZ)("input",{...o()}),l&&(0,i.tZ)("input",{...l()})]})}},50684:function(e,t,n){var i=n(73235),o=n(52903),l=n(10934),r=n(31572),a=n(84001),c=n(3359),s=n(2784);function d(){let e=(0,i._)(["\n    width: ",";\n    height: ",";\n    background-color: ",";\n    border-radius: 50%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #fff;\n    font-weight: bold;\n    font-size: ",";\n"]);return d=function(){return e},e}let u="#000000",p=(0,r.ZP)("div")(d(),e=>{let{size:t}=e;return"".concat(t,"px")},e=>{let{size:t}=e;return"".concat(t,"px")},e=>{let{colorCode:t,opacity:n}=e;return"".concat(t).concat(100===n?"":null!=n?n:95)},e=>{let{size:t}=e;return"".concat(Math.floor(t/2),"px")});t.Z=e=>{let{file:t,email:n,opacity:i}=e,{userIDToEmailMap:r,user:d}=(0,s.useContext)(c.GalleryContext),h=(0,a.Z)(),[Z,g]=(0,s.useState)(""),[f,m]=(0,s.useState)("");return((0,s.useLayoutEffect)(()=>{try{if(!t)return;if(t.ownerID!==d.id){let e=r.get(t.ownerID);if(!e){l.ZP.error("email not found in userIDToEmailMap");return}let n=t.ownerID%h.colors.avatarColors.length,i=h.colors.avatarColors[n];m(e[0].toUpperCase()),g(i)}else if(t.ownerID===d.id){var e;let n=null===(e=t.pubMagicMetadata)||void 0===e?void 0:e.data.uploaderName;if(!n){l.ZP.error("uploaderName not found in file.pubMagicMetadata.data");return}m(n[0].toUpperCase()),g(u)}}catch(e){l.ZP.error("AvatarIcon.tsx - useLayoutEffect file failed",e)}},[t]),(0,s.useLayoutEffect)(()=>{try{if(!n)return;if(d.email===n){m(n[0].toUpperCase()),g(u);return}let e=Array.from(r.keys()).find(e=>r.get(e)===n);if(!e){l.ZP.error("ID not found for email: ".concat(n));return}let t=e%h.colors.avatarColors.length,i=h.colors.avatarColors[t];m(n[0].toUpperCase()),g(i)}catch(e){l.ZP.error("AvatarIcon.tsx - useLayoutEffect email failed",e)}},[n]),Z&&f)?(0,o.tZ)(p,{size:18,colorCode:Z,opacity:i,children:f}):(0,o.tZ)(o.HY,{})}},46562:function(e,t,n){var i=n(52903),o=n(72595);n(2784),t.Z=e=>{let{children:t,sx:n,color:l,...r}=e;return(0,i.tZ)(o.Z,{component:"button",sx:{color:"text.base",textDecoration:"underline rgba(255, 255, 255, 0.4)",paddingBottom:.5,"&:hover":{color:"".concat(l,".main"),textDecoration:"underline ",textDecorationColor:"".concat(l,".main")},...n},...r,children:t})}},23209:function(e,t,n){n.r(t),n.d(t,{DeduplicateContext:function(){return V},Info:function(){return j},default:function(){return Q}});var i=n(73235),o=n(52903),l=n(12595),r=n(71900),a=n(91430),c=n(98996),s=n(8620),d=n(27949),u=n(96269),p=n(50267),h=n(31572),Z=n(42541),g=n(80613),f=n(3229),m=n(63339),v=n(89668),A=n(98642),C=n(53091),x=n(58488),w=n(35999),y=n(24991),b=n(55005),E=n(2784),I=n(77777),_=n(13118);function S(e){let{deleteFileHelper:t,close:n,count:i,clearSelection:l}=e,{setDialogMessage:r}=(0,E.useContext)(b.AppContext);return(0,o.BX)(f.XL,{children:[(0,o.BX)(a.G5,{children:[i?(0,o.tZ)(C.Z,{onClick:l,children:(0,o.tZ)(v.Z,{})}):(0,o.tZ)(C.Z,{onClick:n,children:(0,o.tZ)(m.Z,{})}),(0,o.BX)(x.Z,{ml:1.5,children:[(0,I.u)(i)," ",(0,y.t)("SELECTED")]})]}),(0,o.tZ)(w.Z,{title:(0,y.t)("DELETE"),children:(0,o.tZ)(C.Z,{onClick:()=>r((0,_.BN)(t)),children:(0,o.tZ)(A.Z,{})})})]})}var T=n(14563),P=n(5632),D=n.n(P),R=n(77636),L=n(10934),k=n(68351),O=n(69348),N=n(52721),B=n(56810),M=n(29650);async function U(e,t){try{let n=(await F()).sort((e,t)=>t.size-e.size),i=new Map;for(let t of e)i.set(t.id,t);let o=[];for(let e of n){let n=[];for(let t of e.fileIDs)i.has(t)&&n.push(i.get(t));(n=await H(n,t)).length>1&&(o=[...o,...function(e){let t=[],n=[],i=[];for(let t of e.files)(0,O.L)(t.metadata)?n.push(t):i.push(t);return n.length>1&&t.push(...function(e){let t=[],n=e.files.map(e=>{var t;return{file:e,hash:null!==(t=e.metadata.hash)&&void 0!==t?t:"".concat(e.metadata.imageHash,"_").concat(e.metadata.videoHash)}}).sort((e,t)=>e.hash.localeCompare(t.hash)),i=[];i.push(n[0].file);for(let r=1;r<n.length;r++){var o,l;(o=n[r-1].file.metadata,l=n[r].file.metadata,o.fileType===N.Tv.livePhoto?o.imageHash===l.imageHash&&o.videoHash===l.videoHash:o.hash===l.hash)?i.push(n[r].file):(i.length>1&&t.push({files:[...i],size:e.size}),i=[n[r].file])}return i.length>1&&t.push({files:i,size:e.size}),t}({files:n,size:e.size})),i.length>1&&t.push({files:i,size:e.size}),t}({files:n,size:e.size})])}return o}catch(e){L.ZP.error("failed to get duplicate files",e)}}async function F(){try{return(await B.Z.get(await (0,k.QH)("/files/duplicates"),null,{"X-Auth-Token":(0,M.LP)()})).data.duplicates}catch(e){L.ZP.error("failed to fetch duplicate file IDs",e)}}async function H(e,t){return e.sort((e,n)=>{let i=t.get(e.collectionID).toLocaleLowerCase(),o=t.get(n.collectionID).toLocaleLowerCase();return i.localeCompare(o)})}var X=n(82045),K=n(79301);let W={clubSameTimeFilesOnly:!1,setClubSameTimeFilesOnly:()=>null,fileSizeMap:new Map,isOnDeduplicatePage:!1,collectionNameMap:new Map};var z=n(26552),G=n(22624);function Y(){let e=(0,i._)(["\n    padding: 24px;\n    font-size: 18px;\n"]);return Y=function(){return e},e}let V=(0,E.createContext)(W),j=(0,h.ZP)("div")(Y());function Q(){let{setDialogMessage:e,startLoading:t,finishLoading:n,showNavBar:i}=(0,E.useContext)(b.AppContext),[h,f]=(0,E.useState)(null),[m,v]=(0,E.useState)(new Map),[A,C]=(0,E.useState)({count:0,collectionID:0,ownCount:0,context:void 0});(0,E.useEffect)(()=>{if(!(0,p.km)(p.Qm.ENCRYPTION_KEY)){(0,l.M8)(s.W.DEDUPLICATE),D().push("/");return}i(!0)},[]),(0,E.useEffect)(()=>{x()},[]);let x=async()=>{t();let e=await (0,R.zr)(),i=new Map;for(let t of e)i.set(t.id,t.name);v(i);let o=await (0,r.dm)(),l=await U(o,i),a=new Map,c=[],s=0;for(let e of l)for(let t of(c=[...c,...e.files.slice(1).map(e=>e.id)],s+=e.files.length-1,e.files))a.set(t.id,e.size);f(l);let d={count:s,ownCount:s,collectionID:z.Ug,context:void 0};for(let e of c)d[e]=!0;C(d),n()},w=(0,u.Z)(()=>(null!=h?h:[]).reduce((e,t)=>[...e,...t.files],[]),[h]),I=(0,u.Z)(()=>(0,G.W2)(w),[w]),_=async()=>{try{t();let e=(0,G.Rb)(A,w);await (0,X.N5)(e);let n=await (0,R.sU)();await (0,X.Z0)("normal",n,()=>{}),await (0,K.Rr)(n,()=>{})}catch(t){t instanceof d.MS&&t.httpStatusCode===g.WE.Forbidden?e({title:(0,y.t)("error"),close:{variant:"critical"},content:(0,y.t)("NOT_FILE_OWNER")}):e({title:(0,y.t)("error"),close:{variant:"critical"},content:(0,y.t)("UNKNOWN_ERROR")})}finally{await x(),n()}};return h?(0,o.BX)(V.Provider,{value:{...W,collectionNameMap:m,isOnDeduplicatePage:!0},children:[w.length>0&&(0,o.tZ)(j,{children:(0,y.t)("DEDUPLICATE_BASED_ON_SIZE")}),0===w.length?(0,o.tZ)(a.wx,{children:(0,o.tZ)(Z.Z,{variant:"large",color:"text.muted",children:(0,y.t)("NO_DUPLICATES_FOUND")})}):(0,o.tZ)(T.Z,{page:s.W.DEDUPLICATE,files:w,duplicates:h,syncWithRemote:x,setSelected:C,selected:A,activeCollectionID:z.Ug,fileToCollectionsMap:I,collectionNameMap:m,selectable:!0}),(0,o.tZ)(S,{deleteFileHelper:_,count:A.count,close:function(){D().push(s.W.GALLERY)},clearSelection:function(){C({count:0,collectionID:0,ownCount:0,context:void 0})}})]}):(0,o.tZ)(a.wx,{children:(0,o.tZ)(c.Z,{})})}},3359:function(e,t,n){let i;n.r(t),n.d(t,{GalleryContext:function(){return aD},default:function(){return aR}});var o,l,r,a,c,s,d=n(52903),u=n(12595),p=n(3229),h=n(52535),Z=n(10934),g=n(97222),f=n(91430),m=n(42541),v=n(24991),A=n(2784),C=n(52939);let x=e=>{let{selectedOption:t}=e;return(0,d.BX)(C.R,{children:[(0,d.tZ)(m.Z,{color:"text.muted",variant:"large",children:(0,v.t)("search_results")}),(0,d.tZ)(C.M,{name:t.suggestion.label,fileCount:t.fileCount})]})},w=()=>(0,d.tZ)(f.wx,{children:(0,d.tZ)(m.Z,{color:"text.muted",sx:{paddingBlockEnd:"86px"},children:(0,g.pt)("People will appear here once indexing completes")})});var y=n(73235),b=n(67366),E=n(46082),I=n(24758),_=n(31572),S=n(96386);function T(){let e=(0,y._)(["\n    display: flex;\n    /* Act as container for the absolutely positioned ItemTileOverlays. */\n    position: relative;\n    border-radius: 4px;\n    overflow: hidden;\n    cursor: pointer;\n    & > img {\n        object-fit: cover;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n    }\n    user-select: none;\n"]);return T=function(){return e},e}function P(){let e=(0,y._)(["\n    width: 48px;\n    height: 48px;\n"]);return P=function(){return e},e}function D(){let e=(0,y._)(["\n    width: 90px;\n    height: 64px;\n"]);return D=function(){return e},e}function R(){let e=(0,y._)(["\n    width: 150px;\n    height: 150px;\n"]);return R=function(){return e},e}function L(){let e=(0,y._)(["\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n"]);return L=function(){return e},e}function k(){let e=(0,y._)(["\n    padding: 4px;\n    background: linear-gradient(\n        0deg,\n        rgba(0, 0, 0, 0.1) 0%,\n        rgba(0, 0, 0, 0.5) 86.46%\n    );\n"]);return k=function(){return e},e}function O(){let e=(0,y._)(["\n    padding: 8px;\n    background: linear-gradient(\n        0deg,\n        rgba(0, 0, 0, 0.1) 0%,\n        rgba(0, 0, 0, 0.5) 86.46%\n    );\n"]);return O=function(){return e},e}let N=e=>{let{TileComponent:t,coverFile:n,coverFaceID:i,isScrolling:o,onClick:l,children:r}=e,[a,c]=(0,A.useState)();return(0,A.useEffect)(()=>{if(!n)return;let e=!1;return i?(0,S.U_)(i,n).then(t=>!e&&c(t)):I.Z.getThumbnailForPreview(n,o).then(t=>!e&&c(t)),()=>{e=!0}},[n,i,o]),(0,d.BX)(t,{onClick:l,children:[(null==n?void 0:n.metadata.hasStaticThumbnail)?(0,d.tZ)(E.T,{fileType:n.metadata.fileType}):a?(0,d.tZ)("img",{src:a}):(0,d.tZ)(E.f,{}),r]})},B=(0,_.ZP)("div")(T()),M=(0,_.ZP)(B)(P()),U=(0,_.ZP)(B)(D()),F=(0,_.ZP)(B)(R()),H=(0,_.ZP)("div")(L()),X=(0,_.ZP)(H)(k()),K=(0,_.ZP)(H)(O());var W=n(47423),z=n(93275),G=n(63529),Y=n(46573),V=n(89668),j=n(61387),Q=n(7253),J=n(70949),q=n(58488),$=n(53091),ee=n(84001),et=n(96566),en=n(37862),ei=n(63923),eo=n(68020),el=n(51920),er=n(84951),ea=n(61310);function ec(){let e=(0,y._)(["\n    display: flex;\n    width: 100%;\n    align-items: center;\n    justify-content: center;\n    gap: 8px;\n    background: ",";\n    max-width: 484px;\n    margin: auto;\n"]);return ec=function(){return e},e}let es=e=>{let{isInSearchMode:t,onShowSearchInput:n,...i}=e,o=(0,h.I)();return(0,d.tZ)(q.Z,{sx:{flex:1,px:["4px","24px"]},children:o&&!t?(0,d.tZ)(ed,{onSearch:n}):(0,d.tZ)(eu,{isInSearchMode:t,...i})})},ed=e=>{let{onSearch:t}=e;return(0,d.tZ)(q.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,d.tZ)($.Z,{onClick:t,children:(0,d.tZ)(J.Z,{})})})},eu=e=>{let{isInSearchMode:t,onSelectSearchOption:n,onSelectPerson:i}=e,o=(0,A.useRef)(null),[l,r]=(0,A.useState)(null),[a,c]=(0,A.useState)(""),s=(0,ee.Z)(),u=(0,A.useMemo)(()=>eZ(s),[s]),p=(0,A.useMemo)(()=>({Control:eg,Input:em,Option:ew}),[]),h=()=>{var e;null===(e=o.current)||void 0===e||e.blur(),r(null),c(""),n(void 0)},Z=e=>{h(),i(e)};return(0,d.BX)(ep,{children:[(0,d.tZ)(el.Z,{ref:o,value:l,components:p,styles:u,loadOptions:eh,onChange:e=>{var t,i;let l=null==e?void 0:e.suggestion.type;"collection"==l||"person"==l?(r(null),c("")):(r(e),c(null!==(i=null==e?void 0:e.suggestion.label)&&void 0!==i?i:"")),n((0,z.Y)(e)),null===(t=o.current)||void 0===t||t.blur()},inputValue:a,onInputChange:(e,t)=>{"input-change"==t.action&&c(e)},isClearable:!0,escapeClearsValue:!0,onFocus:()=>{if(a){var e;null===(e=o.current)||void 0===e||e.onInputChange(a,{action:"set-value",prevInputValue:""})}},placeholder:(0,v.t)("search_hint"),noOptionsMessage:e=>{let{inputValue:t}=e;return ev(t)?(0,d.tZ)(eA,{onSelectPerson:Z}):null}}),t&&(0,d.tZ)($.Z,{onClick:h,children:(0,d.tZ)(V.Z,{})})]})},ep=(0,_.ZP)(q.Z)(ec(),e=>{let{theme:t}=e;return t.colors.background.base}),eh=(0,ei.Z)(W.N3,250),eZ=e=>{let{colors:t}=e;return{container:e=>({...e,flex:1}),control:(e,n)=>{let{isFocused:i}=n;return{...e,backgroundColor:t.background.elevated,borderColor:i?t.accent.A500:"transparent",boxShadow:"none",":hover":{borderColor:t.accent.A300,cursor:"text"}}},input:e=>({...e,color:t.text.base,overflowX:"hidden"}),menu:e=>({...e,marginTop:"1px",backgroundColor:t.background.elevated}),option:(e,n)=>{let{isFocused:i}=n;return{...e,padding:0,backgroundColor:"transparent !important","& :hover":{cursor:"pointer"},"& .option-contents":i?{backgroundColor:t.background.elevated2}:{},"&:last-child .MuiDivider-root":{display:"none"}}},placeholder:e=>({...e,color:t.text.muted,whiteSpace:"nowrap",overflowX:"hidden"}),dropdownIndicator:e=>({...e,display:"none"}),indicatorSeparator:e=>({...e,display:"none"}),clearIndicator:e=>({...e,display:"none"})}},eg=e=>{let{children:t,...n}=e;return(0,d.tZ)(eo.c.Control,{...n,children:(0,d.BX)(et.Z,{direction:"row",sx:{alignItems:"center",flex:1},children:[(0,d.tZ)(q.Z,{sx:{display:"inline-flex",pl:"8px",color:e=>e.colors.stroke.muted},children:ef(n.getValue()[0])}),t]})})},ef=e=>{switch(null==e?void 0:e.suggestion.type){case"fileName":return(0,d.tZ)(j.Z,{});case"date":return(0,d.tZ)(G.Z,{});case"location":case"city":return(0,d.tZ)(Q.Z,{});default:return(0,d.tZ)(J.Z,{})}},em=e=>(0,d.tZ)(eo.c.Input,{...e,isHidden:!1}),ev=e=>{if(e||!S.RU)return!1;let t=(0,S.J9)();return!!t&&"disabled"!=t.phase},eA=e=>{let t,{onSelectPerson:n}=e,i=(0,A.useSyncExternalStore)(S.vz,S.J9),o=(0,A.useSyncExternalStore)(S.Gg,S.AR);if(!i||"disabled"==i.phase)return(0,b.L)(),(0,d.tZ)(d.HY,{});switch(i.phase){case"scheduled":t=(0,v.t)("indexing_scheduled");break;case"indexing":t=(0,v.t)("indexing_photos",i);break;case"fetching":t=(0,v.t)("indexing_fetching",i);break;case"clustering":t=(0,v.t)("indexing_people",i);break;case"done":t=(0,v.t)("indexing_done",i)}return(0,d.BX)(q.Z,{sx:{textAlign:"left"},children:[o&&o.length>0&&(0,d.BX)(d.HY,{children:[(0,d.tZ)(eC,{onClick:()=>n(void 0)}),(0,d.tZ)(er.X4,{people:o,onSelectPerson:n})]}),(0,d.tZ)(m.Z,{variant:"mini",sx:{mt:"5px",mb:"4px"},children:t})]})},eC=e=>{let{onClick:t}=e;return(0,d.tZ)(ex,{onClick:t,children:(0,d.BX)(et.Z,{direction:"row",color:"text.muted",children:[(0,d.tZ)(m.Z,{color:"text.base",variant:"large",children:(0,v.t)("people")}),(0,d.tZ)(Y.Z,{})]})})},ex=(0,_.ZP)(ea.k)(e=>{let{theme:t}=e;return"\n    /* The color for the chevron */\n    color: ".concat(t.colors.stroke.muted,";\n    /* Hover indication */\n    && :hover {\n        color: ").concat(t.colors.stroke.base,";\n    }\n")}),ew=e=>(0,d.BX)(eo.c.Option,{...e,children:[(0,d.tZ)(ey,{data:e.data}),(0,d.tZ)(en.Z,{sx:{mx:2,my:1}})]}),ey=e=>{let{data:t}=e;return(0,d.BX)(et.Z,{className:"option-contents",gap:"4px",px:2,py:1,children:[(0,d.tZ)(m.Z,{variant:"mini",color:"text.muted",children:eb(t)}),(0,d.BX)(et.Z,{direction:"row",gap:1,sx:{alignItems:"center",justifyContent:"space-between"},children:[(0,d.BX)(q.Z,{children:[(0,d.tZ)(m.Z,{sx:{fontWeight:"bold",wordBreak:"break-word"},children:t.suggestion.label}),(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("photos_count",{count:t.fileCount})})]}),(0,d.tZ)(et.Z,{direction:"row",gap:1,children:t.previewFiles.map(e=>(0,d.tZ)(N,{coverFile:e,TileComponent:M},e.id))})]})]})},eb=e=>{switch(e.suggestion.type){case"collection":return(0,v.t)("album");case"fileType":return(0,v.t)("file_type");case"fileName":return(0,v.t)("file_name");case"fileCaption":return(0,v.t)("description");case"date":return(0,v.t)("date");case"location":case"city":return(0,v.t)("location");case"clip":return(0,v.t)("magic");case"person":return(0,v.t)("people")}};var eE=n(50507),eI=n(6138),e_=n(22711),eS=n(54002),eT=n(38898),eP=n(27806),eD=n(17699);let eR=async e=>{let t=await e.lastShownChangelogVersion();return t?t<2:(await e.setLastShownChangelogVersion(2),!1)},eL=async e=>e.setLastShownChangelogVersion(2);var ek=n(81174),eO=n(40651);function eN(){let e=(0,y._)(["\n    padding-inline: 1rem;\n\n    li {\n        margin-block: 2rem;\n    }\n"]);return eN=function(){return e},e}function eB(){let e=(0,y._)(["\n    /* Make the button text fill the entire space so the endIcon shows at the\n       trailing edge of the button. */\n    width: 100%;\n    text-align: left;\n"]);return eB=function(){return e},e}let eM=e=>{let{open:t,onClose:n}=e,i=(0,h.I)();return(0,A.useEffect)(()=>{t&&eL((0,eE.M)())},[t]),(0,d.tZ)(e_.Z,{open:t,fullScreen:i,TransitionComponent:eO.s,maxWidth:"xs",fullWidth:!0,children:(0,d.BX)(q.Z,{m:1,children:[(0,d.tZ)(eS.Z,{mt:2,children:(0,d.tZ)(m.Z,{variant:"h4",color:"text.muted",children:(0,g.ut)("What's new")})}),(0,d.tZ)(eT.Z,{children:(0,d.tZ)(eP.Z,{children:(0,d.tZ)(eU,{})})}),(0,d.tZ)(eD.Z,{children:(0,d.tZ)(ek.U,{onClick:n,color:"accent",fullWidth:!0,endIcon:(0,d.tZ)(eI.Z,{}),children:(0,d.tZ)(eH,{children:(0,g.ut)("Continue")})})})]})})},eU=()=>(0,d.BX)(eF,{children:[(0,d.BX)("li",{children:[(0,d.tZ)(m.Z,{color:"primary",children:(0,g.ut)("Improved date search")}),(0,d.BX)(m.Z,{children:["Search for photos by day of week (",(0,d.tZ)("i",{children:"Wednesday"}),") or hour of day (",(0,d.tZ)("i",{children:"8 pm"}),") in addition to the existing search by partial dates (",(0,d.tZ)("i",{children:"20 July"}),", or even ",(0,d.tZ)("i",{children:"2021"}),") and relative dates (",(0,d.tZ)("i",{children:"Last month"}),",",(0,d.tZ)("i",{children:"Yesterday"}),")."]})]}),(0,d.BX)("li",{children:[(0,d.tZ)(m.Z,{color:"primary",children:(0,g.ut)("Faster magic search")}),(0,d.tZ)(m.Z,{children:(0,g.ut)("The magic search beta, where you can search for photos just by typing whatever is in them, just got faster.")})]})]}),eF=(0,_.ZP)("ul")(eN()),eH=(0,_.ZP)("div")(eB());var eX=n(71900),eK=n(77488),eW=n(8033),ez=n(98996),eG=n(8620),eY=n(38045),eV=n(27949),ej=n(46794),eQ=n(96269),eJ=n(25683),eq=n(29650),e$=n(50267),e0=n(37172),e1=n(98e3),e2=n(47245),e5=n(10222),e3=n(52437),e4=n(25312),e8=n(21678),e9=n(55005);function e6(e){let{open:t,onClose:n,onAuthenticate:i}=e,{setDialogMessage:o,setDialogBoxAttributesV2:l,logout:r}=(0,A.useContext)(e9.AppContext),[a,c]=(0,A.useState)(),[s,u]=(0,A.useState)(),p=()=>o({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")}),h=(0,A.useCallback)(async()=>{try{let e=await (0,e3.g)();"valid"!=e.status&&(n(),l(e7(r)))}catch(e){Z.ZP.warn("Ignoring error when determining session validity",e)}},[l,r]);(0,A.useEffect)(()=>{(async()=>{try{let e=(0,eJ.Yu)(eJ.Pd.USER);if(!e)throw Error("User not found");c(e);let t=(0,eJ.Yu)(eJ.Pd.KEY_ATTRIBUTES);if(((null==e?void 0:e.token)||(null==e?void 0:e.encryptedToken))&&(!t||t.memLimit)){if(t)u(t);else throw Error("Key attributes not found")}else throw Error("User not logged in")}catch(e){Z.ZP.error("AuthenticateUserModal initialization failed",e),n(),p()}})()},[]),(0,A.useEffect)(()=>{t&&h()},[t]);let g=async()=>{n(),i()};return(0,d.tZ)(e4.Z,{open:t,onClose:n,sx:{position:"absolute"},attributes:{title:(0,v.t)("password")},children:(0,d.tZ)(e8.Z,{buttonText:(0,v.t)("AUTHENTICATE"),callback:g,user:a,keyAttributes:s,submitButtonProps:{sx:{mb:0}}})})}let e7=e=>({title:(0,v.t)("password_changed_elsewhere"),content:(0,v.t)("password_changed_elsewhere_message"),proceed:{text:(0,v.t)("login"),action:e,variant:"accent"},close:{text:(0,v.t)("cancel")}});var te=n(50006);function tt(e){let{attributes:t,...n}=e;if(!t)return(0,d.tZ)(d.HY,{});let i=async(e,i)=>{try{t.callback(e),n.onHide()}catch(e){i((0,v.t)("UNKNOWN_ERROR"))}};return(0,d.tZ)(e4.Z,{open:n.show,onClose:n.onHide,attributes:{title:t.title},children:(0,d.tZ)(te.Z,{callback:i,fieldType:"text",buttonText:t.buttonText,placeholder:(0,v.t)("enter_album_name"),initialValue:t.autoFilledName,submitButtonProps:{sx:{mt:1,mb:2}},secondaryButtonAction:n.onHide})})}var tn=n(99408),ti=n(27149),to=n(13980),tl=n.n(to);let tr=(0,_.ZP)(e_.Z)(e=>{let{theme:t,position:n}=e;return{"& .MuiDialog-container":{justifyContent:n},"& .MuiPaper-root":{maxWidth:"494px"},"& .MuiDialogTitle-root":{padding:t.spacing(2),paddingRight:t.spacing(1)},"& .MuiDialogContent-root":{padding:t.spacing(2)},[t.breakpoints.down(559)]:{"& .MuiPaper-root":{width:"324px"},"& .MuiDialogContent-root":{padding:6}}}});tr.propTypes={children:tl().node,onClose:tl().func.isRequired};var ta=n(77636),tc=n(95673),ts=n(26552);function td(){let e=(0,y._)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 42px;\n"]);return td=function(){return e},e}let tu=e=>{let{attributes:t,collectionSummaries:n,collections:i,...o}=e,l=(0,ti.Z)("(max-width: 428px)"),[r,a]=(0,A.useState)([]);if((0,A.useEffect)(()=>{t&&o.open&&(async()=>{let e=[...n.values()].filter(e=>{let{id:n,type:i}=e;return n!==t.fromCollection&&(t.intent===tc.r.add?(0,ts.E5)(i):t.intent===tc.r.upload?(0,ts.G0)(i)||"uncategorized"==i:t.intent===tc.r.restore?(0,ts.G0)(i)||"uncategorized"==i:(0,ts.G0)(i))}).sort((e,t)=>e.name.localeCompare(t.name)).sort((e,t)=>ts.BY.get(e.type)-ts.BY.get(t.type));0===e.length&&(o.onClose(),t.showNextModal()),a(e)})()},[n,t,o.open]),!(null==r?void 0:r.length))return(0,d.tZ)(d.HY,{});let c=async e=>{let n;n=e===ts.Ei?await (0,ta.CV)():i.find(t=>t.id===e),t.callback(n),o.onClose()},s=()=>{var e;null===(e=t.onCancel)||void 0===e||e.call(t),o.onClose()};return(0,d.BX)(tr,{onClose:s,open:o.open,position:"center",fullScreen:l,fullWidth:!0,children:[(0,d.tZ)(tn.Z,{onClose:s,children:t.intent===tc.r.upload?(0,v.t)("upload_to_album"):t.intent===tc.r.add?(0,v.t)("add_to_album"):t.intent===tc.r.move?(0,v.t)("move_to_album"):t.intent===tc.r.restore?(0,v.t)("restore_to_album"):t.intent===tc.r.unhide?(0,v.t)("unhide_to_album"):(0,v.t)("select_album")}),(0,d.tZ)(eT.Z,{sx:{"&&&":{padding:0}},children:(0,d.BX)(f.A0,{flexWrap:"wrap",gap:"4px",padding:"16px",children:[(0,d.tZ)(th,{showNextModal:t.showNextModal}),r.map(e=>(0,d.tZ)(tp,{collectionSummary:e,onCollectionClick:c},e.id))]})})]})},tp=e=>{let{collectionSummary:t,onCollectionClick:n}=e;return(0,d.tZ)(N,{TileComponent:F,coverFile:t.coverFile,onClick:()=>n(t.id),children:(0,d.tZ)(K,{children:(0,d.tZ)(m.Z,{children:t.name})})})},th=e=>{let{showNextModal:t}=e;return(0,d.BX)(N,{TileComponent:F,onClick:t,children:[(0,d.tZ)(K,{children:(0,v.t)("create_albums")}),(0,d.tZ)(tZ,{children:"+"})]})},tZ=(0,_.ZP)(H)(td());var tg=n(97335),tf=n(85999),tm=n(53819),tv=n(40352),tA=n(52643);let tC=e=>{let{nestedInDialog:t,disableTriggerButtonBackground:n,...i}=e;return(0,d.BX)(tg.Z,{ariaControls:"collection-sort",triggerButtonIcon:(0,d.tZ)(tv.Z,{}),menuPaperProps:{sx:{backgroundColor:e=>t?e.colors.background.elevated2:void 0}},triggerButtonProps:{sx:{backgroundColor:e=>n?void 0:e.colors.fill.faint}},children:[(0,d.tZ)(tx,{...i,sortBy:"name",children:(0,v.t)("sort_by_name")}),(0,d.tZ)(tx,{...i,sortBy:"creation-time-asc",children:(0,v.t)("sort_by_creation_time_ascending")}),(0,d.tZ)(tx,{...i,sortBy:"updation-time-desc",children:(0,v.t)("sort_by_updation_time_descending")})]})},tx=e=>{let{sortBy:t,activeSortBy:n,onChangeSortBy:i,children:o}=e;return(0,d.tZ)(tf.x,{onClick:()=>i(t),endIcon:n==t?(0,d.tZ)(tm.Z,{}):(0,d.tZ)(tA.Z,{}),children:o})};var tw=n(39010),ty=n(73832),tb=n(27695),tE=n(32096),tI=n(57253),t_=n(22617),tS=n(72686),tT=n(72615),tP=n(69264),tD=n(35999),tR=n(6738),tL=n(52482);function tk(){let e=(0,y._)(["\n    padding-inline: 24px;\n    @media (max-width: ","px) {\n        padding-inline: 4px;\n    }\n    margin-block-end: 16px;\n    border-block-end: 1px solid ",";\n"]);return tk=function(){return e},e}function tO(){let e=(0,y._)(["\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 10px;\n    margin-block-end: 12px;\n"]);return tO=function(){return e},e}function tN(){let e=(0,y._)(["\n    display: flex;\n    align-items: flex-start;\n    gap: 16px;\n"]);return tN=function(){return e},e}function tB(){let e=(0,y._)(["\n    position: absolute;\n    z-index: 2;\n    top: 7px;\n    height: 50px;\n    width: 50px;\n    border: none;\n    padding: 0;\n    margin: 0;\n\n    border-radius: 50%;\n    background-color: ",";\n    color: ",";\n\n    & > svg {\n        border-radius: 50%;\n        height: 30px;\n        width: 30px;\n    }\n"]);return tB=function(){return e},e}function tM(){let e=(0,y._)(["\n    left: 0;\n    text-align: right;\n    transform: translate(-50%, 0%);\n\n    & > svg {\n        transform: rotate(180deg);\n    }\n"]);return tM=function(){return e},e}function tU(){let e=(0,y._)(["\n    right: 0;\n    text-align: left;\n    transform: translate(50%, 0%);\n"]);return tU=function(){return e},e}function tF(){let e=(0,y._)(["\n    position: relative;\n    overflow: hidden;\n    height: 86px;\n    width: 100%;\n"]);return tF=function(){return e},e}function tH(){let e=(0,y._)(["\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2; // number of lines to show\n    line-clamp: 2;\n    -webkit-box-orient: vertical;\n"]);return tH=function(){return e},e}function tX(){let e=(0,y._)(["\n    padding: 4px;\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-end;\n    & > .MuiSvgIcon-root {\n        font-size: 20px;\n    }\n"]);return tX=function(){return e},e}function tK(){let e=(0,y._)(["\n    height: 3px;\n    background-color: ",";\n    margin-top: 18px;\n    border-radius: 2px;\n"]);return tK=function(){return e},e}let tW=e=>{let{showPeopleSectionButton:t,mode:n,onChangeMode:i,collectionSummaries:o,activeCollectionID:l,onSelectCollectionID:r,onShowAllCollections:a,collectionsSortBy:c,onChangeCollectionsSortBy:s,people:u,activePerson:p,onSelectPerson:Z}=e,g=(0,h.I)(),[f,m]=(0,A.useState)(!1),[v,C]=(0,A.useState)(!1),x=(0,A.useRef)(null),w=(0,A.useRef)(null),y=(0,A.useCallback)(()=>{if(!x.current)return;let{scrollLeft:e,scrollWidth:t,clientWidth:n}=x.current;m(e>0),C(e+n<t)},[]),b=(0,A.useCallback)(e=>{if(x.current=e,!e)return;e.addEventListener("scroll",y);let t=new ResizeObserver(y);return t.observe(e),y(),()=>{e.removeEventListener("scroll",y),t.unobserve(e)}},[y]);(0,A.useEffect)(()=>{y()},[y,n,o,u]);let E=e=>()=>{var t;return null===(t=x.current)||void 0===t?void 0:t.scrollBy(250*e,0)};(0,A.useEffect)(()=>{if(!w.current)return;let e=-1;switch(n){case"albums":case"hidden-albums":e=o.findIndex(e=>{let{id:t}=e;return t==l});break;case"people":e=u.findIndex(e=>{let{id:t}=e;return t==(null==p?void 0:p.id)})}-1!=e&&w.current.scrollToItem(e,"smart")},[n,o,l,u,p]);let I=(0,A.useMemo)(()=>"albums"==n||"hidden-albums"==n?{type:"collections",collectionSummaries:o,activeCollectionID:(0,eW.zx)(l),onSelectCollectionID:r}:{type:"people",people:u,activePerson:p,onSelectPerson:Z},[n,o,l,r,u,p,Z]),_=g&&"people"!=n&&(0,d.BX)(q.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,d.tZ)(tC,{activeSortBy:c,onChangeSortBy:s,disableTriggerButtonBackground:!0}),(0,d.tZ)($.Z,{onClick:a,children:(0,d.tZ)(tE.Z,{})})]}),S=!g&&"people"!=n&&(0,d.BX)(q.Z,{display:"flex",alignItems:"center",gap:1,height:"64px",children:[(0,d.tZ)(tC,{activeSortBy:c,onChangeSortBy:s}),(0,d.tZ)(tw._,{onClick:a,children:(0,d.tZ)(tE.Z,{})})]});return(0,d.BX)(tz,{sx:u.length?{}:{borderBlockEndColor:"transparent"},children:[(0,d.BX)(tG,{children:[(0,d.tZ)(tV,{showPeopleSectionButton:t,mode:n,onChangeMode:i}),_]}),(0,d.BX)(tY,{children:[(0,d.BX)(t0,{children:[f&&(0,d.tZ)(tq,{onClick:E(-1)}),(0,d.tZ)(tR.ZP,{disableHeight:!0,children:e=>{let{width:t}=e;return(0,d.tZ)(tL.t7,{ref:w,outerRef:b,layout:"horizontal",width:t,height:110,itemData:I,itemKey:t2,itemCount:t1(I),itemSize:94,children:t5})}}),v&&(0,d.tZ)(t$,{onClick:E(1)})]}),S]})]})},tz=(0,_.ZP)(q.Z)(tk(),ty.C3*ty.yc,e=>{let{theme:t}=e;return t.palette.divider}),tG=(0,_.ZP)(q.Z)(tO()),tY=(0,_.ZP)(q.Z)(tN()),tV=e=>{let{showPeopleSectionButton:t,mode:n,onChangeMode:i}=e;return"hidden-albums"==n?(0,d.tZ)(m.Z,{children:(0,v.t)("hidden_albums")}):t?(0,d.BX)(et.Z,{direction:"row",sx:{gap:"10px"},children:[(0,d.tZ)(tj,{active:"albums"==n,onClick:()=>i("albums"),children:(0,d.tZ)(m.Z,{children:(0,v.t)("albums")})}),(0,d.tZ)(tj,{active:"people"==n,onClick:()=>i("people"),children:(0,d.tZ)(m.Z,{children:(0,v.t)("people")})})]}):(0,d.tZ)(m.Z,{children:(0,v.t)("albums")})},tj=(0,_.ZP)(ea.k,{shouldForwardProp:e=>"active"!=e})(e=>{let{active:t,theme:n}=e;return"\n    p { color: ".concat(t?n.colors.text.base:n.colors.text.muted," }\n    p:hover { color: ").concat(n.colors.text.base," }\n")}),tQ=e=>(0,d.tZ)(tJ,{...e,children:(0,d.tZ)(tS.Z,{})}),tJ=(0,_.ZP)("button")(tB(),e=>{let{theme:t}=e;return t.colors.backdrop.muted},e=>{let{theme:t}=e;return t.colors.stroke.base}),tq=(0,_.ZP)(tQ)(tM()),t$=(0,_.ZP)(tQ)(tU()),t0=(0,_.ZP)(q.Z)(tF()),t1=e=>{switch(e.type){case"collections":return e.collectionSummaries.length;case"people":return e.people.length}},t2=(e,t)=>{switch(t.type){case"collections":{var n;let i=(0,eW.zx)(t.collectionSummaries[e]);return"".concat(t.type,"-").concat(i.id,"-").concat(null===(n=i.coverFile)||void 0===n?void 0:n.id)}case"people":{let n=(0,eW.zx)(t.people[e]);return"".concat(t.type,"-").concat(n.id,"-").concat(n.displayFaceID)}}},t5=(0,A.memo)(e=>{let t;let{data:n,index:i,style:o}=e;switch(n.type){case"collections":{let{collectionSummaries:e,activeCollectionID:o,onSelectCollectionID:l}=n,r=(0,eW.zx)(e[i]);t=(0,d.tZ)(t3,{collectionSummary:r,activeCollectionID:o,onSelectCollectionID:l},r.id);break}case"people":{let{people:e,activePerson:o,onSelectPerson:l}=n,r=(0,eW.zx)(e[i]);t=(0,d.tZ)(nt,{person:r,activePerson:o,onSelectPerson:l},r.id)}}return(0,d.tZ)("div",{style:o,children:t})},tL.wy),t3=e=>{let{collectionSummary:t,activeCollectionID:n,onSelectCollectionID:i}=e;return(0,d.BX)("div",{children:[(0,d.BX)(N,{TileComponent:U,coverFile:t.coverFile,onClick:()=>i(t.id),children:[(0,d.tZ)(t4,{text:t.name}),(0,d.tZ)(t6,{type:t.type})]}),n===t.id&&(0,d.tZ)(ne,{})]})},t4=e=>{let{text:t}=e;return(0,d.tZ)(X,{children:(0,d.tZ)(t8,{text:t})})},t8=e=>{let{text:t}=e;return(0,d.tZ)(tD.Z,{title:t,children:(0,d.tZ)(q.Z,{height:"2.1em",overflow:"hidden",children:(0,d.tZ)(t9,{variant:"small",sx:{wordBreak:"break-word"},children:t})})})},t9=(0,_.ZP)(m.Z)(tH()),t6=e=>{let{type:t}=e;return(0,d.BX)(t7,{children:["favorites"==t&&(0,d.tZ)(tI.Z,{}),"archived"==t&&(0,d.tZ)(tb.Z,{sx:e=>({color:e.colors.white.muted})}),"outgoingShare"==t&&(0,d.tZ)(tT.Z,{}),("incomingShareViewer"==t||"incomingShareCollaborator"==t)&&(0,d.tZ)(tT.Z,{}),"sharedOnlyViaLink"==t&&(0,d.tZ)(t_.Z,{}),"pinned"==t&&(0,d.tZ)(tP.Z,{})]})},t7=(0,_.ZP)(f.aV)(tX()),ne=(0,_.ZP)("div")(tK(),e=>{let{theme:t}=e;return t.palette.primary.main}),nt=e=>{let{person:t,activePerson:n,onSelectPerson:i}=e;return(0,d.BX)(q.Z,{children:[(0,d.tZ)(N,{TileComponent:U,coverFile:t.displayFaceFile,coverFaceID:t.displayFaceID,onClick:()=>i(t),children:t.name&&(0,d.tZ)(t4,{text:t.name})}),(null==n?void 0:n.id)===t.id&&(0,d.tZ)(ne,{})]})};var nn=n(55688),ni=n(49717),no=n(4559),nl=n(86006);let nr=e=>{let{open:t,onClose:n,title:i,placeholder:o,initialValue:l,submitButtonTitle:r,onSubmit:a}=e,c=async(e,t)=>{try{await a(e),n()}catch(n){Z.ZP.error("Error when submitting value ".concat(e),n),t((0,v.t)("UNKNOWN_ERROR"))}};return(0,d.BX)(e_.Z,{open:t,onClose:n,maxWidth:"xs",fullWidth:!0,children:[(0,d.tZ)(eS.Z,{children:i}),(0,d.tZ)(eT.Z,{children:(0,d.tZ)(te.Z,{fieldType:"text",placeholder:o,initialValue:l,callback:c,buttonText:r,submitButtonProps:{sx:{mt:1,mb:2}},secondaryButtonAction:n})})]})},na=e=>{var t;let{person:n,appContext:i,onSelectPerson:o}=e;return(0,d.tZ)(C.R,{children:(0,d.BX)(tw.G,{children:[(0,d.tZ)(C.M,{name:null!==(t=n.name)&&void 0!==t?t:(0,g.pt)("Unnamed person"),nameProps:n.name?{}:{color:"text.muted"},fileCount:n.fileIDs.length}),"cgroup"==n.type?(0,d.tZ)(nc,{cgroup:n.cgroup,onSelectPerson:o,appContext:i}):(0,d.tZ)(ns,{cluster:n.cluster,appContext:i})]})})},nc=e=>{var t;let{cgroup:n,appContext:i,onSelectPerson:o}=e,{startLoading:l,finishLoading:r,onGenericError:a,setDialogBoxAttributesV2:c}=i,[s,u]=(0,A.useState)(!1),p=async e=>{l();try{await (0,S.IP)(e,n)}finally{r()}},h=async()=>{l();try{await (0,S.jt)(n),o(void 0)}catch(e){a(e)}finally{r()}};return(0,d.BX)(d.HY,{children:[(0,d.BX)(tg.Z,{ariaControls:"person-options",triggerButtonIcon:(0,d.tZ)(no.Z,{}),children:[(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(ni.Z,{}),centerAlign:!0,onClick:()=>u(!0),children:(0,v.t)("rename")}),(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(nl.Rk,{}),centerAlign:!0,onClick:()=>c({title:(0,g.pt)("Reset person?"),content:(0,g.pt)("The name, face groupings and suggestions for this person will be reset"),close:{text:(0,v.t)("cancel")},proceed:{text:(0,v.t)("reset"),action:h},buttonDirection:"row"}),children:(0,g.pt)("Reset")})]}),(0,d.tZ)(nr,{open:s,onClose:()=>u(!1),title:(0,g.pt)("Rename person"),placeholder:(0,v.t)("enter_name"),initialValue:null!==(t=n.data.name)&&void 0!==t?t:"",submitButtonTitle:(0,v.t)("rename"),onSubmit:p})]})},ns=e=>{let{cluster:t,appContext:n}=e,{startLoading:i,finishLoading:o}=n,[l,r]=(0,A.useState)(!1),a=()=>r(!0),c=async e=>{i();try{await (0,S.ev)(e,t)}finally{o()}};return(0,d.BX)(d.HY,{children:[(0,d.BX)(et.Z,{direction:"row",sx:{alignItems:"center",gap:2},children:[(0,d.tZ)(tD.Z,{title:(0,g.pt)("Add a name"),children:(0,d.tZ)($.Z,{onClick:a,children:(0,d.tZ)(nn.Z,{})})}),(0,d.tZ)(tg.Z,{ariaControls:"person-options",triggerButtonIcon:(0,d.tZ)(no.Z,{}),children:(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(nn.Z,{}),centerAlign:!0,onClick:a,children:(0,g.pt)("Add a name")})})]}),(0,d.tZ)(nr,{open:l,onClose:()=>r(!1),title:(0,g.pt)("Add person"),placeholder:(0,v.t)("enter_name"),initialValue:"",submitButtonTitle:(0,v.t)("add"),onSubmit:c})]})},nd=["name","creation-time-asc","updation-time-desc"];var nu=n(50255),np=n(36631);let nh=(e,t)=>Math.min(154*e.length+32,(null==t?void 0:t.height)-177)||0,nZ=(0,np.Z)((e,t)=>({collectionRowList:e,onCollectionClick:t})),ng=A.memo(e=>{let{data:t,index:n,style:i,isScrolling:o}=e,{collectionRowList:l,onCollectionClick:r}=t,a=l[n];return(0,d.tZ)("div",{style:i,children:(0,d.tZ)(f.A0,{gap:"4px",padding:"16px",children:a.map(e=>(0,d.tZ)(nm,{isScrolling:o,onCollectionClick:r,collectionSummary:e},e.id))})})},tL.wy);function nf(e){let{collectionSummaries:t,onCollectionClick:n}=e,i=(0,A.useRef)(!1),o=(0,A.useRef)(!1),[l,r]=(0,A.useState)([]),a=function(){let[e,t]=(0,A.useState)({width:void 0,height:void 0});return(0,A.useEffect)(()=>{function e(){t({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}();(0,A.useEffect)(()=>{if(!a.width||!t)return;let e=async()=>{if(i.current){o.current=!0;return}i.current=!0;let n=[],l=0,c=a.width>559?3:2;for(;l<t.length;){let e=[];for(let n=0;n<c&&l<t.length;n++)e.push(t[l++]);n.push(e)}r(n),i.current=!1,o.current&&(o.current=!1,setTimeout(e,0))};e()},[t,a]);let c=nZ(l,n);return(0,d.tZ)(eT.Z,{sx:{"&&":{padding:0}},children:(0,d.tZ)(tL.t7,{height:nh(l,a),width:"100%",itemCount:l.length,itemSize:154,itemData:c,children:ng})})}let nm=e=>{let{onCollectionClick:t,collectionSummary:n,isScrolling:i}=e;return(0,d.tZ)(N,{TileComponent:F,coverFile:n.coverFile,onClick:()=>t(n.id),isScrolling:i,children:(0,d.BX)(K,{children:[(0,d.tZ)(m.Z,{children:n.name}),(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,v.t)("photos_count",{count:n.fileCount})})]})})};function nv(e){let{collectionSummaries:t,open:n,onClose:i,onSelectCollectionID:o,collectionsSortBy:l,onChangeCollectionsSortBy:r,isInHiddenSection:a}=e,c=(0,ti.Z)("(max-width: 428px)");return(0,d.BX)(tr,{position:"flex-end",TransitionComponent:eO.s,onClose:i,open:n,fullScreen:c,fullWidth:!0,children:[(0,d.tZ)(nA,{isInHiddenSection:a,onClose:i,collectionsSortBy:l,onChangeCollectionsSortBy:r,collectionCount:e.collectionSummaries.length}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(nf,{collectionSummaries:t,onCollectionClick:e=>{o(e),i()}})]})}let nA=e=>{let{onClose:t,collectionCount:n,collectionsSortBy:i,onChangeCollectionsSortBy:o,isInHiddenSection:l}=e;return(0,d.tZ)(eS.Z,{children:(0,d.BX)(f.A0,{children:[(0,d.tZ)(f.G5,{mr:1.5,children:(0,d.BX)(q.Z,{children:[(0,d.tZ)(m.Z,{variant:"h3",children:l?(0,v.t)("all_hidden_albums"):(0,v.t)("all_albums")}),(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,v.t)("albums_count",{count:n})})]})}),(0,d.BX)(et.Z,{direction:"row",spacing:1.5,children:[(0,d.tZ)(tC,{activeSortBy:i,onChangeSortBy:o,nestedInDialog:!0}),(0,d.tZ)(tw._,{onClick:t,children:(0,d.tZ)(V.Z,{})})]})]})})};var nC=n(42721),nx=n(81961),nw=n(39116),ny=n(58792),nb=n(72754),nE=n(12856),nI=n(48048),n_=n(50684);let nS=(0,_.ZP)("div")({position:"relative",display:"flex",alignItems:"center",marginLeft:-5}),nT=(0,_.ZP)("div")({position:"relative",display:"flex",alignItems:"center",marginLeft:8}),nP=(0,_.ZP)(nI.Z)({height:20,width:20,fontSize:10,color:"#fff"});var nD=e=>{let{sharees:t}=e,n=(null==t?void 0:t.length)>6,i=(null==t?void 0:t.length)-6;return(0,d.BX)(nT,{children:[null==t?void 0:t.slice(0,6).map(e=>(0,d.tZ)(nS,{children:(0,d.tZ)(n_.Z,{email:e.email,opacity:100},e.email)},e.email)),n&&(0,d.tZ)(nS,{children:(0,d.BX)(nP,{children:["+",i]})},"extra-count")]})};let nR=e=>{let t=(0,eV.a3)(e),n="";switch(t.message){case eV.sH.BAD_REQUEST:n=(0,v.t)("SHARING_BAD_REQUEST_ERROR");break;case eV.sH.SUBSCRIPTION_NEEDED:n=(0,v.t)("SHARING_DISABLED_FOR_FREE_ACCOUNTS");break;case eV.sH.NOT_FOUND:n=(0,v.t)("USER_DOES_NOT_EXIST");break;default:n="".concat((0,v.t)("UNKNOWN_ERROR")," ").concat(t.message)}return n};var nL=n(43643),nk=n(94848),nO=n(53793),nN=n(31708),nB=n(48601);function nM(e){var t;let{submitButtonProps:n}=e,{sx:i,...o}=null!=n?n:{},[l,r]=(0,A.useState)(!1),a=async(t,n)=>{let{setFieldError:i,resetForm:o}=n;try{r(!0),""!==t.inputValue?await e.callback({email:t.inputValue}):0!==t.selectedOptions.length&&await e.callback({emails:t.selectedOptions}),r(!1),e.onClose(),o()}catch(e){i("inputValue",null==e?void 0:e.message),r(!1)}},c=(0,A.useMemo)(()=>{switch(e.fieldType){case"text":return nB.Ry().shape({inputValue:nB.Z_().required((0,v.t)("REQUIRED"))});case"email":return nB.Ry().shape({inputValue:nB.Z_().email((0,v.t)("EMAIL_ERROR"))})}},[e.fieldType]),s=e=>{e("selectedOptions",[])};return(0,d.tZ)(nN.J9,{initialValues:{inputValue:null!==(t=e.initialValue)&&void 0!==t?t:"",selectedOptions:[]},onSubmit:a,validationSchema:c,validateOnChange:!1,validateOnBlur:!1,children:t=>{let{values:n,errors:r,handleChange:a,handleSubmit:c,setFieldValue:u}=t;return(0,d.BX)("form",{noValidate:!0,onSubmit:c,children:[(0,d.BX)(et.Z,{spacing:"24px",py:"20px",px:"12px",children:[e.hiddenPreInput,(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("ADD_NEW_EMAIL")}),(0,d.tZ)(nO.Z,{sx:{marginTop:0},hiddenLabel:e.hiddenLabel,fullWidth:!0,type:e.fieldType,id:e.fieldType,onChange:a("inputValue"),onClick:()=>s(u),name:e.fieldType,...e.hiddenLabel?{placeholder:e.placeholder}:{label:e.placeholder},error:!!r.inputValue,helperText:r.inputValue,value:n.inputValue,disabled:l,autoFocus:!e.disableAutoFocus,autoComplete:e.autoComplete})]}),e.optionsList.length>0&&(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("OR_ADD_EXISTING")}),(0,d.tZ)(ny.GP,{children:e.optionsList.map((t,i)=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>{n.selectedOptions.includes(t)?u("selectedOptions",n.selectedOptions.filter(e=>e!==t)):u("selectedOptions",[...n.selectedOptions,t])},label:t,startIcon:(0,d.tZ)(n_.Z,{email:t}),endIcon:n.selectedOptions.includes(t)?(0,d.tZ)(tm.Z,{}):null},t),i!==e.optionsList.length-1&&(0,d.tZ)(ny.NP,{})]}))})]}),(0,d.tZ)(nk.Z,{sx:{position:"relative",top:r.inputValue?"-22px":"0",float:"right",padding:"0 8px"},children:e.caption}),e.hiddenPostInput]}),(0,d.tZ)(f.A0,{px:"8px",justifyContent:"center",flexWrap:e.blockButton?"wrap-reverse":"nowrap",children:(0,d.BX)(et.Z,{direction:"column",px:"8px",width:"100%",children:[e.secondaryButtonAction&&(0,d.tZ)(e5.Z,{onClick:e.secondaryButtonAction,size:"large",color:"secondary",sx:{"&&&":{mt:e.blockButton?.5:2,mb:e.blockButton?0:4,mr:e.blockButton?0:1,...i}},...o,children:(0,v.t)("cancel")}),(0,d.tZ)(nL.Z,{sx:{"&&&":{mt:2,...i}},buttonText:e.buttonText,loading:l,...o})]})})]})}})}function nU(e){let{open:t,collection:n,onClose:i,onRootClose:o,type:l}=e,{user:r,syncWithRemote:a,emailList:c}=(0,A.useContext)(aD),s=(0,A.useMemo)(()=>c.filter(e=>{var t;return!(null===(t=n.sharees)||void 0===t?void 0:t.find(t=>t.email===e))}),[c,n.sharees]),u=async e=>{var t,i;let{email:o,emails:c}=e;if(o){if(o===r.email)throw Error((0,v.t)("SHARE_WITH_SELF"));if(null==n?void 0:null===(t=n.sharees)||void 0===t?void 0:t.find(e=>e.email===o))throw Error((0,v.t)("ALREADY_SHARED",{email:o}));c=[o]}for(let e of c)if(!(e===r.email||(null==n?void 0:null===(i=n.sharees)||void 0===i?void 0:i.find(t=>t.email===e))))try{await (0,ta.XC)(n,e,l),await a(!1,!0)}catch(e){throw Error(nR(e))}},p=()=>{i(),o()};return(0,d.tZ)(d.HY,{children:(0,d.tZ)(nC.c,{anchor:"right",open:t,onClose:(e,t)=>{"backdropClick"===t?p():i()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:i,title:l===nw.M.VIEWER?(0,v.t)("ADD_VIEWERS"):(0,v.t)("ADD_COLLABORATORS"),onRootClose:p,caption:n.name}),(0,d.tZ)(nM,{onClose:i,callback:u,optionsList:s,placeholder:(0,v.t)("ENTER_EMAIL"),fieldType:"email",buttonText:l===nw.M.VIEWER?(0,v.t)("ADD_VIEWERS"):(0,v.t)("ADD_COLLABORATORS"),submitButtonProps:{size:"large",sx:{mt:1,mb:2}},disableAutoFocus:!0})]})})})}var nF=n(16475),nH=n(37120),nX=n(83498),nK=n(65242),nW=n(98614);function nz(e){let{collection:t,open:n,onClose:i,onRootClose:o,selectedParticipant:l,collectionUnshare:r}=e,a=(0,A.useContext)(aD),c=(0,A.useContext)(e9.AppContext),s=()=>{r(l.email),i()},u=e=>()=>{e!==l.role&&h(l.email,e)},p=async(e,n)=>{try{await (0,ta.XC)(t,e,n),l.role=n,await a.syncWithRemote(!1,!0)}catch(e){Z.ZP.error(nR(e),e)}},h=(e,t)=>{let n,i;"VIEWER"===t?(n=(0,d.tZ)(nW.cC,{i18nKey:"CHANGE_PERMISSIONS_TO_VIEWER",values:{selectedEmail:"".concat(e)}}),i=(0,v.t)("CONVERT_TO_VIEWER")):"COLLABORATOR"===t&&(n=(0,v.t)("CHANGE_PERMISSIONS_TO_COLLABORATOR",{selectedEmail:e}),i=(0,v.t)("CONVERT_TO_COLLABORATOR")),c.setDialogMessage({title:(0,v.t)("CHANGE_PERMISSION"),content:n,close:{text:(0,v.t)("cancel")},proceed:{text:i,action:()=>{p(e,t)},variant:"critical"}})};return l?(0,d.tZ)(d.HY,{children:(0,d.tZ)(nC.c,{anchor:"right",open:n,onClose:(e,t)=>{"backdropClick"===t?o():i()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:i,title:(0,v.t)("MANAGE"),onRootClose:o,caption:l.email}),(0,d.tZ)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,d.BX)(et.Z,{children:[(0,d.tZ)(m.Z,{color:"text.muted",variant:"small",padding:1,children:(0,v.t)("ADDED_AS")}),(0,d.BX)(ny.GP,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:u("COLLABORATOR"),label:"Collaborator",startIcon:(0,d.tZ)(nH.Z,{}),endIcon:"COLLABORATOR"===l.role&&(0,d.tZ)(tm.Z,{})}),(0,d.tZ)(ny.NP,{hasIcon:!0}),(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:u("VIEWER"),label:"Viewer",startIcon:(0,d.tZ)(nX.Z,{}),endIcon:"VIEWER"===l.role&&(0,d.tZ)(tm.Z,{})})]}),(0,d.tZ)(m.Z,{color:"text.muted",variant:"small",padding:1,children:(0,v.t)("COLLABORATOR_RIGHTS")}),(0,d.BX)(et.Z,{py:"30px",children:[(0,d.tZ)(m.Z,{color:"text.muted",variant:"small",padding:1,children:(0,v.t)("REMOVE_PARTICIPANT_HEAD")}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{color:"critical",fontWeight:"normal",onClick:()=>{c.setDialogMessage({title:(0,v.t)("REMOVE_PARTICIPANT"),content:(0,d.tZ)(nW.cC,{i18nKey:"REMOVE_PARTICIPANT_MESSAGE",values:{selectedEmail:"".concat(l.email)}}),close:{text:(0,v.t)("cancel")},proceed:{text:(0,v.t)("CONFIRM_REMOVE"),action:()=>{s()},variant:"critical"}})},label:"Remove",startIcon:(0,d.tZ)(nK.Z,{})})})]})]})})]})})}):(0,d.tZ)(d.HY,{})}function nG(e){var t,n,i,o,l;let{open:r,collection:a,onClose:c,onRootClose:s,peopleCount:u}=e,p=(0,A.useContext)(e9.AppContext),h=(0,A.useContext)(aD),[Z,g]=(0,A.useState)(!1),[f,m]=(0,A.useState)(!1),C=()=>g(!0),x=(0,A.useRef)(),w=(0,A.useRef)(),y=()=>{c(),s()},b=async e=>{try{p.startLoading(),await (0,ta.os)(a,e),await h.syncWithRemote(!1,!0)}finally{p.finishLoading()}},E=h.user.id===(null===(t=a.owner)||void 0===t?void 0:t.id)?h.user.email:null===(n=a.owner)||void 0===n?void 0:n.email,I=h.user.id===(null===(i=a.owner)||void 0===i?void 0:i.id),_=null===(o=a.sharees)||void 0===o?void 0:o.filter(e=>e.role===nw.M.COLLABORATOR).map(e=>e.email),S=(null===(l=a.sharees)||void 0===l?void 0:l.filter(e=>e.role===nw.M.VIEWER).map(e=>e.email))||[],T=e=>{w.current=a.sharees.find(t=>t.email===e),m(!0)};return(0,d.BX)(d.HY,{children:[(0,d.tZ)(nC.c,{anchor:"right",open:r,onClose:(e,t)=>{"backdropClick"===t?y():c()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:c,title:a.name,onRootClose:y,caption:(0,v.t)("participants_count",{count:u})}),(0,d.BX)(et.Z,{py:"20px",px:"12px",spacing:"24px",children:[(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("OWNER"),icon:(0,d.tZ)(nF.Z,{})}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>{},label:I?(0,v.t)("YOU"):E,startIcon:(0,d.tZ)(n_.Z,{email:E})})})]}),(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("COLLABORATORS"),icon:(0,d.tZ)(nH.Z,{})}),(0,d.BX)(ny.GP,{children:[_.map(e=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>T(e),label:e,startIcon:(0,d.tZ)(n_.Z,{email:e}),endIcon:(0,d.tZ)(Y.Z,{})},e),(0,d.tZ)(ny.NP,{hasIcon:!0})]})),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(nn.Z,{}),onClick:()=>{x.current=nw.M.COLLABORATOR,C()},label:(null==_?void 0:_.length)?(0,v.t)("ADD_MORE"):(0,v.t)("ADD_COLLABORATORS")})]})]}),(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("VIEWERS"),icon:(0,d.tZ)(nX.Z,{})}),(0,d.BX)(ny.GP,{children:[S.map(e=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>T(e),label:e,startIcon:(0,d.tZ)(n_.Z,{email:e}),endIcon:(0,d.tZ)(Y.Z,{})},e),(0,d.tZ)(ny.NP,{hasIcon:!0})]})),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(nn.Z,{}),fontWeight:"bold",onClick:()=>{x.current=nw.M.VIEWER,C()},label:(null==S?void 0:S.length)?(0,v.t)("ADD_MORE"):(0,v.t)("ADD_VIEWERS")})]})]})]})]})}),(0,d.tZ)(nz,{collectionUnshare:b,open:f,collection:a,onRootClose:s,onClose:()=>{m(!1)},selectedParticipant:w.current}),(0,d.tZ)(nU,{open:Z,onClose:()=>g(!1),onRootClose:s,collection:a,type:x.current})]})}function nY(e){var t,n,i;let{collection:o,onRootClose:l}=e,[r,a]=(0,A.useState)(!1),[c,s]=(0,A.useState)(!1),u=()=>a(!0),p=(0,A.useRef)();return(0,d.BX)(d.HY,{children:[(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("shared_with_people_count",{count:null!==(i=null===(t=o.sharees)||void 0===t?void 0:t.length)&&void 0!==i?i:0}),icon:(0,d.tZ)(nE.Z,{})}),(0,d.BX)(ny.GP,{children:[o.sharees.length>0?(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",startIcon:(0,d.tZ)(nD,{sharees:o.sharees}),onClick:()=>s(!0),label:1===o.sharees.length?null===(n=o.sharees[0])||void 0===n?void 0:n.email:null,endIcon:(0,d.tZ)(Y.Z,{})}),(0,d.tZ)(ny.NP,{hasIcon:!0})]}):null,(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(nn.Z,{}),onClick:()=>{p.current=nw.M.VIEWER,u()},label:(0,v.t)("ADD_VIEWERS")}),(0,d.tZ)(ny.NP,{hasIcon:!0}),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(nn.Z,{}),onClick:()=>{p.current=nw.M.COLLABORATOR,u()},label:(0,v.t)("ADD_COLLABORATORS")})]})]}),(0,d.tZ)(nU,{open:r,onClose:()=>a(!1),onRootClose:l,collection:o,type:p.current}),(0,d.tZ)(nG,{peopleCount:o.sharees.length,open:c,onClose:()=>s(!1),onRootClose:l,collection:o})]})}var nV=n(98693),nj=n(14289);function nQ(e){let{collection:t,setPublicShareProp:n,setCopyLinkModalView:i}=e,o=(0,A.useContext)(aD),[l,r]=(0,A.useState)(null),a=async()=>{try{r(null),o.setBlockingLoad(!0);let e=await (0,ta.Q8)(t);n(e),i(!0),o.syncWithRemote(!1,!0)}catch(e){r(nR(e))}finally{o.setBlockingLoad(!1)}},c=async()=>{try{r(null),o.setBlockingLoad(!0);let e=await (0,ta.Q8)(t);await (0,ta.lb)({collectionID:t.id,enableCollect:!0}),n(e),i(!0),o.syncWithRemote(!1,!0)}catch(e){r(nR(e))}finally{o.setBlockingLoad(!1)}};return(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("LINK_SHARE_TITLE"),icon:(0,d.tZ)(nj.Z,{})}),(0,d.BX)(ny.GP,{children:[(0,d.tZ)(nb.v,{label:(0,v.t)("CREATE_PUBLIC_SHARING"),startIcon:(0,d.tZ)(t_.Z,{}),onClick:a}),(0,d.tZ)(ny.NP,{hasIcon:!0}),(0,d.tZ)(nb.v,{label:(0,v.t)("COLLECT_PHOTOS"),startIcon:(0,d.tZ)(nV.Z,{}),onClick:c})]}),l&&(0,d.tZ)(m.Z,{textAlign:"center",variant:"small",sx:{color:e=>e.colors.danger.A700,mt:.5},children:l})]})}var nJ=n(91),nq=n(97197);function n$(e){let{open:t,onClose:n,handleCancel:i,copyToClipboardHelper:o}=e;return(0,d.BX)(nJ.Z,{open:t,onClose:n,disablePortal:!0,BackdropProps:{sx:{position:"absolute"}},sx:{position:"absolute"},PaperProps:{sx:{p:1}},children:[(0,d.tZ)(eT.Z,{children:(0,d.BX)(f.wx,{children:[(0,d.tZ)(m.Z,{fontWeight:"bold",children:(0,v.t)("PUBLIC_LINK_CREATED")}),(0,d.tZ)(q.Z,{pt:2,children:(0,d.tZ)(nq.Z,{sx:{fontSize:"48px"}})})]})}),(0,d.BX)(eD.Z,{children:[(0,d.tZ)(e5.Z,{onClick:i,color:"secondary",size:"large",children:(0,v.t)("DONE")}),(0,d.tZ)(e5.Z,{onClick:o,size:"large",color:"primary",autoFocus:!0,children:(0,v.t)("COPY_LINK")})]})]})}var n0=n(1039),n1=n(18302),n2=n(40947),n5=n(12912);function n3(e){let{collection:t,publicShareProp:n,updatePublicShareURLHelper:i,onRootClose:o}=e,l=async e=>i({collectionID:t.id,deviceLimit:e}),[r,a]=(0,A.useState)(!1),c=(0,A.useMemo)(()=>(0,ts.XA)(),[]),s=()=>a(!1),u=e=>async()=>{await l(e),a(!1)};return(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{label:(0,v.t)("LINK_DEVICE_LIMIT"),variant:"captioned",subText:0===n.deviceLimit?(0,v.t)("NO_DEVICE_LIMIT"):n.deviceLimit.toString(),onClick:()=>a(!0),endIcon:(0,d.tZ)(Y.Z,{})}),(0,d.tZ)(nC.c,{anchor:"right",open:r,onClose:(e,t)=>{"backdropClick"===t?o():s()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:s,title:(0,v.t)("LINK_DEVICE_LIMIT"),onRootClose:o}),(0,d.tZ)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,d.tZ)(ny.GP,{children:c.map((e,t)=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:u(e.value),label:e.label},e.label),t!==c.length-1&&(0,d.tZ)(ny.NP,{})]}))})})]})})]})}function n4(e){var t;let{publicShareProp:n,updatePublicShareURLHelper:i,collection:o}=e,l=(0,A.useContext)(e9.AppContext),r=()=>{l.setDialogMessage({title:(0,v.t)("DISABLE_FILE_DOWNLOAD"),content:(0,d.tZ)(nW.cC,{i18nKey:"DISABLE_FILE_DOWNLOAD_MESSAGE"}),close:{text:(0,v.t)("cancel")},proceed:{text:(0,v.t)("disable"),action:()=>i({collectionID:o.id,enableDownload:!1}),variant:"critical"}})};return(0,d.tZ)(nb.v,{checked:null===(t=null==n?void 0:n.enableDownload)||void 0===t||t,onClick:()=>{n.enableDownload?r():i({collectionID:o.id,enableDownload:!0})},variant:"toggle",label:(0,v.t)("FILE_DOWNLOAD")})}var n8=n(37653);function n9(e){let{publicShareProp:t,collection:n,updatePublicShareURLHelper:i,onRootClose:o}=e,l=async e=>i({collectionID:n.id,validTill:e}),[r,a]=(0,A.useState)(!1),c=(0,A.useMemo)(()=>(0,ts.Jk)(),[]),s=()=>a(!1),u=e=>async()=>{await l(e),t.validTill=e,a(!1)};return(0,d.BX)(d.HY,{children:[(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{onClick:()=>a(!0),endIcon:(0,d.tZ)(Y.Z,{}),variant:"captioned",label:(0,v.t)("LINK_EXPIRY"),color:io(null==t?void 0:t.validTill)?"critical":"primary",subText:io(null==t?void 0:t.validTill)?(0,v.t)("LINK_EXPIRED"):(null==t?void 0:t.validTill)?(0,n8.o0)((null==t?void 0:t.validTill)/1e3):(0,v.t)("NEVER")})}),(0,d.tZ)(nC.c,{anchor:"right",open:r,onClose:(e,t)=>{"backdropClick"===t?o():s()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:s,title:(0,v.t)("LINK_EXPIRY"),onRootClose:o}),(0,d.tZ)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:(0,d.tZ)(ny.GP,{children:c.map((e,t)=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:u(e.value()),label:e.label},e.value()),t!==c.length-1&&(0,d.tZ)(ny.NP,{})]}))})})]})})]})}var n6=n(22969);function n7(e){let{open:t,onClose:n,collection:i,publicShareProp:o,updatePublicShareURLHelper:l,setChangePasswordView:r}=e,a=async(e,t)=>{e&&e.trim().length>=1?(await c(e),r(!1),o.passwordEnabled=!0):t("can not be empty")},c=async e=>{let t=await (0,n6.Lb)(),n=await t.generateSaltToDeriveKey(),o=await t.deriveInteractiveKey(e,n);return l({collectionID:i.id,passHash:o.key,nonce:n,opsLimit:o.opsLimit,memLimit:o.memLimit})};return(0,d.tZ)(e_.Z,{open:t,onClose:n,disablePortal:!0,BackdropProps:{sx:{position:"absolute"}},sx:{position:"absolute"},PaperProps:{sx:{p:1}},maxWidth:"sm",fullWidth:!0,children:(0,d.BX)(et.Z,{spacing:3,p:1.5,children:[(0,d.tZ)(m.Z,{variant:"h3",px:1,py:.5,fontWeight:"bold",children:(0,v.t)("PASSWORD_LOCK")}),(0,d.tZ)(te.Z,{callback:a,placeholder:(0,v.t)("password"),buttonText:(0,v.t)("LOCK"),fieldType:"password",secondaryButtonAction:n,submitButtonProps:{sx:{mt:1,mb:2}}})]})})}function ie(e){let{collection:t,publicShareProp:n,updatePublicShareURLHelper:i}=e,o=(0,A.useContext)(e9.AppContext),[l,r]=(0,A.useState)(!1),a=async()=>{n.passwordEnabled?await c():r(!0)},c=async()=>{o.setDialogMessage({title:(0,v.t)("DISABLE_PASSWORD"),content:(0,v.t)("DISABLE_PASSWORD_MESSAGE"),close:{text:(0,v.t)("cancel")},proceed:{text:(0,v.t)("disable"),action:()=>i({collectionID:t.id,disablePassword:!0}),variant:"critical"}})};return(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{label:(0,v.t)("link_password_lock"),onClick:a,checked:!!(null==n?void 0:n.passwordEnabled),variant:"toggle"}),(0,d.tZ)(n7,{open:l,onClose:()=>r(!1),collection:t,publicShareProp:n,updatePublicShareURLHelper:i,setChangePasswordView:r})]})}function it(e){let{publicShareProp:t,updatePublicShareURLHelper:n,collection:i}=e;return(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{onClick:()=>{n({collectionID:i.id,enableCollect:!t.enableCollect})},variant:"toggle",checked:null==t?void 0:t.enableCollect,label:(0,v.t)("PUBLIC_COLLECT")})}),(0,d.tZ)(ny.F_,{title:(0,v.t)("PUBLIC_COLLECT_SUBTEXT")})]})}function ii(e){let{publicShareProp:t,collection:n,setPublicShareProp:i,open:o,onClose:l,onRootClose:r,publicShareUrl:a}=e,c=(0,A.useContext)(aD),[s,u]=(0,A.useState)(null),p=async e=>{try{c.setBlockingLoad(!0);let t=await (0,ta.lb)(e);i(t),c.syncWithRemote(!1,!0)}catch(e){u(nR(e))}finally{c.setBlockingLoad(!1)}},h=async()=>{try{c.setBlockingLoad(!0),await (0,ta.a0)(n),i(null),c.syncWithRemote(!1,!0),l()}catch(e){u(nR(e))}finally{c.setBlockingLoad(!1)}};return(0,d.tZ)(d.HY,{children:(0,d.tZ)(nC.c,{anchor:"right",open:o,onClose:(e,t)=>{"backdropClick"===t?r():l()},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:l,title:(0,v.t)("share_album"),onRootClose:r}),(0,d.BX)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,d.BX)(et.Z,{spacing:3,children:[(0,d.tZ)(it,{collection:n,publicShareProp:t,updatePublicShareURLHelper:p}),(0,d.tZ)(n9,{collection:n,publicShareProp:t,updatePublicShareURLHelper:p,onRootClose:r}),(0,d.BX)(ny.GP,{children:[(0,d.tZ)(n3,{collection:n,publicShareProp:t,updatePublicShareURLHelper:p,onRootClose:r}),(0,d.tZ)(ny.NP,{}),(0,d.tZ)(n4,{collection:n,publicShareProp:t,updatePublicShareURLHelper:p}),(0,d.tZ)(ny.NP,{}),(0,d.tZ)(ie,{collection:n,publicShareProp:t,updatePublicShareURLHelper:p})]}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(n2.Z,{}),onClick:()=>{navigator.clipboard.writeText(a)},label:(0,v.t)("COPY_LINK")})}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{color:"critical",startIcon:(0,d.tZ)(n5.Z,{}),onClick:h,label:(0,v.t)("REMOVE_LINK")})})]}),s&&(0,d.tZ)(m.Z,{textAlign:"center",variant:"small",sx:{color:e=>e.colors.danger.A700,mt:.5},children:s})]})]})})})}let io=e=>e&&e<1e3*Date.now();function il(e){let{publicShareProp:t,setPublicShareProp:n,collection:i,onRootClose:o,publicShareUrl:l,copyToClipboardHelper:r}=e,[a,c]=(0,A.useState)(!1),s=()=>c(!0);return(0,d.BX)(d.HY,{children:[(0,d.BX)(et.Z,{children:[(0,d.BX)(m.Z,{color:"text.muted",variant:"small",padding:1,children:[(0,d.tZ)(nj.Z,{style:{fontSize:17,marginRight:8}}),(0,v.t)("PUBLIC_LINK_ENABLED")]}),(0,d.BX)(ny.GP,{children:[io(t.validTill)?(0,d.tZ)(nb.v,{disabled:!0,startIcon:(0,d.tZ)(n1.Z,{}),color:"critical",onClick:s,label:(0,v.t)("LINK_EXPIRED")}):(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(n0.Z,{}),onClick:r,disabled:io(t.validTill),label:(0,v.t)("COPY_LINK")}),(0,d.tZ)(ny.NP,{hasIcon:!0}),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(t_.Z,{}),endIcon:(0,d.tZ)(Y.Z,{}),onClick:s,label:(0,v.t)("MANAGE_LINK")})]})]}),(0,d.tZ)(ii,{open:a,onClose:()=>c(!1),onRootClose:o,publicShareProp:t,collection:i,setPublicShareProp:n,publicShareUrl:l})]})}function ir(e){let{collection:t,onRootClose:n}=e,[i,o]=(0,A.useState)(null),[l,r]=(0,A.useState)(null),[a,c]=(0,A.useState)(!1);(0,A.useEffect)(()=>{var e;(null===(e=t.publicURLs)||void 0===e?void 0:e.length)&&r(t.publicURLs[0])},[t]),(0,A.useEffect)(()=>{l?o((0,ts.mG)(l.url,t.key)):o(null)},[l]);let s=()=>{navigator.clipboard.writeText(i),u()},u=()=>{c(!1)};return(0,d.BX)(d.HY,{children:[l?(0,d.tZ)(il,{publicShareProp:l,setPublicShareProp:r,collection:t,publicShareUrl:i,onRootClose:n,copyToClipboardHelper:s}):(0,d.tZ)(nQ,{setPublicShareProp:r,collection:t,setCopyLinkModalView:c}),(0,d.tZ)(n$,{open:a,onClose:u,handleCancel:u,copyToClipboardHelper:s})]})}function ia(e){var t,n,i,o,l,r,a;let{collection:c,type:s}=e,u=(0,A.useContext)(aD),p=u.user.id===(null===(t=c.owner)||void 0===t?void 0:t.id)?null===(n=u.user)||void 0===n?void 0:n.email:null===(i=c.owner)||void 0===i?void 0:i.email,h=null===(o=c.sharees)||void 0===o?void 0:o.filter(e=>e.role===nw.M.COLLABORATOR).map(e=>e.email),Z=(null===(l=c.sharees)||void 0===l?void 0:l.filter(e=>e.role===nw.M.VIEWER).map(e=>e.email))||[],g=(null===(r=u.user)||void 0===r?void 0:r.id)===(null===(a=c.owner)||void 0===a?void 0:a.id),f=e=>{var t;return e===(null===(t=u.user)||void 0===t?void 0:t.email)};return(0,d.BX)(d.HY,{children:[(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("OWNER"),icon:(0,d.tZ)(nF.Z,{})}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>{},label:g?(0,v.t)("YOU"):p,startIcon:(0,d.tZ)(n_.Z,{email:p})})})]}),"incomingShareCollaborator"==s&&(null==h?void 0:h.length)>0&&(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("COLLABORATORS"),icon:(0,d.tZ)(nH.Z,{})}),(0,d.tZ)(ny.GP,{children:h.map((e,t)=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>{},label:f(e)?(0,v.t)("YOU"):e,startIcon:(0,d.tZ)(n_.Z,{email:e})},e),t!==h.length-1&&(0,d.tZ)(ny.NP,{})]}))})]}),(null==Z?void 0:Z.length)>0&&(0,d.BX)(et.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("VIEWERS"),icon:(0,d.tZ)(nX.Z,{})}),(0,d.tZ)(ny.GP,{children:Z.map((e,t)=>(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{fontWeight:"normal",onClick:()=>{},label:f(e)?(0,v.t)("YOU"):e,startIcon:(0,d.tZ)(n_.Z,{email:e})},e),t!==Z.length-1&&(0,d.tZ)(ny.NP,{})]}))})]})]})}var ic=function(e){let{collectionSummary:t,...n}=e,i=()=>{n.onClose()};if(!n.collection||!t)return(0,d.tZ)(d.HY,{});let{type:o}=t;return(0,d.tZ)(nC.c,{anchor:"right",open:n.open,onClose:(e,t)=>{"backdropClick"===t?i():n.onClose()},slotProps:{backdrop:{sx:{"&&&":{backgroundColor:"transparent"}}}},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:n.onClose,title:"incomingShareCollaborator"==o||"incomingShareViewer"==o?(0,v.t)("sharing_details"):(0,v.t)("share_album"),onRootClose:i,caption:n.collection.name}),(0,d.tZ)(et.Z,{py:"20px",px:"8px",gap:"24px",children:"incomingShareCollaborator"==o||"incomingShareViewer"==o?(0,d.tZ)(ia,{collection:n.collection,type:o}):(0,d.BX)(d.HY,{children:[(0,d.tZ)(nY,{collection:n.collection,onRootClose:i}),(0,d.tZ)(ir,{collection:n.collection,onRootClose:i})]})})]})})},is=n(98977),id=n(68032),iu=n(84836);let ip=()=>(void 0===i&&(i=new Promise(e=>{let t=document.createElement("script");t.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",window.__onGCastApiAvailable=t=>{t&&(cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:"F5BCEC64",autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),e(cast))},document.body.appendChild(t)})),i);var ih=n(68351),iZ=n(56810);class ig{async getCastData(e){let t;try{t=await iZ.Z.get(await (0,ih.QH)("/cast/cast-data/".concat(e)))}catch(e){throw Z.ZP.error("failed to getCastData",e),e}return t.data.encCastData}async revokeAllTokens(){try{let e=(0,eq.LP)();await iZ.Z.delete(await (0,ih.QH)("/cast/revoke-all-tokens/"),void 0,void 0,{"X-Auth-Token":e})}catch(e){Z.ZP.error("removeAllTokens failed",e)}}async getPublicKey(e){let t;try{let n=(0,eq.LP)();t=await iZ.Z.get(await (0,ih.QH)("/cast/device-info/".concat(e)),void 0,{"X-Auth-Token":n})}catch(e){if(e instanceof eV.MS&&404===e.httpStatusCode)return"";throw Z.ZP.error("failed to getPublicKey",e),e}return t.data.publicKey}async registerDevice(e){return(await iZ.Z.post(await (0,ih.QH)("/cast/device-info/"),{publicKey:e})).data.deviceCode}async publishCastPayload(e,t,n,i){let o=(0,eq.LP)();await iZ.Z.post(await (0,ih.QH)("/cast/cast-data/"),{deviceCode:"".concat(e),encPayload:t,collectionID:n,castToken:i},void 0,{"X-Auth-Token":o})}constructor(){}}var im=new ig,iv=n(72595),iA=n(6364);let iC=e=>{let{open:t,onClose:n,collection:i}=e,[o,l]=(0,A.useState)("choose"),[r,a]=(0,A.useState)(!1);(0,A.useEffect)(()=>{im.revokeAllTokens(),a(void 0!==window.chrome)},[]);let c=async(e,t)=>{try{await s(e.trim()),n()}catch(e){t(e instanceof Error&&"tv-not-found"==e.message?(0,v.t)("tv_not_found"):(0,v.t)("UNKNOWN_ERROR"))}},s=async e=>{let t=await im.getPublicKey(e);if(!t)throw Error("tv-not-found");let n=(0,iA.Z)(),o=JSON.stringify({castToken:n,collectionID:i.id,collectionKey:i.key}),l=await (0,iu.Jl)(btoa(o),t);await im.publishCastPayload(e,l,i.id,n)};return(0,A.useEffect)(()=>{"auto"===o&&ip().then(async e=>{let t=e.framework.CastContext.getInstance();try{await t.requestSession()}catch(e){l("auto-cast-error"),Z.ZP.error("Error requesting session",e);return}let o=t.getCurrentSession();o.addMessageListener("urn:x-cast:pair-request",(e,t)=>{let i=JSON.parse(t).code;i&&s(i).then(()=>{l("choose"),n()}).catch(e=>{Z.ZP.error("Error casting to TV",e),l("auto-cast-error")})});let r=i.id;o.sendMessage("urn:x-cast:pair-request",{collectionID:r}).then(()=>{Z.ZP.debug(()=>"urn:x-cast:pair-request sent")})})},[o]),(0,A.useEffect)(()=>{t&&im.revokeAllTokens()},[t]),(0,d.BX)(e4.Z,{open:t,onClose:n,attributes:{title:(0,v.t)("cast_album_to_tv")},sx:{zIndex:1600},children:["choose"==o&&(0,d.BX)(et.Z,{sx:{py:1,gap:4},children:[r&&(0,d.BX)(et.Z,{sx:{gap:2},children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("cast_auto_pair_description")}),(0,d.tZ)(e5.Z,{onClick:()=>l("auto"),children:(0,v.t)("cast_auto_pair")})]}),(0,d.BX)(et.Z,{sx:{gap:2},children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("pair_with_pin_description")}),(0,d.tZ)(e5.Z,{onClick:()=>l("pin"),children:(0,v.t)("pair_with_pin")})]})]}),"auto"==o&&(0,d.BX)(et.Z,{sx:{pt:1,gap:3,textAlign:"center"},children:[(0,d.tZ)("div",{children:(0,d.tZ)(ez.Z,{})}),(0,d.tZ)(m.Z,{children:(0,v.t)("choose_device_from_browser")}),(0,d.tZ)(e5.Z,{color:"secondary",onClick:()=>l("choose"),children:(0,v.t)("GO_BACK")})]}),"auto-cast-error"==o&&(0,d.BX)(et.Z,{sx:{pt:1,gap:3,textAlign:"center"},children:[(0,d.tZ)(m.Z,{children:(0,v.t)("cast_auto_pair_failed")}),(0,d.tZ)(e5.Z,{color:"secondary",onClick:()=>l("choose"),children:(0,v.t)("GO_BACK")})]}),"pin"==o&&(0,d.BX)(d.HY,{children:[(0,d.tZ)(m.Z,{children:(0,d.tZ)(nW.cC,{i18nKey:"visit_cast_url",components:{a:(0,d.tZ)(iv.Z,{target:"_blank",href:"https://cast.ente.io"})},values:{url:"cast.ente.io"}})}),(0,d.tZ)(m.Z,{children:(0,v.t)("enter_cast_pin_code")}),(0,d.tZ)(te.Z,{callback:c,fieldType:"text",realLabel:"Code",realPlaceholder:"123456",buttonText:(0,v.t)("pair_device_to_tv"),submitButtonProps:{sx:{mt:1,mb:2}}}),(0,d.tZ)(e5.Z,{variant:"text",onClick:()=>l("choose"),children:(0,v.t)("GO_BACK")})]})]})};var ix=n(53903),iw=n(27559),iy=n(2732),ib=n(34288),iE=n(17983),iI=n(44533),i_=n(11344),iS=n(66918),iT=n(13757),iP=n(40510);let iD=e=>(0,d.BX)(tA.Z,{id:"eNi9tomYy271",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960","shape-rendering":"geometricPrecision","text-rendering":"geometricPrecision",...e,children:[(0,d.tZ)("defs",{children:(0,d.BX)("linearGradient",{id:"eNi9tomYy273-fill",x1:"0",y1:"0.5",x2:"1",y2:"0.5",spreadMethod:"pad",gradientUnits:"objectBoundingBox",gradientTransform:"translate(0 0)",children:[(0,d.tZ)("stop",{id:"eNi9tomYy273-fill-0",offset:"100%","stop-color":"#fff"}),(0,d.tZ)("stop",{id:"eNi9tomYy273-fill-1",offset:"100%","stop-color":"#fff"})]})}),(0,d.tZ)("path",{d:"M634,-448l86,77v60h-210v241l-30,30-30-30v-241h-210v-60l80-77v-332h-50v-60h414v60h-50v332Zm-313,77h312l-59-55v-354h-194v354l-59,55Zm156,0"}),(0,d.tZ)("rect",{width:"26.347306",height:"26.347306",rx:"0",ry:"0",transform:"matrix(29.14543 20.40785-1.147153 1.638304 147.37857-852.859017)",fill:"url(#eNi9tomYy273-fill)","stroke-width":"0"}),(0,d.tZ)("rect",{width:"65.868264",height:"8.383234",rx:"0",ry:"0",transform:"matrix(.961684 0.648664-.559193 0.829038 575.09991-562.860814)",fill:"#f8eeee","stroke-width":"0"}),(0,d.tZ)("rect",{width:"65.868264",height:"8.383234",rx:"0",ry:"0",transform:"matrix(.961684 0.648664-.559193 0.829038 322.549012-741.890754)",fill:"#fff","stroke-width":"0"}),(0,d.tZ)("rect",{width:"96",height:"96",rx:"0",ry:"0",transform:"translate(1379.418154-389.125449)",fill:"#d2dbed","stroke-width":"0"})]});iD.defaultProps={height:20,width:20};var iR=n(79301),iL=n(28188);let ik=e=>{let{collectionSummary:t,...n}=e;if(!t)return(0,b.L)("Gallery/CollectionHeader without a collection"),(0,d.tZ)(d.HY,{});let{name:i,type:o,fileCount:l}=t;return(0,d.tZ)(C.R,{children:(0,d.BX)(tw.G,{children:[(0,d.tZ)(C.M,{name:i,fileCount:l,endIcon:(0,d.tZ)(e=>{let{type:t}=e;switch(t){case"favorites":return(0,d.tZ)(tI.Z,{});case"archived":return(0,d.tZ)(iw.Z,{});case"incomingShareViewer":case"incomingShareCollaborator":case"outgoingShare":return(0,d.tZ)(tT.Z,{});case"sharedOnlyViaLink":return(0,d.tZ)(t_.Z,{});default:return(0,d.tZ)(d.HY,{})}},{type:o})}),iO(o)&&(0,d.tZ)(iN,{collectionSummaryType:o,...n})]})})},iO=e=>"all"!=e&&"archive"!=e,iN=e=>{let{activeCollection:t,collectionSummaryType:n,setActiveCollectionID:i,onCollectionShare:o,onCollectionCast:l,setCollectionNamerAttributes:r,setFilesDownloadProgressAttributesCreator:a,isActiveCollectionDownloadInProgress:c}=e,{startLoading:s,finishLoading:u,setDialogMessage:p}=(0,A.useContext)(e9.AppContext),{syncWithRemote:h}=(0,A.useContext)(aD),g=(0,A.useRef)(null),[m,C]=(0,A.useState)(!1),x=(0,A.useCallback)(e=>{Z.ZP.error("Collection action failed",e),p({title:(0,v.t)("error"),content:(0,v.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})},[p]),w=(0,A.useCallback)(e=>{let t=async()=>{s();try{await e()}catch(e){x(e)}finally{h(!1,!0),u()}};return()=>void t()},[x,h,s,u]),y=async e=>{t.name!==e&&await ta.LU(t,e)},b=e=>w(()=>y(e))(),E=w(async()=>{await ta.P4(t.id,!1),i(ts.Ug)}),I=w(async()=>{await ta.P4(t.id,!0),i(ts.Ug)}),_=()=>p({title:(0,v.t)("empty_trash_title"),content:(0,v.t)("empty_trash_message"),proceed:{action:S,text:(0,v.t)("empty_trash"),variant:"critical"},close:{text:(0,v.t)("cancel")}}),S=w(async()=>{await iR.uo(),await iR.lM(),i(ts.Ug)}),T=()=>{if(!c())return"hiddenItems"==n?(0,ts.gC)(a(t.name,ts.zA,!0)):(0,ts.LP)(t.id,a(t.name,t.id,(0,ts._K)(t)))},P=()=>void T().catch(x),D=w(()=>(0,ts.gf)(t,ix.GI.archived)),R=w(()=>(0,ts.gf)(t,ix.GI.visible)),L=w(async()=>{await ta.jV(t.id),i(ts.Ug)}),k=w(()=>(0,ts.pd)(t,1)),O=w(()=>(0,ts.pd)(t,0)),N=w(async()=>{await (0,ts.gf)(t,ix.GI.hidden),i(ts.Ug)}),B=w(async()=>{await (0,ts.gf)(t,ix.GI.visible),i(ts.zA)}),M=w(()=>(0,ts.Ql)(t,!0)),U=w(()=>(0,ts.Ql)(t,!1));return(0,d.BX)(f.cD,{sx:{display:"inline-flex",gap:"16px"},children:[(0,d.tZ)(iB,{collectionSummaryType:n,isDownloadInProgress:c,onEmptyTrashClick:_,onDownloadClick:P,onShareClick:o}),(0,d.tZ)(tg.Z,{ariaControls:"collection-options",triggerButtonIcon:(0,d.tZ)(no.Z,{ref:g}),children:"trash"==n?(0,d.tZ)(iW,{onClick:_}):"favorites"==n?(0,d.tZ)(iz,{isDownloadInProgress:c,onClick:P,children:(0,v.t)("download_favorites")}):"uncategorized"==n?(0,d.tZ)(iz,{onClick:P,children:(0,v.t)("download_uncategorized")}):"hiddenItems"==n?(0,d.tZ)(iz,{onClick:P,children:(0,v.t)("download_hidden_items")}):"incomingShareViewer"==n||"incomingShareCollaborator"==n?(0,d.tZ)(iG,{isArchived:(0,iL.v)(t),onArchiveClick:D,onUnarchiveClick:R,onLeaveSharedAlbumClick:()=>{p({title:(0,v.t)("leave_shared_album_title"),content:(0,v.t)("leave_shared_album_message"),proceed:{text:(0,v.t)("leave_shared_album"),action:L,variant:"critical"},close:{text:(0,v.t)("cancel")}})},onCastClick:l}):(0,d.tZ)(iY,{isArchived:(0,iL.v)(t),isHidden:(0,ts._K)(t),isPinned:(0,iL.ED)(t),onRenameClick:()=>{r({title:(0,v.t)("rename_album"),buttonText:(0,v.t)("rename"),autoFilledName:t.name,callback:b})},onSortClick:()=>C(!0),onArchiveClick:D,onUnarchiveClick:R,onPinClick:k,onUnpinClick:O,onHideClick:N,onUnhideClick:B,onDeleteClick:()=>{p({title:(0,v.t)("delete_album_title"),content:(0,d.tZ)(nW.cC,{i18nKey:"delete_album_message",components:{a:(0,d.tZ)(q.Z,{component:"span",color:"text.base"})}}),proceed:{text:(0,v.t)("delete_photos"),action:E,variant:"critical"},secondary:{text:(0,v.t)("keep_photos"),action:I,variant:"primary"},close:{text:(0,v.t)("cancel")}})},onShareClick:o,onCastClick:l})}),(0,d.tZ)(iV,{open:m,onClose:()=>C(!1),overFlowMenuIconRef:g,onAscClick:M,onDescClick:U})]})},iB=e=>{let{onEmptyTrashClick:t,onDownloadClick:n,onShareClick:i,collectionSummaryType:o,isDownloadInProgress:l}=e;return(0,d.BX)(et.Z,{direction:"row",sx:{alignItems:"center",gap:"16px"},children:[iM(o)&&(0,d.tZ)(iU,{onClick:t}),iF(o)&&(l()?(0,d.tZ)(ez.Z,{size:"20px",sx:{m:"12px"}}):(0,d.tZ)(iH,{onClick:n,collectionSummaryType:o})),iX(o)&&(0,d.tZ)(iK,{onClick:i,collectionSummaryType:o})]})},iM=e=>"trash"==e,iU=e=>{let{onClick:t}=e;return(0,d.tZ)(tD.Z,{title:(0,v.t)("empty_trash"),children:(0,d.tZ)($.Z,{onClick:t,children:(0,d.tZ)(iy.Z,{})})})},iF=e=>"folder"==e||"favorites"==e||"album"==e||"uncategorized"==e||"hiddenItems"==e||"incomingShareViewer"==e||"incomingShareCollaborator"==e||"outgoingShare"==e||"sharedOnlyViaLink"==e||"archived"==e||"pinned"==e,iH=e=>{let{onClick:t,collectionSummaryType:n}=e;return(0,d.tZ)(tD.Z,{title:"favorites"==n?(0,v.t)("download_favorites"):"uncategorized"==n?(0,v.t)("download_uncategorized"):"hiddenItems"==n?(0,v.t)("download_hidden_items"):(0,v.t)("download_album"),children:(0,d.tZ)($.Z,{onClick:t,children:(0,d.tZ)(ib.Z,{})})})},iX=e=>"folder"==e||"album"==e||"outgoingShare"==e||"sharedOnlyViaLink"==e||"archived"==e||"incomingShareViewer"==e||"incomingShareCollaborator"==e||"pinned"==e,iK=e=>{let{onClick:t,collectionSummaryType:n}=e;return(0,d.tZ)(tD.Z,{title:"incomingShareViewer"==n||"incomingShareCollaborator"==n?(0,v.t)("sharing_details"):"outgoingShare"==n||"sharedOnlyViaLink"==n?(0,v.t)("modify_sharing"):(0,v.t)("share_album"),children:(0,d.tZ)($.Z,{onClick:t,children:(0,d.tZ)(tT.Z,{})})})},iW=e=>{let{onClick:t}=e;return(0,d.tZ)(tf.x,{color:"critical",startIcon:(0,d.tZ)(iy.Z,{}),onClick:t,children:(0,v.t)("empty_trash")})},iz=e=>{let{isDownloadInProgress:t,onClick:n,children:i}=e;return(0,d.tZ)(tf.x,{startIcon:t&&t()?(0,d.tZ)(ez.Z,{size:"20px",sx:{cursor:"not-allowed"}}):(0,d.tZ)(ib.Z,{}),onClick:n,children:i})},iG=e=>{let{isArchived:t,onArchiveClick:n,onUnarchiveClick:i,onLeaveSharedAlbumClick:o,onCastClick:l}=e;return(0,d.BX)(d.HY,{children:[t?(0,d.tZ)(tf.x,{onClick:i,startIcon:(0,d.tZ)(iS.Z,{}),children:(0,v.t)("unarchive_album")}):(0,d.tZ)(tf.x,{onClick:n,startIcon:(0,d.tZ)(iw.Z,{}),children:(0,v.t)("archive_album")}),(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(iE.Z,{}),onClick:o,children:(0,v.t)("leave_album")}),(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(i_.Z,{}),onClick:l,children:(0,v.t)("cast_album_to_tv")})]})},iY=e=>{let{isArchived:t,isPinned:n,isHidden:i,onRenameClick:o,onSortClick:l,onArchiveClick:r,onUnarchiveClick:a,onPinClick:c,onUnpinClick:s,onHideClick:u,onUnhideClick:p,onDeleteClick:h,onShareClick:Z,onCastClick:g}=e;return(0,d.BX)(d.HY,{children:[(0,d.tZ)(tf.x,{onClick:o,startIcon:(0,d.tZ)(ni.Z,{}),children:(0,v.t)("rename_album")}),(0,d.tZ)(tf.x,{onClick:l,startIcon:(0,d.tZ)(tv.Z,{}),children:(0,v.t)("sort_by")}),n?(0,d.tZ)(tf.x,{onClick:s,startIcon:(0,d.tZ)(iD,{}),children:(0,v.t)("unpin_album")}):(0,d.tZ)(tf.x,{onClick:c,startIcon:(0,d.tZ)(iI.Z,{}),children:(0,v.t)("pin_album")}),!i&&(0,d.tZ)(d.HY,{children:t?(0,d.tZ)(tf.x,{onClick:a,startIcon:(0,d.tZ)(iS.Z,{}),children:(0,v.t)("unarchive_album")}):(0,d.tZ)(tf.x,{onClick:r,startIcon:(0,d.tZ)(iw.Z,{}),children:(0,v.t)("archive_album")})}),i?(0,d.tZ)(tf.x,{onClick:p,startIcon:(0,d.tZ)(iP.Z,{}),children:(0,v.t)("unhide_collection")}):(0,d.tZ)(tf.x,{onClick:u,startIcon:(0,d.tZ)(iT.Z,{}),children:(0,v.t)("hide_collection")}),(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(iy.Z,{}),onClick:h,children:(0,v.t)("delete_album")}),(0,d.tZ)(tf.x,{onClick:Z,startIcon:(0,d.tZ)(tT.Z,{}),children:(0,v.t)("share_album")}),(0,d.tZ)(tf.x,{startIcon:(0,d.tZ)(i_.Z,{}),onClick:g,children:(0,v.t)("cast_album_to_tv")})]})},iV=e=>{let{open:t,onClose:n,overFlowMenuIconRef:i,onAscClick:o,onDescClick:l}=e;return(0,d.BX)(tg.l,{id:"collection-files-sort",anchorEl:i.current,open:t,onClose:n,MenuListProps:{disablePadding:!0,"aria-labelledby":"collection-files-sort"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,d.tZ)(tf.x,{onClick:()=>{n(),l()},children:(0,v.t)("newest_first")}),(0,d.tZ)(tf.x,{onClick:()=>{n(),o()},children:(0,v.t)("oldest_first")})]})},ij=e=>{let{shouldHide:t,showPeopleSectionButton:n,mode:i,onChangeMode:o,collectionSummaries:l,activeCollection:r,activeCollectionID:a,setActiveCollectionID:c,hiddenCollectionSummaries:s,people:u,activePerson:p,onSelectPerson:h,setCollectionNamerAttributes:Z,setPhotoListHeader:g,filesDownloadProgressAttributesList:f,setFilesDownloadProgressAttributesCreator:m}=e,v=(0,A.useContext)(e9.AppContext),[C,x]=(0,A.useState)(!1),[w,y]=(0,A.useState)(!1),[b,E]=(0,A.useState)(!1),[I,_]=iQ("updation-time-desc"),S=(0,A.useMemo)(()=>"hidden-albums"==i?s:l,[i,s,l]),T=(0,A.useMemo)(()=>t||!(0,ts.Hl)(S)&&a===ts.Ug,[t,S,a]),P=(0,A.useMemo)(()=>(0,ta.pF)([...S.values()],I),[I,S]),D=(0,A.useCallback)(()=>{let e=f.find(e=>e.collectionID===a);return e&&!(0,id.z7)(e)&&!(0,id.ZN)(e)},[a,f]);return((0,A.useEffect)(()=>{t||g({item:"people"!=i?(0,d.tZ)(ik,{activeCollection:r,setActiveCollectionID:c,setCollectionNamerAttributes:Z,setFilesDownloadProgressAttributesCreator:m,isActiveCollectionDownloadInProgress:D,collectionSummary:S.get(a),onCollectionShare:()=>y(!0),onCollectionCast:()=>E(!0)}):p?(0,d.tZ)(na,{person:p,onSelectPerson:h,appContext:v}):(0,d.tZ)(d.HY,{}),itemType:is.Z$.HEADER,height:68})},[t,i,S,a,D,p]),T)?(0,d.tZ)(d.HY,{}):(0,d.BX)(d.HY,{children:[(0,d.tZ)(tW,{showPeopleSectionButton:n,mode:i,onChangeMode:o,activeCollectionID:a,people:u,activePerson:p,onSelectPerson:h,collectionsSortBy:I,onSelectCollectionID:c,onChangeCollectionsSortBy:_,onShowAllCollections:()=>x(!0),collectionSummaries:P.filter(e=>(0,ts.Nf)(e.type))}),(0,d.tZ)(nv,{open:C,onClose:()=>x(!1),collectionSummaries:P.filter(e=>!(0,ts.K7)(e.type)),onSelectCollectionID:c,onChangeCollectionsSortBy:_,collectionsSortBy:I,isInHiddenSection:"hidden-albums"==i}),(0,d.tZ)(ic,{collectionSummary:S.get(a),open:w,onClose:()=>y(!1),collection:r}),(0,d.tZ)(iC,{open:b,onClose:()=>E(!1),collection:r})]})},iQ=e=>{let t="collectionsSortBy",[n,i]=(0,A.useState)(e);return(0,A.useEffect)(()=>{let e=localStorage.getItem(t);if(e)(0,nu.q)(nd,e)&&i(e);else{let e=(0,eJ.Yu)(eJ.Pd.COLLECTION_SORT_BY);if(e){let n;switch(e.value){case 0:n="name";break;case 1:n="creation-time-asc";break;case 2:n="updation-time-desc"}n&&(localStorage.setItem(t,n),i(n)),(0,eJ.NU)(eJ.Pd.COLLECTION_SORT_BY)}}},[]),[n,e=>{localStorage.setItem(t,e),i(e)}]};var iJ=n(85872),iq=n(87283),i$=n(72751),i0=n.n(i$),i1=n(65454),i2=n(13118),i5=n(83446);let i3=(0,_.ZP)(i5.Z)(e=>{let{width:t}=e;return"\n    width: ".concat(t,"px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    /* Beginning of string */\n    direction: rtl;\n    text-align: left;\n")}),i4=e=>{let{width:t,path:n}=e,i=async()=>{try{await (0,eE.M)().openDirectory(n)}catch(e){Z.ZP.error("openDirectory failed",e)}};return(0,d.tZ)(i3,{width:t,onClick:i,children:(0,d.tZ)(tD.Z,{title:n,children:(0,d.tZ)("span",{children:n})})})};var i8=n(77777),i9=n(39327);function i6(){let e=(0,y._)(["\n    position: relative;\n    top: 5px;\n    display: inline-block;\n    max-width: 394px;\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n"]);return i6=function(){return e},e}let i7=(0,_.ZP)("div")(i6());var oe=e=>(0,d.tZ)(e4.Z,{open:e.isOpen,onClose:e.onClose,fullWidth:!0,PaperProps:{sx:{maxWidth:"444px"}},attributes:{title:(0,v.t)("PENDING_ITEMS"),close:{action:e.onClose,text:(0,v.t)("close")}},children:(0,d.tZ)(i9.Z,{maxHeight:240,itemSize:50,items:e.pendingExports,renderListItem:t=>(0,d.BX)(f.A0,{children:[(0,d.tZ)(q.Z,{sx:{marginRight:"8px"},children:(0,d.tZ)(N,{TileComponent:M,coverFile:t},t.id)}),(0,d.tZ)(i7,{children:"".concat(e.collectionNameMap.get(t.collectionID)," / ").concat(t.metadata.title)})]}),getItemTitle:t=>"".concat(e.collectionNameMap.get(t.collectionID)," / ").concat(t.metadata.title),generateItemKey:e=>"".concat(e.collectionID,"-").concat(e.id)})}),ot=n(46562);function on(e){let[t,n]=(0,A.useState)(!1);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(eT.Z,{children:(0,d.BX)(et.Z,{pr:2,children:[(0,d.BX)(f.Gm,{minHeight:"48px",children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("PENDING_ITEMS")}),e.pendingExports.length?(0,d.tZ)(ot.Z,{onClick:()=>{n(!0)},children:(0,i8.u)(e.pendingExports.length)}):(0,d.tZ)(m.Z,{children:(0,i8.u)(e.pendingExports.length)})]}),(0,d.BX)(f.Gm,{minHeight:"48px",children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("LAST_EXPORT_TIME")}),(0,d.tZ)(m.Z,{children:e.lastExportTime?(0,n8.o0)(e.lastExportTime):(0,v.t)("NEVER")})]})]})}),(0,d.BX)(eD.Z,{children:[(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:e.onHide,children:(0,v.t)("close")}),(0,d.tZ)(e5.Z,{size:"large",color:"primary",onClick:e.onResync,children:(0,v.t)("EXPORT_AGAIN")})]}),(0,d.tZ)(oe,{pendingExports:e.pendingExports,collectionNameMap:e.collectionNameMap,isOpen:t,onClose:()=>{n(!1)}})]})}var oi=n(64433);function oo(){let e=(0,y._)(["\n    padding: 0 0.5rem;\n    word-spacing: 1rem;\n    color: #ddd;\n"]);return oo=function(){return e},e}let ol=(0,_.ZP)("span")(oo());function or(e){return(0,d.BX)(d.HY,{children:[(0,d.tZ)(eT.Z,{children:(0,d.BX)(f.wx,{children:[(0,d.tZ)(q.Z,{mb:1.5,children:e.exportStage===i1.OQ.STARTING?(0,v.t)("EXPORT_STARTING"):e.exportStage===i1.OQ.MIGRATION?(0,v.t)("MIGRATING_EXPORT"):e.exportStage===i1.OQ.RENAMING_COLLECTION_FOLDERS?(0,v.t)("RENAMING_COLLECTION_FOLDERS"):e.exportStage===i1.OQ.TRASHING_DELETED_FILES?(0,v.t)("TRASHING_DELETED_FILES"):e.exportStage===i1.OQ.TRASHING_DELETED_COLLECTIONS?(0,v.t)("TRASHING_DELETED_COLLECTIONS"):(0,d.tZ)(nW.cC,{i18nKey:"EXPORT_PROGRESS",components:{a:(0,d.tZ)(ol,{})},values:{progress:e.exportProgress}})}),(0,d.tZ)(f.A0,{px:1,children:e.exportStage===i1.OQ.STARTING||e.exportStage===i1.OQ.MIGRATION||e.exportStage===i1.OQ.RENAMING_COLLECTION_FOLDERS||e.exportStage===i1.OQ.TRASHING_DELETED_FILES||e.exportStage===i1.OQ.TRASHING_DELETED_COLLECTIONS?(0,d.tZ)(oi.Z,{}):(0,d.tZ)(oi.Z,{variant:"determinate",value:Math.round((e.exportProgress.success+e.exportProgress.failed)*100/e.exportProgress.total)})})]})}),(0,d.BX)(eD.Z,{children:[(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:e.closeExportDialog,children:(0,v.t)("close")}),(0,d.tZ)(e5.Z,{size:"large",color:"critical",onClick:e.stopExport,children:(0,v.t)("STOP_EXPORT")})]})]})}function oa(e){let{startExport:t}=e;return(0,d.tZ)(eT.Z,{children:(0,d.tZ)(eD.Z,{children:(0,d.tZ)(e5.Z,{size:"large",color:"accent",onClick:t,children:(0,v.t)("START")})})})}function oc(e){let t=(0,A.useContext)(e9.AppContext),[n,i]=(0,A.useState)(i1.OQ.INIT),[o,l]=(0,A.useState)(""),[r,a]=(0,A.useState)(!1),[c,s]=(0,A.useState)({success:0,failed:0,total:0}),[u,p]=(0,A.useState)([]),[h,g]=(0,A.useState)(0);(0,A.useEffect)(()=>{if(i0()())try{var e,t;i1.ZP.setUIUpdaters({setExportStage:i,setExportProgress:s,setLastExportTime:g,setPendingExports:p});let n=i1.ZP.getExportSettings();l(null!==(e=null==n?void 0:n.folder)&&void 0!==e?e:null),a(null!==(t=null==n?void 0:n.continuousExport)&&void 0!==t&&t),m(null==n?void 0:n.folder)}catch(e){Z.ZP.error("export on mount useEffect failed",e)}},[]),(0,A.useEffect)(()=>{e.show&&m(o)},[e.show]);let f=async()=>!!await i1.ZP.exportFolderExists(o)||(t.setDialogMessage((0,i2.j8)()),!1),m=async e=>{try{if(!await i1.ZP.exportFolderExists(e)){let e=await i1.ZP.getPendingExports(null);p(e)}let t=await i1.ZP.getExportRecord(e);i(t.stage),g(t.lastAttemptTimestamp);let n=await i1.ZP.getPendingExports(t);p(n)}catch(e){e.message!==eV.sH.EXPORT_FOLDER_DOES_NOT_EXIST&&Z.ZP.error("syncExportRecord failed",e)}},C=async()=>{let e=await (0,i1.M9)();e&&(Z.ZP.info("Export folder changed to ".concat(e)),i1.ZP.updateExportSettings({folder:e}),l(e),await m(e))},x=async()=>{if(!await f())return;let e=!r;e?i1.ZP.enableContinuousExport():i1.ZP.disableContinuousExport(),i1.ZP.updateExportSettings({continuousExport:e}),a(e)},w=async e=>{await f()&&await i1.ZP.scheduleExport(null!=e?e:{})};return(0,d.BX)(e_.Z,{open:e.show,onClose:e.onHide,maxWidth:"xs",fullWidth:!0,children:[(0,d.tZ)(tn.Z,{onClose:e.onHide,children:(0,v.t)("EXPORT_DATA")}),(0,d.BX)(eT.Z,{children:[(0,d.tZ)(os,{exportFolder:o,changeExportDirectory:C,exportStage:n}),(0,d.tZ)(od,{continuousExport:r,toggleContinuousExport:x})]}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(ou,{exportStage:n,startExport:w,stopExport:()=>{i1.ZP.stopRunningExport()},onHide:e.onHide,lastExportTime:h,exportProgress:c,pendingExports:u,collectionNameMap:e.collectionNameMap})]})}function os(e){let{exportFolder:t,changeExportDirectory:n,exportStage:i}=e;return(0,d.BX)(f.Gm,{minHeight:"48px",children:[(0,d.tZ)(m.Z,{color:"text.muted",mr:"16px",children:(0,v.t)("DESTINATION")}),(0,d.tZ)(d.HY,{children:t?(0,d.BX)(f.zr,{children:[(0,d.tZ)(i4,{width:262,path:t}),i===i1.OQ.FINISHED||i===i1.OQ.INIT?(0,d.tZ)(iq.Z,{onClick:n}):(0,d.tZ)(q.Z,{sx:{width:"16px"}})]}):(0,d.tZ)(e5.Z,{color:"accent",onClick:n,children:(0,v.t)("select_folder")})})]})}function od(e){let{continuousExport:t,toggleContinuousExport:n}=e;return(0,d.BX)(f.Gm,{minHeight:"48px",children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("CONTINUOUS_EXPORT")}),(0,d.tZ)(q.Z,{children:(0,d.tZ)(iJ.Z,{color:"accent",checked:t,onChange:n})})]})}let ou=e=>{let{exportStage:t,startExport:n,stopExport:i,onHide:o,lastExportTime:l,exportProgress:r,pendingExports:a,collectionNameMap:c}=e;switch(t){case i1.OQ.INIT:return(0,d.tZ)(oa,{startExport:n});case i1.OQ.MIGRATION:case i1.OQ.STARTING:case i1.OQ.EXPORTING_FILES:case i1.OQ.RENAMING_COLLECTION_FOLDERS:case i1.OQ.TRASHING_DELETED_FILES:case i1.OQ.TRASHING_DELETED_COLLECTIONS:return(0,d.tZ)(or,{exportStage:t,exportProgress:r,stopExport:i,closeExportDialog:o});case i1.OQ.FINISHED:return(0,d.tZ)(on,{onHide:o,lastExportTime:l,pendingExports:a,collectionNameMap:c,onResync:()=>n({resync:!0})});default:return(0,d.tZ)(d.HY,{})}};var op=n(52721),oh=n(98925),oZ=n(27677),og=n(34302),of=n(34189),om=n(20145),ov=n(29637),oA=n(71523),oC=n(62434),ox=e=>{let{isOpen:t,hide:n,attributes:i}=e,[o,l]=(0,A.useState)(),[r,a]=(0,A.useState)({current:0,total:0}),c=(0,A.useContext)(aD);(0,A.useEffect)(()=>{i&&t&&"running"!==o&&l(void 0)},[t]);let s=async e=>{l("running"),l(await oI(i.files,e.option,e.customDate,a)?"completed-with-errors":"completed"),await c.syncWithRemote()},u="running"==o?(0,v.t)("FIX_CREATION_TIME_IN_PROGRESS"):(0,v.t)("FIX_CREATION_TIME"),p=ow(o);return i?(0,d.tZ)(og.Z,{open:t,onClose:n,attributes:{title:u,nonClosable:!0},children:(0,d.BX)("div",{style:{marginBottom:"10px",display:"flex",flexDirection:"column",..."running"==o?{alignItems:"center"}:{}},children:[p&&(0,d.tZ)("div",{children:p}),"running"===o&&(0,d.tZ)(oy,{progressTracker:r}),(0,d.tZ)(ob,{step:o,onSubmit:s,hide:n})]})}):(0,d.tZ)(d.HY,{})};let ow=e=>{switch(e){case void 0:case"running":return;case"completed":return(0,v.t)("UPDATE_CREATION_TIME_COMPLETED");case"completed-with-errors":return(0,v.t)("UPDATE_CREATION_TIME_COMPLETED_WITH_ERROR")}},oy=e=>{let{progressTracker:t}=e,n=Math.round(100*t.current/t.total);return(0,d.BX)(d.HY,{children:[(0,d.BX)("div",{style:{marginBottom:"10px"},children:[(0,d.BX)(ol,{children:[" ",t.current," / ",t.total," "]})," ",(0,d.BX)("span",{style:{marginLeft:"10px"},children:[" ",(0,v.t)("CREATION_TIME_UPDATED")]})]}),(0,d.tZ)("div",{style:{width:"100%",marginTop:"10px",marginBottom:"20px"},children:(0,d.tZ)(oi.Z,{variant:"determinate",value:n})})]})},ob=e=>{let{step:t,onSubmit:n,hide:i}=e,{values:o,handleChange:l,setValues:r,handleSubmit:a}=(0,nN.TA)({initialValues:{option:"date-time-original",customDate:void 0},validateOnBlur:!1,onSubmit:n});return(0,d.BX)(d.HY,{children:[(void 0===t||"completed-with-errors"===t)&&(0,d.tZ)("div",{style:{marginTop:"10px"},children:(0,d.BX)("form",{onSubmit:a,children:[(0,d.tZ)(of.Z,{children:(0,d.tZ)(om.Z,{children:(0,v.t)("UPDATE_CREATION_TIME_NOT_STARTED")})}),(0,d.BX)(ov.Z,{name:"option",value:o.option,onChange:l,children:[(0,d.tZ)(oA.Z,{value:"date-time-original",control:(0,d.tZ)(oC.Z,{size:"small"}),label:(0,v.t)("DATE_TIME_ORIGINAL")}),(0,d.tZ)(oA.Z,{value:"date-time-digitized",control:(0,d.tZ)(oC.Z,{size:"small"}),label:(0,v.t)("DATE_TIME_DIGITIZED")}),(0,d.tZ)(oA.Z,{value:"metadata-date",control:(0,d.tZ)(oC.Z,{size:"small"}),label:(0,v.t)("METADATA_DATE")}),(0,d.tZ)(oA.Z,{value:"custom",control:(0,d.tZ)(oC.Z,{size:"small"}),label:(0,v.t)("CUSTOM_TIME")})]}),"custom"==o.option&&(0,d.tZ)(oh.Y,{onAccept:e=>r({option:"custom",customDate:e})})]})}),(0,d.tZ)(oE,{step:t,startFix:a,hide:i})]})},oE=e=>{let{step:t,startFix:n,...i}=e;return"running"!=t&&(0,d.BX)("div",{style:{width:"100%",display:"flex",marginTop:"30px",justifyContent:"space-around"},children:[(!t||"completed-with-errors"==t)&&(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:()=>{i.hide()},children:(0,v.t)("cancel")}),"completed"==t&&(0,d.tZ)(e5.Z,{color:"primary",size:"large",onClick:i.hide,children:(0,v.t)("close")}),(!t||"completed-with-errors"==t)&&(0,d.BX)(d.HY,{children:[(0,d.tZ)("div",{style:{width:"30px"}}),(0,d.tZ)(e5.Z,{color:"accent",size:"large",onClick:n,children:(0,v.t)("FIX_CREATION_TIME")})]})]})},oI=async(e,t,n,i)=>{i({current:0,total:e.length});let o=!1;for(let[l,r]of e.entries())try{await o_(r,t,n)}catch(e){Z.ZP.error("Failed to update date of ".concat((0,eK.wM)(r)),e),o=!0}finally{i({current:l+1,total:e.length})}return o},o_=async(e,t,n)=>{let i;if("custom"==t)i={dateTime:(0,eW.zx)(n).dateTime,offset:void 0,timestamp:(0,eW.zx)(n).timestamp};else if(e.metadata.fileType==op.Tv.image){let n=await I.Z.getFile(e),o=new File([await new Response(n).blob()],e.metadata.title),{DateTimeOriginal:l,DateTimeDigitized:r,MetadataDate:a,DateTime:c}=await (0,oZ.EK)(o);switch(t){case"date-time-original":i=null!=l?l:c;break;case"date-time-digitized":i=r;break;case"metadata-date":i=a}}if(!i)return;let o=(0,ix.nM)(e,await (0,ix.kw)(e));i.timestamp!=o.getTime()&&await (0,ix.xS)(e,{dateTime:i.dateTime,offsetTime:i.offset,editedTime:i.timestamp})};var oS=n(13058),oT=n(36659),oP=n(15833),oD=n(28936),oR=n(33967);function oL(){let e=(0,y._)(["\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    text-align: center;\n"]);return oL=function(){return e},e}function ok(){let e=(0,y._)(["\n    pointer-events: none;\n"]);return ok=function(){return e},e}let oO=(0,_.ZP)(q.Z)(oL()),oN=(0,_.ZP)("img")(ok());function oB(e){let{openUploader:t}=e;return(0,d.BX)(oO,{children:[(0,d.BX)(et.Z,{sx:{flex:"none",pt:1.5,pb:1.5},children:[(0,d.BX)(f.wx,{sx:{flex:"none"},children:[(0,d.tZ)(m.Z,{variant:"h3",color:"text.muted",mb:1,children:(0,d.tZ)(nW.cC,{i18nKey:"WELCOME_TO_ENTE_HEADING",components:{a:(0,d.tZ)(oT.W,{})}})}),(0,d.tZ)(m.Z,{variant:"h2",children:(0,v.t)("WELCOME_TO_ENTE_SUBHEADING")})]}),(0,d.tZ)(m.Z,{mt:3.5,color:"text.muted",children:(0,v.t)("WHERE_YOUR_BEST_PHOTOS_LIVE")})]}),(0,d.tZ)(oN,{height:287.57,src:"/images/empty-state/ente_duck.png",srcSet:"/images/empty-state/ente_duck@2x.png, /images/empty-state/ente_duck@3x.png"}),(0,d.BX)(f.wx,{paddingTop:1.5,paddingBottom:1.5,children:[(0,d.tZ)(e5.Z,{style:{cursor:!oR.Z.shouldAllowNewUpload()&&"not-allowed"},color:"accent",onClick:()=>t("upload"),disabled:!oR.Z.shouldAllowNewUpload(),sx:{mt:1.5,p:1,width:320,borderRadius:.5},children:(0,d.BX)(f.A0,{sx:{gap:1},justifyContent:"center",children:[(0,d.tZ)(oP.Z,{}),(0,v.t)("UPLOAD_FIRST_PHOTO")]})}),(0,d.tZ)(e5.Z,{style:{cursor:!oR.Z.shouldAllowNewUpload()&&"not-allowed"},onClick:()=>t("import"),disabled:!oR.Z.shouldAllowNewUpload(),sx:{mt:1.5,p:1,width:320,borderRadius:.5},children:(0,d.BX)(f.A0,{sx:{gap:1},justifyContent:"center",children:[(0,d.tZ)(oD.Z,{}),(0,v.t)("IMPORT_YOUR_FOLDERS")]})})]})]})}var oM=n(33446),oU=n(14563),oF=n(16645),oH=n(60373),oX=n(42869),oK=n(82729),oW=n(80458),oz=n(95525),oG=n(31531),oY=n(84907),oV=n(19694),oj=n(42405);function oQ(e){let{themeColor:t,setThemeColor:n}=e;return(0,d.BX)(oV.Z,{size:"small",value:t,exclusive:!0,onChange:(e,t)=>{null!==t&&n(t)},children:[(0,d.tZ)(oj.Z,{value:oz.l.LIGHT,children:(0,d.tZ)(oY.Z,{})}),(0,d.tZ)(oj.Z,{value:oz.l.DARK,children:(0,d.tZ)(oG.Z,{})})]})}var oJ=n(31204),oq=n(24570),o$=n(73230),o0=n(63404),o1=n(86743),o2=n(16331),o5=n(46854),o3=n(30394),o4=n(24819),o8=n(1799);async function o9(e){let t=await (0,n6.Lb)(),n=await (0,o8.G)(),i=(0,eJ.Yu)(eJ.Pd.KEY_ATTRIBUTES),o=await t.decryptB64(i.encryptedSecretKey,i.secretKeyDecryptionNonce,n);return atob(await t.boxSealOpen(e,i.publicKey,o))}var o6=n(70341),o7=n(56840);function le(e){let{disabled:t,checked:n,onChange:i,label:o,labelProps:l}=e;return(0,d.tZ)(o6.Z,{sx:{width:"100%"},children:(0,d.tZ)(oA.Z,{control:(0,d.tZ)(o7.Z,{size:"small",disabled:t,checked:n,onChange:e=>i(e.target.checked),color:"accent"}),label:(0,d.tZ)(m.Z,{color:"text.secondary",...l,children:o})})})}var lt=n(49243),ln=n(71951);function li(e){let{label:t,labelProps:n,options:i,message:o,selected:l,placeholder:r,setSelected:a,messageProps:c}=e;return(0,d.BX)(et.Z,{spacing:"4px",children:[(0,d.tZ)(m.Z,{...n,children:t}),(0,d.tZ)(lt.Z,{IconComponent:tE.Z,displayEmpty:!0,variant:"standard",MenuProps:{PaperProps:{sx:{maxWidth:0}},MenuListProps:{sx:e=>({backgroundColor:e.colors.background.elevated2,".MuiMenuItem-root ":{color:e.colors.text.faint,whiteSpace:"normal"},"&&& > .Mui-selected":{background:e.colors.background.elevated2,color:e.colors.text.base}})}},sx:e=>({"::before , ::after":{borderBottom:"none !important"},".MuiInput-root":{background:e.colors.fill.faint,borderRadius:"8px"},".MuiSelect-select":{background:e.colors.fill.faint,borderRadius:"8px"},"&&& .MuiSelect-select":{p:"12px 36px 12px 16px"},".MuiSelect-icon":{mr:"12px",color:e.colors.stroke.muted}}),renderValue:e=>(null==e?void 0:e.length)?i.find(t=>t.value===e).label:(0,d.tZ)(q.Z,{color:"text.muted",children:null!=r?r:""}),value:l,onChange:e=>{a(e.target.value)},children:i.map((e,t)=>(0,d.tZ)(ln.Z,{divider:t!==i.length-1,value:e.value,sx:{px:"16px",py:"14px",color:e=>e.palette.primary.main},children:e.label},e.value))}),o&&(0,d.tZ)(m.Z,{variant:"small",px:"8px",color:"text.muted",...c,children:o})]})}function lo(e){let{label:t,labelProps:n,message:i,messageProps:o,placeholder:l,value:r,rowCount:a,onChange:c}=e;return(0,d.BX)(et.Z,{spacing:"4px",children:[(0,d.tZ)(m.Z,{...n,children:t}),(0,d.tZ)(nO.Z,{variant:"standard",multiline:!0,rows:a,value:r,onChange:e=>c(e.target.value),placeholder:l,sx:e=>({border:"1px solid",borderColor:e.colors.stroke.faint,borderRadius:"8px",padding:"12px",".MuiInputBase-formControl":{"::before, ::after":{borderBottom:"none !important"}}})}),(0,d.tZ)(m.Z,{px:"8px",variant:"small",color:"text.secondary",...o,children:i})]})}var ll=e=>{let{open:t,onClose:n}=e,{setDialogBoxAttributesV2:i,logout:o}=(0,A.useContext)(e9.AppContext),{authenticateUser:l}=(0,A.useContext)(aD),[r,a]=(0,A.useState)(!1),c=(0,A.useRef)(),[s,u]=(0,A.useState)(!1),p=(0,A.useRef)(),h=(0,ti.Z)("(max-width: 428px)"),g=()=>i({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")}),f=async(e,t)=>{let{reason:n,feedback:i}=e,{setFieldError:o}=t;try{if(i=i.trim(),0===i.length){o("feedback","found_another_service"===n?(0,v.t)("feedback_required_found_another_service"):(0,v.t)("feedback_required"));return}a(!0),p.current={reason:n,feedback:i};let e=await (0,o4.JU)();c.current=e.encryptedChallenge,e.allowDelete?l(m):C()}catch(e){Z.ZP.error("Error while initiating account deletion",e),g()}finally{a(!1)}},m=()=>{i({title:(0,v.t)("delete_account"),content:(0,d.tZ)(nW.cC,{i18nKey:"delete_account_confirm_message"}),proceed:{text:(0,v.t)("DELETE"),action:x,variant:"critical"},close:{text:(0,v.t)("cancel")}})},C=()=>{let e="account-deletion@ente.io";i({title:(0,v.t)("delete_account"),content:(0,d.tZ)(nW.cC,{i18nKey:"delete_account_manually_message",components:{a:(0,d.tZ)(iv.Z,{href:"mailto:".concat(e)})},values:{emailID:e}}),proceed:{text:(0,v.t)("DELETE"),action:()=>(0,oK.e)(e),variant:"critical"},close:{text:(0,v.t)("cancel")}})},x=async e=>{try{e(!0);let t=await o9(c.current),{reason:n,feedback:i}=p.current;await (0,o4.tm)(t,n,i),o()}catch(e){Z.ZP.error("solveChallengeAndDeleteAccount failed",e),g()}finally{e(!1)}};return(0,d.tZ)(d.HY,{children:(0,d.tZ)(e4.Z,{fullWidth:!0,open:t,onClose:n,fullScreen:h,attributes:{title:(0,v.t)("delete_account"),secondary:{action:n,text:(0,v.t)("cancel")}},children:(0,d.tZ)(nN.J9,{initialValues:{reason:"",feedback:""},validationSchema:nB.Ry().shape({reason:nB.Z_().required((0,v.t)("REQUIRED"))}),validateOnChange:!1,validateOnBlur:!1,onSubmit:f,children:e=>{let{values:t,errors:i,handleChange:o,handleSubmit:l}=e;return(0,d.tZ)("form",{noValidate:!0,onSubmit:l,children:(0,d.BX)(et.Z,{spacing:"24px",children:[(0,d.tZ)(li,{options:la(),label:(0,v.t)("delete_account_reason_label"),placeholder:(0,v.t)("delete_account_reason_placeholder"),selected:t.reason,setSelected:o("reason"),messageProps:{color:"critical.main"},message:i.reason}),(0,d.tZ)(lo,{label:(0,v.t)("delete_account_feedback_label"),placeholder:(0,v.t)("delete_account_feedback_placeholder"),value:t.feedback,onChange:o("feedback"),message:i.feedback,messageProps:{color:"critical.main"},rowCount:3}),(0,d.tZ)(le,{checked:s,onChange:u,label:(0,v.t)("delete_account_confirm_checkbox_label")}),(0,d.BX)(et.Z,{spacing:"8px",children:[(0,d.tZ)(o3.Z,{type:"submit",size:"large",color:"critical",disabled:!s,loading:r,children:(0,v.t)("delete_account_confirm")}),(0,d.tZ)(e5.Z,{size:"large",color:"secondary",onClick:n,children:(0,v.t)("cancel")})]})]})})}})})})};let lr=["missing_feature","behaviour","found_another_service","not_listed"],la=()=>lr.map(e=>({label:(0,v.t)("delete_reason.".concat(e)),value:e}));var lc=n(30433),ls=n(69141),ld=n(5632),lu=n.n(ld);function lp(e){let{closeDialog:t}=e,{setDialogMessage:n}=(0,A.useContext)(e9.AppContext),i=async()=>{n({title:(0,v.t)("DISABLE_TWO_FACTOR"),content:(0,v.t)("DISABLE_TWO_FACTOR_MESSAGE"),close:{text:(0,v.t)("cancel")},proceed:{variant:"critical",text:(0,v.t)("disable"),action:o}})},o=async()=>{try{await (0,lc.XB)(),await (0,eJ.CA)({...(0,eJ.Yu)(eJ.Pd.USER),isTwoFactorEnabled:!1}),t()}catch(e){n({title:(0,v.t)("TWO_FACTOR_DISABLE_FAILED"),close:{}})}},l=async()=>{n({title:(0,v.t)("UPDATE_TWO_FACTOR"),content:(0,v.t)("UPDATE_TWO_FACTOR_MESSAGE"),close:{text:(0,v.t)("cancel")},proceed:{variant:"accent",text:(0,v.t)("UPDATE"),action:r}})},r=async()=>{t(),lu().push(eG.W.TWO_FACTOR_SETUP)};return(0,d.BX)(d.HY,{children:[(0,d.BX)(ls.ZP,{mb:1.5,rowSpacing:1,container:!0,alignItems:"center",justifyContent:"center",children:[(0,d.tZ)(ls.ZP,{item:!0,sm:9,xs:12,children:(0,v.t)("UPDATE_TWO_FACTOR_LABEL")}),(0,d.tZ)(ls.ZP,{item:!0,sm:3,xs:12,children:(0,d.tZ)(e5.Z,{color:"accent",onClick:l,size:"large",children:(0,v.t)("reconfigure")})})]}),(0,d.BX)(ls.ZP,{rowSpacing:1,container:!0,alignItems:"center",justifyContent:"center",children:[(0,d.BX)(ls.ZP,{item:!0,sm:9,xs:12,children:[(0,v.t)("DISABLE_TWO_FACTOR_LABEL")," "]}),(0,d.tZ)(ls.ZP,{item:!0,sm:3,xs:12,children:(0,d.tZ)(e5.Z,{color:"critical",onClick:i,size:"large",children:(0,v.t)("disable")})})]})]})}var lh=n(88215);function lZ(e){let{closeDialog:t}=e,n=(0,ld.useRouter)();return(0,d.BX)(f.wx,{sx:{mb:2},children:[(0,d.tZ)(lh.Z,{sx:{fontSize:e=>e.spacing(5),mb:2}}),(0,d.tZ)(m.Z,{mb:4,children:(0,v.t)("TWO_FACTOR_INFO")}),(0,d.tZ)(e5.Z,{variant:"contained",color:"accent",size:"large",onClick:()=>{t(),n.push(eG.W.TWO_FACTOR_SETUP)},children:(0,v.t)("ENABLE_TWO_FACTOR")})]})}let lg=(0,_.ZP)(e_.Z)(e=>{let{theme:t}=e;return{"& .MuiDialogContent-root":{padding:t.spacing(2,4)}}});var lf=function(e){let[t,n]=(0,A.useState)(!1);(0,A.useEffect)(()=>{var e;n(null!==(e=(0,eJ.Yu)(eJ.Pd.USER).isTwoFactorEnabled)&&void 0!==e&&e)},[]),(0,A.useEffect)(()=>{e.show&&(async()=>{let e=await (0,o4.bW)();n(e),await (0,eJ.CA)({...(0,eJ.Yu)(eJ.Pd.USER),isTwoFactorEnabled:e})})()},[e.show]);let i=()=>{e.onHide(),e.closeSidebar()};return(0,d.BX)(lg,{maxWidth:"xs",open:e.show,onClose:e.onHide,children:[(0,d.tZ)(tn.Z,{onClose:e.onHide,children:(0,v.t)("TWO_FACTOR_AUTHENTICATION")}),(0,d.tZ)(eT.Z,{sx:{px:4},children:t?(0,d.tZ)(lp,{closeDialog:i}):(0,d.tZ)(lZ,{closeDialog:i})})]})},lm=n(34349),lv=n(61917),lA=n(5873),lC=n(21532),lx=n(30333),lw=n(7706),ly=n(21240),lb=n(16003);function lE(){let e=(0,y._)(["\n    padding: 16px 12px 16px 16px;\n"]);return lE=function(){return e},e}let lI=e=>{let{open:t,onClose:n}=e,[i,o]=(0,A.useState)(),[l,r]=(0,A.useState)(),[a,c]=(0,A.useState)(!1),s=(0,A.useContext)(e9.AppContext);(0,A.useEffect)(()=>{lb.Z.getWatches().then(e=>o(e))},[]),(0,A.useEffect)(()=>{s.watchFolderFiles&&s.watchFolderFiles.length>0&&(u(s.watchFolderFiles),s.setWatchFolderFiles(null))},[s.watchFolderFiles]);let u=async e=>{for(let t=0;t<e.length;t++){let n=e[t].path.replace(/\\/g,"/");await (0,eE.M)().fs.isDir(n)&&await p(n)}},p=async e=>{lM(await (0,eE.M)().fs.findFiles(e))?h(e,"root"):(r(e),c(!0))},h=(e,t)=>lb.Z.addWatch(e,t).then(e=>o(e)),Z=async()=>{let e=await (0,eE.M)().selectDirectory();e&&await p(e)},g=async e=>lb.Z.removeWatch(e.folderPath).then(e=>o(e)),f=()=>c(!1);return(0,d.BX)(d.HY,{children:[(0,d.BX)(e_.Z,{open:t,onClose:n,fullWidth:!0,PaperProps:{sx:{height:"448px",maxWidth:"414px"}},children:[(0,d.tZ)(l_,{children:(0,d.tZ)(tn.Z,{onClose:n,children:(0,v.t)("WATCHED_FOLDERS")})}),(0,d.tZ)(eT.Z,{sx:{flex:1},children:(0,d.BX)(et.Z,{spacing:1,p:1.5,height:"100%",children:[(0,d.tZ)(lS,{watches:i,removeWatch:g}),(0,d.BX)(e5.Z,{fullWidth:!0,color:"accent",onClick:Z,children:[(0,d.tZ)("span",{children:"+"}),(0,d.tZ)("span",{style:{marginLeft:"8px"}}),(0,v.t)("ADD_FOLDER")]})]})})]}),(0,d.tZ)(ly.C,{open:a,onClose:f,didSelect:e=>{f(),r(void 0),h((0,eW.zx)(l),e)}})]})},l_=(0,_.ZP)("div")(lE()),lS=e=>{let{watches:t,removeWatch:n}=e;return 0===(null!=t?t:[]).length?(0,d.tZ)(lP,{}):(0,d.tZ)(lT,{children:t.map(e=>(0,d.tZ)(lL,{watch:e,removeWatch:n},e.folderPath))})},lT=(0,_.ZP)(q.Z)(()=>({height:"278px",overflow:"auto","&::-webkit-scrollbar":{width:"4px"}})),lP=()=>(0,d.tZ)(lD,{children:(0,d.BX)(et.Z,{spacing:1,children:[(0,d.tZ)(m.Z,{variant:"large",fontWeight:"bold",children:(0,v.t)("NO_FOLDERS_ADDED")}),(0,d.tZ)(m.Z,{py:.5,variant:"small",color:"text.muted",children:(0,v.t)("FOLDERS_AUTOMATICALLY_MONITORED")}),(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,d.BX)(f.A0,{gap:1,children:[(0,d.tZ)(lR,{}),(0,v.t)("UPLOAD_NEW_FILES_TO_ENTE")]})}),(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,d.BX)(f.A0,{gap:1,children:[(0,d.tZ)(lR,{}),(0,v.t)("REMOVE_DELETED_FILES_FROM_ENTE")]})})]})}),lD=(0,_.ZP)(f.wx)({textAlign:"left",alignItems:"flex-start",marginBottom:"32px"}),lR=()=>(0,d.tZ)(nq.Z,{fontSize:"small",sx:{display:"inline",fontSize:"15px",color:e=>e.palette.secondary.main}}),lL=e=>{let{watch:t,removeWatch:n}=e,i=A.useContext(e9.AppContext);return(0,d.BX)(f.Gm,{children:[(0,d.BX)(f.cD,{sx:{overflow:"hidden"},children:["root"===t.collectionMapping?(0,d.tZ)(tD.Z,{title:(0,v.t)("UPLOADED_TO_SINGLE_COLLECTION"),children:(0,d.tZ)(lx.Z,{})}):(0,d.tZ)(tD.Z,{title:(0,v.t)("UPLOADED_TO_SEPARATE_COLLECTIONS"),children:(0,d.tZ)(lC.Z,{})}),(0,d.BX)(lk,{children:[(0,d.tZ)(lO,{watch:t}),(0,d.tZ)(lN,{children:t.folderPath})]})]}),(0,d.tZ)(lB,{confirmStopWatching:()=>{i.setDialogMessage({title:(0,v.t)("STOP_WATCHING_FOLDER"),content:(0,v.t)("STOP_WATCHING_DIALOG_MESSAGE"),close:{text:(0,v.t)("cancel"),variant:"secondary"},proceed:{action:()=>n(t),text:(0,v.t)("YES_STOP"),variant:"critical"}})}})]})},lk=(0,_.ZP)(q.Z)({overflow:"hidden",marginLeft:"12px",marginRight:"6px",marginBottom:"12px"}),lO=e=>{let{watch:t}=e,n=t.folderPath;return(0,d.BX)(f.A0,{gap:1,children:[(0,d.tZ)(m.Z,{children:(0,lv.EZ)(n)}),lb.Z.isSyncingFolder(n)&&(0,d.tZ)(lw.Z,{size:12})]})},lN=e=>{let{children:t}=e;return(0,d.tZ)(lm.L,{variant:"small",color:"text.muted",children:t})},lB=e=>{let{confirmStopWatching:t}=e;return(0,d.tZ)(tg.Z,{menuPaperProps:{sx:{backgroundColor:e=>e.colors.background.elevated2}},ariaControls:"watch-mapping-option",triggerButtonIcon:(0,d.tZ)(no.Z,{}),children:(0,d.tZ)(tf.x,{color:"critical",onClick:t,startIcon:(0,d.tZ)(lA.Z,{}),children:(0,v.t)("STOP_WATCHING")})})},lM=e=>1==new Set(e.map(lv.XX)).size;var lU=n(77836),lF=n(84934);let lH="free";(o=a||(a={})).AUTHENTICATION_FAILED="authentication_failed",o.REQUIRE_PAYMENT_METHOD="requires_payment_method",o.STRIPE_ERROR="stripe_error",o.CANCELED="canceled",o.SERVER_ERROR="server_error",(l=c||(c={})).success="success",l.fail="fail";let lX=e=>!e||"free"==e.productID||e.expiryTime<1e3*Date.now()?"buyPlan":"stripe"==e.paymentProvider?"updateSubscriptionToPlan":"appstore"==e.paymentProvider||"playstore"==e.paymentProvider?"cancelOnMobile":"contactSupport";function lK(e){return e&&lW(e)&&e.productID!==lH}function lW(e){return e&&e.expiryTime>1e3*Date.now()}function lz(e){return e&&lW(e)&&e.productID===lH}function lG(e){return e&&e.storageBonuses&&e.storageBonuses.length>0&&e.storageBonuses.some(e=>e.type.startsWith("ADD_ON"))}function lY(e){return e&&e.attributes.isCancelled}function lV(e,t){return lW(t)&&(e.stripeID===t.productID||e.iosID===t.productID||e.androidID===t.productID)}function lj(e){return e.paymentProvider.length>0&&"stripe"===e.paymentProvider}function lQ(e){var t;let n=null!==(t=e.storageBonus)&&void 0!==t?t:0;return(0,lF.uD)(e.familyData)?(0,lF.mw)(e.familyData)>e.familyData.storage+n:e.usage>e.subscription.storage+n}function lJ(e){let t=1e3*Date.now();return!lY(e)&&e.expiryTime<t&&e.expiryTime>=t-2592e9}let lq=e=>107374182400===e.storage;async function l$(e,t,n,i){try{n(!0),await lU.Z.updateSubscription(e.stripeID)}catch(e){t({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_UPDATE_FAILED"),close:{variant:"critical"}})}finally{n(!1),i()}}async function l0(e,t,n){try{n(!0),await lU.Z.cancelSubscription(),e({title:(0,v.t)("success"),content:(0,v.t)("SUBSCRIPTION_CANCEL_SUCCESS"),close:{variant:"accent"}})}catch(t){e({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_CANCEL_FAILED"),close:{variant:"critical"}})}finally{t(),n(!1)}}async function l1(e,t,n){try{n(!0),await lU.Z.activateSubscription(),e({title:(0,v.t)("success"),content:(0,v.t)("SUBSCRIPTION_ACTIVATE_SUCCESS"),close:{variant:"accent"}})}catch(t){e({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_ACTIVATE_FAILED"),close:{variant:"critical"}})}finally{t(),n(!1)}}async function l2(e,t){try{t(!0),await lU.Z.redirectToCustomerPortal()}catch(n){t(!1),e({title:(0,v.t)("error"),content:(0,v.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})}}async function l5(e,t,n){var i;let{session_id:o,status:l,reason:r}=null!==(i=t.query)&&void 0!==i?i:{};try{if("fail"===l)!function(e,t,n){switch(Z.ZP.error("subscription purchase failed: ".concat(e)),e){case"canceled":t({content:(0,v.t)("SUBSCRIPTION_PURCHASE_CANCELLED"),close:{variant:"critical"}});break;case"requires_payment_method":t({title:(0,v.t)("UPDATE_PAYMENT_METHOD"),content:(0,v.t)("UPDATE_PAYMENT_METHOD_MESSAGE"),proceed:{text:(0,v.t)("UPDATE_PAYMENT_METHOD"),variant:"accent",action:l2.bind(null,t,n)},close:{text:(0,v.t)("cancel")}});break;case"authentication_failed":t({title:(0,v.t)("UPDATE_PAYMENT_METHOD"),content:(0,v.t)("STRIPE_AUTHENTICATION_FAILED"),proceed:{text:(0,v.t)("UPDATE_PAYMENT_METHOD"),variant:"accent",action:l2.bind(null,t,n)},close:{text:(0,v.t)("cancel")}});break;default:t({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_PURCHASE_FAILED"),close:{variant:"critical"}})}}(r,e,n);else if("success"===l)try{let t=await lU.Z.verifySubscription(o);e((0,i2.Ui)(t))}catch(t){e({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_VERIFICATION_ERROR"),close:{}})}}catch(e){}}var l3=n(41198),l4=n(82870),l8=n(22624),l9=n(93542);let l6=[{fileName:"Screenshot_20220807-195908_Firefox",expectedDateTime:"2022-08-07 19:59:08"},{fileName:"Screenshot_20220507-195908",expectedDateTime:"2022-05-07 19:59:08"},{fileName:"2022-02-18 16.00.12-DCMX.png",expectedDateTime:"2022-02-18 16:00:12"},{fileName:"20221107_231730",expectedDateTime:"2022-11-07 23:17:30"},{fileName:"2020-11-01 02.31.02",expectedDateTime:"2020-11-01 02:31:02"},{fileName:"IMG_20210921_144423",expectedDateTime:"2021-09-21 14:44:23"},{fileName:"2019-10-31 155703",expectedDateTime:"2019-10-31 00:00:00",correctExpectedDateTime:"2019-10-31 15:57:03"},{fileName:"IMG_20210921_144423_783",expectedDateTime:"2021-09-21 14:44:23"},{fileName:"Screenshot_2022-06-21-16-51-29-164_newFormat.heic",expectedDateTime:"2022-06-21 16:51:29"},{fileName:"Screenshot 20221106 211633.com.google.android.apps.nbu.paisa.user.jpg",expectedDateTime:"2022-11-06 21:16:33"},{fileName:"signal-2022-12-17-15-16-04-718.jpg",expectedDateTime:"2022-12-17 15:16:04"}],l7=["Snapchat-431959199.mp4.","Snapchat-400000000.mp4","Snapchat-900000000.mp4","Snapchat-100-10-20-19-15-12"],re=[{filename:"IMG20210211125718-edited.jpg",jsonFilename:"IMG20210211125718.jpg.json"},{filename:"IMG20210211174722.jpg",jsonFilename:"IMG20210211174722.jpg.json"},{filename:"21345678901234567890123456789012345678901234567.png",jsonFilename:"2134567890123456789012345678901234567890123456.json"},{filename:"IMG20210211174722(1).jpg",jsonFilename:"IMG20210211174722.jpg(1).json"},{filename:"IMG2021021(4455)74722(1).jpg",jsonFilename:"IMG2021021(4455)74722.jpg(1).json"},{filename:"IMG2021021.json74722(1).jpg",jsonFilename:"IMG2021021.json74722.jpg(1).json"},{filename:"IMG2021021(1)74722(1).jpg",jsonFilename:"IMG2021021(1)74722.jpg(1).json"}];async function rt(){let e=l9.env.NEXT_PUBLIC_ENTE_TEST_EXPECTED_JSON;if(!e)throw Error("Please specify the NEXT_PUBLIC_ENTE_TEST_EXPECTED_JSON to run the upload tests");let t=JSON.parse(e);if(!t)throw Error("upload test failed expectedState missing");try{await ri(t),await ro(t),await rl(t),await rr(t),await ra(t),await rc(t),await rs(t),await rn(t),l6.forEach(e=>{let{fileName:t,expectedDateTime:n}=e,i=function(e){let t=e.getFullYear(),n=rd(e.getMonth()+1),i=rd(e.getDate()),o=rd(e.getHours()),l=rd(e.getMinutes()),r=rd(e.getSeconds());return"".concat(t,"-").concat(n,"-").concat(i," ").concat(o,":").concat(l,":").concat(r)}((0,l3.k)(t));if(i!==n)throw Error("parseDateTimeFromFileNameTest failed ❌ ,\n                    for ".concat(t,"\n                    expected: ").concat(n," got: ").concat(i))}),l7.forEach(e=>{let t=(0,l3.k)(e);if(t)throw Error("parseDateTimeFromFileNameTest failed ❌ ,\n                for ".concat(e,"\n                expected: null got: ").concat(t))}),console.log("parseDateTimeFromFileNameTest passed ✅"),re.forEach(e=>{let{filename:t,jsonFilename:n}=e,i=(0,l4.RJ)(0,n),o=(0,l4.qg)(0,t);if(o!==i&&t.length>l4.Gz&&(o=(0,l4.Ob)(0,t)),o!==i)throw Error("mappingFileAndJSONFileCheck failed ❌ ,\n                    for ".concat(t,"\n                    expected: ").concat(i," got: ").concat(o))}),console.log("mappingFileAndJSONFileCheck passed ✅")}catch(e){console.log(e)}}async function rn(e){let t=await (0,o4.C7)();if(e.total_file_count===t.fileCount)console.log("file count check passed ✅");else throw Error("total file count check failed ❌, expected: ".concat(e.total_file_count,",  got: ").concat(t.fileCount))}async function ri(e){let t=await (0,ta.zr)();if(e.collection_count===t.length)console.log("collection count check passed ✅");else throw Error("total Collection count check failed ❌\n                expected : ".concat(e.collection_count,",  got: ").concat(t.length))}async function ro(e){let t=await (0,eX.dm)(),n=await (0,ta.zr)(),i=(0,l8.qF)(t),o=new Map(n.map(e=>[e.id,e.name])),l=new Map([...i.entries()].map(e=>{let[t,n]=e;return[o.get(t),n.length]}));Object.entries(e.collection_files_count).forEach(e=>{let[t,n]=e;if(n!==l.get(t))throw Error("collectionWiseFileCount check failed ❌\n                        for collection ".concat(t,"\n                        expected File count : ").concat(n," ,  got: ").concat(l.get(t)))}),console.log("collection wise file count check passed ✅")}async function rl(e){let t=(await (0,eX.dm)()).filter(e=>e.metadata.hasStaticThumbnail),n=new Set,i=t.filter(e=>!n.has(e.id)&&(n.add(e.id),!0)),o=i.map(e=>e.metadata.title);if(e.thumbnail_generation_failure.count<i.length)throw Error("thumbnailGenerationFailedFiles Count Check failed ❌\n                expected: ".concat(e.thumbnail_generation_failure.count,",  got: ").concat(i.length));o.forEach(t=>{if(!e.thumbnail_generation_failure.files.includes(t))throw Error("thumbnailGenerationFailedFiles Check failed ❌\n                    expected: ".concat(e.thumbnail_generation_failure.files,",  got: ").concat(o))}),console.log("thumbnail generation failure check passed ✅")}async function rr(e){let t=(await (0,eX.dm)()).filter(e=>e.metadata.fileType===op.Tv.livePhoto),n=new Set,i=t.filter(e=>!n.has(e.id)&&(n.add(e.id),!0)).map(e=>e.metadata.title);if(e.live_photo.count!==i.length)throw Error("livePhotoClubbing Check failed ❌\n                expected: ".concat(e.live_photo.count,",  got: ").concat(i.length));e.live_photo.files.forEach(t=>{if(!i.includes(t))throw Error("livePhotoClubbing Check failed ❌\n                        expected: ".concat(e.live_photo.files,",  got: ").concat(i))}),console.log("live-photo clubbing check passed ✅")}async function ra(e){let t=await (0,eX.dm)();Object.entries(e.exif).map(e=>{let[n,i]=e,o=t.find(e=>e.metadata.title===n);if(!o)throw Error("exifDataParsingCheck failed , ".concat(n," missing"));if(i.creation_time&&i.creation_time!==o.metadata.creationTime)throw Error("exifDataParsingCheck failed ❌ ,\n                            for ".concat(n,"\n                            expected: ").concat(i.creation_time," got: ").concat(o.metadata.creationTime));if(i.location&&(Math.abs(i.location.latitude-o.metadata.latitude)>1||Math.abs(i.location.longitude-o.metadata.longitude)>1))throw Error("exifDataParsingCheck failed ❌  ,\n                            for ".concat(n,"\n                            expected: ").concat(JSON.stringify(i.location),"\n                            got: [").concat(o.metadata.latitude,",").concat(o.metadata.longitude,"]"))}),console.log("exif data parsing check passed ✅")}async function rc(e){let t=await (0,eX.dm)();Object.entries(e.file_dimensions).map(e=>{let[n,i]=e,o=t.find(e=>e.metadata.title===n);if(!o)throw Error("fileDimensionExtractionCheck failed , ".concat(n," missing"));if(i.width&&i.width!==o.pubMagicMetadata.data.w&&i.height&&i.height!==o.pubMagicMetadata.data.h)throw Error("fileDimensionExtractionCheck failed ❌ ,\n                                for ".concat(n,"\n                                expected: ").concat(i.width," x ").concat(i.height," got: ").concat(o.pubMagicMetadata.data.w," x ").concat(o.pubMagicMetadata.data.h))}),console.log("file dimension extraction check passed ✅")}async function rs(e){let t=await (0,eX.dm)();Object.entries(e.google_import).map(e=>{let[n,i]=e,o=t.find(e=>e.metadata.title===n);if(!o)throw Error("exifDataParsingCheck failed , ".concat(n," missing"));if(i.creation_time&&i.creation_time!==o.metadata.creationTime)throw Error("googleMetadataJSON reading check failed ❌ ,\n                for ".concat(n,"\n                expected: ").concat(i.creation_time," got: ").concat(o.metadata.creationTime));if(i.location&&(Math.abs(i.location.latitude-o.metadata.latitude)>1||Math.abs(i.location.longitude-o.metadata.longitude)>1))throw Error("googleMetadataJSON reading check failed ❌  ,\n                                for ".concat(n,"\n                                expected: ").concat(JSON.stringify(i.location),"\n                                got: [").concat(o.metadata.latitude,",").concat(o.metadata.longitude,"]"))}),console.log("googleMetadataJSON reading check passed ✅")}function rd(e){return e<10?"0".concat(e):e}function ru(e){var t;let{open:n,userDetails:i,onClose:o}=e,{setDialogMessage:l}=(0,A.useContext)(e9.AppContext),r=(0,h.I)();async function a(){try{await lU.Z.leaveFamily()}catch(e){l({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")})}}return i?(0,d.BX)(e_.Z,{open:n,onClose:o,fullScreen:r,maxWidth:"xs",fullWidth:!0,children:[(0,d.BX)(tn.Z,{onClose:o,children:[(0,d.tZ)(m.Z,{variant:"h3",fontWeight:"bold",children:(0,v.t)("SUBSCRIPTION")}),(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("FAMILY_PLAN")})]}),(0,d.tZ)(eT.Z,{children:(0,d.BX)(f.wx,{children:[(0,d.BX)(q.Z,{mb:4,children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("subscription_info_family")}),(0,d.tZ)(m.Z,{children:null===(t=(0,lF.yS)(i.familyData))||void 0===t?void 0:t.email})]}),(0,d.tZ)("img",{height:256,src:"/images/family-plan/1x.png",srcSet:"/images/family-plan/2x.png 2x, /images/family-plan/3x.png 3x"}),(0,d.tZ)(f.A0,{px:2,children:(0,d.tZ)(e5.Z,{size:"large",variant:"outlined",color:"critical",onClick:()=>l({title:(0,v.t)("LEAVE_FAMILY_PLAN}"),content:(0,v.t)("LEAVE_FAMILY_CONFIRM"),proceed:{text:(0,v.t)("LEAVE"),action:a,variant:"critical"},close:{text:(0,v.t)("cancel")}}),children:(0,v.t)("LEAVE_FAMILY_PLAN")})})]})})]}):(0,d.tZ)(d.HY,{})}var rp=n(67295);let rh=e=>{let t,{open:n,onClose:i,onRootClose:o,appContext:l}=e,{startLoading:r,finishLoading:a,setDialogBoxAttributesV2:c,somethingWentWrong:s}=l,u=(0,A.useSyncExternalStore)(S.vz,S.J9),[p,h]=(0,A.useState)(!1),g=()=>{i(),o()},f=async()=>{r();try{await (0,S.i4)(),h(!1)}catch(e){Z.ZP.error("Failed to enable ML",e),s()}finally{a()}},m=async()=>{r();try{await (0,S.Yj)()}catch(e){Z.ZP.error("Failed to disable ML",e),s()}finally{a()}};return t=u?"disabled"==u.phase?(0,d.tZ)(rg,{onEnable:()=>h(!0)}):(0,d.tZ)(rm,{mlStatus:u,setDialogBoxAttributesV2:c,onDisableML:m}):(0,d.tZ)(rZ,{}),(0,d.BX)(q.Z,{children:[(0,d.tZ)(nC.c,{anchor:"left",transitionDuration:0,open:n,onClose:(e,t)=>{"backdropClick"==t?g():i()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:i,title:(0,v.t)("ml_search"),onRootClose:o}),t]})}),(0,d.tZ)(rf,{open:p,onClose:()=>h(!1),onRootClose:g,onConsent:f})]})},rZ=()=>(0,d.tZ)(q.Z,{textAlign:"center",pt:4,children:(0,d.tZ)(ez.Z,{})}),rg=e=>{let{onEnable:t}=e;return(0,d.BX)(et.Z,{py:"20px",px:"16px",spacing:"32px",children:[(0,d.tZ)(m.Z,{color:"text.muted",children:(0,v.t)("ml_search_description")}),(0,d.BX)(et.Z,{spacing:"8px",children:[(0,d.tZ)(e5.Z,{color:"accent",size:"large",onClick:t,children:(0,v.t)("enable")}),(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:()=>(0,oK.p)("https://help.ente.io/photos/features/machine-learning"),children:(0,v.t)("more_details")})]}),(0,d.tZ)(m.Z,{color:"text.faint",variant:"small",children:(0,v.t)("ml_search_footnote")})]})},rf=e=>{let{open:t,onClose:n,onRootClose:i,onConsent:o}=e,[l,r]=(0,A.useState)(!1);(0,A.useEffect)(()=>{r(!1)},[t]);let a=()=>{n(),i()},c=(0,d.tZ)(iv.Z,{target:"_blank",href:"https://ente.io/privacy#8-biometric-information-privacy-policy",underline:"always",sx:{color:"inherit",textDecorationColor:"inherit"}});return(0,d.tZ)(nC.c,{transitionDuration:0,open:t,onClose:(e,t)=>{"backdropClick"==t?a():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:n,title:(0,v.t)("ml_consent_title"),onRootClose:a}),(0,d.BX)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,d.tZ)(m.Z,{component:"div",color:"text.muted",px:"8px",children:(0,d.tZ)(nW.cC,{i18nKey:"ml_consent_description",components:{a:c}})}),(0,d.tZ)(o6.Z,{sx:{width:"100%"},children:(0,d.tZ)(oA.Z,{sx:{color:"text.muted",ml:0,mt:2},control:(0,d.tZ)(o7.Z,{size:"small",checked:l,onChange:e=>r(e.target.checked)}),label:(0,v.t)("ml_consent_confirmation")})}),(0,d.BX)(et.Z,{px:"8px",spacing:"8px",children:[(0,d.tZ)(e5.Z,{color:"accent",size:"large",disabled:!l,onClick:o,children:(0,v.t)("ml_consent")}),(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:n,children:(0,v.t)("cancel")})]})]})]})})},rm=e=>{let t,{mlStatus:n,onDisableML:i,setDialogBoxAttributesV2:o}=e,{phase:l,nSyncedFiles:r,nTotalFiles:a}=n;switch(l){case"scheduled":t=(0,v.t)("indexing_status_scheduled");break;case"fetching":t=(0,v.t)("indexing_status_fetching");break;case"indexing":t=(0,v.t)("indexing_status_running");break;case"clustering":t=(0,v.t)("people");break;default:t=(0,v.t)("indexing_status_done")}let c="clustering"==l?"".concat(Math.round(100*r/a),"%"):"".concat(r," / ").concat(a);return(0,d.BX)(et.Z,{px:"16px",py:"20px",gap:4,children:[(0,d.tZ)(et.Z,{gap:3,children:(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{label:(0,v.t)("enabled"),variant:"toggle",checked:!0,onClick:()=>{o({title:(0,v.t)("ml_search_disable"),content:(0,v.t)("ml_search_disable_confirm"),close:{text:(0,v.t)("cancel")},proceed:{variant:"critical",text:(0,v.t)("disable"),action:i},buttonDirection:"row"})}})})}),(0,d.tZ)(rp.Z,{variant:"outlined",children:(0,d.BX)(et.Z,{children:[(0,d.BX)(et.Z,{direction:"row",gap:2,px:2,pt:1,pb:2,justifyContent:"space-between",children:[(0,d.tZ)(m.Z,{color:"text.faint",children:(0,v.t)("indexing")}),(0,d.tZ)(m.Z,{children:t})]}),(0,d.tZ)(en.Z,{sx:{marginInlineStart:2}}),(0,d.BX)(et.Z,{direction:"row",gap:2,px:2,pt:2,pb:1,justifyContent:"space-between",children:[(0,d.tZ)(m.Z,{color:"text.faint",children:(0,v.t)("processed")}),(0,d.tZ)(m.Z,{textAlign:"right",children:c})]})]})})]})};var rv=n(61783);let rA=e=>{let{open:t,onClose:n,onRootClose:i}=e,o=(0,A.useContext)(e9.AppContext),l=()=>{n(),i()};return(0,d.tZ)(nC.c,{transitionDuration:0,open:t,onClose:(e,t)=>{"backdropClick"===t?l():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:n,title:(0,v.t)("advanced"),onRootClose:l}),(0,d.tZ)(q.Z,{px:"8px",children:(0,d.tZ)(et.Z,{py:"20px",spacing:"24px",children:(0,d.BX)(q.Z,{children:[(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{variant:"toggle",checked:!o.isCFProxyDisabled,onClick:()=>{o.setIsCFProxyDisabled(!o.isCFProxyDisabled)},label:(0,v.t)("FASTER_UPLOAD")})}),(0,d.tZ)(ny.F_,{title:(0,v.t)("FASTER_UPLOAD_DESCRIPTION")})]})})})]})})},rC=e=>{let{open:t,onClose:n,onRootClose:i}=e,{mapEnabled:o,updateMapEnabled:l}=(0,A.useContext)(e9.AppContext),[r,a]=(0,A.useState)(!1);(0,A.useEffect)(()=>{t&&(async()=>{l(await (0,o4.KV)())})()},[t]);let c=()=>{n(),i()};return(0,d.BX)(nC.c,{transitionDuration:0,open:t,onClose:(e,t)=>{"backdropClick"===t?c():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:[(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:n,title:(0,v.t)("MAP"),onRootClose:c}),(0,d.tZ)(q.Z,{px:"8px",children:(0,d.tZ)(et.Z,{py:"20px",spacing:"24px",children:(0,d.tZ)(q.Z,{children:(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{onClick:()=>a(!0),variant:"toggle",checked:o,label:(0,v.t)("MAP_SETTINGS")})})})})})]}),(0,d.tZ)(rx,{open:r,mapEnabled:o,onClose:()=>a(!1),onRootClose:c})]})},rx=e=>{let{open:t,onClose:n,onRootClose:i,mapEnabled:o}=e,{somethingWentWrong:l,updateMapEnabled:r}=(0,A.useContext)(e9.AppContext),a=async()=>{try{await r(!1),n()}catch(e){Z.ZP.error("Disable Map failed",e),l()}},c=async()=>{try{await r(!0),n()}catch(e){Z.ZP.error("Enable Map failed",e),l()}},s=()=>{n(),i()};return(0,d.tZ)(q.Z,{children:(0,d.tZ)(nC.c,{anchor:"left",transitionDuration:0,open:t,onClose:(e,t)=>{"backdropClick"===t?s():n()},slotProps:{backdrop:{sx:{"&&&":{backgroundColor:"transparent"}}}},children:o?(0,d.tZ)(ry,{onClose:n,disableMap:a,onRootClose:s}):(0,d.tZ)(rw,{onClose:n,enableMap:c,onRootClose:s})})})};function rw(e){let{onClose:t,enableMap:n,onRootClose:i}=e;return(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:t,title:(0,v.t)("ENABLE_MAPS"),onRootClose:i}),(0,d.BX)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,d.BX)(q.Z,{px:"8px",children:[" ",(0,d.tZ)(m.Z,{color:"text.muted",children:(0,d.tZ)(nW.cC,{i18nKey:"ENABLE_MAP_DESCRIPTION",components:{a:(0,d.tZ)(iv.Z,{target:"_blank",rel:"noopener",href:"https://www.openstreetmap.org/"})}})})]}),(0,d.BX)(et.Z,{px:"8px",spacing:"8px",children:[(0,d.tZ)(e5.Z,{color:"accent",size:"large",onClick:n,children:(0,v.t)("enable")}),(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:t,children:(0,v.t)("cancel")})]})]})]})}function ry(e){let{onClose:t,disableMap:n,onRootClose:i}=e;return(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:t,title:(0,v.t)("DISABLE_MAPS"),onRootClose:i}),(0,d.BX)(et.Z,{py:"20px",px:"8px",spacing:"32px",children:[(0,d.tZ)(q.Z,{px:"8px",children:(0,d.tZ)(m.Z,{color:"text.muted",children:(0,d.tZ)(nW.cC,{i18nKey:"DISABLE_MAP_DESCRIPTION"})})}),(0,d.BX)(et.Z,{px:"8px",spacing:"8px",children:[(0,d.tZ)(e5.Z,{color:"critical",size:"large",onClick:n,children:(0,v.t)("disable")}),(0,d.tZ)(e5.Z,{color:"secondary",size:"large",onClick:t,children:(0,v.t)("cancel")})]})]})]})}let rb=e=>{let{open:t,onClose:n,onRootClose:i}=e,o=(0,A.useContext)(e9.AppContext),[l,r]=(0,A.useState)(!1),[a,c]=(0,A.useState)(!1),[s,u]=(0,A.useState)(!1),p=()=>{n(),i()};return(0,d.BX)(nC.c,{transitionDuration:0,open:t,onClose:(e,t)=>{"backdropClick"===t?p():n()},BackdropProps:{sx:{"&&&":{backgroundColor:"transparent"}}},children:[(0,d.BX)(et.Z,{spacing:"4px",py:"12px",children:[(0,d.tZ)(nx.b,{onClose:n,title:(0,v.t)("preferences"),onRootClose:p}),(0,d.tZ)(q.Z,{px:"8px",children:(0,d.BX)(et.Z,{py:"20px",spacing:"24px",children:[(0,d.tZ)(rE,{}),(0,d.tZ)(nb.v,{onClick:()=>c(!0),endIcon:(0,d.tZ)(Y.Z,{}),label:(0,v.t)("MAP")}),(0,d.tZ)(nb.v,{onClick:()=>r(!0),endIcon:(0,d.tZ)(Y.Z,{}),label:(0,v.t)("advanced")}),S.RU&&(0,d.BX)(q.Z,{children:[(0,d.tZ)(ny.F_,{title:(0,v.t)("labs"),icon:(0,d.tZ)(rv.Z,{})}),(0,d.tZ)(ny.GP,{children:(0,d.tZ)(nb.v,{endIcon:(0,d.tZ)(Y.Z,{}),onClick:()=>u(!0),label:(0,v.t)("ml_search")})})]})]})})]}),(0,d.tZ)(rh,{open:s,onClose:()=>u(!1),onRootClose:p,appContext:o}),(0,d.tZ)(rC,{open:a,onClose:()=>c(!1),onRootClose:i}),(0,d.tZ)(rA,{open:l,onClose:()=>r(!1),onRootClose:i})]})},rE=()=>{let e=(0,g.F2)(),t=g.nD.map(e=>({label:rI(e),value:e}));return(0,d.tZ)(li,{options:t,label:(0,v.t)("language"),labelProps:{color:"text.muted"},selected:e,setSelected:e=>{(0,g.oj)(e),window.location.reload()}})},rI=e=>{switch(e){case"en-US":return"English";case"fr-FR":return"Fran\xe7ais";case"de-DE":return"Deutsch";case"zh-CN":return"中文";case"nl-NL":return"Nederlands";case"es-ES":return"Espa\xf1ol";case"pt-BR":return"Brazilian Portuguese";case"ru-RU":return"Russian";case"pl-PL":return"Polish"}};var r_=n(12256);function rS(){let e=(0,y._)(["\n    display: none;\n    @media (max-width: 359px) {\n        display: block;\n    }\n"]);return rS=function(){return e},e}function rT(){let e=(0,y._)(["\n    display: none;\n    @media (min-width: 360px) {\n        display: block;\n    }\n"]);return rT=function(){return e},e}let rP=(0,_.ZP)(q.Z)(rS()),rD=(0,_.ZP)(q.Z)(rT());function rR(e){let{usage:t,storage:n}=e;return(0,d.BX)(q.Z,{width:"100%",children:[(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,v.t)("STORAGE")}),(0,d.tZ)(rD,{children:(0,d.tZ)(m.Z,{fontWeight:"bold",sx:{fontSize:"24px",lineHeight:"30px"},children:"".concat((0,r_.nS)(t,{round:!0})," ").concat((0,v.t)("OF")," ").concat((0,r_.nS)(n)," ").concat((0,v.t)("USED"))})}),(0,d.tZ)(rP,{children:(0,d.tZ)(m.Z,{fontWeight:"bold",sx:{fontSize:"24px",lineHeight:"30px"},children:"".concat((0,r_.e8)(t)," /  ").concat((0,r_.e8)(n)," ").concat((0,v.t)("storage_unit.gb")," ").concat((0,v.t)("USED"))})})]})}var rL=n(43563);function rk(){let e=(0,y._)(["\n    font-size: 4px;\n    margin: 0 ",";\n    color: inherit;\n"]);return rk=function(){return e},e}function rO(){let e=(0,y._)(["\n    font-size: 8.71px;\n    margin: 0;\n    margin-right: 4px;\n    color: inherit;\n"]);return rO=function(){return e},e}let rN=(0,_.ZP)(oi.Z)(()=>({".MuiLinearProgress-bar":{borderRadius:"2px"},borderRadius:"2px",backgroundColor:"rgba(255, 255, 255, 0.2)"}));rN.defaultProps={variant:"determinate"};let rB=(0,_.ZP)(rL.Z)(rk(),e=>{let{theme:t}=e;return t.spacing(1)}),rM=(0,_.ZP)(rB)(rO());function rU(e){let{label:t,color:n}=e;return(0,d.BX)(f.A0,{children:[(0,d.tZ)(rM,{sx:{color:n}}),(0,d.tZ)(m.Z,{variant:"mini",fontWeight:"bold",children:t})]})}function rF(e){let{userUsage:t,totalUsage:n,totalStorage:i}=e;return(0,d.BX)(q.Z,{position:"relative",width:"100%",children:[(0,d.tZ)(rN,{sx:{backgroundColor:"transparent"},value:Math.min(100*t/i,100)}),(0,d.tZ)(rN,{sx:{position:"absolute",top:0,zIndex:1,".MuiLinearProgress-bar ":{backgroundColor:"text.muted"},width:"100%"},value:Math.min(100*n/i,100)})]})}function rH(e){let{userUsage:t,totalUsage:n,fileCount:i,totalStorage:o}=e;return(0,d.BX)(q.Z,{width:"100%",children:[(0,d.tZ)(rF,{totalUsage:n,userUsage:t,totalStorage:o}),(0,d.BX)(f.Gm,{sx:{marginTop:1.5},children:[(0,d.BX)(et.Z,{direction:"row",spacing:1.5,children:[(0,d.tZ)(rU,{label:(0,v.t)("YOU"),color:"text.base"}),(0,d.tZ)(rU,{label:(0,v.t)("FAMILY"),color:"text.muted"})]}),(0,d.tZ)(m.Z,{variant:"mini",fontWeight:"bold",children:(0,v.t)("photos_count",{count:null!=i?i:0})})]})]})}function rX(e){var t;let{userDetails:n}=e,i=(0,A.useMemo)(()=>(0,lF.uD)(n.familyData)?n.familyData.members.reduce((e,t)=>e+t.usage,0):n.usage,[n]),o=n.familyData.storage+(null!==(t=n.storageBonus)&&void 0!==t?t:0);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(rR,{storage:o,usage:i}),(0,d.tZ)(rH,{userUsage:n.usage,fileCount:n.fileCount,totalUsage:i,totalStorage:o})]})}function rK(e){let{usage:t,storage:n,fileCount:i}=e;return(0,d.BX)(q.Z,{width:"100%",children:[(0,d.tZ)(rN,{value:Math.min(100*t/n,100)}),(0,d.BX)(f.Gm,{sx:{marginTop:1.5},children:[(0,d.tZ)(m.Z,{variant:"mini",children:"".concat((0,r_.nS)(n-t)," ").concat((0,v.t)("FREE"))}),(0,d.tZ)(m.Z,{variant:"mini",fontWeight:"bold",children:(0,v.t)("photos_count",{count:null!=i?i:0})})]})]})}function rW(e){var t;let{userDetails:n}=e,i=n.subscription.storage+(null!==(t=n.storageBonus)&&void 0!==t?t:0);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(rR,{storage:i,usage:n.usage}),(0,d.tZ)(rK,{usage:n.usage,fileCount:n.fileCount,storage:i})]})}function rz(e){let{userDetails:t}=e;return(0,d.tZ)(f.aV,{children:(0,d.tZ)(f.Gm,{height:"100%",flexDirection:"column",padding:"20px 16px",children:(0,lF.dc)(t.familyData)?(0,d.tZ)(rX,{userDetails:t}):(0,d.tZ)(rW,{userDetails:t})})})}function rG(e){let{userDetails:t,onClick:n}=e;return t?(0,d.BX)(q.Z,{position:"relative",children:[(0,d.tZ)(rY,{}),(0,d.tZ)(rz,{userDetails:t}),(0,d.tZ)(rV,{onClick:n})]}):(0,d.tZ)(o5.Z,{animation:"wave",variant:"rectangular",height:152,sx:{borderRadius:"8px"}})}function rY(){return(0,d.tZ)("img",{style:{aspectRatio:"2/1"},width:"100%",src:"/images/subscription-card-background/1x.png",srcSet:"/images/subscription-card-background/2x.png 2x, /images/subscription-card-background/3x.png 3x"})}function rV(e){let{onClick:t}=e;return(0,d.tZ)(f.aV,{display:"flex",children:(0,d.tZ)(f.A0,{onClick:t,justifyContent:"flex-end",sx:{cursor:"pointer"},children:(0,d.tZ)(Y.Z,{})})})}function rj(e){let{collectionSummaries:t,sidebarView:n,closeSidebar:i}=e;return(0,d.BX)(rQ,{open:n,onClose:i,children:[(0,d.tZ)(rJ,{closeSidebar:i}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(rq,{sidebarView:n}),(0,d.BX)(et.Z,{spacing:.5,mb:3,children:[(0,d.tZ)(r0,{closeSidebar:i,collectionSummaries:t}),(0,d.tZ)(r1,{closeSidebar:i}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(r2,{}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(r5,{}),(0,d.tZ)(en.Z,{}),(0,d.tZ)(r3,{})]})]})}let rQ=(0,_.ZP)(nC.c)(e=>{let{theme:t}=e;return{"& .MuiPaper-root":{padding:t.spacing(1.5)}}});rQ.defaultProps={anchor:"left"};let rJ=e=>{let{closeSidebar:t}=e;return(0,d.BX)(f.Gm,{mt:.5,mb:1,pl:1.5,children:[(0,d.tZ)(oT.W,{}),(0,d.tZ)($.Z,{"aria-label":"close",onClick:t,color:"secondary",children:(0,d.tZ)(V.Z,{fontSize:"small"})})]})},rq=e=>{let{sidebarView:t}=e,n=(0,A.useContext)(aD),[i,o]=(0,oJ.T)(eJ.Pd.USER_DETAILS,void 0),[l,r]=(0,A.useState)(!1),a=()=>r(!0);(0,A.useEffect)(()=>{t&&(async()=>{let e=await (0,o4.C7)();o(e),(0,eJ.a_)(eJ.Pd.SUBSCRIPTION,e.subscription),(0,eJ.a_)(eJ.Pd.FAMILY_DATA,e.familyData),await (0,eJ.CA)({...(0,eJ.Yu)(eJ.Pd.USER),email:e.email})})()},[t]);let c=(0,A.useMemo)(()=>i&&(0,lF.uD)(i.familyData)&&!(0,lF.re)(i.familyData),[i]);return(0,d.BX)(d.HY,{children:[(0,d.BX)(q.Z,{px:.5,mt:2,pb:1.5,mb:1,children:[(0,d.tZ)(m.Z,{px:1,pb:1,color:"text.muted",children:i?i.email:(0,d.tZ)(o5.Z,{animation:"wave"})}),(0,d.tZ)(rG,{userDetails:i,onClick:()=>{c?a():i&&lj(i.subscription)&&lJ(i.subscription)?lU.Z.redirectToCustomerPortal():n.showPlanSelectorModal()}}),(0,d.tZ)(r$,{userDetails:i})]}),c&&(0,d.tZ)(ru,{userDetails:i,open:l,onClose:()=>r(!1)})]})},r$=e=>{let t,{userDetails:n}=e,{showPlanSelectorModal:i}=(0,A.useContext)(aD),o=(0,A.useMemo)(()=>!(!n||(0,lF.uD)(n.familyData)&&!(0,lF.re)(n.familyData)||lK(n.subscription)&&!lY(n.subscription)),[n]),l=(0,A.useMemo)(()=>e=>{e.stopPropagation(),n&&(lW(n.subscription)?lQ(n)&&i():lj(n.subscription)&&lJ(n.subscription)?lU.Z.redirectToCustomerPortal():i())},[n]);if(!o)return(0,d.tZ)(d.HY,{});if(!lG(n.bonusData)){if(lW(n.subscription)){if(lz(n.subscription))t=(0,v.t)("subscription_info_free");else if(lY(n.subscription)){var r;t=(0,v.t)("subscription_info_renewal_cancelled",{date:null===(r=n.subscription)||void 0===r?void 0:r.expiryTime})}}else t=(0,d.tZ)(nW.cC,{i18nKey:"subscription_info_expired",components:{a:(0,d.tZ)(ot.Z,{onClick:l})}})}return(!t&&lQ(n)&&(t=(0,d.tZ)(nW.cC,{i18nKey:"subscription_info_storage_quota_exceeded",components:{a:(0,d.tZ)(ot.Z,{onClick:l})}})),t)?(0,d.tZ)(q.Z,{px:1,pt:.5,children:(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",onClick:l&&l,sx:{cursor:l&&"pointer"},children:t})}):(0,d.tZ)(d.HY,{})},r0=e=>{var t,n,i;let{closeSidebar:o,collectionSummaries:l}=e,r=(0,A.useContext)(aD),[a,c]=(0,A.useState)();return(0,A.useEffect)(()=>{(async()=>{let e=await (0,ta.hT)();e?c(e.id):c(ts.Ei)})()},[]),(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(o$.Z,{}),onClick:()=>{r.setActiveCollectionID(a),o()},variant:"captioned",label:(0,v.t)("section_uncategorized"),subText:null===(t=l.get(a))||void 0===t?void 0:t.fileCount.toString()}),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(iw.Z,{}),onClick:()=>{r.setActiveCollectionID(ts.TS),o()},variant:"captioned",label:(0,v.t)("section_archive"),subText:null===(n=l.get(ts.TS))||void 0===n?void 0:n.fileCount.toString()}),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(o2.Z,{}),onClick:()=>{r.openHiddenSection(()=>{o()})},variant:"captioned",label:(0,v.t)("section_hidden"),subIcon:(0,d.tZ)(o1.Z,{})}),(0,d.tZ)(nb.v,{startIcon:(0,d.tZ)(o0.Z,{}),onClick:()=>{r.setActiveCollectionID(ts.jn),o()},variant:"captioned",label:(0,v.t)("section_trash"),subText:null===(i=l.get(ts.jn))||void 0===i?void 0:i.fileCount.toString()})]})},r1=e=>{let{closeSidebar:t}=e,n=(0,ld.useRouter)(),{setDialogMessage:i,startLoading:o,watchFolderView:l,setWatchFolderView:r,themeColor:a,setThemeColor:c}=(0,A.useContext)(e9.AppContext),[s,u]=(0,A.useState)(!1),[p,h]=(0,A.useState)(!1),[g,f]=(0,A.useState)(!1),m=async()=>{t();try{await (0,oF.yr)()}catch(e){Z.ZP.error("failed to redirect to accounts page",e)}};return(0,d.BX)(d.HY,{children:[i0()()&&(0,d.tZ)(nb.v,{onClick:()=>{i0()()?r(!0):i((0,i2.nf)())},variant:"secondary",label:(0,v.t)("WATCH_FOLDERS")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>u(!0),label:(0,v.t)("recovery_key")}),r4()&&(0,d.tZ)(nb.v,{onClick:()=>{c(a===oz.l.DARK?oz.l.LIGHT:oz.l.DARK)},variant:"secondary",label:(0,v.t)("CHOSE_THEME"),endIcon:(0,d.tZ)(oQ,{themeColor:a,setThemeColor:c})}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>h(!0),label:(0,v.t)("TWO_FACTOR")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:m,label:(0,v.t)("passkeys")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>{t(),n.push(eG.W.CHANGE_PASSWORD)},label:(0,v.t)("CHANGE_PASSWORD")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>{t(),n.push(eG.W.CHANGE_EMAIL)},label:(0,v.t)("CHANGE_EMAIL")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>n.push(eG.W.DEDUPLICATE),label:(0,v.t)("DEDUPLICATE_FILES")}),(0,d.tZ)(nb.v,{variant:"secondary",onClick:()=>f(!0),label:(0,v.t)("preferences")}),(0,d.tZ)(oW.Z,{show:s,onHide:()=>u(!1),somethingWentWrong:()=>i({title:(0,v.t)("error"),content:(0,v.t)("RECOVER_KEY_GENERATION_FAILED"),close:{variant:"critical"}})}),(0,d.tZ)(lf,{show:p,onHide:()=>h(!1),closeSidebar:t,setLoading:o}),i0()()&&(0,d.tZ)(lI,{open:l,onClose:()=>r(!1)}),(0,d.tZ)(rb,{open:g,onClose:()=>f(!1),onRootClose:t})]})},r2=()=>{let{setDialogMessage:e}=(0,A.useContext)(e9.AppContext),{openExportModal:t}=(0,A.useContext)(aD);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{onClick:()=>(0,oK.p)("https://github.com/ente-io/ente/discussions"),label:(0,v.t)("request_feature"),variant:"secondary"}),(0,d.tZ)(nb.v,{onClick:()=>(0,oK.e)("support@ente.io"),labelComponent:(0,d.tZ)("span",{title:"support@ente.io",children:(0,v.t)("support")}),variant:"secondary"}),(0,d.tZ)(nb.v,{onClick:()=>oH.nI?t():e((0,i2.nf)()),label:(0,v.t)("EXPORT"),endIcon:i1.ZP.isExportInProgress()&&(0,d.tZ)(ez.Z,{size:"20px"}),variant:"secondary"})]})},r5=()=>{let{setDialogMessage:e,logout:t}=(0,A.useContext)(e9.AppContext),[n,i]=(0,A.useState)(!1);return(0,d.BX)(d.HY,{children:[(0,d.tZ)(nb.v,{onClick:()=>{e({title:(0,v.t)("logout_message"),proceed:{text:(0,v.t)("logout"),action:t,variant:"critical"},close:{text:(0,v.t)("cancel")}})},color:"critical",label:(0,v.t)("logout"),variant:"secondary"}),(0,d.tZ)(nb.v,{onClick:()=>i(!0),color:"critical",variant:"secondary",label:(0,v.t)("delete_account")}),(0,d.tZ)(ll,{open:n,onClose:()=>i(!1)})]})},r3=()=>{let e=(0,A.useContext)(e9.AppContext),[t,n]=(0,A.useState)(),[i,o]=(0,A.useState)(),l=globalThis.electron;(0,A.useEffect)(()=>{null==l||l.appVersion().then(n),(0,ih.yv)().then(o)});let r=()=>{Z.ZP.info("Downloading logs"),l?l.openLogDirectory():(0,oq.KG)("debug_logs_".concat(Date.now(),".txt"),(0,oX.Is)())};return(0,d.BX)(d.HY,{children:[r4()&&(0,d.tZ)(nb.v,{variant:"secondary",onClick:rt,label:"Test Upload"}),(0,d.tZ)(nb.v,{onClick:()=>e.setDialogMessage({title:(0,v.t)("DOWNLOAD_LOGS"),content:(0,d.tZ)(nW.cC,{i18nKey:"DOWNLOAD_LOGS_MESSAGE"}),proceed:{text:(0,v.t)("download"),variant:"accent",action:r},close:{text:(0,v.t)("cancel")}}),variant:"mini",label:(0,v.t)("debug_logs")}),(0,d.BX)(et.Z,{py:"14px",px:"16px",gap:"24px",color:"text.muted",children:[t&&(0,d.tZ)(m.Z,{variant:"mini",children:t}),i&&(0,d.tZ)(m.Z,{variant:"mini",children:i})]})]})},r4=()=>{var e;let t=null===(e=(0,eJ.Yu)(eJ.Pd.USER))||void 0===e?void 0:e.email;return!!t&&t.endsWith("@ente.io")};var r8=n(86508),r9=n(92289);function r6(){var e;return null===(e=(0,eJ.Yu)(eJ.Pd.USER_DETAILS))||void 0===e?void 0:e.value}function r7(){let e=(0,y._)(["\n    align-items: flex-start;\n"]);return r7=function(){return e},e}(r=s||(s={})).MONTH="month",r.YEAR="year";var ae=function(e){let t=(0,ti.Z)((0,ee.Z)().breakpoints.down("sm"));return e.modalView?(0,d.tZ)(e_.Z,{fullScreen:t,open:e.modalView,onClose:e.closeModal,PaperProps:{sx:e=>({width:{sm:"391px"},p:1,[e.breakpoints.down(360)]:{p:0}})},children:(0,d.tZ)(at,{closeModal:e.closeModal,setLoading:e.setLoading})}):(0,d.tZ)(d.HY,{})};function at(e){let t=(0,A.useMemo)(()=>(0,eJ.Yu)(eJ.Pd.SUBSCRIPTION),[]),[n,i]=(0,A.useState)(),[o,l]=(0,A.useState)((null==t?void 0:t.period)||s.MONTH),r=(0,A.useContext)(aD),a=(0,A.useContext)(e9.AppContext),c=(0,A.useMemo)(()=>{let e=r6();return e?e.bonusData:null},[]),u=(0,A.useMemo)(()=>{let e=r6();return e?(0,lF.uD)(e.familyData)?(0,lF.mw)(e.familyData):e.usage:0},[]);function p(){a.closeMessageDialog(),r.showPlanSelectorModal()}async function h(n){switch(lX(t)){case"buyPlan":try{e.setLoading(!0),await lU.Z.buySubscription(n.stripeID)}catch(t){e.setLoading(!1),a.setDialogMessage({title:(0,v.t)("error"),content:(0,v.t)("SUBSCRIPTION_PURCHASE_FAILED"),close:{variant:"critical"}})}break;case"updateSubscriptionToPlan":a.setDialogMessage({title:(0,v.t)("update_subscription_title"),content:(0,v.t)("UPDATE_SUBSCRIPTION_MESSAGE"),proceed:{text:(0,v.t)("UPDATE_SUBSCRIPTION"),action:l$.bind(null,n,a.setDialogMessage,e.setLoading,e.closeModal),variant:"accent"},close:{text:(0,v.t)("cancel")}});break;case"cancelOnMobile":a.setDialogMessage({title:(0,v.t)("CANCEL_SUBSCRIPTION_ON_MOBILE"),content:(0,v.t)("CANCEL_SUBSCRIPTION_ON_MOBILE_MESSAGE"),close:{variant:"secondary"}});break;case"contactSupport":a.setDialogMessage({title:(0,v.t)("MANAGE_PLAN"),content:(0,d.tZ)(nW.cC,{i18nKey:"MAIL_TO_MANAGE_SUBSCRIPTION",components:{a:(0,d.tZ)(iv.Z,{href:"mailto:support@ente.io"})},values:{emailID:"support@ente.io"}}),close:{variant:"secondary"}})}}(0,A.useEffect)(()=>{(async()=>{try{e.setLoading(!0);let n=await lU.Z.getPlans(),{plans:o}=n;if(lW(t)){let e=0===o.filter(e=>lV(e,t)).length;t&&!lz(t)&&e&&o.push({id:t.productID,storage:t.storage,price:t.price,period:t.period,stripeID:t.productID,iosID:t.productID,androidID:t.productID})}i(n)}catch(t){Z.ZP.error("plan selector modal open failed",t),e.closeModal(),a.setDialogMessage({title:(0,v.t)("OPEN_PLAN_SELECTOR_MODAL_FAILED"),content:(0,v.t)("UNKNOWN_ERROR"),close:{text:(0,v.t)("close"),variant:"secondary"},proceed:{text:(0,v.t)("REOPEN_PLAN_SELECTOR_MODAL"),variant:"accent",action:p}})}finally{e.setLoading(!1)}})()},[]);let{closeModal:g,setLoading:f}=e,m={subscription:t,bonusData:c,closeModal:g,planPeriod:o,togglePeriod:()=>{l(e=>e===s.MONTH?s.YEAR:s.MONTH)},setLoading:f},C=(0,d.tZ)(ar,{plansResponse:n,planPeriod:o,onPlanSelect:h,subscription:t,bonusData:c,closeModal:g});return(0,d.tZ)(d.HY,{children:(0,d.tZ)(et.Z,{spacing:3,p:1.5,children:lK(t)?(0,d.tZ)(ai,{...m,usage:u,children:C}):(0,d.tZ)(an,{...m,children:C})})})}function an(e){let{children:t,subscription:n,bonusData:i,closeModal:o,setLoading:l,planPeriod:r,togglePeriod:a}=e;return(0,d.BX)(d.HY,{children:[(0,d.tZ)(m.Z,{variant:"h3",fontWeight:"bold",children:(0,v.t)("CHOOSE_PLAN")}),(0,d.tZ)(q.Z,{children:(0,d.BX)(et.Z,{spacing:3,children:[(0,d.BX)(q.Z,{children:[(0,d.tZ)(ao,{planPeriod:r,togglePeriod:a}),(0,d.tZ)(m.Z,{variant:"small",mt:.5,color:"text.muted",children:(0,v.t)("TWO_MONTHS_FREE")})]}),t,lG(i)&&(0,d.tZ)(ag,{bonusData:i,closeModal:o}),lG(i)&&(0,d.tZ)(am,{subscription:n,bonusData:i,closeModal:o,setLoading:l})]})})]})}function ai(e){let{children:t,subscription:n,bonusData:i,closeModal:o,usage:l,planPeriod:r,togglePeriod:a,setLoading:c}=e;return(0,d.BX)(d.HY,{children:[(0,d.tZ)(q.Z,{pl:1.5,py:.5,children:(0,d.BX)(f.Gm,{children:[(0,d.BX)(q.Z,{children:[(0,d.tZ)(m.Z,{variant:"h3",fontWeight:"bold",children:(0,v.t)("SUBSCRIPTION")}),(0,d.BX)(m.Z,{variant:"small",color:"text.muted",children:[(0,r_.e8)(n.storage,2)," ",(0,v.t)("storage_unit.gb")]})]}),(0,d.tZ)($.Z,{onClick:o,color:"secondary",children:(0,d.tZ)(V.Z,{})})]})}),(0,d.tZ)(q.Z,{px:1.5,children:(0,d.tZ)(m.Z,{color:"text.muted",fontWeight:"bold",children:(0,d.tZ)(nW.cC,{i18nKey:"CURRENT_USAGE",values:{usage:"".concat((0,r_.e8)(l,2)," ").concat((0,v.t)("storage_unit.gb"))}})})}),(0,d.BX)(q.Z,{children:[(0,d.BX)(et.Z,{spacing:3,border:e=>"1px solid ".concat(e.palette.divider),p:1.5,borderRadius:e=>"".concat(e.shape.borderRadius,"px"),children:[(0,d.BX)(q.Z,{children:[(0,d.tZ)(ao,{planPeriod:r,togglePeriod:a}),(0,d.tZ)(m.Z,{variant:"small",mt:.5,color:"text.muted",children:(0,v.t)("TWO_MONTHS_FREE")})]}),t]}),(0,d.BX)(q.Z,{py:1,px:1.5,children:[(0,d.tZ)(m.Z,{color:"text.muted",children:lY(n)?(0,v.t)("subscription_status_renewal_cancelled",{date:n.expiryTime}):(0,v.t)("subscription_status_renewal_active",{date:n.expiryTime})}),lG(i)&&(0,d.tZ)(ag,{bonusData:i,closeModal:o})]})]}),(0,d.tZ)(am,{subscription:n,bonusData:i,closeModal:o,setLoading:c})]})}function ao(e){let{planPeriod:t,togglePeriod:n}=e;return(0,d.BX)(oV.Z,{value:t,exclusive:!0,onChange:(e,i)=>{null!==i&&i!==t&&n()},color:"primary",children:[(0,d.tZ)(al,{value:s.MONTH,children:(0,v.t)("MONTHLY")}),(0,d.tZ)(al,{value:s.YEAR,children:(0,v.t)("YEARLY")})]})}let al=(0,_.ZP)(oj.Z)(e=>{let{theme:t}=e;return{textTransform:"none",padding:"12px 16px",borderRadius:"4px",backgroundColor:t.colors.fill.faint,border:"1px solid transparent",color:t.colors.text.faint,"&.Mui-selected":{backgroundColor:t.colors.accent.A500,color:t.colors.text.base},"&.Mui-selected:hover":{backgroundColor:t.colors.accent.A500,color:t.colors.text.base},width:"97.433px"}}),ar=e=>{var t;let{plansResponse:n,planPeriod:i,subscription:o,bonusData:l,onPlanSelect:r,closeModal:a}=e,{freePlan:c,plans:s}=null!=n?n:{};return(0,d.BX)(et.Z,{spacing:2,children:[null==s?void 0:null===(t=s.filter(e=>e.period===i))||void 0===t?void 0:t.map(e=>(0,d.tZ)(aa,{disabled:lV(e,o),popular:lq(e),plan:e,subscription:o,onPlanSelect:r},e.stripeID)),!lK(o)&&!lG(l)&&c&&(0,d.tZ)(ah,{storage:c.storage,closeModal:a})]})};function aa(e){let{plan:t,subscription:n,onPlanSelect:i,disabled:o,popular:l}=e;return(0,d.BX)(ac,{children:[(0,d.BX)(as,{children:[(0,d.tZ)(m.Z,{variant:"h1",fontWeight:"bold",children:(0,r_.e8)(t.storage)}),(0,d.BX)(f.A0,{flexWrap:"wrap",gap:1,children:[(0,d.tZ)(m.Z,{variant:"h3",color:"text.muted",children:(0,v.t)("storage_unit.gb")}),l&&!lK(n)&&(0,d.tZ)(ap,{children:(0,v.t)("POPULAR")})]})]}),(0,d.tZ)(q.Z,{width:"136px",children:(0,d.tZ)(o?ad:au,{sx:{justifyContent:"flex-end",borderTopLeftRadius:0,borderBottomLeftRadius:0},size:"large",onClick:()=>{lV(t,n)||i(t)},children:(0,d.BX)(q.Z,{textAlign:"right",children:[(0,d.BX)(m.Z,{fontWeight:"bold",variant:"large",children:[t.price," "]})," ",(0,d.tZ)(m.Z,{color:"text.muted",variant:"small",children:"/ ".concat(t.period===s.MONTH?(0,v.t)("MONTH_SHORT"):(0,v.t)("YEAR"))})]})})})]})}let ac=(0,_.ZP)(f.A0)(()=>({background:"linear-gradient(268.22deg, rgba(256, 256, 256, 0.08) -3.72%, rgba(256, 256, 256, 0) 85.73%)"})),as=(0,_.ZP)(f.G5)(r7()),ad=(0,_.ZP)(e=>(0,d.tZ)(e5.Z,{disabled:!0,endIcon:(0,d.tZ)(tm.Z,{}),...e}))(e=>{let{theme:t}=e;return{"&.Mui-disabled":{backgroundColor:"transparent",color:t.colors.text.base}}}),au=(0,_.ZP)(e=>(0,d.tZ)(e5.Z,{color:"accent",...e,endIcon:(0,d.tZ)(eI.Z,{})}))(()=>({".MuiButton-endIcon":{transition:"transform .2s ease-in-out"},"&:hover .MuiButton-endIcon":{transform:"translateX(4px)"}})),ap=(0,_.ZP)(q.Z)(e=>{let{theme:t}=e;return{borderRadius:t.shape.borderRadius,padding:"2px 4px",backgroundColor:t.colors.black.muted,backdropFilter:"blur(".concat(t.colors.blur.muted,")"),color:t.colors.white.base,textTransform:"uppercase",...t.typography.mini}}),ah=e=>{let{closeModal:t,storage:n}=e;return(0,d.BX)(aZ,{onClick:t,children:[(0,d.BX)(q.Z,{children:[(0,d.tZ)(m.Z,{children:(0,v.t)("free_plan_option")}),(0,d.tZ)(m.Z,{variant:"small",color:"text.muted",children:(0,v.t)("free_plan_description",{storage:(0,r_.nS)(n)})})]}),(0,d.tZ)($.Z,{className:"endIcon",children:(0,d.tZ)(eI.Z,{})})]})},aZ=(0,_.ZP)(f.Gm)(e=>{let{theme:t}=e;return{gap:t.spacing(1.5),padding:t.spacing(1.5,1),cursor:"pointer","&:hover .endIcon":{backgroundColor:"rgba(255,255,255,0.08)"}}});function ag(e){let{bonusData:t,closeModal:n}=e;return(0,d.tZ)(d.HY,{children:t.storageBonuses.map(e=>e.type.startsWith("ADD_ON")?(0,d.tZ)(af,{onClick:n,children:(0,d.tZ)(q.Z,{children:(0,d.tZ)(m.Z,{color:"text.muted",children:(0,d.tZ)(nW.cC,{i18nKey:"add_on_valid_till",values:{storage:(0,r_.nS)(e.storage),date:e.validTill}})})})},e.id):null)})}let af=(0,_.ZP)(f.Gm)(e=>{let{theme:t}=e;return{padding:t.spacing(1,0),cursor:"pointer","&:hover .endIcon":{backgroundColor:"rgba(255,255,255,0.08)"}}});function am(e){let{subscription:t,bonusData:n,closeModal:i,setLoading:o}=e,{setDialogMessage:l}=(0,A.useContext)(e9.AppContext),r=async()=>{o(!0);try{(0,oK.p)(await (0,o4.tO)())}catch(e){Z.ZP.error("Could not redirect to family portal",e),l({title:(0,v.t)("error"),content:(0,v.t)("UNKNOWN_ERROR"),close:{variant:"critical"}})}o(!1)};return(0,d.BX)(et.Z,{spacing:1,children:[lj(t)&&(0,d.tZ)(av,{subscription:t,bonusData:n,closeModal:i,setLoading:o}),(0,d.tZ)(aA,{color:"secondary",onClick:r,children:(0,v.t)("MANAGE_FAMILY_PORTAL")})]})}function av(e){let{subscription:t,bonusData:n,setLoading:i,closeModal:o}=e,l=(0,A.useContext)(e9.AppContext),r=l2.bind(null,l.setDialogMessage,i);return(0,d.BX)(d.HY,{children:[lY(t)?(0,d.tZ)(aA,{color:"secondary",onClick:()=>l.setDialogMessage({title:(0,v.t)("REACTIVATE_SUBSCRIPTION"),content:(0,v.t)("REACTIVATE_SUBSCRIPTION_MESSAGE",{date:t.expiryTime}),proceed:{text:(0,v.t)("REACTIVATE_SUBSCRIPTION"),action:l1.bind(null,l.setDialogMessage,o,i),variant:"accent"},close:{text:(0,v.t)("cancel")}}),children:(0,v.t)("REACTIVATE_SUBSCRIPTION")}):(0,d.tZ)(aA,{color:"secondary",onClick:()=>l.setDialogMessage({title:(0,v.t)("CANCEL_SUBSCRIPTION"),content:lG(n)?(0,d.tZ)(nW.cC,{i18nKey:"CANCEL_SUBSCRIPTION_WITH_ADDON_MESSAGE"}):(0,d.tZ)(nW.cC,{i18nKey:"CANCEL_SUBSCRIPTION_MESSAGE"}),proceed:{text:(0,v.t)("CANCEL_SUBSCRIPTION"),action:l0.bind(null,l.setDialogMessage,o,i),variant:"critical"},close:{text:(0,v.t)("NEVERMIND")}}),children:(0,v.t)("CANCEL_SUBSCRIPTION")}),(0,d.tZ)(aA,{color:"secondary",onClick:r,children:(0,v.t)("MANAGEMENT_PORTAL")})]})}let aA=e=>{let{children:t,...n}=e;return(0,d.tZ)(e5.Z,{size:"large",endIcon:(0,d.tZ)(Y.Z,{}),...n,children:(0,d.tZ)(f.G5,{children:t})})};var aC=n(91664),ax=n(98642),aw=n(50634),ay=n(52754),ab=e=>{let{showCreateCollectionModal:t,setCollectionSelectorAttributes:n,handleCollectionOps:i,handleFileOps:o,selectedCollection:l,count:r,ownCount:a,clearSelection:c,barMode:s,activeCollectionID:u,isFavoriteCollection:h,isUncategorizedCollection:Z,isIncomingSharedCollection:g,isInSearchMode:m,isInHiddenSection:C}=e,{setDialogMessage:x}=(0,A.useContext)(e9.AppContext),w="people"==s,y=()=>n({callback:i(ts.W6.ADD),showNextModal:t(ts.W6.ADD),intent:tc.r.add,fromCollection:m||w?void 0:u}),b=()=>x((0,i2.BN)(o(l8.j_.TRASH))),E=()=>{n({callback:i(ts.W6.MOVE),showNextModal:t(ts.W6.MOVE),intent:tc.r.move,fromCollection:m||w?void 0:u})};return(0,d.BX)(p.XL,{children:[(0,d.BX)(f.G5,{children:[(0,d.tZ)($.Z,{onClick:c,children:(0,d.tZ)(V.Z,{})}),(0,d.BX)(q.Z,{ml:1.5,children:[(0,i8.u)(r)," ",(0,v.t)("SELECTED")," ",a!==r&&"(".concat((0,i8.u)(a)," ").concat((0,v.t)("YOURS"),")")]})]}),(0,d.tZ)(et.Z,{spacing:2,direction:"row",mr:2,children:m?(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("FIX_CREATION_TIME"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.FIX_TIME),children:(0,d.tZ)(aC.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("add"),children:(0,d.tZ)($.Z,{onClick:y,children:(0,d.tZ)(nn.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("archive"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.ARCHIVE),children:(0,d.tZ)(iw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("HIDE"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.HIDE),children:(0,d.tZ)(iT.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE"),children:(0,d.tZ)($.Z,{onClick:b,children:(0,d.tZ)(ax.Z,{})})})]}):w?(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("add"),children:(0,d.tZ)($.Z,{onClick:y,children:(0,d.tZ)(nn.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("archive"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.ARCHIVE),children:(0,d.tZ)(iw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("HIDE"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.HIDE),children:(0,d.tZ)(iT.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE"),children:(0,d.tZ)($.Z,{onClick:b,children:(0,d.tZ)(ax.Z,{})})})]}):u===ts.jn?(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("RESTORE"),children:(0,d.tZ)($.Z,{onClick:()=>n({callback:i(ts.W6.RESTORE),showNextModal:t(ts.W6.RESTORE),intent:tc.r.restore}),children:(0,d.tZ)(ay.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE_PERMANENTLY"),children:(0,d.tZ)($.Z,{onClick:()=>x({title:(0,v.t)("DELETE_FILES_TITLE"),content:(0,v.t)("DELETE_FILES_MESSAGE"),proceed:{action:o(l8.j_.DELETE_PERMANENTLY),text:(0,v.t)("DELETE"),variant:"critical"},close:{text:(0,v.t)("cancel")}}),children:(0,d.tZ)(ax.Z,{})})})]}):Z?(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("MOVE"),children:(0,d.tZ)($.Z,{onClick:E,children:(0,d.tZ)(eI.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE"),children:(0,d.tZ)($.Z,{onClick:b,children:(0,d.tZ)(ax.Z,{})})})]}):g?(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}):C?(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("UNHIDE"),children:(0,d.tZ)($.Z,{onClick:()=>{n({callback:i(ts.W6.UNHIDE),showNextModal:t(ts.W6.UNHIDE),intent:tc.r.unhide})},children:(0,d.tZ)(iP.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE"),children:(0,d.tZ)($.Z,{onClick:b,children:(0,d.tZ)(ax.Z,{})})})]}):(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("FIX_CREATION_TIME"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.FIX_TIME),children:(0,d.tZ)(aC.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("download"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.DOWNLOAD),children:(0,d.tZ)(aw.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("add"),children:(0,d.tZ)($.Z,{onClick:y,children:(0,d.tZ)(nn.Z,{})})}),u===ts.TS&&(0,d.tZ)(tD.Z,{title:(0,v.t)("unarchive"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.UNARCHIVE),children:(0,d.tZ)(iS.Z,{})})}),u===ts.Ug&&(0,d.tZ)(tD.Z,{title:(0,v.t)("archive"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.ARCHIVE),children:(0,d.tZ)(iw.Z,{})})}),u!==ts.Ug&&u!==ts.TS&&!h&&(0,d.BX)(d.HY,{children:[(0,d.tZ)(tD.Z,{title:(0,v.t)("MOVE"),children:(0,d.tZ)($.Z,{onClick:E,children:(0,d.tZ)(eI.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("REMOVE"),children:(0,d.tZ)($.Z,{onClick:()=>{a===r?x({title:(0,v.t)("REMOVE_FROM_COLLECTION"),content:(0,v.t)("CONFIRM_SELF_REMOVE_MESSAGE"),proceed:{action:()=>i(ts.W6.REMOVE)(l),text:(0,v.t)("YES_REMOVE"),variant:"primary"},close:{text:(0,v.t)("cancel")}}):x({title:(0,v.t)("REMOVE_FROM_COLLECTION"),content:(0,v.t)("CONFIRM_SELF_AND_OTHER_REMOVE_MESSAGE"),proceed:{action:()=>i(ts.W6.REMOVE)(l),text:(0,v.t)("YES_REMOVE"),variant:"critical"},close:{text:(0,v.t)("cancel")}})},children:(0,d.tZ)(n5.Z,{})})})]}),(0,d.tZ)(tD.Z,{title:(0,v.t)("HIDE"),children:(0,d.tZ)($.Z,{onClick:o(l8.j_.HIDE),children:(0,d.tZ)(iT.Z,{})})}),(0,d.tZ)(tD.Z,{title:(0,v.t)("DELETE"),children:(0,d.tZ)($.Z,{onClick:b,children:(0,d.tZ)(ax.Z,{})})})]})})]})},aE=n(75031),aI=n(82045),a_=n(11492);let aS=async()=>{(0,a_.Qc)(),await Promise.all([S.RU&&(0,S.c5)()])},aT=async()=>{await Promise.all([(0,o4.Hs)(),(0,W.VL)()]),(0,S.ZK)()},aP={showPlanSelectorModal:()=>null,setActiveCollectionID:()=>null,onShowCollection:()=>null,syncWithRemote:()=>null,setBlockingLoad:()=>null,photoListHeader:null,openExportModal:()=>null,authenticateUser:()=>null,user:null,userIDToEmailMap:null,emailList:null,openHiddenSection:()=>null,isClipSearchResult:null,selectedFile:null,setSelectedFiles:()=>null},aD=(0,A.createContext)(aP);function aR(){var e,t,n,i,o,l;let[r,a]=(0,A.useState)(null),[c,s]=(0,A.useState)(null),[h,g]=(0,A.useState)(null),[C,y]=(0,A.useState)(null),[b,E]=(0,A.useState)(),[_,T]=(0,A.useState)(null),[P,D]=(0,A.useState)(null),[R,L]=(0,A.useState)(null),[k,O]=(0,A.useState)(),[N,B]=(0,A.useState)(!1),[M,U]=(0,A.useState)({ownCount:0,count:0,collectionID:0,context:{mode:"albums",collectionID:ts.Ug}}),[F,H]=(0,A.useState)(!1),[X,K]=(0,A.useState)(!1),[z,G]=(0,A.useState)(null),[Y,V]=(0,A.useState)(!1),[j,Q]=(0,A.useState)(null),[J,q]=(0,A.useState)(!1),[$,ee]=(0,A.useState)(!1),[et,en]=(0,A.useState)(!1),[ei,eo]=(0,A.useState)(!1),{getRootProps:el,getInputProps:er,acceptedFiles:ea}=(0,aE.uI)({noClick:!0,noKeyboard:!0,disabled:$}),{getInputProps:ec,openSelector:es,selectedFiles:ed}=(0,ej.e)({directory:!1}),{getInputProps:eu,openSelector:ep,selectedFiles:eh}=(0,ej.e)({directory:!0}),{getInputProps:eZ,openSelector:eg,selectedFiles:ef}=(0,ej.e)({directory:!1,accept:".zip"}),em=(0,A.useRef)(!1),ev=(0,A.useRef)(),eA=(0,A.useRef)(),{startLoading:eC,finishLoading:ex,setDialogMessage:ew,logout:ey,...eb}=(0,A.useContext)(e9.AppContext),[eE,eI]=(0,A.useState)(),[e_,eS]=(0,A.useState)(),[eT,eP]=(0,A.useState)(null),[eD,eL]=(0,A.useState)(null),[ek,eO]=(0,A.useState)(void 0),[eN,eB]=(0,A.useState)(new Set),[eU,eF]=(0,A.useState)(!1),[eH,e0]=(0,A.useState)(null),[e1,e2]=(0,A.useState)(),[e5,e3]=(0,A.useState)(!1),[e4,e8]=(0,A.useState)("upload"),[e7,te]=(0,A.useState)(!1),[tn,ti]=(0,A.useState)(!1),[to,tl]=(0,A.useState)(!1),tr=(0,A.useRef)(),tc=e=>{tr.current=e,tl(!0)},[td,tp]=(0,A.useState)(!1),[th,tZ]=(0,A.useState)(),[tg,tf]=(0,A.useState)("albums"),[tm,tv]=(0,A.useState)(),tA=(0,A.useSyncExternalStore)(S.Gg,S.AR),[tC,tx]=(0,A.useState)(!1),[tw,ty]=(0,A.useState)(null),[tb,tE]=(0,A.useState)([]),[tI,t_]=(0,A.useState)(new Set),[tS,tT]=(0,A.useState)(new Set),tP=(0,ld.useRouter)(),tD=async()=>{try{return await (0,eY.yr)(),!0}catch(e){return ey(),!1}};(0,A.useEffect)(()=>{eb.showNavBar(!0);let e=(0,e$.km)(e$.Qm.ENCRYPTION_KEY),t=(0,eq.LP)();if(!e||!t){(0,u.M8)(eG.W.GALLERY),tP.push("/");return}aL("/images/subscription-card-background");let n=globalThis.electron;return(async()=>{if(!await tD())return;await I.Z.init(t),tK(),eO(ts.Ug),B((0,eq.aF)()),(0,eq.fo)()&&H(!0),(0,eq.Qj)(!1);let e=(0,eJ.Yu)(eJ.Pd.USER),i=(0,lF.nU)(),o=(0,l8.hE)((0,eK.SA)(await (0,eX.dm)("normal"))),l=(0,l8.hE)((0,eK.SA)(await (0,eX.dm)("hidden"))),r=await (0,ta.Iz)(),{normalCollections:c,hiddenCollections:d}=await (0,ts.Zf)(r),u=await (0,eX.hM)();a(e),s(i),T(o),L(u),D(l),g(c),y(d),await tX(!0),B(!1),(0,eq.n_)(!1),ev.current=setInterval(()=>tX(!1,!0),3e5),n&&(n.onMainWindowFocus(()=>tX(!1,!0)),await eR(n)&&eo(!0))})(),()=>{clearInterval(ev.current),n&&n.onMainWindowFocus(void 0)}},[]),(0,A.useEffect)(()=>(0,W.Yl)({collections:null!=h?h:[],files:(0,l8.V_)(null!=_?_:[])}),[h,_]),(0,A.useEffect)(()=>{r&&_&&h&&P&&R&&tW(r,h,C,_,R,P)},[h,C,_,P,R,r]),(0,A.useEffect)(()=>{h&&r&&eP((0,ta.GH)(r,h))},[h]),(0,A.useEffect)(()=>{r&&h&&eL((0,ta.xg)(r,h,c))},[r,h,c]),(0,A.useEffect)(()=>{z&&V(!0)},[z]),(0,A.useEffect)(()=>{j&&q(!0)},[j]),(0,A.useEffect)(()=>{eH&&eF(!0)},[eH]),(0,A.useEffect)(()=>{if(void 0===ek||!tP.isReady)return;let e="";ek!==ts.Ug&&(e="?collection=".concat(ek));let t="/gallery".concat(e);tP.push(t,void 0,{shallow:!0})},[ek,tP.isReady]),(0,A.useEffect)(()=>{let e=(0,e$.km)(e$.Qm.ENCRYPTION_KEY);tP.isReady&&e&&l5(ew,tP,K)},[tP.isReady]),(0,A.useEffect)(()=>{td&&th&&ty({height:104,item:(0,d.tZ)(x,{selectedOption:th}),itemType:is.Z$.HEADER})},[td,th]);let tR=(0,A.useMemo)(()=>h&&C?[...h,...C].find(e=>e.id===ek):null,[h,ek]),tL=(0,eQ.Z)(async()=>{var e,t,n,i,o,l;let a;if(!_||!r||!R||!P||!e1)return{filteredData:[],galleryPeopleState:void 0};if(ek===ts.jn&&!th)return{filteredData:(0,l8.V_)([...R,..._.filter(e=>null==tI?void 0:tI.has(e.id))]),galleryPeopleState:void 0};let c=[];if(th)c=await (0,W.Um)(th.suggestion);else if("people"==tg){let e=null!=tA?tA:[];(null!==(n=null==tI?void 0:tI.size)&&void 0!==n?n:null==tS?void 0:tS.size)&&(e=e.map(e=>({...e,fileIDs:e.fileIDs.filter(e=>!(null==tI?void 0:tI.has(e))&&!(null==tS?void 0:tS.has(e)))})).filter(e=>e.fileIDs.length>0));let t=null!==(i=e.find(e=>e.id==tm))&&void 0!==i?i:e[0],l=new Set(null!==(o=null==t?void 0:t.fileIDs)&&void 0!==o?o:[]);c=(0,l8.V_)(_.filter(e=>{let{id:t}=e;return!!l.has(t)})),a={activePerson:t,people:e}}else{let e="hidden-albums"==tg?P:_;c=(0,l8.V_)(e.filter(e=>!((null==tI?void 0:tI.has(e.id))||"hidden-albums"!=tg&&(null==tS?void 0:tS.has(e.id)))&&(e1.has(e.collectionID)?ek===e.collectionID:!!(ek===ts.zA&&b.has(e.collectionID))||((0,iL.m_)(e)?ek===ts.TS||ek===e.collectionID:ek===ts.Ug?!eN.has(e.id):ek===e.collectionID))))}return null!==(l=null==tR?void 0:null===(t=tR.pubMagicMetadata)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.asc)&&void 0!==l&&l&&(c=(0,l8.hE)(c,!0)),{filteredData:c,galleryPeopleState:a}},[tg,_,R,P,tI,tS,eN,th,ek,e1,tA,tm]),{filteredData:tk,galleryPeopleState:tO}=null!=tL?tL:{filteredData:[],galleryPeopleState:void 0},tN=e=>{var t;if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e7||e5||Y||J||eU||F||tn||to||et||!(null==tk?void 0:tk.length)||!r)return;e.preventDefault();let n={ownCount:0,count:0,collectionID:ek,context:"people"==tg&&(null==tO?void 0:null===(t=tO.activePerson)||void 0===t?void 0:t.id)?{mode:"people",personID:tO.activePerson.id}:{mode:tg,collectionID:(0,eW.zx)(ek)}};tk.forEach(e=>{e.ownerID===r.id&&n.ownCount++,n.count++,n[e.id]=!0}),U(n)},tB=()=>{(null==M?void 0:M.count)&&U({ownCount:0,count:0,collectionID:0,context:void 0})},tM=(0,A.useRef)({selectAll:tN,clearSelection:tB});(0,A.useEffect)(()=>{tM.current={selectAll:tN,clearSelection:tB}},[tN,tB]);let tU=(0,eQ.Z)(()=>(0,l8.W2)(_),[_]),tF=(0,A.useMemo)(()=>h&&C?(0,ts.Ew)([...h,...C]):new Map,[h,C]),tH=()=>{ew((0,i2.gZ)(ey))},tX=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!navigator.onLine)return;if(em.current&&!e){eA.current={force:e,silent:t};return}let n=em.current&&e;em.current=!0;try{let e=(0,eq.LP)();if(!e)return;if(!await (0,o4.D3)(e))throw Error(eV.sH.SESSION_EXPIRED);t||eC(),await aS();let i=await (0,ta.sU)(),{normalCollections:o,hiddenCollections:l}=await (0,ts.Zf)(i);g(o),y(l),await (0,aI.Z0)("normal",o,T),await (0,aI.Z0)("hidden",l,D),await (0,iR.Rr)(i,L),n||await aT()}catch(e){switch(e.message){case eV.sH.SESSION_EXPIRED:tH();break;case eV.sH.KEY_MISSING:(0,e$.z5)(),tP.push(eG.W.CREDENTIALS);break;default:Z.ZP.error("syncWithRemote failed",e)}}finally{t_(new Set),tT(new Set),t||ex()}if(em.current=!1,eA.current){let{force:e,silent:t}=eA.current;setTimeout(()=>tX(e,t),0),eA.current=null}},tK=()=>{let e=e=>{switch(e.key){case"Escape":tM.current.clearSelection();break;case"a":(e.ctrlKey||e.metaKey)&&tM.current.selectAll(e)}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},tW=async(e,t,n,i,o,l)=>{O(await (0,ta.QI)(i));let r=(0,ts.IA)(t);e2(r),E((0,ts.Yo)(n)),eB(new Set(l.map(e=>e.id)));let a=(0,ta.kQ)(e,t,i),c=(0,ta.c1)(i,o,r),s=(0,ta.kQ)(e,n,l),d=(0,ta.Lv)(l,n);s.set(ts.zA,d),eI(ak(a,c)),eS(s)},tz=(e,t,n)=>{var i;let o=null!==(i=null==tb?void 0:tb.length)&&void 0!==i?i:0,l=e=>{tE(t=>{let n=null==t?void 0:t.find(e=>e.id===o),i="function"==typeof e?e(n):{...n,...e};return n?t.map(e=>e.id===o?i:e):[...t,i]})};return l({id:o,folderName:e,collectionID:t,isHidden:n,canceller:null,total:0,success:0,failed:0,downloadDirPath:null}),l},tG=e=>async t=>{eC();try{V(!1);let n=(0,l8.Rb)(M,tk),i=e===ts.W6.REMOVE?n:n.filter(e=>e.ownerID===r.id);i.length>0&&await (0,ts.n5)(e,t,i,M.collectionID),tB(),await tX(!1,!0)}catch(t){Z.ZP.error("collection ops (".concat(e,") failed"),t),ew({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")})}finally{ex()}},tY=e=>{oR.Z.shouldAllowNewUpload()&&(e3(!0),e8(null!=e?e:"upload"))},tV=e=>{tv(null==e?void 0:e.id),tf("people")};return eE&&tk?(0,d.tZ)(aD.Provider,{value:{...aP,showPlanSelectorModal:()=>H(!0),setActiveCollectionID:eO,onShowCollection:e=>{tf("albums"),eO(e),tp(!1)},syncWithRemote:tX,setBlockingLoad:K,photoListHeader:tw,openExportModal:()=>{ti(!0)},authenticateUser:tc,userIDToEmailMap:eT,user:r,emailList:eD,openHiddenSection:e=>{tc(()=>{tf("hidden-albums"),eO(ts.zA),null==e||e()})},isClipSearchResult:tC,selectedFile:M,setSelectedFiles:U},children:(0,d.BX)(oS.Z,{getDragAndDropRootProps:el,children:[(0,d.tZ)(r9.l,{getDragAndDropInputProps:er,getFileSelectorInputProps:ec,getFolderSelectorInputProps:eu,getZipFileSelectorInputProps:eZ}),X&&(0,d.tZ)(oM.f,{children:(0,d.tZ)(ez.Z,{})}),N&&(0,d.tZ)(f.Tn,{children:(0,d.tZ)(m.Z,{color:"text.muted",variant:"small",children:(0,v.t)("INITIAL_LOAD_DELAY_WARNING")})}),(0,d.tZ)(ae,{modalView:F,closeModal:()=>H(!1),setLoading:K}),(0,d.tZ)(tt,{show:J,onHide:q.bind(null,!1),attributes:j}),(0,d.tZ)(tu,{open:Y,onClose:()=>{V(!1)},collectionSummaries:eE,attributes:z,collections:h}),(0,d.tZ)(id.yu,{attributesList:tb,setAttributesList:tE}),(0,d.tZ)(ox,{isOpen:eU,hide:()=>eF(!1),attributes:eH}),(0,d.tZ)(p.sD,{sx:{background:"transparent",position:"absolute",marginBottom:"12px"},children:"hidden-albums"==tg?(0,d.tZ)(aM,{onBack:()=>{tf("albums"),eO(ts.Ug)}}):(0,d.tZ)(aO,{openSidebar:()=>te(!0),openUploader:tY,isInSearchMode:td,onShowSearchInput:()=>tp(!0),onSelectSearchOption:e=>{let t=null==e?void 0:e.suggestion.type;"collection"==t||"person"==t?(tp(!1),tZ(void 0),"collection"==t?(tf("albums"),eO(e.suggestion.collectionID)):(tf("people"),tv(e.suggestion.person.id))):(tp(!!e),tZ(e)),tx("clip"==t)},onSelectPerson:tV})}),(0,d.tZ)(ij,{shouldHide:td,mode:tg,onChangeMode:tf,collectionSummaries:eE,activeCollection:tR,activeCollectionID:ek,setActiveCollectionID:eO,hiddenCollectionSummaries:e_,showPeopleSectionButton:void 0!==tA,people:null!==(l=null==tO?void 0:tO.people)&&void 0!==l?l:[],activePerson:null==tO?void 0:tO.activePerson,onSelectPerson:tV,setCollectionNamerAttributes:Q,setPhotoListHeader:ty,setFilesDownloadProgressAttributesCreator:tz,filesDownloadProgressAttributesList:tb}),(0,d.tZ)(r8.Z,{activeCollection:tR,syncWithRemote:tX,showCollectionSelector:V.bind(null,!0),closeUploadTypeSelector:e3.bind(null,!1),setCollectionSelectorAttributes:G,closeCollectionSelector:V.bind(null,!1),setLoading:K,setCollectionNamerAttributes:Q,setShouldDisableDropzone:ee,setFiles:T,setCollections:g,isFirstUpload:!(0,ts.Hl)(eE),dragAndDropFiles:ea,openFileSelector:es,fileSelectorFiles:ed,openFolderSelector:ep,folderSelectorFiles:eh,openZipFileSelector:eg,fileSelectorZipFiles:ef,uploadTypeSelectorIntent:e4,uploadTypeSelectorView:e5,showSessionExpiredMessage:tH}),(0,d.tZ)(rj,{collectionSummaries:eE,sidebarView:e7,closeSidebar:()=>te(!1)}),(0,d.tZ)(eM,{open:ei,onClose:()=>eo(!1)}),td||N||(null==_?void 0:_.length)||(null==P?void 0:P.length)||ek!==ts.Ug?td||N||"people"!=tg||(null==tO?void 0:tO.activePerson)?(0,d.tZ)(oU.Z,{page:eG.W.GALLERY,mode:tg,files:tk,syncWithRemote:tX,favItemIds:k,setSelected:U,selected:M,tempDeletedFileIds:tI,setTempDeletedFileIds:t_,setIsPhotoSwipeOpen:en,activeCollectionID:ek,activePersonID:null==tO?void 0:null===(e=tO.activePerson)||void 0===e?void 0:e.id,enableDownload:!0,fileToCollectionsMap:tU,collectionNameMap:tF,showAppDownloadBanner:_.length<30&&!td,isInHiddenSection:"hidden-albums"==tg,setFilesDownloadProgressAttributesCreator:tz,selectable:!0,onSelectPerson:e=>{tv(e),tf("people")}}):(0,d.tZ)(w,{}):(0,d.tZ)(oB,{openUploader:tY}),M.count>0&&M.collectionID===ek&&(0,d.tZ)(ab,{handleCollectionOps:tG,handleFileOps:e=>async()=>{eC();try{let t=(0,l8.Rb)(M,e===l8.j_.HIDE?_:tk),n=e===l8.j_.DOWNLOAD?t:t.filter(e=>e.ownerID===r.id);n.length>0&&await (0,l8.QG)(e,n,t_,tT,e0,tz),tB(),await tX(!1,!0)}catch(t){Z.ZP.error("file ops (".concat(e,") failed"),t),ew({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")})}finally{ex()}},showCreateCollectionModal:e=>{let t=async t=>{try{eC();let n=await (0,ta.mp)(t);await tG(e)(n)}catch(t){Z.ZP.error("create and collection ops (".concat(e,") failed"),t),ew({title:(0,v.t)("error"),close:{variant:"critical"},content:(0,v.t)("UNKNOWN_ERROR")})}finally{ex()}};return()=>Q({title:(0,v.t)("CREATE_COLLECTION"),buttonText:(0,v.t)("CREATE"),autoFilledName:"",callback:t})},setCollectionSelectorAttributes:G,count:M.count,ownCount:M.ownCount,clearSelection:tB,barMode:tg,activeCollectionID:ek,selectedCollection:(0,ts.IX)(M.collectionID,h),isFavoriteCollection:(null===(t=eE.get(ek))||void 0===t?void 0:t.type)=="favorites",isUncategorizedCollection:(null===(n=eE.get(ek))||void 0===n?void 0:n.type)=="uncategorized",isIncomingSharedCollection:(null===(i=eE.get(ek))||void 0===i?void 0:i.type)=="incomingShareCollaborator"||(null===(o=eE.get(ek))||void 0===o?void 0:o.type)=="incomingShareViewer",isInSearchMode:td,isInHiddenSection:"hidden-albums"==tg}),(0,d.tZ)(oc,{show:tn,onHide:()=>{ti(!1)},collectionNameMap:tF}),(0,d.tZ)(e6,{open:to,onClose:()=>tl(!1),onAuthenticate:tr.current})]})}):(0,d.tZ)("div",{})}let aL=e=>{let t=[];for(let n=1;n<=3;n++)t.push("".concat(e,"/").concat(n,"x.png ").concat(n,"x"));new Image().srcset=t.join(",")},ak=(e,t)=>{let n=new Map(e);return t.forEach((e,t)=>{n.set(t,e)}),n},aO=e=>{let{openSidebar:t,openUploader:n,...i}=e;return(0,d.BX)(d.HY,{children:[!i.isInSearchMode&&(0,d.tZ)(aN,{onClick:t}),(0,d.tZ)(es,{...i}),!i.isInSearchMode&&(0,d.tZ)(aB,{onClick:n})]})},aN=e=>(0,d.tZ)($.Z,{...e,children:(0,d.tZ)(e2.Z,{})}),aB=e=>{let t=!oR.Z.shouldAllowNewUpload(),n=(0,h.I)(),i=(0,d.tZ)(e1.Z,{});return(0,d.tZ)(q.Z,{children:n?(0,d.tZ)($.Z,{...e,disabled:t,children:i}):(0,d.tZ)(e5.Z,{...e,disabled:t,color:"secondary",startIcon:i,children:(0,v.t)("upload")})})},aM=e=>{let{onBack:t}=e;return(0,d.BX)(f.cD,{gap:"24px",sx:{width:"100%",background:e=>e.palette.background.default},children:[(0,d.tZ)($.Z,{onClick:t,children:(0,d.tZ)(e0.Z,{})}),(0,d.tZ)(f.A0,{children:(0,d.tZ)(m.Z,{children:(0,v.t)("section_hidden")})})]})}},77836:function(e,t,n){var i,o,l=n(10934),r=n(68351),a=n(56810),c=n(25683),s=n(29650),d=n(72751),u=n.n(d),p=n(24819);(i=o||(o={})).Buy="buy",i.Update="update";class h{async getPlans(){let e=(0,s.LP)();try{return(e?await a.Z.get(await (0,r.QH)("/billing/user-plans"),null,{"X-Auth-Token":(0,s.LP)()}):await a.Z.get(await (0,r.QH)("/billing/plans/v2"))).data}catch(e){l.ZP.error("failed to get plans",e)}}async syncSubscription(){try{let{subscription:e}=(await a.Z.get(await (0,r.QH)("/billing/subscription"),null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,e)}catch(e){l.ZP.error("failed to get user's subscription details",e)}}async buySubscription(e){try{let t=await (0,p.WO)();await this.redirectToPayments(t,e,"buy")}catch(e){throw l.ZP.error("unable to buy subscription",e),e}}async updateSubscription(e){try{let t=await (0,p.WO)();await this.redirectToPayments(t,e,"update")}catch(e){throw l.ZP.error("subscription update failed",e),e}}async cancelSubscription(){try{let{subscription:e}=(await a.Z.post(await (0,r.QH)("/billing/stripe/cancel-subscription"),null,null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,e)}catch(e){throw l.ZP.error("subscription cancel failed",e),e}}async activateSubscription(){try{let{subscription:e}=(await a.Z.post(await (0,r.QH)("/billing/stripe/activate-subscription"),null,null,{"X-Auth-Token":(0,s.LP)()})).data;(0,c.a_)(c.Pd.SUBSCRIPTION,e)}catch(e){throw l.ZP.error("failed to activate subscription",e),e}}async verifySubscription(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=(0,s.LP)();if(!t)return;let{subscription:n}=(await a.Z.post(await (0,r.QH)("/billing/verify-subscription"),{paymentProvider:"stripe",productID:null,verificationData:e},null,{"X-Auth-Token":t})).data;return(0,c.a_)(c.Pd.SUBSCRIPTION,n),n}catch(e){throw l.ZP.error("Error while verifying subscription",e),e}}async leaveFamily(){if((0,s.LP)())try{await a.Z.delete(await (0,r.QH)("/family/leave"),null,null,{"X-Auth-Token":(0,s.LP)()}),(0,c.NU)(c.Pd.FAMILY_DATA)}catch(e){throw l.ZP.error("/family/leave failed",e),e}}async redirectToPayments(e,t,n){try{let i=this.getRedirectURL();window.location.href="".concat((0,r.Fm)(),"?productID=").concat(t,"&paymentToken=").concat(e,"&action=").concat(n,"&redirectURL=").concat(i)}catch(e){throw l.ZP.error("unable to get payments url",e),e}}async redirectToCustomerPortal(){try{let e=this.getRedirectURL(),t=await a.Z.get(await (0,r.QH)("/billing/stripe/customer-portal"),{redirectURL:e},{"X-Auth-Token":(0,s.LP)()});window.location.href=t.data.url}catch(e){throw l.ZP.error("unable to get customer portal url",e),e}}getRedirectURL(){return u()()?"".concat((0,r.Fm)(),"/desktop-redirect"):"".concat(window.location.origin,"/gallery")}}t.Z=new h},23499:function(e,t,n){n.d(t,{CE:function(){return C},DH:function(){return B},Kc:function(){return y},SP:function(){return v},Uo:function(){return k},Wk:function(){return N},e4:function(){return A},ed:function(){return w},mF:function(){return R},py:function(){return I},to:function(){return b},w4:function(){return O},yB:function(){return Z}});var i=n(22969),o=n(10934),l=n(68351),r=n(77488),a=n(27949),c=n(56810),s=n(27588),d=n(22624);let u="public-collection-files",p="public-collections",h="public-referral-code",Z=e=>"".concat(e),g=e=>"public-".concat(e,"-time"),f=e=>"public-".concat(e,"-passkey"),m=e=>"public-".concat(e,"-uploaderName"),v=async e=>await s.Z.getItem(m(e)),A=async(e,t)=>await s.Z.setItem(m(e),t),C=async e=>((await s.Z.getItem(u)||[]).find(t=>t.collectionUID===e)||{collectionUID:null,files:[]}).files,x=async(e,t)=>{let n=await s.Z.getItem(u)||[];await s.Z.setItem(u,T([{collectionUID:e,files:t},...n]))},w=async e=>await s.Z.getItem(f(e))||"",y=async(e,t)=>await s.Z.setItem(f(e),t),b=async e=>(await s.Z.getItem(p)||[]).find(t=>t.key===e)||null,E=async e=>{var t;let n=null!==(t=await s.Z.getItem(p))&&void 0!==t?t:[];await s.Z.setItem(p,S([e,...n]))},I=async()=>await s.Z.getItem(h),_=async e=>{e||s.Z.removeItem(h),await s.Z.setItem(h,e)},S=e=>{let t=new Set([]);return e.filter(e=>!t.has(e.key)&&(t.add(e.key),!0))},T=e=>{let t=new Set([]);return e.filter(e=>{let{collectionUID:n}=e;return!t.has(n)&&(t.add(n),!0)})},P=async e=>{var t;return null!==(t=await s.Z.getItem(g(e)))&&void 0!==t?t:0},D=async(e,t)=>await s.Z.setItem(g(e),t),R=async(e,t,n,i)=>{try{var l,c;let s=[],u=null!==(c=null==n?void 0:null===(l=n.pubMagicMetadata)||void 0===l?void 0:l.data.asc)&&void 0!==c&&c,p=Z(e),h=await C(p);s=[...s,...h];try{if(!e)return(0,d.hE)(s,u);let o=await P(p);if(n.updationTime===o)return(0,d.hE)(s,u);let l=await L(e,t,n,o,s,i);s=[...s,...l];let a=new Map;for(let[e,t]of(s.forEach(e=>{let t="".concat(e.collectionID,"-").concat(e.id);(!a.has(t)||a.get(t).updationTime<e.updationTime)&&a.set(t,e)}),s=[],a))t.isDeleted||s.push(t);await x(p,s),await D(p,n.updationTime),i([...(0,d.hE)((0,r.SA)(s),u)])}catch(t){let e=(0,a.a3)(t);if(o.ZP.error("failed to sync shared collection files",t),e.message===a.sH.TOKEN_EXPIRED)throw t}return[...(0,d.hE)((0,r.SA)(s),u)]}catch(e){throw o.ZP.error("failed to get local  or sync shared collection files",e),e}},L=async(e,t,n,i,a,s)=>{try{var u,p;let o;let h=[],Z=i,g=null!==(p=null==n?void 0:null===(u=n.pubMagicMetadata)||void 0===u?void 0:u.data.asc)&&void 0!==p&&p;do{if(!e)break;o=await c.Z.get(await (0,l.QH)("/public-collection/diff"),{sinceTime:Z},{"Cache-Control":"no-cache","X-Auth-Access-Token":e,...t&&{"X-Auth-Access-Token-JWT":t}}),h=[...h,...await Promise.all(o.data.diff.map(async e=>e.isDeleted?e:await (0,d.np)(e,n.key)))],o.data.diff.length&&(Z=o.data.diff.slice(-1)[0].updationTime),s((0,d.hE)((0,r.SA)([...a||[],...h].filter(e=>!e.isDeleted)),g))}while(o.data.hasMore);return h}catch(e){throw o.ZP.error("Get public  files failed",e),e}},k=async(e,t)=>{try{var n,r;let o;if(!e)return;let a=await c.Z.get(await (0,l.QH)("/public-collection/info"),null,{"Cache-Control":"no-cache","X-Auth-Access-Token":e}),s=a.data.collection,d=null!==(r=a.data.referralCode)&&void 0!==r?r:"",u=await (0,i.Lb)(),p=s.name=s.name||await u.decryptToUTF8(s.encryptedName,s.nameDecryptionNonce,t);(null===(n=s.pubMagicMetadata)||void 0===n?void 0:n.data)&&(o={...s.pubMagicMetadata,data:await u.decryptMetadataJSON({encryptedDataB64:s.pubMagicMetadata.data,decryptionHeaderB64:s.pubMagicMetadata.header,keyB64:t})});let h={...s,name:p,key:t,pubMagicMetadata:o};return await E(h),await _(d),[h,d]}catch(e){throw o.ZP.error("failed to get public collection",e),e}},O=async(e,t)=>{try{return(await c.Z.post(await (0,l.QH)("/public-collection/verify-password"),{passHash:t},null,{"Cache-Control":"no-cache","X-Auth-Access-Token":e})).data.jwtToken}catch(e){throw o.ZP.error("failed to verify public collection password",e),e}},N=async(e,t)=>{let n=await s.Z.getItem(p)||[];await s.Z.setItem(p,n.filter(e=>e.key!==t)),await B(e)},B=async e=>{var t;await s.Z.removeItem(f(e)),await s.Z.removeItem(g(e));let n=null!==(t=await s.Z.getItem(u))&&void 0!==t?t:[];await s.Z.setItem(u,n.filter(t=>t.collectionUID!==e))}},79301:function(e,t,n){n.d(t,{Rr:function(){return f},lM:function(){return A},uo:function(){return v}});var i=n(10934),o=n(68351),l=n(71900),r=n(56810),a=n(27588),c=n(29650),s=n(22624),d=n(77636);let u="trash-time",p="deleted-collection";async function h(){let e=await a.Z.getItem(p)||[],t=e.filter(e=>!!e);return t.length!==e.length&&await a.Z.setItem(p,t),t}async function Z(e){let t=await h(),n=new Set(e.map(e=>e.file.collectionID)),i=t.filter(e=>n.has(e.id));await a.Z.setItem(p,i)}async function g(){var e;return null!==(e=await a.Z.getItem(u))&&void 0!==e?e:0}async function f(e,t){let n=await (0,l.up)(),i=new Map((e=[...e,...await h()]).map(e=>[e.id,e]));if(!(0,c.LP)())return;let o=await g();Z(await m(i,o,t,n))}let m=async(e,t,n,h)=>{try{let i,Z=[...h],g=t;do{let t=(0,c.LP)();if(!t)break;for(let n of(i=await r.Z.get(await (0,o.QH)("/trash/v2/diff"),{sinceTime:g},{"X-Auth-Token":t})).data.diff){let t=n.file.collectionID,i=e.get(t);if(i||(i=await (0,d._N)(t),e.set(t,i),a.Z.setItem(p,[...e.values()])),n.isDeleted||n.isRestored)Z=Z.filter(e=>e.file.id!==n.file.id);else{let e=await (0,s.np)(n.file,i.key);Z.push({...n,file:e})}}i.data.diff.length&&(g=i.data.diff.slice(-1)[0].updatedAt),n((0,l._V)(Z)),await a.Z.setItem(l.R4,Z),await a.Z.setItem(u,g)}while(i.data.hasMore);return Z}catch(e){i.ZP.error("Get trash files failed",e)}return h},v=async()=>{try{let e=(0,c.LP)();if(!e)return;let t=await g();await r.Z.post(await (0,o.QH)("/trash/empty"),{lastUpdatedAt:t},null,{"X-Auth-Token":e})}catch(e){throw i.ZP.error("empty trash failed",e),e}},A=async()=>{await a.Z.setItem(l.R4,[])}},41198:function(e,t,n){n.d(t,{F:function(){return o},k:function(){return c}});var i=n(10934);let o=e=>{try{return l(e)}catch(t){i.ZP.error("Could not extract date from file name ".concat(e),t);return}},l=e=>{let t;if((e=e.trim()).startsWith("IMG-")||e.startsWith("VID-"))t=a(e.split("-")[1]);else if(e.startsWith("Screenshot_"))t=a(e.replaceAll("Screenshot_",""));else if(e.startsWith("signal-")){let n=e.split("-");t=n.length>5?a("".concat(n[1]).concat(n[2]).concat(n[3],"-").concat(n[4]).concat(n[5]).concat(n[6])):a("".concat(n[1]).concat(n[2]).concat(n[3],"-").concat(n[4]))}if(t||(t=c(e)),!t||isNaN(t.getTime()))return;let n=1e3*t.getTime();return n===Date.UTC(0,0,0,0,0,0,0)||0===n?void 0:n>1e3*Date.now()?void 0:n},r=new Date().getFullYear(),a=e=>s({year:Number(e.slice(0,4)),month:Number(e.slice(4,6))-1,day:Number(e.slice(6,8)),hour:Number(e.slice(9,11)),minute:Number(e.slice(11,13)),second:Number(e.slice(13,15))}),c=e=>{var t;let[n,i,o,l,r,c]=null!==(t=e.match(/\d+/g))&&void 0!==t?t:[];return(null==n?void 0:n.length)==8&&(null==i?void 0:i.length)==6?a(n+"-"+i):s({year:Number(n),month:Number(i)-1,day:Number(o),hour:Number(l),minute:Number(r),second:Number(c)})},s=e=>{let t=p(e);if(h(e)&&!u(t,e)&&(t=p({...e,hour:0,minute:0,second:0})),!(!d(t,e)||1990>t.getFullYear()||t.getFullYear()>r+1))return t},d=(e,t)=>{let{year:n,month:i,day:o}=t;return e.getFullYear()===n&&e.getMonth()===i&&e.getDate()===o},u=(e,t)=>{let{hour:n,minute:i,second:o}=t;return e.getHours()===n&&e.getMinutes()===i&&e.getSeconds()===o},p=e=>{let{year:t,month:n,day:i,hour:o,minute:l,second:r}=e;return h(e)?new Date(t,n,i,o,l,r):new Date(t,n,i)},h=e=>{let{hour:t,minute:n,second:i}=e;return!isNaN(t)&&!isNaN(n)&&!isNaN(i)}},82870:function(e,t,n){n.d(t,{Gz:function(){return c},Ob:function(){return d},qg:function(){return u},RJ:function(){return s},gq:function(){return A},jN:function(){return h}});var i=n(50507),o=n(61917),l=n(10934),r=n(94102);let a=e=>{let t=parseInt(e,10);return Number.isNaN(t)?void 0:t},c=46,s=(e,t)=>{let n=t.slice(0,-5),i=n.match(/\(\d+\)$/);if(i){n=n.slice(0,-1*i[0].length);let[t,l]=(0,o.YA)(n);return"".concat(e,"-").concat(t).concat(i[0],".").concat(l)}return"".concat(e,"-").concat(n)},d=(e,t)=>"".concat(e,"-").concat(t.slice(0,c)),u=(e,t)=>"".concat(e,"-").concat(function(e){let t=null,[n,i]=(0,o.YA)(e);return t=n.endsWith(p)?n.slice(0,-1*p.length):n,i&&(t+="."+i),t}(t)),p="-edited",h=async e=>{try{return g(await Z(e))}catch(e){l.ZP.error("Failed to parse takeout metadata JSON",e);return}},Z=async e=>{if(e instanceof File)return await e.text();if("string"==typeof e)return await (0,i.M)().fs.readTextFile(e);if(!Array.isArray(e))return await e.file.text();{let{response:t}=await (0,r.o4)((0,i.M)(),e);return await t.text()}},g=e=>{var t,n;let i=JSON.parse(e);if(!i)return;let o={};return o.creationTime=null!==(t=f(i.photoTakenTime))&&void 0!==t?t:f(i.creationTime),o.modificationTime=f(i.modificationTime),o.location=null!==(n=m(i.geoData))&&void 0!==n?n:m(i.geoDataExif),o.description=v(i.description),o},f=e=>{if(e&&"object"==typeof e&&"timestamp"in e&&"string"==typeof e.timestamp){let t=a(e.timestamp);if(t)return 1e6*t}},m=e=>{if(e&&"object"==typeof e&&"latitude"in e&&"number"==typeof e.latitude&&"longitude"in e&&"number"==typeof e.longitude){let{latitude:t,longitude:n}=e;if(0!==t||0!==n)return{latitude:t,longitude:n}}},v=e=>e&&"string"==typeof e?e:void 0,A=(e,t,n)=>{let i=u(t,e),o=n.get(i);return!o&&i.length>c&&(i=d(t,e),o=n.get(i)),o}},33967:function(e,t,n){n.d(t,{Z:function(){return eH}});var i=n(22969),o=n(61917),l=n(10934),r=n(52721),a=n(57701),c=n(71900),s=n(96386),d=n(95033),u=n(8033),p=n(13413),h=n(27949),Z=n(72751),g=n.n(Z),f=n(23499),m=n(24819),v=n(16003),A=n(22624),C=n(82870),x=n(84836),w=n(50507),y=n(89600),b=n(69348),E=n(27677),I=n(60446),_=n(53102),S=n(94102),T=n(77636),P=n(28188),D=n(4129),R=n(41198),L=n(68351),k=n(56810),O=n(29650);class N{async uploadFile(e){try{let t=(0,O.LP)();if(!t)return;let n=await (0,L.QH)("/files");return(await U(()=>k.Z.post(n,e,null,{"X-Auth-Token":t}),h.a0)).data}catch(e){throw l.ZP.error("upload Files Failed",e),e}}async fetchUploadURLs(e,t){try{if(!this.uploadURLFetchInProgress)try{let n=(0,O.LP)();if(!n)return;for(let i of(this.uploadURLFetchInProgress=k.Z.get(await (0,L.QH)("/files/upload-urls"),{count:Math.min(50,2*e)},{"X-Auth-Token":n}),(await this.uploadURLFetchInProgress).data.urls))t.push(i)}finally{this.uploadURLFetchInProgress=null}return this.uploadURLFetchInProgress}catch(e){throw l.ZP.error("fetch upload-url failed ",e),e}}async fetchMultipartUploadURLs(e){try{let t=(0,O.LP)();if(!t)return;return(await k.Z.get(await (0,L.QH)("/files/multipart-upload-urls"),{count:e},{"X-Auth-Token":t})).data.urls}catch(e){throw l.ZP.error("fetch multipart-upload-url failed",e),e}}async putFile(e,t,n){try{return await U(()=>k.Z.put(e.url,t,null,null,n),h.a0),e.objectKey}catch(e){throw e.message!==h.sH.UPLOAD_CANCELLED&&l.ZP.error("putFile to dataStore failed ",e),e}}async putFileV2(e,t,n){try{let i=await (0,L.qw)();return await U(()=>k.Z.put("".concat(i,"/file-upload"),t,null,{"UPLOAD-URL":e.url},n)),e.objectKey}catch(e){throw e.message!==h.sH.UPLOAD_CANCELLED&&l.ZP.error("putFile to dataStore failed ",e),e}}async putFilePart(e,t,n){try{return(await U(async()=>{var i;let o=await k.Z.put(e,t,null,null,n);if(!(null==o?void 0:null===(i=o.headers)||void 0===i?void 0:i.etag)){let e=Error(h.sH.ETAG_MISSING);throw l.ZP.error("putFile in parts failed",e),e}return o},h.a0)).headers.etag}catch(e){throw e.message!==h.sH.UPLOAD_CANCELLED&&l.ZP.error("put filePart failed",e),e}}async putFilePartV2(e,t,n){try{let i=await (0,L.qw)();return(await U(async()=>{var o;let r=await k.Z.put("".concat(i,"/multipart-upload"),t,null,{"UPLOAD-URL":e},n);if(!(null==r?void 0:null===(o=r.data)||void 0===o?void 0:o.etag)){let e=Error(h.sH.ETAG_MISSING);throw l.ZP.error("putFile in parts failed",e),e}return r})).data.etag}catch(e){throw e.message!==h.sH.UPLOAD_CANCELLED&&l.ZP.error("put filePart failed",e),e}}async completeMultipartUpload(e,t){try{await U(()=>k.Z.post(e,t,null,{"content-type":"text/xml"}))}catch(e){throw l.ZP.error("put file in parts failed",e),e}}async completeMultipartUploadV2(e,t){try{let n=await (0,L.qw)();await U(()=>k.Z.post("".concat(n,"/multipart-complete"),t,null,{"content-type":"text/xml","UPLOAD-URL":e}))}catch(e){throw l.ZP.error("put file in parts failed",e),e}}constructor(){this.uploadURLFetchInProgress=null}}var B=new N;let M=[2e3,5e3,1e4];async function U(e,t){let n=async function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{return await e()}catch(o){if(t&&t(o),i<M.length)return await (0,p.Dc)(M[i]),await n(e,i+1);throw o}};return await n(e)}class F{async uploadFile(e,t,n){try{if(!t)throw Error(h.sH.TOKEN_MISSING);let i=await (0,L.QH)("/public-collection/file");return(await U(()=>k.Z.post(i,e,null,{"X-Auth-Access-Token":t,...n&&{"X-Auth-Access-Token-JWT":n}}),h.a0)).data}catch(e){throw l.ZP.error("upload public File Failed",e),e}}async fetchUploadURLs(e,t,n,i){try{if(!this.uploadURLFetchInProgress)try{if(!n)throw Error(h.sH.TOKEN_MISSING);for(let o of(this.uploadURLFetchInProgress=k.Z.get(await (0,L.QH)("/public-collection/upload-urls"),{count:Math.min(50,2*e)},{"X-Auth-Access-Token":n,...i&&{"X-Auth-Access-Token-JWT":i}}),(await this.uploadURLFetchInProgress).data.urls))t.push(o)}finally{this.uploadURLFetchInProgress=null}return this.uploadURLFetchInProgress}catch(e){throw l.ZP.error("fetch public upload-url failed ",e),e}}async fetchMultipartUploadURLs(e,t,n){try{if(!t)throw Error(h.sH.TOKEN_MISSING);return(await k.Z.get(await (0,L.QH)("/public-collection/multipart-upload-urls"),{count:e},{"X-Auth-Access-Token":t,...n&&{"X-Auth-Access-Token-JWT":n}})).data.urls}catch(e){throw l.ZP.error("fetch public multipart-upload-url failed",e),e}}constructor(){this.uploadURLFetchInProgress=null}}var H=new F,X=n(36066);let K=(e,t,n)=>{if(0==e||0==t)return{width:0,height:0};let i=Math.min(n/e,n/t),o={width:Math.round(e*i),height:Math.round(t*i)};return 0==o.width||0==o.height?{width:0,height:0}:o},W=async(e,t)=>t.fileType===r.Tv.image?await z(e,t):await j(e),z=async(e,t)=>{let{extension:n}=t;return("heic"==n||"heif"==n)&&(l.ZP.debug(()=>"Pre-converting HEIC to JPEG for thumbnail generation"),e=await (0,X.x)(e)),G(e)},G=async e=>{let t=document.createElement("canvas"),n=(0,u.zx)(t.getContext("2d")),i=URL.createObjectURL(e);return await (0,p.Fb)(new Promise((e,o)=>{let l=new Image;l.setAttribute("src",i),l.onload=()=>{try{URL.revokeObjectURL(i);let{width:o,height:r}=K(l.width,l.height,720);t.width=o,t.height=r,n.drawImage(l,0,0,o,r),e(void 0)}catch(e){o(e)}}}),3e4),await Y(t)},Y=async e=>{let t;let n=Number.MAX_SAFE_INTEGER,i=.7;do t&&(n=t.size),t=await new Promise(t=>{e.toBlob(e=>t(e),"image/jpeg",i)}),i-=.1;while(i>=.5&&t&&t.size>102400&&V(t.size,n)>=10);return new Uint8Array(await (0,u.zx)(t).arrayBuffer())},V=(e,t)=>(t-e)*100/t,j=async e=>{try{return await I.Py(e)}catch(t){return l.ZP.error("Failed to generate video thumbnail using the wasm FFmpeg web worker, will fallback to canvas",t),Q(e)}},Q=async e=>{let t=document.createElement("canvas"),n=(0,u.zx)(t.getContext("2d")),i=URL.createObjectURL(e);return await (0,p.Fb)(new Promise((e,o)=>{let l=document.createElement("video");l.preload="metadata",l.src=i,l.addEventListener("loadeddata",()=>{try{URL.revokeObjectURL(i);let{width:o,height:r}=K(l.videoWidth,l.videoHeight,720);t.width=o,t.height=r,n.drawImage(l,0,0,o,r),e(void 0)}catch(e){o(e)}})}),3e4),await Y(t)},J=async(e,t,n)=>n.fileType===r.Tv.image?await e.generateImageThumbnail((0,d.K2)(t),720,102400):I.NA(e,t),q=()=>Uint8Array.from(atob($),e=>e.charCodeAt(0)),$="/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCACWASwDAREAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD/AD/6ACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgD/9k=";class ee{init(e){this.publicUploadProps=e}async setFileCount(e){this.pendingUploadCount=e,await this.preFetchUploadURLs()}reducePendingUploadCount(){this.pendingUploadCount--}async getUploadURL(){return 0===this.uploadURLs.length&&this.pendingUploadCount&&await this.fetchUploadURLs(),this.uploadURLs.pop()}async preFetchUploadURLs(){try{await this.fetchUploadURLs()}catch(e){l.ZP.error("prefetch uploadURL failed",e),(0,h.a0)(e)}}async uploadFile(e){return this.publicUploadProps.accessedThroughSharedURL?H.uploadFile(e,this.publicUploadProps.token,this.publicUploadProps.passwordToken):B.uploadFile(e)}async fetchUploadURLs(){this.publicUploadProps.accessedThroughSharedURL?await H.fetchUploadURLs(this.pendingUploadCount,this.uploadURLs,this.publicUploadProps.token,this.publicUploadProps.passwordToken):await B.fetchUploadURLs(this.pendingUploadCount,this.uploadURLs)}async fetchMultipartUploadURLs(e){return this.publicUploadProps.accessedThroughSharedURL?await H.fetchMultipartUploadURLs(e,this.publicUploadProps.token,this.publicUploadProps.passwordToken):await B.fetchMultipartUploadURLs(e)}constructor(){this.uploadURLs=[],this.pendingUploadCount=0,this.publicUploadProps=void 0}}let et=new ee,en=e=>e instanceof File?e.name:"string"==typeof e?(0,o.EZ)(e):Array.isArray(e)?(0,o.EZ)(e[1]):e.file.name,ei=async(e,t,n)=>{let i,a;if(e.collectionID!=t.collectionID)return!1;let[c,s]=(0,o.YA)(e.fileName),[d,u]=(0,o.YA)(t.fileName);if(e.fileType==r.Tv.image&&t.fileType==r.Tv.video)i=eo(c,u?".".concat(u):void 0),a=eo(d);else{if(e.fileType!=r.Tv.video||t.fileType!=r.Tv.image)return!1;i=eo(c),a=eo(d,s?".".concat(s):void 0)}if(i!=a)return!1;let p=await el(e.uploadItem),h=await el(t.uploadItem);if(p>20971520||h>20971520)return l.ZP.info("Not classifying files with too large sizes (".concat(p," and ").concat(h," bytes) as a live photo")),!1;let Z=(0,C.gq)(e.fileName,e.collectionID,n),g=(0,C.gq)(t.fileName,t.collectionID,n),f=await er(e.uploadItem,e.fileType,Z),m=await er(t.uploadItem,t.fileType,g);return!!(f&&m&&Math.abs(f-m)/1e6<86400)||(!!Z||!!g)&&(!Z||!g)},eo=(e,t)=>{let n;let i="_HVEC";return e.endsWith("_3")?n="_3":e.endsWith(i)||e.endsWith(i.toLowerCase())?n=i:t&&(e.endsWith(t)||e.endsWith(t.toLowerCase()))&&(n=t),n?e.slice(0,-1*n.length):e},el=async e=>e instanceof File?e.size:"string"==typeof e||Array.isArray(e)?(0,w.M)().pathOrZipItemSize(e):e.file.size,er=async(e,t,n)=>{var i;let o;if(null==n?void 0:n.creationTime)return null==n?void 0:n.creationTime;if(t==r.Tv.image)o=await ef(e,void 0);else if(t==r.Tv.video)o=await em(e);else throw Error("Unexpected file type ".concat(t," for ").concat(e));return null==o?void 0:null===(i=o.creationDate)||void 0===i?void 0:i.timestamp},ea=async(e,t,n,i,o,r,a,c)=>{let{collection:s,localID:u,fileName:p,...Z}=e;l.ZP.info("Uploading ".concat(p));try{let{fileTypeInfo:e,fileSize:l,lastModifiedMs:p}=await es(Z);if(l>=4294967296)return{uploadResult:d.Le.TOO_LARGE};a();let{metadata:h,publicMagicMetadata:g}=await eh(Z,e,p,s.id,i,o),f=n.filter(e=>eA(e.metadata,h)),m=(null==f?void 0:f.length)>0?f[0]:void 0;if(m){let e=f.find(e=>e.collectionID==s.id);if(e)return{uploadResult:d.Le.ALREADY_UPLOADED,uploadedFile:e};{let e=Object.assign({},m);return e.collectionID=s.id,await (0,T.xo)(s,[e]),{uploadResult:d.Le.ADDED_SYMLINK,uploadedFile:e}}}a();let{fileStreamOrData:v,thumbnail:A,hasStaticThumbnail:C}=await ew(e,Z);C&&(h.hasStaticThumbnail=!0);let x=await eS({...g,uploaderName:t});a();let w=await eT({localID:u,fileStreamOrData:v,thumbnail:A,metadata:h,pubMagicMetadata:x},s.key,o);a();let y=await eR(w.file,c,r,a),b=await et.uploadFile({collectionID:s.id,encryptedKey:w.fileKey.encryptedData,keyDecryptionNonce:w.fileKey.nonce,...y});return{uploadResult:h.hasStaticThumbnail?d.Le.UPLOADED_WITH_STATIC_THUMBNAIL:d.Le.UPLOADED,uploadedFile:b}}catch(e){switch(e.message==h.sH.UPLOAD_CANCELLED?l.ZP.info("Upload for ".concat(p," cancelled")):e.message==h.sH.UNSUPPORTED_FILE_FORMAT?l.ZP.info("Not uploading ".concat(p,": unsupported file format")):l.ZP.error("Upload failed for ".concat(p),e),(0,h.a0)(e).message){case h.sH.ETAG_MISSING:return{uploadResult:d.Le.BLOCKED};case h.sH.UNSUPPORTED_FILE_FORMAT:return{uploadResult:d.Le.UNSUPPORTED};case h.sH.FILE_TOO_LARGE:return{uploadResult:d.Le.LARGER_THAN_AVAILABLE_STORAGE};default:return{uploadResult:d.Le.FAILED}}}},ec=async e=>{let t,n,i,o,l;if("string"==typeof e||Array.isArray(e)){let{response:n,size:l,lastModifiedMs:r}=await (0,S.o4)((0,w.M)(),e);t=n.body,i=l,o=r}else e instanceof File?n=e:n=e.file,t=n.stream(),i=n.size,o=n.lastModified;let r=x.kF,a=Math.ceil(i/x.kF),c=new TransformStream({async transform(e,t){let n;for(l?((n=new Uint8Array(l.length+e.length)).set(l),n.set(e,l.length),l=void 0):n=e;n.length>=r;)t.enqueue(n.slice(0,r)),n=n.slice(r);n.length&&(l=n)},flush(e){l&&e.enqueue(l)}});return{stream:t.pipeThrough(c),chunkCount:a,fileSize:i,lastModifiedMs:o,file:n}},es=async e=>{let{isLivePhoto:t,livePhotoAssets:n,uploadItem:i}=e;return t?ed(n):eu(i)},ed=async e=>{let{image:t,video:n}=e,i=await eu(t),o=await eu(n);return{fileTypeInfo:{fileType:r.Tv.livePhoto,extension:"".concat(i.fileTypeInfo.extension,"+").concat(o.fileTypeInfo.extension),imageType:i.fileTypeInfo.extension,videoType:o.fileTypeInfo.extension},fileSize:i.fileSize+o.fileSize,lastModifiedMs:i.lastModifiedMs}},eu=async e=>{let{stream:t,fileSize:n,lastModifiedMs:i}=await ec(e);return{fileTypeInfo:await (0,_.b)(async()=>{let e=t.getReader(),n=(0,u.zx)((await e.read()).value);return await e.cancel(),n},en(e)),fileSize:n,lastModifiedMs:i}},ep=async e=>new Uint8Array(await new Response(e).arrayBuffer()),eh=async(e,t,n,i,o,l)=>{let{isLivePhoto:r,uploadItem:a,livePhotoAssets:c}=e;return r?await eZ(c,t,n,i,o,l):await eg(a,t,n,i,o,l)},eZ=async(e,t,n,i,o,l)=>{let a={fileType:r.Tv.image,extension:t.imageType},{metadata:c,publicMagicMetadata:s}=await eg(e.image,a,n,i,o,l),d=await ev(e.video,l);return{metadata:{...c,title:en(e.image),fileType:r.Tv.livePhoto,imageHash:c.hash,videoHash:d,hash:void 0},publicMagicMetadata:s}},eg=async(e,t,n,i,o,l)=>{var a,c,s;let d,p;let h=en(e),{fileType:Z}=t;if(Z==r.Tv.image)d=await ef(e,n);else if(Z==r.Tv.video)d=await em(e);else throw Error("Unexpected file type ".concat(Z," for ").concat(e));let g=await ev(e,l),f=(0,C.gq)(h,i,o),m={},v=null!==(a=null==f?void 0:f.modificationTime)&&void 0!==a?a:1e3*n;if(null==f?void 0:f.creationTime)p=f.creationTime;else if(null==d?void 0:d.creationDate){let{dateTime:e,offset:t,timestamp:n}=d.creationDate;p=n,m.dateTime=e,t&&(m.offsetTime=t)}else p=null!==(c=(0,R.F)(h))&&void 0!==c?c:v;let A={fileType:Z,title:h,creationTime:(0,u.vU)(p),modificationTime:(0,u.vU)(v),hash:g},x=null!==(s=null==f?void 0:f.location)&&void 0!==s?s:null==d?void 0:d.location;if(x&&(A.latitude=(0,u.q9)(x.latitude),A.longitude=(0,u.q9)(x.longitude)),d){let{width:e,height:t}=d;e&&(m.w=(0,u.vU)(e)),t&&(m.h=(0,u.vU)(t))}let w=null==f?void 0:f.description;return w&&(m.caption=w),{metadata:A,publicMagicMetadata:m}},ef=async(e,t)=>{let n;if("string"==typeof e||Array.isArray(e)){let{response:i}=await (0,S.o4)((0,w.M)(),e),l="string"==typeof e?e:e[1];n=new File([await i.arrayBuffer()],(0,o.EZ)(l),t?{lastModified:t}:{})}else e instanceof File?n=e:n=e.file;try{return(0,E.mh)(n)}catch(t){l.ZP.error("Failed to extract image metadata for ".concat(e),t);return}},em=async e=>{try{return await I.gq(e)}catch(t){l.ZP.error("Failed to extract video metadata for ".concat(e),t);return}},ev=async(e,t)=>{let{stream:n,chunkCount:i}=await ec(e),o=await t.initChunkHashing(),l=n.getReader();for(let e=0;e<i;e++){let{done:e,value:n}=await l.read();if(e)throw Error("Less chunks than expected");await t.hashFileChunk(o,Uint8Array.from(n))}let{done:r}=await l.read();if(!r)throw Error("More chunks than expected");return await t.completeChunkHashing(o)},eA=(e,t)=>(0,b.L)(e)&&(0,b.L)(t)?eC(e,t):ex(e,t),eC=(e,t)=>e.fileType===t.fileType&&e.title===t.title&&(e.fileType===r.Tv.livePhoto?e.imageHash===t.imageHash&&e.videoHash===t.videoHash:e.hash===t.hash),ex=(e,t)=>e.fileType==t.fileType&&e.title==t.title&&1e6>Math.abs(e.creationTime-t.creationTime)&&1e6>Math.abs(e.modificationTime-t.modificationTime),ew=async(e,t)=>{let{isLivePhoto:n,uploadItem:i,livePhotoAssets:o}=t;return n?await ey(o,e):await eb(i,e)},ey=async(e,t)=>{let{fileStreamOrData:n,thumbnail:i,hasStaticThumbnail:o}=await e_(e.image,{extension:t.imageType,fileType:r.Tv.image},await ec(e.image)),l=await ec(e.video),c=async e=>{let t=async e=>{let{file:t,stream:n}=e;return t||await ep(n)};return e instanceof Uint8Array?e:t(e)};return{fileStreamOrData:await (0,a.k_)({imageFileName:en(e.image),imageFileOrData:await c(n),videoFileName:en(e.video),videoFileOrData:await c(l)}),thumbnail:i,hasStaticThumbnail:o}},eb=async(e,t)=>{let n=await ec(e);return e_(e,t,n)};class eE{constructor(){this.isNativeImageThumbnailGenerationNotAvailable=!1}}let eI=new eE,e_=async(e,t,n)=>{let i,o;let a=!1,c=globalThis.electron,s=t.fileType==r.Tv.image&&eI.isNativeImageThumbnailGenerationNotAvailable;if(c&&!s&&!(e instanceof File))try{o=await J(c,e,t)}catch(e){e.message.endsWith(y.S.NotAvailable)?eI.isNativeImageThumbnailGenerationNotAvailable=!0:l.ZP.error("Native thumbnail generation failed",e)}if(!o){let a;if(e instanceof File)a=e;else if(t.fileType==r.Tv.image){let e=await ep(n.stream);a=new Blob([e]),i=e}else l.ZP.warn("Not using browser based thumbnail generation fallback for video at path ".concat(e));try{a&&(o=await W(a,t))}catch(e){l.ZP.error("Web thumbnail creation failed",e)}}return o||(o=q(),a=!0),{fileStreamOrData:null!=i?i:n,thumbnail:o,hasStaticThumbnail:a}},eS=async e=>{var t;return(null===(t=Object.values((0,P.Yr)(e)))||void 0===t?void 0:t.length)===0?null:await (0,P.FA)(e)},eT=async(e,t,n)=>{let i;let{key:o,file:l}=await eP(e.fileStreamOrData,n),{encryptedData:r,decryptionHeader:a}=await n.encryptThumbnail(e.thumbnail,o),c=await n.encryptMetadataJSON({jsonValue:e.metadata,keyB64:o});if(e.pubMagicMetadata){let t=await n.encryptMetadataJSON({jsonValue:e.pubMagicMetadata.data,keyB64:o});i={version:e.pubMagicMetadata.version,count:e.pubMagicMetadata.count,data:t.encryptedDataB64,header:t.decryptionHeaderB64}}let s=await n.encryptToB64(o,t);return{file:{file:l,thumbnail:{encryptedData:r,decryptionHeader:a},metadata:c,pubMagicMetadata:i,localID:e.localID},fileKey:s}},eP=async(e,t)=>e instanceof Uint8Array?await t.encryptFile(e):await eD(e,t),eD=async(e,t)=>{let{stream:n,chunkCount:i}=e,o=n.getReader(),{key:l,decryptionHeader:r,pushState:a}=await t.initChunkEncryption(),c={pullCount:1};return{key:l,file:{decryptionHeader:r,encryptedData:{stream:new ReadableStream({async pull(e){let{value:n}=await o.read(),l=await t.encryptFileChunk(n,a,c.pullCount===i);e.enqueue(l),c.pullCount===i&&e.close(),c.pullCount++}}),chunkCount:i}}}},eR=async(e,t,n,i)=>{try{let o=null,l=e.file.encryptedData;if(l instanceof Uint8Array||!(l.chunkCount>=5)){let i=l instanceof Uint8Array?l:await ep(l.stream),r=t(e.localID),a=await et.getUploadURL();o=n?await B.putFile(a,i,r):await B.putFileV2(a,i,r)}else o=await eL(e.localID,l,t,n,i);let r=await et.getUploadURL(),a=null;return a=n?await B.putFile(r,e.thumbnail.encryptedData,null):await B.putFileV2(r,e.thumbnail.encryptedData,null),{file:{decryptionHeader:e.file.decryptionHeader,objectKey:o},thumbnail:{decryptionHeader:e.thumbnail.decryptionHeader,objectKey:a},metadata:{encryptedData:e.metadata.encryptedDataB64,decryptionHeader:e.metadata.decryptionHeaderB64},pubMagicMetadata:e.pubMagicMetadata}}catch(e){throw e.message!==h.sH.UPLOAD_CANCELLED&&l.ZP.error("Error when uploading to bucket",e),e}};async function eL(e,t,n,i,o){let l=Math.ceil(t.chunkCount/5),r=await et.fetchMultipartUploadURLs(l),{stream:a}=t,c=a.getReader(),s=(0,d.Pu)()/l,u=[];for(let[t,l]of r.partURLs.entries()){o();let r=await ek(c),a=n(e,s,t),d=null;d=i?await B.putFilePart(l,r,a):await B.putFilePartV2(l,r,a),u.push({PartNumber:t+1,ETag:d})}let{done:p}=await c.read();if(!p)throw Error("More chunks than expected");let h=r.completeURL,Z=D.js2xml({CompleteMultipartUpload:{Part:u}},{compact:!0,ignoreComment:!0,spaces:4});return i?await B.completeMultipartUpload(h,Z):await B.completeMultipartUploadV2(h,Z),r.objectKey}async function ek(e){let t=[];for(let n=0;n<5;n++){let{done:n,value:i}=await e.read();if(n)break;for(let e=0;e<i.length;e++)t.push(i[e])}return Uint8Array.from(t)}class eO{reset(){this.shouldUploadBeCancelled.value=!1}requestUploadCancelation(){this.shouldUploadBeCancelled.value=!0}isUploadCancelationRequested(){return this.shouldUploadBeCancelled.value}constructor(){this.shouldUploadBeCancelled={value:!1}}}let eN=new eO;class eB{init(e){this.progressUpdater=e,this.progressUpdater.setUploadStage(this.uploadStage),this.progressUpdater.setUploadFilenames(this.filenames),this.progressUpdater.setHasLivePhotos(this.hasLivePhoto),this.progressUpdater.setUploadProgressView(this.uploadProgressView),this.progressUpdater.setUploadCounter({finished:this.filesUploadedCount,total:this.totalFilesCount}),this.progressUpdater.setInProgressUploads(eM(this.inProgressUploads)),this.progressUpdater.setFinishedUploads(eU(this.finishedUploads))}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.setTotalFileCount(e),this.filesUploadedCount=0,this.inProgressUploads=new Map,this.finishedUploads=new Map,this.updateProgressBarUI()}setTotalFileCount(e){this.totalFilesCount=e,e>0?this.perFileProgress=100/this.totalFilesCount:this.perFileProgress=0}setFileProgress(e,t){this.inProgressUploads.set(e,t),this.updateProgressBarUI()}setUploadStage(e){this.uploadStage=e,this.progressUpdater.setUploadStage(e)}setFiles(e){let t=new Map(e.map(e=>[e.localID,e.fileName]));this.filenames=t,this.progressUpdater.setUploadFilenames(t)}setHasLivePhoto(e){this.hasLivePhoto=e,this.progressUpdater.setHasLivePhotos(e)}setUploadProgressView(e){this.uploadProgressView=e,this.progressUpdater.setUploadProgressView(e)}increaseFileUploaded(){this.filesUploadedCount++,this.updateProgressBarUI()}moveFileToResultList(e,t){this.finishedUploads.set(e,t),this.inProgressUploads.delete(e),this.updateProgressBarUI()}hasFilesInResultList(){return this.finishedUploads.size>0}updateProgressBarUI(){let{setPercentComplete:e,setUploadCounter:t,setInProgressUploads:n,setFinishedUploads:i}=this.progressUpdater;t({finished:this.filesUploadedCount,total:this.totalFilesCount});let o=this.perFileProgress*(this.finishedUploads.size||this.filesUploadedCount);if(this.inProgressUploads)for(let[e,t]of this.inProgressUploads)t<0||(o+=this.perFileProgress*t/100);e(o),n(eM(this.inProgressUploads)),i(eU(this.finishedUploads))}trackUploadProgress(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.Pu)(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i={exec:()=>{}},o=()=>i.exec(h.sH.REQUEST_TIMEOUT),l=()=>i.exec(h.sH.UPLOAD_CANCELLED),r=null,a=()=>{r&&clearTimeout(r),r=setTimeout(o,3e4)};return{cancel:i,onUploadProgress:i=>{this.inProgressUploads.set(e,Math.min(Math.round(t*n+t*i.loaded/i.total),98)),this.updateProgressBarUI(),i.loaded===i.total?clearTimeout(r):a(),eN.isUploadCancelationRequested()&&l()}}}constructor(){this.uploadStage=d.ps.START,this.filenames=new Map,this.hasLivePhoto=!1,this.uploadProgressView=!1,this.inProgressUploads=new Map,this.finishedUploads=new Map}}function eM(e){return[...e.entries()].map(e=>{let[t,n]=e;return{localFileID:t,progress:n}})}let eU=e=>{let t=new Map;for(let[n,i]of e)t.has(i)||t.set(i,[]),t.get(i).push(n);return t};class eF{async init(e,t,n,i){this.uiService.init(e);let o=await (0,m.ST)();o&&(i=o),this.isCFUploadProxyDisabled=i,et.init(n),this.setFiles=t,this.publicUploadProps=n}isUploadRunning(){return this.uploadInProgress}resetState(){this.itemsToBeUploaded=[],this.failedItems=[],this.parsedMetadataJSONMap=new Map,this.uploaderName=null}prepareForNewUpload(){this.resetState(),this.uiService.reset(),eN.reset(),this.uiService.setUploadStage(d.ps.START)}showUploadProgressDialog(){this.uiService.setUploadProgressView(!0)}async uploadItems(e,t,n){if(this.uploadInProgress)throw Error("Cannot run multiple uploads at once");l.ZP.info("Uploading ".concat(e.length," files")),this.uploadInProgress=!0,this.uploaderName=n;let i=setInterval(eG,1e3);try{await this.updateExistingFilesAndCollections(t);let n=e.map(eX);this.uiService.setFiles(n);let[i,o]=eK(n);if(i.length&&(this.uiService.setUploadStage(d.ps.READING_GOOGLE_METADATA_FILES),await this.parseMetadataJSONFiles(i)),o.length){let e=await ez(o,this.parsedMetadataJSONMap);this.abortIfCancelled(),this.uiService.setFiles(e),this.uiService.setHasLivePhoto(o.length!=e.length),await this.uploadMediaItems(e)}}catch(e){if(e.message!=h.sH.UPLOAD_CANCELLED)throw l.ZP.error("Upload failed",e),e}finally{var o,r;this.uiService.setUploadStage(d.ps.FINISH),null===(o=globalThis.electron)||void 0===o||o.clearPendingUploads();for(let e=0;e<4;e++)null===(r=this.comlinkCryptoWorkers[e])||void 0===r||r.terminate();this.uploadInProgress=!1,clearInterval(i)}return this.uiService.hasFilesInResultList()}async updateExistingFilesAndCollections(e){this.publicUploadProps.accessedThroughSharedURL?this.existingFiles=await (0,f.CE)((0,f.yB)(this.publicUploadProps.token)):this.existingFiles=(0,A.Zt)(await (0,c.dm)()),this.collections=new Map(e.map(e=>[e.id,e]))}async parseMetadataJSONFiles(e){for(let{uploadItem:t,fileName:n,collectionID:i}of(this.uiService.reset(e.length),e)){this.abortIfCancelled(),l.ZP.info("Parsing metadata JSON ".concat(n));let e=await (0,C.jN)((0,u.zx)(t));e&&(this.parsedMetadataJSONMap.set((0,C.RJ)(i,n),e),this.uiService.increaseFileUploaded())}}async uploadMediaItems(e){this.itemsToBeUploaded=[...this.itemsToBeUploaded,...e],this.uiService.reset(e.length),await et.setFileCount(e.length),this.uiService.setUploadStage(d.ps.UPLOADING);let t=[];for(let e=0;e<4&&this.itemsToBeUploaded.length>0;e++){this.comlinkCryptoWorkers[e]=(0,i.AL)();let n=await this.comlinkCryptoWorkers[e].remote;t.push(this.uploadNextItemInQueue(n))}await Promise.all(t)}async uploadNextItemInQueue(e){let t=this.uiService;for(;this.itemsToBeUploaded.length>0;){this.abortIfCancelled(),eG();let n=this.itemsToBeUploaded.pop(),{localID:i,collectionID:o}=n,l=this.collections.get(o),r={...n,collection:l};t.setFileProgress(i,0),await (0,p.Dc)(0);let{uploadResult:a,uploadedFile:c}=await ea(r,this.uploaderName,this.existingFiles,this.parsedMetadataJSONMap,e,this.isCFUploadProxyDisabled,()=>{this.abortIfCancelled()},(e,n,i)=>t.trackUploadProgress(e,n,i)),s=await this.postUploadTask(r,a,c);this.uiService.moveFileToResultList(i,s),this.uiService.increaseFileUploaded(),et.reducePendingUploadCount()}}async postUploadTask(e,t,n){let i=d.Le[t];l.ZP.info("Uploaded ".concat(e.fileName," with result ").concat(t," (").concat(i,")"));try{let i;let l=globalThis.electron;switch(l&&await eW(l,e),t){case d.Le.FAILED:case d.Le.BLOCKED:this.failedItems.push(e);break;case d.Le.ALREADY_UPLOADED:i=n;break;case d.Le.ADDED_SYMLINK:i=n,t=d.Le.UPLOADED;break;case d.Le.UPLOADED:case d.Le.UPLOADED_WITH_STATIC_THUMBNAIL:i=await (0,A.np)(n,e.collection.key);break;case d.Le.UNSUPPORTED:case d.Le.TOO_LARGE:break;default:throw Error("Invalid Upload Result ".concat(t))}if([d.Le.ADDED_SYMLINK,d.Le.UPLOADED,d.Le.UPLOADED_WITH_STATIC_THUMBNAIL].includes(t)){var o;let n=null!==(o=e.uploadItem)&&void 0!==o?o:e.livePhotoAssets.image;n&&(t==d.Le.UPLOADED||t==d.Le.UPLOADED_WITH_STATIC_THUMBNAIL)&&(0,s.z)(i,n),this.updateExistingFiles(i)}return await this.watchFolderCallback(t,e,n),t}catch(e){return l.ZP.error("failed to do post file upload action",e),d.Le.FAILED}}async watchFolderCallback(e,t,n){g()()&&v.Z.isUploadRunning()&&await v.Z.onFileUpload(e,t,n)}cancelRunningUpload(){l.ZP.info("User cancelled running upload"),this.uiService.setUploadStage(d.ps.CANCELLING),eN.requestUploadCancelation()}getFailedItemsWithCollections(){return{items:this.failedItems,collections:[...this.collections.values()]}}getUploaderName(){return this.uploaderName}updateExistingFiles(e){if(!e)throw Error("decrypted file can't be undefined");this.existingFiles.push(e),this.updateUIFiles(e)}updateUIFiles(e){this.setFiles(t=>(0,A.hE)([...t,e]))}constructor(){this.comlinkCryptoWorkers=[,,,,],this.isCFUploadProxyDisabled=!1,this.abortIfCancelled=()=>{if(eN.isUploadCancelationRequested())throw Error(h.sH.UPLOAD_CANCELLED)},this.shouldAllowNewUpload=()=>!this.uploadInProgress||v.Z.isUploadRunning(),this.uiService=new eB}}var eH=new eF;let eX=e=>({localID:(0,u.zx)(e.localID),collectionID:(0,u.zx)(e.collectionID),fileName:(0,u.zx)(e.isLivePhoto?en(e.livePhotoAssets.image):en(e.uploadItem)),isLivePhoto:e.isLivePhoto,uploadItem:e.uploadItem,livePhotoAssets:e.livePhotoAssets}),eK=e=>e.reduce((e,t)=>{let[n,i]=e;return"json"==(0,o.qN)(t.fileName)?n.push(t):i.push(t),[n,i]},[[],[]]),eW=async(e,t)=>{if(t.isLivePhoto){let[n,i]=[t.livePhotoAssets.image,t.livePhotoAssets.video];if(Array.isArray(n)&&Array.isArray(i))e.markUploadedZipItems([n,i]);else if("string"==typeof n&&"string"==typeof i)e.markUploadedFiles([n,i]);else if(n&&"object"==typeof n&&"path"in n&&i&&"object"==typeof i&&"path"in i)e.markUploadedFiles([n.path,i.path]);else throw Error("Attempting to mark upload completion of unexpected desktop upload items")}else{let n=(0,u.zx)(t.uploadItem);if(Array.isArray(n))e.markUploadedZipItems([n]);else if("string"==typeof n)e.markUploadedFiles([n]);else if(n&&"object"==typeof n&&"path"in n)e.markUploadedFiles([n.path]);else throw Error("Attempting to mark upload completion of unexpected desktop upload items")}},ez=async(e,t)=>{let n=[];e.sort((e,t)=>(0,o.YA)(e.fileName)[0].localeCompare((0,o.YA)(t.fileName)[0])).sort((e,t)=>e.collectionID-t.collectionID);let i=0;for(;i<e.length-1;){let o=e[i],l=e[i+1],c=(0,a.Ji)(o.fileName),s=(0,a.Ji)(l.fileName),d={fileName:o.fileName,fileType:c,collectionID:o.collectionID,uploadItem:o.uploadItem},u={fileName:l.fileName,fileType:s,collectionID:l.collectionID,uploadItem:l.uploadItem};if(await ei(d,u,t)){let[e,t]=c==r.Tv.image?[o,l]:[l,o];n.push({localID:o.localID,collectionID:o.collectionID,fileName:e.fileName,isLivePhoto:!0,livePhotoAssets:{image:e.uploadItem,video:t.uploadItem}}),i+=2}else n.push({...o,isLivePhoto:!1}),i+=1}return i===e.length-1&&n.push({...e[i],isLivePhoto:!1}),n},eG=()=>{if(!globalThis.electron)return;let e=performance.memory.totalJSHeapSize,t=performance.memory.jsHeapSizeLimit;e/t>.7&&l.ZP.info("Memory usage (".concat(e," bytes of ").concat(t," bytes) exceeds the high water mark"))}},16003:function(e,t,n){var i=n(50507),o=n(61917),l=n(10934),r=n(71900),a=n(95033),c=n(8033),s=n(36386),d=n.n(s),u=n(33967),p=n(22624),h=n(77636);class Z{init(e,t){this.upload=e,this.requestSyncWithRemote=t,this.registerListeners(),this.syncWithDisk()}isUploadRunning(){return this.uploadRunning}isSyncPaused(){return this.isPaused}pauseRunningSync(){this.isPaused=!0,u.Z.cancelRunningUpload()}resumePausedSync(){this.isPaused=!1,this.syncWithDisk()}async getWatches(){return await (0,i.M)().watch.get()}isSyncingFolder(e){var t;return(null===(t=this.activeWatch)||void 0===t?void 0:t.folderPath)==e}async addWatch(e,t){let n=await (0,i.M)().watch.add(e,t);return this.syncWithDisk(),n}async removeWatch(e){return await (0,i.M)().watch.remove(e)}async syncWithDisk(){try{let e=await this.getWatches();if(!e)return;this.eventQueue=[];let t=await f(e);l.ZP.info("Folder watch deduced ".concat(t.length," events")),this.eventQueue=this.eventQueue.concat(t),this.debouncedRunNextEvent()}catch(e){l.ZP.error("Ignoring error while syncing watched folders",e)}}pushEvent(e){this.eventQueue.push(e),l.ZP.info("Folder watch event",e),this.debouncedRunNextEvent()}registerListeners(){let e=(0,i.M)().watch;e.onAddFile((e,t)=>{this.pushEvent({action:"upload",collectionName:x(e,t),folderPath:t.folderPath,filePath:e})}),e.onRemoveFile((e,t)=>{this.pushEvent({action:"trash",collectionName:x(e,t),folderPath:t.folderPath,filePath:e})}),e.onRemoveDir((e,t)=>{e==t.folderPath&&(l.ZP.info("Received file system delete event for a watched folder at ".concat(e)),this.deletedFolderPaths.push(e))})}async runNextEvent(){if(0==this.eventQueue.length||this.activeWatch||this.isPaused)return;let e=e=>{l.ZP.info("Ignoring event since ".concat(e)),this.debouncedRunNextEvent()},t=this.dequeueClubbedEvent();l.ZP.info("Processing ".concat(t.action," event for folder watch ").concat(t.folderPath," (collectionName ").concat(t.collectionName,", ").concat(t.filePaths.length," files)"));let n=(await this.getWatches()).find(e=>e.folderPath==t.folderPath);if(!n){e("no folder watch for found for ".concat(t.folderPath));return}if("upload"===t.action){let i=m(t.filePaths,n);if(0==i.length){e("none of the files need uploading");return}this.activeWatch=n,this.uploadRunning=!0;let o=t.collectionName;l.ZP.info("Folder watch requested upload of ".concat(i.length," files to collection ").concat(o)),this.upload(o,i)}else{if(this.pruneFileEventsFromDeletedFolderPaths()){e("event was from a deleted folder path");return}let[o,l]=n.syncedFiles.reduce((e,n)=>{let[i,o]=e;return(t.filePaths.includes(n.path)?i:o).push(n),[i,o]},[[],[]]);this.activeWatch=n,await this.moveToTrash(o),await (0,i.M)().watch.updateSyncedFiles(l,n.folderPath),this.activeWatch=void 0,this.debouncedRunNextEvent()}}dequeueClubbedEvent(){let e=this.eventQueue.shift();if(!e)return;let t=[e.filePath];for(;this.eventQueue.length>0&&e.action===this.eventQueue[0].action&&e.folderPath===this.eventQueue[0].folderPath&&e.collectionName===this.eventQueue[0].collectionName;)t.push(this.eventQueue[0].filePath),this.eventQueue.shift();return{...e,filePaths:t}}async onFileUpload(e,t,n){[a.Le.ADDED_SYMLINK,a.Le.UPLOADED,a.Le.UPLOADED_WITH_STATIC_THUMBNAIL,a.Le.ALREADY_UPLOADED].includes(e)?t.isLivePhoto?(this.uploadedFileForPath.set((0,c.Zs)(t.livePhotoAssets.image),n),this.uploadedFileForPath.set((0,c.Zs)(t.livePhotoAssets.video),n)):this.uploadedFileForPath.set((0,c.Zs)(t.uploadItem),n):[a.Le.UNSUPPORTED,a.Le.TOO_LARGE].includes(e)&&(t.isLivePhoto?(this.unUploadableFilePaths.add((0,c.Zs)(t.livePhotoAssets.image)),this.unUploadableFilePaths.add((0,c.Zs)(t.livePhotoAssets.video))):this.unUploadableFilePaths.add((0,c.Zs)(t.uploadItem)))}async allFileUploadsDone(e,t){let n=(0,i.M)(),o=this.activeWatch;l.ZP.debug(()=>["watch/allFileUploadsDone",JSON.stringify({uploadItemsWithCollection:e,collections:t,watch:o})]);let{syncedFiles:r,ignoredFiles:a}=this.deduceSyncedAndIgnored(e);r.length>0&&await n.watch.updateSyncedFiles(o.syncedFiles.concat(r),o.folderPath),a.length>0&&await n.watch.updateIgnoredFiles(o.ignoredFiles.concat(a),o.folderPath),this.activeWatch=void 0,this.uploadRunning=!1,this.debouncedRunNextEvent()}deduceSyncedAndIgnored(e){let t=[],n=[],i=(e,n)=>{t.push({path:n,uploadedFileID:e.id,collectionID:e.collectionID}),this.uploadedFileForPath.delete(n)},o=e=>{l.ZP.debug(()=>"Permanently ignoring file at ".concat(e)),n.push(e),this.unUploadableFilePaths.delete(e)};for(let t of e)if(t.isLivePhoto){let e=(0,c.Zs)(t.livePhotoAssets.image),n=(0,c.Zs)(t.livePhotoAssets.video),l=this.uploadedFileForPath.get(e),r=this.uploadedFileForPath.get(n);l&&r?(i(l,e),i(r,n)):this.unUploadableFilePaths.has(e)&&this.unUploadableFilePaths.has(n)&&(o(e),o(n))}else{let e=(0,c.Zs)(t.uploadItem),n=this.uploadedFileForPath.get(e);n?i(n,e):this.unUploadableFilePaths.has(e)&&o(e)}return{syncedFiles:t,ignoredFiles:n}}pruneFileEventsFromDeletedFolderPaths(){let e=this.deletedFolderPaths.shift();return!!e&&(this.eventQueue=this.eventQueue.filter(t=>!t.filePath.startsWith(e)),!0)}async moveToTrash(e){let t=new Map;for(let n of e)t.set(n.uploadedFileID,n);let n=(await (0,r.dm)()).filter(e=>{let n=t.get(e.id);return!!n&&n.collectionID==e.collectionID});for(let[e,t]of(0,p.qF)(n).entries())await (0,h.uQ)(e,t);this.requestSyncWithRemote()}constructor(){this.eventQueue=[],this.deletedFolderPaths=[],this.uploadRunning=!1,this.isPaused=!1,this.uploadedFileForPath=new Map,this.unUploadableFilePaths=new Set,this.debouncedRunNextEvent=d()(()=>this.runNextEvent(),1e3)}}let g=new Z;t.Z=g;let f=async e=>{let t=(0,i.M)(),n=[];for(let i of e){let e=i.folderPath,o=await t.fs.findFiles(e);for(let t of m(o,i))n.push({action:"upload",folderPath:e,collectionName:x(t,i),filePath:t});for(let t of A(o,i))n.push({action:"trash",folderPath:e,collectionName:x(t,i),filePath:t})}return n},m=(e,t)=>e.filter(e=>!v(e)).filter(e=>!C(e,t)),v=e=>(0,o.EZ)(e).startsWith("."),A=(e,t)=>t.syncedFiles.map(e=>e.path).filter(t=>!e.includes(t)),C=(e,t)=>t.ignoredFiles.includes(e)||t.syncedFiles.find(t=>t.path===e),x=(e,t)=>"root"==t.collectionMapping?(0,o.EZ)(t.folderPath):w(e),w=e=>(0,o.EZ)((0,o.XX)(e))},95673:function(e,t,n){var i,o;n.d(t,{r:function(){return i}}),(o=i||(i={}))[o.upload=0]="upload",o[o.add=1]="add",o[o.move=2]="move",o[o.restore=3]="restore",o[o.unhide=4]="unhide"},77777:function(e,t,n){n.d(t,{u:function(){return l}});var i=n(24991);let o=new Intl.NumberFormat(i.ZP.language);function l(e){return o.format(e)}},38924:function(e,t,n){n.d(t,{Kz:function(){return r},Po:function(){return d},Rw:function(){return s},al:function(){return c},r:function(){return a}});var i=n(10934),o=n(52721),l=n(8033);async function r(e,t){e.paused&&(e.style.opacity=1,t.style.opacity=0,e.load(),e.play().catch(()=>{a(e,t)}))}async function a(e,t){e.paused||(e.pause(),e.style.opacity=0,t.style.opacity=1)}function c(e,t){e.w=window.innerWidth,e.h=window.innerHeight,e.msrc=t,e.isSourceLoaded=!1,e.conversionFailed=!1,e.isConverted=!1,e.metadata.fileType===o.Tv.image?e.src=t:e.html="\n            <div class = 'pswp-item-container'>\n                <img src=\"".concat(t,'"/>\n            </div>\n            ')}async function s(e,t,n){let{url:l,isRenderable:r,isOriginal:a}=t;if(e.w=window.innerWidth,e.h=window.innerHeight,e.isSourceLoaded=e.metadata.fileType!==o.Tv.livePhoto||"livePhoto"===t.type,e.isConverted=!a,e.conversionFailed=!r,e.srcURLs=t,!r){e.isSourceLoaded=!0;return}if(e.metadata.fileType===o.Tv.video)e.html="\n                <video controls ".concat(!n&&'controlsList="nodownload"',' onContextMenu="return false;">\n                    <source src="').concat(l,'" />\n                    Your browser does not support the video tag.\n                </video>\n                ');else if(e.metadata.fileType===o.Tv.livePhoto){if("normal"===t.type)e.html="\n                <div class = 'pswp-item-container'>\n                    <img id = \"live-photo-image-".concat(e.id,'" src="').concat(l,'" onContextMenu="return false;"/>\n                </div>\n                ');else{let{image:t,video:n}=l;e.html="\n            <div class = 'pswp-item-container'>\n                <img id = \"live-photo-image-".concat(e.id,'" src="').concat(t,'" onContextMenu="return false;"/>\n                <video id = "live-photo-video-').concat(e.id,'" loop muted onContextMenu="return false;">\n                    <source src="').concat(n,'" />\n                    Your browser does not support the video tag.\n                </video>\n            </div>\n            ')}}else e.metadata.fileType===o.Tv.image||i.ZP.error("unknown file type - ".concat(e.metadata.fileType)),e.src=l}let d=(e,t,n,i,o)=>(r,a,c)=>s=>{void 0!==c&&(s?o(c):o(void 0)),e(e=>{if(t){if(e.context){if(e.context.mode!=t)e={ownCount:0,count:0,collectionID:0,context:"people"==t?{mode:t,personID:(0,l.zx)(i)}:{mode:t,collectionID:(0,l.zx)(n)}};else{var o,c,d;(null===(o=e.context)||void 0===o?void 0:o.mode)=="people"?e.context.personID!=i&&(e={ownCount:0,count:0,collectionID:0,context:{mode:null===(c=e.context)||void 0===c?void 0:c.mode,personID:(0,l.zx)(i)}}):e.context.collectionID!=n&&(e={ownCount:0,count:0,collectionID:0,context:{mode:null===(d=e.context)||void 0===d?void 0:d.mode,collectionID:(0,l.zx)(n)}})}}else e={...e,context:"people"==t?{mode:t,personID:(0,l.zx)(i)}:{mode:t,collectionID:(0,l.zx)(n)}}}else e.collectionID!==n&&(e={ownCount:0,count:0,collectionID:0,context:void 0});let u=t?"people"==t?{mode:t,personID:(0,l.zx)(i)}:{mode:t,collectionID:(0,l.zx)(n)}:void 0,p=t=>e[r]===s?t:s?t+1:t-1;return{...e,[r]:s,collectionID:n,context:u,...a?{ownCount:p(e.ownCount),count:p(e.count)}:{count:p(e.count)}}})}},50846:function(e,t,n){n.d(t,{H:function(){return i}});let i=(0,n(2784).createContext)({token:null,passwordToken:null,referralCode:null,accessedThroughSharedURL:!1,photoListHeader:null,photoListFooter:null})},52437:function(e,t,n){n.d(t,{g:function(){return s}});var i=n(58034),o=n(62860),l=n(68351),r=n(8033),a=n(25683),c=n(50193);let s=async()=>{let e=await fetch(await (0,l.QH)("/users/session-validity/v2"),{headers:await (0,i.Qk)()});if(!e.ok){if(401==e.status)return{status:"invalid"};throw new i.Bb(e)}let t=await e.json();if("keyAttributes"in t&&"object"==typeof t.keyAttributes&&null!==t.keyAttributes){let e=t.keyAttributes,n=(0,o.Fd)().email,i=(0,r.zx)((0,a.Yu)(a.Pd.SRP_ATTRIBUTES)),l=await (0,c.O3)(n);if(l&&l.kekSalt!=i.kekSalt)return{status:"validButPasswordChanged",updatedKeyAttributes:e,updatedSRPAttributes:l}}return{status:"valid"}}},42721:function(e,t,n){n.d(t,{c:function(){return l}});var i=n(31572),o=n(92519);let l=(0,i.ZP)(o.ZP)(e=>{let{theme:t}=e;return{"& .MuiPaper-root":{maxWidth:"375px",width:"100%",scrollbarWidth:"thin",padding:t.spacing(1)}}})},85872:function(e,t,n){n.d(t,{Z:function(){return r}});var i=n(52903),o=n(31572),l=n(23179);n(2784);let r=(0,o.ZP)(e=>(0,i.tZ)(l.Z,{focusVisibleClassName:".Mui-focusVisible",disableRipple:!0,...e}))(e=>{let{theme:t}=e;return{width:40,height:24,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:"dark"===t.palette.mode?"#2ECA45":"#65C466",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:"light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:"light"===t.palette.mode?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:20,height:20},"& .MuiSwitch-track":{borderRadius:11,backgroundColor:"light"===t.palette.mode?"#E9E9EA":t.colors.fill.muted,opacity:1,transition:t.transitions.create(["background-color"],{duration:500})}}})},58792:function(e,t,n){n.d(t,{F_:function(){return c},GP:function(){return d},NP:function(){return s}});var i=n(52903),o=n(91430),l=n(42541),r=n(37862),a=n(31572);n(2784);let c=e=>{let{title:t,icon:n}=e;return(0,i.BX)(o.zr,{px:"8px",py:"6px",gap:"8px",sx:{"& > svg":{fontSize:"17px",color:e=>e.colors.stroke.muted}},children:[n&&n,(0,i.tZ)(l.Z,{variant:"small",color:"text.muted",children:t})]})},s=e=>{let{hasIcon:t}=e;return(0,i.tZ)(r.Z,{sx:{"&&&":{my:0,ml:t?"48px":"16px"}}})},d=(0,a.ZP)("div")(e=>{let{theme:t}=e;return"\n    & > .MuiMenuItem-root{\n        border-radius: 8px;\n        background-color: transparent;\n    }\n    & > .MuiMenuItem-root:not(:last-of-type) {\n        border-bottom-left-radius: 0;\n        border-bottom-right-radius: 0;\n    }\n    & > .MuiMenuItem-root:not(:first-of-type) {\n        border-top-left-radius: 0;\n        border-top-right-radius: 0;\n    }\n    background-color: ".concat(t.colors.fill.faint,";\n    border-radius: 8px;\n")})},81961:function(e,t,n){n.d(t,{b:function(){return d}});var i=n(52903),o=n(91430),l=n(37172),r=n(89668),a=n(53091),c=n(58488),s=n(42541);n(2784);let d=e=>{let{title:t,caption:n,onClose:d,backIsClose:u,actionButton:p,onRootClose:h}=e;return(0,i.BX)(i.HY,{children:[(0,i.BX)(o.A0,{height:48,alignItems:"center",justifyContent:"space-between",children:[(0,i.tZ)(a.Z,{onClick:d,color:u?"secondary":"primary",children:u?(0,i.tZ)(r.Z,{}):(0,i.tZ)(l.Z,{})}),(0,i.BX)(c.Z,{display:"flex",gap:"4px",children:[p&&p,!u&&(0,i.tZ)(a.Z,{onClick:h,color:"secondary",children:(0,i.tZ)(r.Z,{})})]})]}),(0,i.BX)(c.Z,{py:.5,px:2,children:[(0,i.tZ)(s.Z,{variant:"h3",fontWeight:"bold",children:t}),(0,i.tZ)(s.Z,{variant:"small",color:"text.muted",sx:{wordBreak:"break-all",minHeight:"17px"},children:n})]})]})}},52535:function(e,t,n){n.d(t,{I:function(){return l},T:function(){return r}});var i=n(27149),o=n(84001);let l=()=>(0,i.Z)((0,o.Z)().breakpoints.down("sm")),r=()=>(0,i.Z)("(hover: none) and (pointer: coarse)",{noSsr:!0})},69348:function(e,t,n){n.d(t,{L:function(){return i}});let i=e=>!!e.hash||!!e.imageHash&&!!e.videoHash},52939:function(e,t,n){n.d(t,{M:function(){return u},R:function(){return p}});var i=n(73235),o=n(52903),l=n(42541),r=n(96566),a=n(58488),c=n(31572),s=n(24991);function d(){let e=(0,i._)(["\n    width: 100%;\n    margin-bottom: 12px;\n"]);return d=function(){return e},e}n(2784);let u=e=>{let{name:t,nameProps:n,fileCount:i,endIcon:c}=e;return(0,o.BX)("div",{children:[(0,o.tZ)(l.Z,{variant:"h3",...null!=n?n:{},children:t}),(0,o.BX)(r.Z,{direction:"row",gap:1.5,sx:{minHeight:"24px"},children:[(0,o.tZ)(l.Z,{variant:"small",color:"text.muted",children:(0,s.t)("photos_count",{count:i})}),c&&(0,o.tZ)(a.Z,{sx:{svg:{fontSize:"17px",color:"text.muted"}},children:c})]})]})},p=(0,c.ZP)(a.Z)(d())},84951:function(e,t,n){n.d(t,{IA:function(){return y},X4:function(){return m},mU:function(){return C}});var i=n(73235),o=n(52903),l=n(52535),r=n(97222),a=n(96386),c=n(31572),s=n(42541),d=n(46854),u=n(24991),p=n(2784),h=n(61310);function Z(){let e=(0,i._)(["\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 5px;\n    margin-block-start: 12px;\n    margin-block-end: 15px;\n"]);return Z=function(){return e},e}function g(){let e=(0,i._)(["\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    align-items: center;\n    gap: 5px;\n    margin: 5px;\n"]);return g=function(){return e},e}function f(){let e=(0,i._)(["\n    width: 112px;\n    height: 112px;\n    margin: 5px;\n    border-radius: 50%;\n    overflow: hidden;\n    & > img {\n        width: 100%;\n        height: 100%;\n    }\n"]);return f=function(){return e},e}let m=e=>{let{people:t,onSelectPerson:n}=e,i=(0,l.I)();return(0,o.tZ)(v,{sx:{justifyContent:t.length>3?"center":"start"},children:t.slice(0,i?6:7).map(e=>(0,o.tZ)(A,{onClick:()=>n(e),children:(0,o.tZ)(E,{faceID:e.displayFaceID,enteFile:e.displayFaceFile,placeholderDimension:87})},e.id))})},v=(0,c.ZP)("div")(Z()),A=(0,c.ZP)(h.k)(e=>{let{theme:t}=e;return"\n    width: 87px;\n    height: 87px;\n    border-radius: 50%;\n    overflow: hidden;\n    & > img {\n        width: 100%;\n        height: 100%;\n    }\n    :hover {\n        outline: 1px solid ".concat(t.colors.stroke.faint,";\n        outline-offset: 2px;\n    }\n")}),C=e=>{let{enteFile:t,annotatedFaceIDs:n,onSelectFace:i}=e;return 0==n.length?(0,o.tZ)(o.HY,{}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(s.Z,{variant:"large",p:1,children:(0,u.t)("people")}),(0,o.tZ)(x,{children:n.map(e=>(0,o.tZ)(w,{onClick:()=>i(e),children:(0,o.tZ)(E,{faceID:e.faceID,enteFile:t,placeholderDimension:112})},e.faceID))})]})},x=(0,c.ZP)("div")(g()),w=(0,c.ZP)(h.k)(e=>{let{theme:t}=e;return"\n    width: 112px;\n    height: 112px;\n    border-radius: 50%;\n    overflow: hidden;\n    & > img {\n        width: 100%;\n        height: 100%;\n    }\n    :hover {\n        outline: 1px solid ".concat(t.colors.stroke.faint,";\n        outline-offset: 2px;\n    }\n")}),y=e=>{let{enteFile:t,faceIDs:n}=e;return 0==n.length?(0,o.tZ)(o.HY,{}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(s.Z,{variant:"large",p:1,children:(0,r.pt)("Other faces")}),(0,o.tZ)(x,{children:n.map(e=>(0,o.tZ)(b,{children:(0,o.tZ)(E,{placeholderDimension:112,enteFile:t,faceID:e})},e))})]})},b=(0,c.ZP)("div")(f()),E=e=>{let{faceID:t,enteFile:n,placeholderDimension:i}=e,[l,r]=(0,p.useState)();return(0,p.useEffect)(()=>{let e=!1;return(0,a.U_)(t,n).then(t=>!e&&r(t)),()=>{e=!0}},[t,n]),l?(0,o.tZ)("img",{style:{objectFit:"cover"},src:l}):(0,o.tZ)(d.Z,{variant:"circular",animation:"wave",sx:{backgroundColor:e=>e.colors.background.elevated2},width:i,height:i})}},98925:function(e,t,n){n.d(t,{Y:function(){return u}});var i=n(52903),o=n(51861),l=n(41633),r=n(10493),a=n(90740),c=n(28879),s=n.n(c),d=n(2784);let u=e=>{let{initialValue:t,disabled:n,onAccept:c,onClose:u}=e,[Z,g]=(0,d.useState)(!0),[f,m]=(0,d.useState)(s()(t));return(0,i.tZ)(l._,{dateAdapter:a.y,children:(0,i.tZ)(r.W,{value:f,onChange:e=>m(e),open:Z,onClose:()=>{g(!1),null==u||u()},onOpen:()=>g(!0),disabled:n,disableFuture:!0,orientation:"landscape",onAccept:e=>{if(!s().isDayjs(e))throw Error("Unexpected non-dayjs result ".concat(typeof e));c(h(e))},slots:{field:p},slotProps:{layout:{sx:{".MuiTimeClock-root":{minHeight:"336px"}}},dialog:{sx:{zIndex:o.g+2}}}})})},p=()=>(0,i.tZ)(i.HY,{}),h=e=>{let t,n;let i=e.format(),o=i.match(/Z|[+-]\d\d:?\d\d$/);if(null==o?void 0:o.index)t=i.substring(0,o.index),n=i.substring(o.index);else throw Error('Dayjs.format returned a string "'.concat(i,'" without a timezone offset'));return{dateTime:t,offset:n,timestamp:1e3*e.valueOf()}}},73832:function(e,t,n){n.d(t,{C3:function(){return l},Ho:function(){return o},dP:function(){return i},yc:function(){return r}});let i=4,o=180,l=180,r=4},51861:function(e,t,n){n.d(t,{g:function(){return i}});let i=1500},46082:function(e,t,n){n.d(t,{T:function(){return p},f:function(){return h}});var i=n(73235),o=n(52903),l=n(52721),r=n(91430),a=n(46467),c=n(70815),s=n(31572);function d(){let e=(0,i._)(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n"]);return d=function(){return e},e}n(2784);let u=(0,s.ZP)(r.aV)(d()),p=e=>(0,o.tZ)(u,{sx:e=>({backgroundColor:e.colors.fill.faint,borderWidth:"1px",borderStyle:"solid",borderColor:e.colors.stroke.faint,borderRadius:"4px","& > svg":{color:e.colors.stroke.muted,fontSize:"50px"}}),children:e.fileType!==l.Tv.video?(0,o.tZ)(a.Z,{}):(0,o.tZ)(c.Z,{})}),h=()=>(0,o.tZ)(r.aV,{sx:e=>({backgroundColor:e.colors.fill.faint,borderRadius:"4px"})})},61310:function(e,t,n){n.d(t,{k:function(){return l}});var i=n(73235);function o(){let e=(0,i._)(["\n    /* Reset some button defaults that are affecting us */\n    background: transparent;\n    border: 0;\n    padding: 0;\n\n    font: inherit;\n    /* We customized the letter spacing in the theme. Need to tell the button to\n       inherit that customization also. */\n    letter-spacing: inherit;\n\n    /* Default cursor on mouse over of a button is not a hand pointer */\n    cursor: pointer;\n"]);return o=function(){return e},e}let l=(0,n(31572).ZP)("button")(o())},40651:function(e,t,n){n.d(t,{s:function(){return l}});var i=n(52903),o=n(36236);let l=(0,n(2784).forwardRef)(function(e,t){return(0,i.tZ)(o.Z,{direction:"up",ref:t,...e})})},27677:function(e,t,n){n.d(t,{A:function(){return x},EK:function(){return d},RC:function(){return a},mh:function(){return r},nF:function(){return C}});var i=n(86617),o=n(53903),l=n(83282);let r=async e=>await C(e).then(a),a=e=>{let t=c(e),n=s(e),i=v(e),o=null!=i?i:{};return n&&(o.creationDate=n),t&&(o.location=t),o},c=e=>{var t,n;let i=null===(t=e.gps)||void 0===t?void 0:t.Latitude,o=null===(n=e.gps)||void 0===n?void 0:n.Longitude;return void 0!==i&&void 0!==o?{latitude:i,longitude:o}:void 0},s=e=>{var t,n;let{DateTimeOriginal:i,DateTimeDigitized:o,MetadataDate:l,DateTime:r}=u(e);return null!==(n=null!==(t=null!=i?i:o)&&void 0!==t?t:l)&&void 0!==n?n:r},d=e=>C(e).then(u),u=e=>{var t,n,i,o,l,r,a,c;let s=e=>(null==e?void 0:e.timestamp)?e:void 0,d=p(e),u=f(e),h=Z(e);return{DateTimeOriginal:null!==(i=null!==(n=null!==(t=s(h.DateTimeOriginal))&&void 0!==t?t:s(u.DateTimeOriginal))&&void 0!==n?n:s(d.DateTimeOriginal))&&void 0!==i?i:s(h.DateCreated),DateTimeDigitized:null!==(r=null!==(l=null!==(o=s(h.DateTimeDigitized))&&void 0!==o?o:s(u.DateTimeDigitized))&&void 0!==l?l:s(d.DateTimeDigitized))&&void 0!==r?r:s(h.CreateDate),DateTime:s(null!==(c=null!==(a=h.DateTime)&&void 0!==a?a:d.DateTime)&&void 0!==c?c:h.ModifyDate),MetadataDate:s(h.MetadataDate)}},p=e=>{let{exif:t}=e;return{DateTimeOriginal:h(null==t?void 0:t.DateTimeOriginal,null==t?void 0:t.SubSecTimeOriginal,null==t?void 0:t.OffsetTimeOriginal),DateTimeDigitized:h(null==t?void 0:t.DateTimeDigitized,null==t?void 0:t.SubSecTimeDigitized,null==t?void 0:t.OffsetTimeDigitized),DateTime:h(null==t?void 0:t.DateTime,null==t?void 0:t.SubSecTime,null==t?void 0:t.OffsetTime)}},h=(e,t,n)=>{var i,l,r;let[a]=null!==(i=null==e?void 0:e.value)&&void 0!==i?i:[];if(!a)return;let[c]=null!==(l=null==t?void 0:t.value)&&void 0!==l?l:[],[s]=null!==(r=null==n?void 0:n.value)&&void 0!==r?r:[];return(0,o.vJ)(a.replace(":","-").replace(":","-").replace(" ","T")+(c?"."+c:"")+(null!=s?s:""))},Z=e=>{let{xmp:t}=e;return{DateTimeOriginal:g(null==t?void 0:t.DateTimeOriginal),DateTimeDigitized:g(null==t?void 0:t.DateTimeDigitized),DateTime:g(null==t?void 0:t.DateTime),CreateDate:g(null==t?void 0:t.CreateDate),ModifyDate:g(null==t?void 0:t.ModifyDate),MetadataDate:g(null==t?void 0:t.MetadataDate),DateCreated:g(null==t?void 0:t.DateCreated)}},g=e=>{if(!e)return;let t=e.value;if("string"==typeof t)return(0,o.vJ)(t)},f=e=>{let{iptc:t}=e;return{DateTimeOriginal:m(null==t?void 0:t["Date Created"],null==t?void 0:t["Time Created"]),DateTimeDigitized:m(null==t?void 0:t["Digital Creation Date"],null==t?void 0:t["Digital Creation Time"])}},m=(e,t)=>{if(!e)return;let n=e.description;return t&&(n=n+"T"+t.description),(0,o.vJ)(n)},v=e=>{var t,n,i,o,l,r,a,c,s,d,u,p,h,Z,g,f,m,v,C,x,w,y,b,E,I,_,S,T,P,D,R,L,k,O,N;let B=(e,t)=>e&&t?{width:e,height:t}:void 0;return null!==(N=null!==(O=null!==(k=null!==(L=null!==(R=null!==(D=null!==(P=B(null===(n=e.exif)||void 0===n?void 0:null===(t=n.ImageWidth)||void 0===t?void 0:t.value,null===(o=e.exif)||void 0===o?void 0:null===(i=o.ImageLength)||void 0===i?void 0:i.value))&&void 0!==P?P:B(null===(r=e.exif)||void 0===r?void 0:null===(l=r.PixelXDimension)||void 0===l?void 0:l.value,null===(c=e.exif)||void 0===c?void 0:null===(a=c.PixelYDimension)||void 0===a?void 0:a.value))&&void 0!==D?D:B(A(null===(s=e.xmp)||void 0===s?void 0:s.ImageWidth),A(null===(d=e.xmp)||void 0===d?void 0:d.ImageLength)))&&void 0!==R?R:B(A(null===(u=e.xmp)||void 0===u?void 0:u.PixelXDimension),A(null===(p=e.xmp)||void 0===p?void 0:p.PixelYDimension)))&&void 0!==L?L:B(null===(Z=e.pngFile)||void 0===Z?void 0:null===(h=Z["Image Width"])||void 0===h?void 0:h.value,null===(f=e.pngFile)||void 0===f?void 0:null===(g=f["Image Height"])||void 0===g?void 0:g.value))&&void 0!==k?k:B(null===(v=e.gif)||void 0===v?void 0:null===(m=v["Image Width"])||void 0===m?void 0:m.value,null===(x=e.gif)||void 0===x?void 0:null===(C=x["Image Height"])||void 0===C?void 0:C.value))&&void 0!==O?O:B(null===(y=e.riff)||void 0===y?void 0:null===(w=y.ImageWidth)||void 0===w?void 0:w.value,null===(E=e.riff)||void 0===E?void 0:null===(b=E.ImageHeight)||void 0===b?void 0:b.value))&&void 0!==N?N:B(null===(_=e.file)||void 0===_?void 0:null===(I=_["Image Width"])||void 0===I?void 0:I.value,null===(T=e.file)||void 0===T?void 0:null===(S=T["Image Height"])||void 0===S?void 0:S.value)},A=e=>{if(!e)return;let t=e.value;if("string"!=typeof t)return;let n=parseInt(t,10);if(!isNaN(n))return n},C=async e=>{var t,n;if((0,i.iO)())throw Error("DOMParser is not available in web workers");let o=await l.ZP.load(await e.arrayBuffer(),{async:!0,expanded:!0});return delete o.Thumbnail,null===(t=o.exif)||void 0===t||delete t.Thumbnail,delete o.mpf,null===(n=o.xmp)||void 0===n||delete n._raw,o},x=e=>{var t,n;let i=e.value;return Array.isArray(i)?(null!==(t=i[0])&&void 0!==t?t:0)/(null!==(n=i[1])&&void 0!==n?n:1):i}},12256:function(e,t,n){n.d(t,{O5:function(){return r},e8:function(){return l},nS:function(){return a}});var i=n(24991);let o=["b","kb","mb","gb","tb"],l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(e/1073741824).toFixed(t)};function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(e<=0)return"0 ".concat((0,i.t)("storage_unit.mb"));let n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),o.length-1),l=o[n];return"".concat((e/Math.pow(1024,n)).toFixed(t)," ").concat((0,i.t)("storage_unit.".concat(l)))}let a=(e,t)=>{if(e<=0)return"0 ".concat((0,i.t)("storage_unit.mb"));let n=Math.min(Math.floor(Math.log(e)/Math.log(1024)),o.length-1),l=e/Math.pow(1024,n),r=o[n];return l>100&&n<o.length-2&&(l/=1024,r=o[n+1]),l=Number(l.toFixed(1)),e>=10737418240&&(l=(null==t?void 0:t.round)?Math.ceil(l):Math.round(l)),"".concat(l," ").concat((0,i.t)("storage_unit.".concat(r)))}},87283:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(52903),o=n(97335),l=n(85999),r=n(12214),a=n(4559),c=n(24991);function s(e){let{onClick:t}=e;return(0,i.tZ)(o.Z,{triggerButtonProps:{sx:{ml:1}},ariaControls:"export-option",triggerButtonIcon:(0,i.tZ)(a.Z,{}),children:(0,i.tZ)(l.x,{onClick:t,startIcon:(0,i.tZ)(r.Z,{}),children:(0,c.t)("CHANGE_FOLDER")})})}},92549:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(52903),o=n(40947),l=n(53819),r=n(35999),a=n(53091),c=n(24991),s=n(2784);function d(e){let{code:t,color:n,size:d}=e,[u,p]=(0,s.useState)(!1);return(0,i.tZ)(r.Z,{arrow:!0,open:u,title:(0,c.t)("COPIED"),PopperProps:{sx:{zIndex:2e3}},children:(0,i.tZ)(a.Z,{onClick:()=>{navigator.clipboard.writeText(t),p(!0),setTimeout(()=>p(!1),1e3)},color:n,children:u?(0,i.tZ)(l.Z,{fontSize:null!=d?d:"small"}):(0,i.tZ)(o.Z,{fontSize:null!=d?d:"small"})})})}},93727:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(73235),o=n(52903),l=n(98996),r=n(31572);n(2784);var a=n(92549),c=n(91430),s=n(58488);function d(){let e=(0,i._)(["\n    position: relative;\n    background: ",";\n    border-radius: ","px;\n    min-height: 80px;\n"]);return d=function(){return e},e}function u(){let e=(0,i._)(["\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    margin-top: ",";\n"]);return u=function(){return e},e}function p(){let e=(0,i._)(["\n    padding: 16px 36px 16px 16px;\n    border-radius: ","px;\n"]);return p=function(){return e},e}let h=(0,r.ZP)(c.Tn)(d(),e=>{let{theme:t}=e;return t.colors.accent.A700},e=>{let{theme:t}=e;return t.shape.borderRadius}),Z=(0,r.ZP)(s.Z)(u(),e=>{let{theme:t}=e;return t.spacing(1)}),g=(0,r.ZP)("div")(p(),e=>{let{theme:t}=e;return t.shape.borderRadius});function f(){let e=(0,i._)(["\n    word-break: break-word;\n    min-width: 30%;\n    text-align: left;\n"]);return f=function(){return e},e}function m(e){let{code:t,...n}=e;return t?(0,o.BX)(h,{...n,children:[(0,o.tZ)(g,{children:(0,o.tZ)(v,{children:t})}),(0,o.tZ)(Z,{children:(0,o.tZ)(a.Z,{code:t})})]}):(0,o.tZ)(h,{children:(0,o.tZ)(l.Z,{})})}let v=(0,r.ZP)("div")(f())},72754:function(e,t,n){n.d(t,{v:function(){return p}});var i=n(52903),o=n(85872),l=n(91430),r=n(42541);let a=e=>"critical"===e?"critical.main":"text.faint",c=e=>(0,i.BX)(l.zr,{gap:"4px",children:[(0,i.BX)(r.Z,{children:[" ",e.mainText]}),(0,i.tZ)(r.Z,{variant:"small",color:a(e.color),children:"•"}),e.subText?(0,i.tZ)(r.Z,{variant:"small",color:a(e.color),children:e.subText}):(0,i.tZ)(r.Z,{variant:"small",color:a(e.color),children:e.subIcon})]});var s=n(87283),d=n(71951),u=n(58488);n(2784);let p=e=>{let{onClick:t,color:n="primary",startIcon:a,endIcon:p,label:h,subText:Z,subIcon:g,checked:f,variant:m="primary",fontWeight:v="bold",labelComponent:A,disabled:C=!1}=e,x=()=>{("path"===m||"toggle"===m)&&t()},w=null!=h?h:"";return(0,i.tZ)(d.Z,{disabled:C,onClick:()=>{"path"!==m&&"toggle"!==m&&t()},disableRipple:"toggle"==m,sx:{width:"100%",color:e=>"captioned"!==m?e.palette[n].main:"inherit",backgroundColor:e=>"secondary"!==m&&"mini"!==m?e.colors.fill.faint:"inherit","&:hover":{backgroundColor:e=>e.colors.fill.faintPressed},"& .MuiSvgIcon-root":{fontSize:"20px"},p:0,borderRadius:"4px"},children:(0,i.BX)(l.Gm,{sx:{pl:"16px",pr:"12px"},children:[(0,i.BX)(l.zr,{sx:{py:"14px"},gap:"10px",children:[a&&a,(0,i.tZ)(u.Z,{px:"2px",children:A||("captioned"===m?(0,i.tZ)(c,{color:n,mainText:w,subText:Z,subIcon:g}):"mini"===m?(0,i.tZ)(r.Z,{variant:"mini",color:"text.muted",children:w}):(0,i.tZ)(r.Z,{fontWeight:v,children:w}))})]}),(0,i.BX)(l.zr,{gap:"4px",children:[p&&p,"toggle"===m&&(0,i.tZ)(o.Z,{checked:f,onClick:x}),"path"===m&&(0,i.tZ)(s.Z,{onClick:x})]})]})})}},11478:function(e,t,n){n.d(t,{j:function(){return i}});let i=(0,n(2784).createContext)({close:()=>{}})},97335:function(e,t,n){n.d(t,{Z:function(){return p},l:function(){return u}});var i=n(73235),o=n(52903),l=n(31572),r=n(53091),a=n(53968),c=n(2784),s=n(11478);function d(){let e=(0,i._)(["\n    & .MuiPaper-root {\n        margin: 16px auto;\n        box-shadow:\n            0px 0px 6px rgba(0, 0, 0, 0.16),\n            0px 3px 6px rgba(0, 0, 0, 0.12);\n    }\n    & .MuiList-root {\n        padding: 0;\n        border: none;\n    }\n"]);return d=function(){return e},e}let u=(0,l.ZP)(a.Z)(d());function p(e){let{children:t,ariaControls:n,triggerButtonIcon:i,triggerButtonProps:l,menuPaperProps:a}=e,[d,p]=(0,c.useState)(null),h=()=>p(null);return(0,o.BX)(s.j.Provider,{value:{close:h},children:[(0,o.tZ)(r.Z,{onClick:e=>p(e.currentTarget),"aria-controls":d?n:void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,...l,children:i}),(0,o.tZ)(u,{id:n,anchorEl:d,open:!!d,onClose:h,MenuListProps:{disablePadding:!0,"aria-labelledby":n},PaperProps:a,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t})]})}},85999:function(e,t,n){n.d(t,{x:function(){return d}});var i=n(52903),o=n(91430),l=n(71951),r=n(58488),a=n(42541),c=n(2784),s=n(11478);function d(e){let{onClick:t,color:n="primary",startIcon:d,endIcon:u,keepOpenAfterClick:p,centerAlign:h,children:Z}=e,g=(0,c.useContext)(s.j);return(0,i.BX)(l.Z,{onClick:()=>{t(),p||g.close()},sx:{minWidth:220,color:e=>e.palette[n].main,padding:1.5,"& .MuiSvgIcon-root":{fontSize:"20px"}},children:[(0,i.BX)(o.G5,{children:[d&&(0,i.tZ)(r.Z,{sx:{padding:0,marginBlockStart:h?"6px":0,marginRight:1.5},children:d}),(0,i.tZ)(a.Z,{fontWeight:"bold",children:Z})]}),u&&(0,i.tZ)(r.Z,{sx:{padding:0,marginLeft:1},children:u})]})}},80458:function(e,t,n){var i=n(52903),o=n(52535),l=n(8033),r=n(93727),a=n(99408),c=n(38045),s=n(24570),d=n(22711),u=n(38898),p=n(42541),h=n(17699),Z=n(10222),g=n(31572),f=n(58488),m=n(36832),v=n(24991),A=n(2784);m.setDefaultWordlist("english"),t.Z=function(e){let{somethingWentWrong:t,...n}=e,[g,f]=(0,A.useState)(null),x=(0,o.I)();return(0,A.useEffect)(()=>{n.show&&(async()=>{try{let e=await (0,c.yr)();f(m.entropyToMnemonic(e))}catch(e){t(),n.onHide()}})()},[n.show]),(0,i.BX)(d.Z,{fullScreen:x,open:n.show,onClose:n.onHide,maxWidth:"xs",fullWidth:!0,children:[(0,i.tZ)(a.Z,{onClose:n.onHide,children:(0,v.t)("recovery_key")}),(0,i.BX)(u.Z,{children:[(0,i.tZ)(p.Z,{mb:3,children:(0,v.t)("RECOVERY_KEY_DESCRIPTION")}),(0,i.BX)(C,{children:[(0,i.tZ)(r.Z,{code:g}),(0,i.tZ)(p.Z,{m:2,children:(0,v.t)("KEY_NOT_STORED_DISCLAIMER")})]})]}),(0,i.BX)(h.Z,{children:[(0,i.tZ)(Z.Z,{color:"secondary",size:"large",onClick:n.onHide,children:(0,v.t)("do_this_later")}),(0,i.tZ)(Z.Z,{color:"accent",size:"large",onClick:function(){(0,s.KG)("ente-recovery-key.txt",(0,l.zx)(g)),n.onHide()},children:(0,v.t)("save_key")})]})]})};let C=(0,g.ZP)(f.Z)(e=>{let{theme:t}=e;return{border:"1px dashed ".concat(t.palette.grey.A400),borderRadius:t.spacing(1)}})},21678:function(e,t,n){n.d(t,{Z:function(){return d}});var i=n(52903),o=n(22969),l=n(10934),r=n(84381),a=n(24991),c=n(50006),s=n(27949);function d(e){let{user:t,keyAttributes:n,srpAttributes:d,callback:u,buttonText:p,submitButtonProps:h,getKeyAttributes:Z}=e,g=async(e,t)=>{try{let t;let i=await (0,o.Lb)();try{if(d)t=await i.deriveKey(e,d.kekSalt,d.opsLimit,d.memLimit);else if(n)t=await i.deriveKey(e,n.kekSalt,n.opsLimit,n.memLimit);else throw Error("Both SRP and key attributes are missing")}catch(e){throw l.ZP.error("failed to derive key",e),Error(s.sH.WEAK_DEVICE)}if(n||"function"!=typeof Z||(n=await Z(t)),!n)throw Error("couldn't get key attributes");try{let o=await i.decryptB64(n.encryptedKey,n.keyDecryptionNonce,t);u(o,t,n,e)}catch(e){throw l.ZP.error("user entered a wrong password",e),Error(s.sH.INCORRECT_PASSWORD)}}catch(e){if(e instanceof Error){if(e.message===s.sH.TWO_FACTOR_ENABLED)return;switch(l.ZP.error("failed to verify passphrase",e),e.message){case s.sH.WEAK_DEVICE:t((0,a.t)("WEAK_DEVICE"));break;case s.sH.INCORRECT_PASSWORD:t((0,a.t)("INCORRECT_PASSPHRASE"));break;default:t("".concat((0,a.t)("UNKNOWN_ERROR")," ").concat(e.message))}}}};return(0,i.tZ)(c.Z,{callback:g,placeholder:(0,a.t)("password"),buttonText:p,submitButtonProps:h,hiddenPreInput:(0,i.tZ)(r.Z,{sx:{display:"none"},id:"email",name:"email",autoComplete:"username",type:"email",value:null==t?void 0:t.email}),autoComplete:"current-password",fieldType:"password"})}},46794:function(e,t,n){n.d(t,{e:function(){return o}});var i=n(2784);let o=e=>{let{directory:t,accept:n}=e,[o,l]=(0,i.useState)([]),r=(0,i.useRef)(),a=(0,i.useCallback)(()=>{r.current&&(r.current.value=null,r.current.click())},[]),c=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.files;n&&l([...n])},s=t?{directory:"",webkitdirectory:""}:{};return{getInputProps:(0,i.useCallback)(()=>({type:"file",multiple:!0,style:{display:"none"},...s,ref:r,onChange:c,...n?{accept:n}:{}}),[s,n,c]),openSelector:a,selectedFiles:o}}},96269:function(e,t,n){n.d(t,{Z:function(){return o}});var i=n(2784);function o(e,t){let[n,o]=(0,i.useState)(null),l=(0,i.useRef)(!1),r=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{let t=async()=>{if(l.current){r.current=!0;return}l.current=!0;let n=e();n&&"function"==typeof n.then?o(await n):o(n),l.current=!1,r.current&&(r.current=!1,setTimeout(t,0))};t()},t),n}},37653:function(e,t,n){n.d(t,{mr:function(){return c},o0:function(){return s},p6:function(){return a}});var i=n(24991);let o=new Intl.DateTimeFormat(i.ZP.language,{weekday:"short",month:"short",day:"numeric"}),l=new Intl.DateTimeFormat(i.ZP.language,{year:"numeric"}),r=new Intl.DateTimeFormat(i.ZP.language,{timeStyle:"short"});function a(e){return[o,new Date().getFullYear()===new Date(e).getFullYear()?null:l].filter(e=>!!e).map(t=>t.format(e)).join(" ")}function c(e){return r.format(e).toUpperCase()}function s(e){return[a(e),(0,i.t)("at"),c(e)].join(" ")}}}]);