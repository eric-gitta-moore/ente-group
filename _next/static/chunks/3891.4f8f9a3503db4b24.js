!function(){var e,t,a,n,r,i,o={60373:function(e,t,a){"use strict";a.d(t,{SL:function(){return n}}),a(93542).env.desktopAppVersion;let n="io.ente.photos.web"},86617:function(e,t,a){"use strict";a.d(t,{iO:function(){return r},lE:function(){return n}});let n=!1,r=()=>"function"==typeof importScripts},59545:function(e,t,a){"use strict";a.d(t,{j:function(){return n}});let n=(0,a(90758).Ud)(globalThis)},93891:function(e,t,a){"use strict";let n,r;var i,o,c,l,s=a(60373),u=a(8033),d=a(30195),p=a(18762),f=a(10934);let h=async()=>{let e=await (0,p.X3)("kv",1,{upgrade(e){e.createObjectStore("kv")},blocking(){f.ZP.info("Another client is attempting to open a new version of KV DB"),e.close(),n=void 0},blocked(){f.ZP.warn("Waiting for an existing client to close their connection so that we can update the KV DB version")},terminated(){f.ZP.warn("Our connection to KV DB was unexpectedly terminated"),n=void 0}});return e},y=()=>null!=n?n:n=h(),m=async e=>(await y()).get("kv",e),w=async(e,t)=>{let a=await y(),n=await a.get("kv",e);if(void 0!==n){if(typeof n!=t)throw Error("Expected the value corresponding to key ".concat(e," to be a ").concat(t,", but instead got ").concat(String(n)));return n}},g=async e=>w(e,"string"),b=async e=>w(e,"number"),v=async(e,t)=>{let a=await y();await a.put("kv",t,e)};d.z.object({id:d.z.number(),email:d.z.string(),token:d.z.string()});let z=async()=>(0,u.zx)(await g("token")),k=async()=>({"X-Auth-Token":await z(),"X-Client-Package":s.SL});class T extends Error{constructor(e){let t=new URL(e.url);t.search="",super("Fetch failed: ".concat(t.href,": HTTP ").concat(e.status," ").concat(e.statusText)),Error.captureStackTrace&&Error.captureStackTrace(this,T),this.name=this.constructor.name,this.res=e}}let j=e=>{if(!e.ok)throw new T(e)};var P=a(50507),S=a(90758);class x{terminate(){this.worker.terminate(),f.ZP.debug(()=>"Terminated ".concat(this.name," web worker"))}constructor(e,t){this.name=e,this.worker=t,t.onerror=t=>{f.ZP.error("Got error event from worker: ".concat(JSON.stringify({event:t,name:e})))},f.ZP.debug(()=>"Created ".concat(e," web worker"));let a=(0,S.Ud)(t);this.remote=new a,(0,S.Jj)(D,t)}}let D={logToDisk:f.Q2,convertToJPEG:e=>(0,P.M)().convertToJPEG(e)};var O=a(86617),F=a(84836);let M=F.L7;F.jK,F.hk,F.L$;let E=F.ZN,B=F.KL;F.WF;let L=async(e,t)=>JSON.parse(new TextDecoder().decode(await B(e,t))),C=async e=>L({encryptedData:e.encryptedDataB64,decryptionHeader:e.decryptionHeaderB64},e.keyB64),I=async()=>(null!=r?r:r=N()).remote,N=()=>new x("crypto",new Worker(a.tu(new URL(a.p+a.u(8354),a.b))));F.eT;let A=F.nE,_=(e,t)=>(0,O.iO)()?M(e,t):I().then(a=>a.encryptBoxB64(e,t)),U=(e,t)=>(0,O.iO)()?E(e,t):I().then(a=>a.decryptBoxB64(e,t)),J=(e,t)=>(0,O.iO)()?B(e,t):I().then(a=>a.decryptBlob(e,t)),R=e=>(0,O.iO)()?C(e):I().then(t=>t.decryptMetadataJSON(e));a(93542);let K=async()=>{var e;return null!==(e=await H())&&void 0!==e?e:"https://api.ente.io"},Z=async(e,t)=>{let a=await K()+e;if(t){let e=new URLSearchParams(t);a="".concat(a,"?").concat(e.toString())}return a},H=async()=>{var e,t;return null!==(t=null!==(e=await g("apiOrigin"))&&void 0!==e?e:"https://ente.tianhaoltd.top/api")&&void 0!==t?t:void 0};a(59545),(i=c||(c={}))[i.image=0]="image",i[i.video=1]="video",i[i.livePhoto=2]="livePhoto",i[i.other=3]="other",a(27949),a(5025);let Y=e=>{var t;return"file ".concat(null!==(t=e.metadata.title)&&void 0!==t?t:"-"," (").concat(e.id,")")};var V=a(93275);(o=l||(l={}))[o.visible=0]="visible",o[o.archived=1]="archived",o[o.hidden=2]="hidden";let G=d.z.object({editedTime:d.z.number().optional()}).passthrough(),W=async e=>{let t=e.pubMagicMetadata;if(!t)return;let a="string"==typeof t.data?await R({encryptedDataB64:t.data,decryptionHeaderB64:t.header,keyB64:e.key}):t.data,n=G.parse(X(a));return t.data=n,n},X=e=>Object.fromEntries(Object.entries(e).filter(e=>{let[,t]=e;return null!=t})),Q=(e,t)=>{var a,n;return $(null!==(n=null!==(a=null==t?void 0:t.dateTime)&&void 0!==a?a:null==t?void 0:t.editedTime)&&void 0!==n?n:e.metadata.creationTime)},$=e=>{switch(typeof e){case"object":return new Date(e.dateTime);case"string":return new Date(e);case"number":return new Date(e/1e3)}},q=e=>{if(!e.metadata)return;let t=(0,V.Y)(e.metadata.latitude),a=(0,V.Y)(e.metadata.longitude);if(void 0!==t&&void 0!==a)return{latitude:t,longitude:a}},ee=e=>{if(e.pubMagicMetadata){if("string"==typeof e.pubMagicMetadata.data){if(O.lE)throw Error("Public magic metadata for ".concat(Y(e)," had not been decrypted even when the file reached the UI layer"));W(e)}return e.pubMagicMetadata.data}};var et=a(74473);let ea=async e=>new Response(new Blob([e]).stream().pipeThrough(new DecompressionStream("gzip"))).text(),en=d.z.object({id:d.z.string(),encryptedData:d.z.string().nullable(),header:d.z.string().nullable(),isDeleted:d.z.boolean(),updatedAt:d.z.number()}),er=async(e,t,a)=>{let n=(e,t)=>J({encryptedData:e,decryptionHeader:t},a),r=new URLSearchParams({type:e,sinceTime:t.toString(),limit:"500"}),i=await Z("/user-entity/entity/diff"),o=await fetch("".concat(i,"?").concat(r.toString()),{headers:await k()});return j(o),Promise.all(d.z.object({diff:d.z.array(en)}).parse(await o.json()).diff.map(async e=>{let{id:t,encryptedData:a,header:r,isDeleted:i,updatedAt:o}=e;return{id:t,data:i?void 0:await n((0,u.zx)(a),(0,u.zx)(r)),updatedAt:o}}))},ei=async e=>{let t=new URLSearchParams({type:e}),a=await Z("/user-entity/key"),n=await fetch("".concat(a,"?").concat(t.toString()),{headers:await k()});if(n.ok)return eo.parse(await n.json());if(404!=n.status)throw new T(n)},eo=d.z.object({encryptedKey:d.z.string(),header:d.z.string()}),ec=async(e,t)=>{let a=await Z("/user-entity/key");j(await fetch(a,{method:"POST",headers:await k(),body:JSON.stringify({type:e,...t})}))},el=e=>"entity/".concat(e),es=e=>"entity/".concat(e,"/key"),eu=e=>"entity/".concat(e,"/time"),ed=d.z.object({id:d.z.string(),data:d.z.object({}).passthrough(),updatedAt:d.z.number()}),ep=(e,t)=>v(el(e),t),ef=async e=>{var t;return ed.array().parse(null!==(t=await m(el(e)))&&void 0!==t?t:[])},eh=(e,t)=>v(es(e),t),ey=e=>m(es(e)).then(e=>e?eo.parse(e):void 0),em=(e,t)=>v(eu(e),t),ew=e=>b(eu(e)),eg=d.z.object({name:d.z.string(),radius:d.z.number(),centerPoint:d.z.object({latitude:d.z.number(),longitude:d.z.number()})}),eb=()=>ef("location").then(e=>e.map(e=>eg.parse(e.data))),ev=d.z.object({id:d.z.string(),faces:d.z.string().array()});d.z.object({name:d.z.string().nullish().transform(V.Y),assigned:d.z.array(ev),isHidden:d.z.boolean(),avatarFaceID:d.z.string().nullish().transform(V.Y)});let ez=async(e,t)=>{var a;let n=await eT(e,t),r=null!==(a=await ew(e))&&void 0!==a?a:0;for(;;){let t=await er(e,r,n);if(0==t.length)break;let a=new Map((await ef(e)).map(e=>[e.id,e]));for(let{id:n,data:i,updatedAt:o}of t){if(i){let t=ek(e)?await ea(i):new TextDecoder().decode(i);a.set(n,{id:n,data:JSON.parse(t),updatedAt:o})}else a.delete(n);r=Math.max(r,o)}await ep(e,[...a.values()]),await em(e,r)}},ek=e=>"cgroup"==e,eT=async(e,t)=>{let a=await ey(e);if(a)return eP(a,t);let n=await ei(e);if(n){let a=await eP(n,t);return await eh(e,n),a}let r=await ej(t),i=eP(r,t);return await ec(e,r),await eh(e,r),i},ej=async e=>{let{encryptedData:t,nonce:a}=await _(await A(),e);return{encryptedKey:t,header:a}},eP=async(e,t)=>U({encryptedData:e.encryptedKey,nonce:e.header},t);class eS{async sync(e){return Promise.all([ez("location",e).then(()=>eb()).then(e=>this.locationTags=e),eA().then(e=>this.cities=e)])}setCollectionsAndFiles(e){this.collectionsAndFiles=e}setPeople(e){this.people=e}suggestionsForString(e,t,a){return ex(e,RegExp("(\\b|_)"+e,"i"),t,this.collectionsAndFiles,this.people,a,this.locationTags,this.cities)}filterSearchableFiles(e){return eU(this.collectionsAndFiles.files,e)}filterSearchableFilesMulti(e){let t=this.collectionsAndFiles.files;return e.map(e=>[eU(t,e),e]).filter(e=>{let[t]=e;return t.length})}constructor(){this.locationTags=[],this.cities=[],this.collectionsAndFiles={collections:[],files:[]},this.people=[]}}(0,S.Jj)(eS);let ex=(e,t,a,n,r,i,o,c)=>{let{collections:l,files:s}=n,{locale:u,holidays:d,labelledFileTypes:p}=i;return[[eE(t,r)].flat(),[eO(t,p),eB(e,t,u,d),e_(t,o,c),eD(t,l),eF(e,t,a,s),eM(t,a,s)].flat()]},eD=(e,t)=>t.filter(t=>e.test(t.name)).map(e=>{let{id:t,name:a}=e;return{type:"collection",collectionID:t,label:a}}),eO=(e,t)=>t.filter(t=>{let{label:a}=t;return e.test(a)}).map(e=>{let{fileType:t,label:a}=e;return{type:"fileType",fileType:t,label:a}}),eF=(e,t,a,n)=>{let r=Number(e)||void 0,i=n.filter(e=>{let{id:a,metadata:n}=e;return a===r||t.test(n.title)}).map(e=>e.id);return i.length?[{type:"fileName",fileIDs:i,label:a}]:[]},eM=(e,t,a)=>{let n=a.filter(t=>{var a,n;let r=null===(n=t.pubMagicMetadata)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.caption;return r&&e.test(r)}).map(e=>e.id);return n.length?[{type:"fileCaption",fileIDs:n,label:t}]:[]},eE=(e,t)=>t.filter(t=>e.test(t.name)).map(e=>({type:"person",person:e.person,label:e.name})),eB=(e,t,a,n)=>eL(e,t,a,n).map(e=>{let{components:t,label:a}=e;return{type:"date",dateComponents:t,label:a}}),eL=(e,t,a,n)=>[eC(e,a),eI(e),n.filter(e=>t.test(e.label))].flat(),eC=(e,t)=>et.Qc(e).map(e=>{let a=e.start,n=e=>a.isCertain(e)?(0,V.Y)(a.get(e)):void 0,r=n("year"),i=n("month"),o=n("day"),c=n("weekday"),l=n("hour");if(!r&&!i&&!o&&!c&&!l)return;let s={};return r&&(s.year="numeric"),i&&(s.month="long"),o&&(s.day="numeric"),c&&(s.weekday="long"),l&&(s.hour="numeric",s.dayPeriod="short"),{components:{year:r,month:i,day:o,weekday:c,hour:l},label:new Intl.DateTimeFormat(t,s).format(a.date())}}).filter(e=>void 0!==e),eI=e=>{if(4==e.length){let t=parseInt(e);if(t&&t<=9999)return[{components:{year:t},label:e}]}return[]},eN=d.z.object({data:d.z.array(d.z.object({city:d.z.string(),lat:d.z.number(),lng:d.z.number()}))}),eA=async()=>{let e=await fetch("https://static.ente.io/world_cities.json");if(!e.ok)throw new T(e);return eN.parse(await e.json()).data.map(e=>{let{city:t,lat:a,lng:n}=e;return{name:t,latitude:a,longitude:n}})},e_=(e,t,a)=>{let n=t.filter(t=>e.test(t.name)),r=new Set(n.map(e=>e.name.toLowerCase())),i=a.filter(t=>e.test(t.name)).filter(e=>!r.has(e.name.toLowerCase()));return[n.map(e=>({type:"location",locationTag:e,label:e.name})),i.map(e=>({type:"city",city:e,label:e.name}))].flat()},eU=(e,t)=>eV(e.filter(e=>eJ(e,t)),t),eJ=(e,t)=>{switch(t.type){case"collection":return t.collectionID===e.collectionID;case"fileType":return t.fileType===e.metadata.fileType;case"fileName":case"fileCaption":return t.fileIDs.includes(e.id);case"date":return eR(t.dateComponents,Q(e,ee(e)));case"location":{let a=q(e);if(!a)return!1;return eK(a,t.locationTag)}case"city":{let a=q(e);if(!a)return!1;return eZ(a,t.city)}case"clip":return t.clipScoreForFileID.has(e.id);case"person":return t.person.fileIDs.includes(e.id)}},eR=(e,t)=>{let{year:a,month:n,day:r,weekday:i,hour:o}=e,c=!0;return a&&(c=t.getFullYear()==a),c&&n&&(c=t.getMonth()+1==n),c&&r&&(c=t.getDate()==r),c&&i&&(c=t.getDay()==i),c&&o&&(c=t.getHours()==o),c},eK=(e,t)=>eH(e,t.centerPoint,t.radius),eZ=(e,t)=>eH(e,t,10),eH=(e,t,a)=>{let n=a*eY(t.latitude)/111.16,r=a/111.16,i=t.latitude-e.latitude,o=t.longitude-e.longitude;return i*i/(n*n)+o*o/(r*r)<=1},eY=e=>1/Math.cos(Math.PI/180*e),eV=(e,t)=>{if("clip"!=t.type)return e;let a=e=>{let{id:a}=e;return(0,u.zx)(t.clipScoreForFileID.get(a))};return e.sort((e,t)=>a(t)-a(e))}},27949:function(e,t,a){}},c={};function l(e){var t=c[e];if(void 0!==t)return t.exports;var a=c[e]={exports:{}},n=!0;try{o[e].call(a.exports,a,a.exports,l),n=!1}finally{n&&delete c[e]}return a.exports}l.m=o,l.x=function(){var e=l.O(void 0,[2479,8934,7518,8742,4758,2473,545],function(){return l(93891)});return l.O(e)},e=[],l.O=function(t,a,n,r){if(a){r=r||0;for(var i=e.length;i>0&&e[i-1][2]>r;i--)e[i]=e[i-1];e[i]=[a,n,r];return}for(var o=1/0,i=0;i<e.length;i++){for(var a=e[i][0],n=e[i][1],r=e[i][2],c=!0,s=0;s<a.length;s++)o>=r&&Object.keys(l.O).every(function(e){return l.O[e](a[s])})?a.splice(s--,1):(c=!1,r<o&&(o=r));if(c){e.splice(i--,1);var u=n();void 0!==u&&(t=u)}}return t},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,{a:t}),t},l.d=function(e,t){for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.f={},l.e=function(e){return Promise.all(Object.keys(l.f).reduce(function(t,a){return l.f[a](e,t),t},[]))},l.u=function(e){return"static/chunks/"+(({2479:"27263495",8934:"e893f787"})[e]||e)+"."+({545:"0fff9ad4d9f35a4c",2473:"fe577c3d1e82a493",2479:"49ac711006241c06",4758:"0582ec61c7ed11c0",7518:"fbe1453a695955f1",8284:"2994441d9852c565",8354:"56430bedb5c11003",8742:"cc6d661f3d9979ee",8934:"a38e02114c19c9f5"})[e]+".js"},l.miniCssF=function(e){},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.tt=function(){return void 0===t&&(t={createScriptURL:function(e){return e}},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(t=trustedTypes.createPolicy("nextjs#bundler",t))),t},l.tu=function(e){return l.tt().createScriptURL(e)},l.p="/_next/",l.b=self.location+"/../../../",a={3891:1},l.f.i=function(e,t){a[e]||importScripts(l.tu(l.p+l.u(e)))},r=(n=self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push.bind(n),n.push=function(e){var t=e[0],n=e[1],i=e[2];for(var o in n)l.o(n,o)&&(l.m[o]=n[o]);for(i&&i(l);t.length;)a[t.pop()]=1;r(e)},i=l.x,l.x=function(){return Promise.all([2479,8934,7518,8742,4758,2473,545].map(l.e,l)).then(i)},_N_E=l.x()}();